{"id":"bd-10i","title":"FrankenTUI: Complete Implementation Epic","description":"# FrankenTUI (ftui) - Master Epic\n\n## Vision\nFrankenTUI is a deliberately minimal, high-performance terminal UI kernel that fuses the best surviving abstractions from three Rust codebases (rich_rust, charmed_rust, opentui_rust) into one coherent system.\n\n## Core Promise\nftui is designed so you can build a Claude Code / Codex-class agent harness UI without flicker, without cursor corruption, and without sacrificing native scrollback.\n\n## Three-Library Synthesis (conceptual)\n- opentui_rust: Cell grid, diff algorithm, alpha blending, scissor/opacity stacks, grapheme pool (cache-optimal 16-byte cells)\n- rich_rust: Segment abstraction, markup parser, measurement protocol (Cow<str> for zero-copy)\n- charmed_rust: LipGloss styling, CSS-like properties, theme system, Elm architecture (bitflags property tracking)\n\n## Non-Negotiables (Engineering Contract)\n1. One writer owns the terminal - serialized output\n2. Untrusted bytes never executed - sanitize by default\n3. Diffed + buffered UI only - no ad-hoc println\n4. Inline-first is real - preserve scrollback\n5. Safe by default, unsafe isolated (repo policy: unsafe forbidden)\n6. Deterministic by design\n7. Correctness continuously verified\n\n## Performance Budgets (v1)\n- Present (80x24, 5% changed): p50 < 1.0ms\n- Cell comparison: < 1ns\n- 16 bytes per cell (4 per cache line)\n\n## Success Criteria (v1 = Done)\n(Directly derived from plan Section 0.11.)\n\n- [ ] Inline mode default is stable (streaming logs + UI does not corrupt scrollback/cursor).\n- [ ] PTY tests confirm cleanup on normal exit and panic.\n- [ ] Presenter/diff correctness validated by terminal-model tests.\n- [ ] Unicode width correctness proven by corpus tests (ZWJ/emoji/combining).\n- [ ] Style system is deterministic and documented (explicit masks + inheritance).\n- [ ] Runtime supports update/view loop + ticks + batch/sequence cmds + deterministic simulator.\n- [ ] Harness-essential widgets exist and are tested (viewport/log viewer, status/panel, prompt/text input, progress/spinner).\n- [ ] Docs exist: agent harness tutorial, inline vs alt-screen trade-offs, one-writer rule guidance, windows limitations, compatibility matrix.","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-31T22:04:22.713361602Z","created_by":"ubuntu","updated_at":"2026-01-31T23:24:44.775656345Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-10i.1","title":"Phase -1: Decision Spikes","description":"# Phase -1: Decision Spikes\n\n## Purpose\nBefore building a big structure, run small spikes that de-risk the hardest unknowns. These are tiny experiments for fast learning.\n\n## Why This Phase Exists\nThe plan is ambitious and certain decisions could cause multi-week churn if not resolved early. Decision spikes force us to confront reality before committing to architecture.\n\n## Exit Criteria\nOne ADR (Architecture Decision Record) per spike capturing:\n- Context: What problem are we solving?\n- Decision: What did we choose?\n- Alternatives considered\n- Consequences: What are the tradeoffs?\n- Test plan: How we'll know it worked\n\n## Key Spikes Required\n1. Inline mode spike: Implement both scroll-region and overlay strategies in tiny prototype\n2. Presenter validation spike: Build terminal-model harness to validate output\n3. Backend spike: Validate raw mode + resize + input reading across platforms\n\n## Relationship to Other Phases\nThis phase BLOCKS Phase 0 (Contracts + Workspace Skeleton). We must not proceed with architecture until we've validated our assumptions through concrete experiments.\n\n## Success Criteria\n- [ ] Spikes are completed with runnable prototypes (even if throwaway) and notes.\n- [ ] ADR-001/002/003 are unblocked and written based on spike outcomes.\n- [ ] We have a clear go/no-go decision for:\n  - inline mode strategy baseline\n  - presenter emission baseline\n  - backend selection","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:04:34.363862676Z","created_by":"ubuntu","updated_at":"2026-01-31T23:24:55.666699497Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.1","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:04:34.363862676Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.1.1","title":"Spike: Inline Mode Strategies","description":"# Spike: Inline Mode Strategies\n\n## Objective\nImplement both scroll-region and overlay strategies in a tiny prototype. Verify behavior across terminal environments. Choose a default strategy and document fallback rules.\n\n## Background: Why Inline Mode is Hard\nInline mode + streaming logs is where most TUIs become flaky:\n- Logs write while UI is mid-draw\n- Cursor gets lost\n- Scrollback gets wiped by 'helpful' full clear\n- tmux/screen complicate cursor save/restore and margins\n\n## Strategy A: Scroll-Region Anchoring (DECSTBM)\nUse CSI t ; b r to set top/bottom margins:\n- Constrains scrolling to log region\n- UI region stays pinned while logs scroll above\n- Pros: fewer redraws, less cursor thrash\n- Cons: varies under tmux/screen, must reset on exit\n\n## Strategy B: Overlay Redraw (Universal Fallback)\nBefore writing logs:\n- Save cursor position\n- Clear/hide UI region\n- Write logs normally (enters scrollback)\n- Redraw UI region\n- Restore cursor\n- Pros: works nearly everywhere\n- Cons: more redraw work\n\n## Strategy C: Hybrid (Recommended Default)\n- Overlay redraw is always available as correctness baseline\n- Scroll-region anchoring is internal optimization when proven safe\n- Public API exposes policy, not mechanism\n\n## Test Environments\n1. Plain terminal (xterm, native macOS Terminal)\n2. Modern terminals (Kitty, WezTerm, Alacritty, Ghostty)\n3. tmux (most common mux)\n4. screen (legacy mux)\n\n## Deliverable\n- Tiny prototype (~200 LOC) that demonstrates both strategies\n- PTY test harness to verify behavior\n- ADR-001 document with decision and rationale\n\n## Success Criteria\n- Prototype shows no cursor drift under sustained log output\n- Strategy selection logic documented\n- tmux behavior characterized and fallback rules defined","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:07:24.429895270Z","created_by":"ubuntu","updated_at":"2026-01-31T22:07:24.429895270Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.1.1","depends_on_id":"bd-10i.1","type":"parent-child","created_at":"2026-01-31T22:07:24.429895270Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.1.2","title":"Spike: Presenter Validation with Terminal Model","description":"# Spike: Presenter Validation with Terminal Model\n\n## Objective\nBuild a terminal-model harness (subset of escape sequences) and validate that a present cycle produces expected grid + cursor behavior.\n\n## Why This Spike Matters\nThe Presenter is the translation layer between our internal model and the terminal. If it emits incorrect sequences:\n- Styles leak across cells\n- Cursor ends up in wrong position\n- Links remain open after they should close\n- Screen corruption under edge cases\n\nWe need a way to prove correctness without relying on visual inspection.\n\n## Terminal Model Approach\nBuild a minimal terminal emulator in Rust that:\n- Tracks a grid of cells (just like our Buffer)\n- Tracks cursor position\n- Tracks current SGR state (style)\n- Tracks current link state (OSC 8)\n- Parses and applies ANSI sequences\n\nThis is NOT a full terminal emulator - just enough to validate our output.\n\n## Sequences to Support in Model\n- CUP (cursor position): CSI r ; c H\n- SGR (style): CSI n ; n ; ... m\n- ED (erase display): CSI n J\n- EL (erase line): CSI n K\n- OSC 8 (hyperlinks): OSC 8 ; ; url ST\n- Sync output: CSI ? 2026 h/l\n\n## Test Approach\n1. Create a Buffer with known content\n2. Run through Presenter to get ANSI output\n3. Feed output through terminal model\n4. Assert model's grid matches our Buffer\n5. Assert cursor position is correct\n6. Assert no dangling style/link state\n\n## Deliverable\n- TerminalModel struct with grid, cursor, style tracking\n- Property tests: random Buffer -> Presenter -> Model -> assert equality\n- Foundation for ongoing correctness testing\n\n## Success Criteria\n- Model correctly interprets all Presenter output\n- Property tests find no discrepancies\n- Framework ready for use in CI","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:07:38.682217640Z","created_by":"ubuntu","updated_at":"2026-01-31T22:07:38.682217640Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.1.2","depends_on_id":"bd-10i.1","type":"parent-child","created_at":"2026-01-31T22:07:38.682217640Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.1.3","title":"Spike: Terminal Backend Validation","description":"# Spike: Terminal Backend Validation\n\n## Objective\nValidate raw mode + resize + input reading across platforms with candidate backend (Crossterm). Confirm it meets our needs or identify gaps.\n\n## Why This Spike Matters\nThe terminal backend is foundational:\n- Raw mode enter/exit must be reliable\n- Resize events must be delivered correctly\n- Input parsing must work with our Event types\n- Cleanup on panic must work\n\nIf we choose wrong, we'll be fighting the backend throughout development.\n\n## Crossterm Evaluation Criteria\n\n### Functionality\n- [ ] Raw mode enter/exit\n- [ ] Resize event delivery\n- [ ] Key event parsing (standard + extended)\n- [ ] Mouse event parsing (SGR mode)\n- [ ] Bracketed paste handling\n- [ ] Focus events\n\n### Platform Coverage\n- [ ] Linux (primary)\n- [ ] macOS\n- [ ] Windows (basic support acceptable)\n\n### Panic Recovery\n- [ ] Can we hook into panic for cleanup?\n- [ ] Does Drop work reliably?\n\n### API Ergonomics\n- [ ] Can we hide Crossterm behind our abstractions?\n- [ ] Does it fit our Event model?\n\n## Alternative Backends to Consider\n- termion: Unix-only but simpler\n- raw custom termios: maximum control but more work\n- termwiz: another option worth evaluating\n\n## Test Approach\n1. Build minimal wrapper around Crossterm\n2. Test on Linux, macOS, Windows\n3. Verify resize delivery under window resize\n4. Verify panic cleanup with forced panic\n5. Verify mouse + keyboard input parsing\n\n## Deliverable\n- Evaluation document with findings\n- Minimal TerminalBackend trait design\n- ADR-003 decision with rationale\n\n## Success Criteria\n- Confident choice of backend for v1\n- Known limitations documented\n- Path to alternative backends if needed","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:07:51.564188110Z","created_by":"ubuntu","updated_at":"2026-01-31T22:07:51.564188110Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.1.3","depends_on_id":"bd-10i.1","type":"parent-child","created_at":"2026-01-31T22:07:51.564188110Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10","title":"ADRs: Architecture Decision Records","description":"# ADRs: Architecture Decision Records\n\n## Purpose\nLock the 'churn-magnets' - decisions that most often cause multi-week churn if not resolved early. Each ADR follows the format:\n- Context\n- Decision\n- Alternatives considered\n- Consequences\n- Test plan\n\n## Why ADRs Matter\nThese are not bureaucratic paperwork. They are the decisions that:\n- Could cause weeks of refactoring if changed later\n- Have non-obvious tradeoffs\n- Need documented rationale for future contributors\n- Serve as the 'why' behind the code\n\n## ADRs Required for v1\n\n### ADR-001: Inline Mode Strategy\nHybrid anchoring: overlay redraw baseline + scroll-region optimization\n- Most impactful decision for agent harness behavior\n\n### ADR-002: Presenter Emission Strategy\nReset+apply for v1 correctness; incremental behind feature flag\n- Affects output size and correctness guarantees\n\n### ADR-003: Terminal Backend Selection\nCrossterm as v1 default\n- Affects portability and maintenance burden\n\n### ADR-004: Windows v1 Scope\nWhat's supported vs best-effort\n- Sets user expectations and testing requirements\n\n### ADR-005: One-Writer Rule Enforcement\nType-level ownership model\n- Core correctness invariant for inline mode\n\n### ADR-006: Untrusted Output Policy\nSanitize-by-default for security\n- Prevents escape sequence injection attacks\n\n## ADR Discipline Rules\n- Every controversial design choice gets an ADR\n- ADRs are short and opinionated\n- Once written and reviewed, ADRs are locked\n- Changes require new ADR or amendment with rationale\n\n## Success Criteria\n- [ ] ADR-001..ADR-006 are each written with: Context / Decision / Alternatives / Consequences / Test Plan.\n- [ ] Each ADR includes explicit stop-ship tests (PTY/terminal-model/property tests as appropriate).\n- [ ] Any future changes to a locked decision require a new ADR (no silent drift).","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-31T22:06:50.475979143Z","created_by":"ubuntu","updated_at":"2026-01-31T23:24:29.339053736Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:06:50.475979143Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.1","title":"ADR-001: Inline Mode Strategy","description":"# ADR-001: Inline Mode Strategy\n\n## Status\nPROPOSED\n\n## Context\nWe need stable UI chrome + scrollback-native logs, with no flicker or cursor corruption, across terminals and multiplexers.\n\nInline mode plus streaming output is the hardest real-world requirement. Most flicker/corruption bugs come from broken assumptions about terminal ownership and write interleaving.\n\n## Options Considered\n\n### Option A: Scroll-Region Anchoring (DECSTBM)\n- Pros: UI truly pinned, logs scroll naturally, fewer UI redraws\n- Cons: Tricky interactions (cursor save/restore, origin mode), mux quirks, needs serious PTY coverage\n\n### Option B: Overlay Redraw\n- Pros: Portable baseline, correctness-first, simplest mental model\n- Cons: Needs careful 'clear only UI region', buffered output to avoid flicker\n\n### Option C: Hybrid (RECOMMENDED)\n- Pros: Best of both; baseline works everywhere, optimization where safe\n- Cons: Complexity; requires capability policy and more tests\n\n## Decision\n**Hybrid approach**:\n1. Overlay redraw is always available and is the correctness baseline\n2. Scroll-region anchoring is an internal optimization enabled only when proven safe\n3. Public API exposes policy, not mechanism\n\n## Implementation Notes (Baseline Overlay)\n1. Begin synchronized output if supported\n2. Save cursor position (prefer robust option)\n3. Move cursor to UI anchor\n4. Clear only the UI region (localized EL/ED)\n5. Present diffed UI frame\n6. Restore cursor position\n7. End synchronized output; flush\n\n## Implementation Notes (Scroll-Region Optimization)\nWhen enabled:\n- Set scroll region to log area: top..(h-ui_height)\n- Ensure UI writes land outside scroll region\n- Restore scroll region on exit and mode switches\n- Disable by default in tmux/screen\n\n## Consequences\n- More complex than pure overlay or pure scroll-region\n- Requires capability detection and policy logic\n- Requires PTY tests for both strategies\n- Better user experience when optimization is safe\n\n## Test Plan\n- PTY test: log spam + UI tick does not corrupt scrollback\n- Cursor contract test: cursor restored after every present\n- Resize test: changing ui_height and terminal height re-anchors correctly\n- Mux tests: verify tmux/screen behavior and fallback","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T22:08:10.132311732Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:35.588316533Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.1","depends_on_id":"bd-10i.1.1","type":"blocks","created_at":"2026-01-31T22:21:35.588286787Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.10.1","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:08:10.132311732Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.2","title":"ADR-002: Presenter Emission Strategy","description":"# ADR-002: Presenter Emission Strategy\n\n## Status\nPROPOSED\n\n## Context\nSGR and link state tracking can either be simple and correct or minimal-bytes and complex. The Presenter must emit ANSI sequences that transform the terminal from current state to desired state.\n\n## Options Considered\n\n### Option A: Reset+Apply Always\nEmit SGR 0 then re-apply all attributes for each style change.\n- Pros: Simplest, correctness is trivial\n- Cons: More bytes emitted\n\n### Option B: Incremental SGR Diffs\nTrack previous style, emit only changed attributes.\n- Pros: Fewer bytes, faster on slow terminals\n- Cons: Complex, risk of 'dangling attributes' bugs\n\n### Option C: Hybrid (RECOMMENDED for future)\nReset on hard cases, incremental on small diffs.\n- Pros: Best of both\n- Cons: Needs heuristics and benchmarks\n\n## Decision\n**v1 default: Reset+Apply** for correctness.\n**Add incremental/hybrid behind feature flag** until benchmarks + PTY coverage justify enabling by default.\n\n## Rationale\nCorrectness beats optimization at this stage. Reset+apply is:\n- Trivially correct\n- Easy to test and verify\n- Good enough for most workloads\n- Foundation for future optimization\n\nIncremental emission can be added later when:\n- We have comprehensive terminal-model tests\n- Benchmarks show meaningful benefit\n- PTY tests cover edge cases\n\n## Consequences\n- Higher byte output than theoretically minimal\n- Simpler implementation and maintenance\n- Clear path to optimization via feature flag\n- No 'dangling attribute' bugs possible\n\n## Test Plan\n- Terminal-model tests: style state cannot leak across runs\n- PTY tests: links (OSC 8) cannot remain open after present/exit\n- Benchmark: measure bytes/frame for representative workloads\n- Regression: track byte output in CI","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T22:08:24.426412320Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:35.878559287Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.2","depends_on_id":"bd-10i.1.2","type":"blocks","created_at":"2026-01-31T22:21:35.878528890Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.10.2","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:08:24.426412320Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.3","title":"ADR-003: Terminal Backend Selection","description":"# ADR-003: Terminal Backend Selection\n\n## Status\nPROPOSED\n\n## Context\nWe must support raw mode, key/mouse input, resize, and reliable cleanup on Unix and Windows.\n\n## Options Considered\n\n### Option A: Crossterm\n- Pros: Widely used, cross-platform, avoids bespoke termios/Windows plumbing\n- Cons: Another dependency, abstractions may not fit perfectly\n\n### Option B: termion\n- Pros: Pure Rust, simpler\n- Cons: Unix-only, no Windows support\n\n### Option C: Raw termios + Windows Console API\n- Pros: Maximum control\n- Cons: Significant implementation effort, platform-specific code\n\n### Option D: termwiz\n- Pros: Feature-rich, from wezterm project\n- Cons: Heavier dependency, may include more than we need\n\n## Decision\n**v1 default: Crossterm**\n\nKernel remains backend-agnostic at the conceptual level, but v1 does NOT over-abstract. Ship one backend 'batteries included'; treat alternatives as experimental.\n\n## Rationale\n- Crossterm is widely used and tested\n- Cross-platform without custom code\n- Fits our Event model reasonably well\n- Community support and maintenance\n- We can switch later if needed (abstraction in place)\n\n## Consequences\n- Dependency on crossterm crate\n- Must work within crossterm's event model\n- Windows support comes 'for free' (with caveats)\n- Path to alternatives via feature flags\n\n## Test Plan\n- Spike validates Crossterm functionality (bd-10i.1.3)\n- PTY tests verify raw mode + cleanup\n- Multi-platform CI (Linux, macOS, Windows)\n- Document any Crossterm limitations in Windows ADR","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T22:08:38.701607178Z","created_by":"ubuntu","updated_at":"2026-01-31T23:14:45.713690490Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.3","depends_on_id":"bd-10i.1","type":"blocks","created_at":"2026-01-31T23:14:45.713641407Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.10.3","depends_on_id":"bd-10i.1.3","type":"blocks","created_at":"2026-01-31T22:21:36.119868797Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.10.3","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:08:38.701607178Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.4","title":"ADR-004: Windows v1 Scope","description":"# ADR-004: Windows v1 Scope\n\n## Status\nPROPOSED\n\n## Context\nWindows terminal support varies significantly from Unix. We need to decide what's fully supported vs best-effort for v1.\n\n## Supported in v1\n- Raw mode enter/exit and cleanup on panic\n- Key input and resize events\n- Basic mouse (where Crossterm supports it)\n- Color where available (16/256/truecolor when exposed)\n\n## Best-Effort / May Be Missing in v1\n- DEC synchronized output (mode 2026) - not widely supported\n- OSC 8 hyperlinks - limited Windows Terminal support\n- Bracketed paste differences across terminals\n- Focus events differences\n- Kitty keyboard protocol - not supported\n\n## Decision\nAccept Windows as 'supported with documented limitations' for v1.\n\n## Rationale\n- Primary target is agent harness UIs (likely Unix/macOS)\n- Windows Terminal is improving but not at feature parity\n- Full Windows feature parity would delay v1 significantly\n- Honest documentation is better than broken promises\n\n## Consequences\n- Windows users may have reduced functionality\n- Must clearly document limitations\n- Future versions can improve Windows support\n- CI must include Windows builds (even if tests are limited)\n\n## Documentation Requirement\nA 'Windows Limitations' section must exist and be honest about:\n- Which features work fully\n- Which features are degraded\n- Which features are missing\n- Workarounds if any\n\n## Test Plan\n- Windows CI build must pass\n- Core functionality tests on Windows (raw mode, basic input)\n- Document behavior differences","status":"open","priority":1,"issue_type":"docs","created_at":"2026-01-31T22:08:51.697779300Z","created_by":"ubuntu","updated_at":"2026-01-31T22:08:51.697779300Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.4","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:08:51.697779300Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.5","title":"ADR-005: One-Writer Rule Enforcement","description":"# ADR-005: One-Writer Rule Enforcement\n\n## Status\nPROPOSED\n\n## Context\nInline mode guarantees break if other code writes to stdout/stderr concurrently. The terminal is a shared mutable resource that doesn't support concurrent access safely.\n\n## Problem\nIf multiple sources write to the terminal simultaneously:\n- Cursor position becomes undefined\n- Partial escape sequences corrupt output\n- UI and logs interleave unpredictably\n- Scrollback gets corrupted\n\n## Decision\nEnforce the one-writer rule through type-level ownership:\n- TerminalOwner / TerminalSession owns raw mode and output handle\n- TerminalWriter is the only way to write logs and present UI\n- Provide routing helpers for subprocess and in-process logs\n\n## Type-Level Enforcement\nTerminalSession takes ownership of stdout:\n- Only TerminalWriter can produce output\n- Cannot accidentally println! while ftui is active\n- Drop returns terminal to normal state\n\n## Supported Routing Patterns\n\n### Pattern A: LogSink (In-Process Logs)\nProvide a LogSink: Write that application code uses instead of println!\n- Discourage raw println! during inline mode\n- Route through TerminalWriter with sanitization\n\n### Pattern B: PTY Capture (Subprocess Output)\nSpawn tool subprocesses under PTY:\n- Read their stdout/stderr streams\n- Write as log stream through ftui\n- Preserves scrollback and UI stability\n- Feature-gated (adds dependency on PTY crate)\n\n### Pattern C: Stdio Capture (Optional)\nPipe + reader thread that forwards through ftui:\n- Captures accidental println! from libraries\n- Best-effort, may miss some output\n- Feature-gated\n\n## Consequences\n- Application code must use ftui APIs for output\n- Libraries that write directly may cause issues\n- Subprocess output requires explicit handling\n- More disciplined but more work for users\n\n## What Happens If Violated\nIf external code writes to stdout during inline mode:\n- Behavior is undefined\n- Cursor may drift\n- UI may corrupt\n- This is documented as unsupported\n\n## Test Plan\n- PTY tests with concurrent log writes via supported mux path\n- Assert stability under parallel output\n- Document undefined behavior for unsupported patterns","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T22:09:09.275630145Z","created_by":"ubuntu","updated_at":"2026-01-31T22:09:09.275630145Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.5","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:09:09.275630145Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.10.6","title":"ADR-006: Untrusted Output Policy (Sanitize-by-Default)","description":"# ADR-006: Untrusted Output Policy (Sanitize-by-Default)\n\n## Status\nPROPOSED\n\n## Context\nAgent harnesses display tool output, LLM streams, and logs. Malicious or buggy content can smuggle ANSI/OSC sequences that:\n- Manipulate terminal state\n- Deceive users (fake prompts, hidden commands)\n- Persist changes after the app exits\n- Exfiltrate data via terminal queries\n\nThis is a real security concern for AI agent UIs.\n\n## Decision\n**Sanitize by default**: Any text flowing through write_log() or rendered as user-provided content has control sequences stripped or escaped.\n\n**Explicit opt-in for raw passthrough**: An API like write_raw() or Text::raw() allows trusted content to include ANSI.\n\n## What Gets Sanitized\n- ESC (0x1B) and all CSI/OSC/DCS/APC sequences\n- C0 controls except: TAB (0x09), LF (0x0A), CR (0x0D)\n- Option for semi-trusted mode: allow SGR styling only\n\n## Sanitization Strategies\n1. **Strip**: Remove escape sequences entirely\n2. **Escape**: Convert to visible representation (e.g., ^[ for ESC)\n3. **Replace**: Substitute with placeholder character\n\nDefault: Strip (cleanest output)\n\n## API Design\n// Sanitized by default\nharness.write_log('User provided text with \\x1b[31mattack\\x1b[0m');\n// -> 'User provided text with attack'\n\n// Explicit opt-in for trusted content\nharness.write_raw(trusted_ansi_bytes);\n\n// Text with explicit trust level\nText::sanitized(user_input);\nText::raw(trusted_source);\n\n## Consequences\n- User content is safe by default\n- Trusted content must be explicitly marked\n- Some legitimate ANSI in logs will be stripped\n- Security posture matches threat model\n\n## Test Plan\n- PTY tests feeding adversarial sequences into logs\n- Assert terminal invariants remain intact\n- Fuzz tests with random byte streams in log paths\n- Verify no state leakage after malicious input","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T22:09:25.501690222Z","created_by":"ubuntu","updated_at":"2026-01-31T22:09:25.501690222Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.10.6","depends_on_id":"bd-10i.10","type":"parent-child","created_at":"2026-01-31T22:09:25.501690222Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.11","title":"Testing + QA: Verification Suite","description":"# Testing + QA: Verification Suite\n\n## Purpose\nKernel must be 'boringly correct'. Testing is not optional - it's how we prove our claims and prevent regressions.\n\n## Test Categories\n\n### Unit Tests (Kernel)\n- Cell packing/equality\n- Buffer bounds + scissor/opacity invariants\n- GraphemePool refcount correctness\n- LinkRegistry correctness\n- Width measurement accuracy\n\n### Property Tests (Randomized)\n- Diff correctness: applying changes reproduces target buffer\n- Presenter state tracking never emits malformed sequences\n- Width correctness: rendering never writes beyond frame bounds\n\n### Snapshot Tests (Widgets/Apps)\n- Frame buffers across themes and widths\n- Segment streams for export pipelines\n- Deterministic outputs in simulator mode\n\n### PTY Integration Tests (Terminal Reality)\nSpawn a PTY, run minimal ftui app, capture output, assert:\n- Cursor restored after each present() in Inline mode\n- Raw mode restored on exit\n- Cursor visibility restored (show cursor)\n- Bracketed paste/mouse modes disabled on exit\n- Alt screen exited on exit\n\nTest scenarios:\n- Normal exit\n- Panic during render\n- IO error mid-write\n\n### Fuzzing (Input Parser)\n- Random byte streams\n- No panics\n- Sequence length limits enforced\n- Linear time for worst-case inputs\n\n### Terminal-Model Tests\nValidate presenter output by:\n- Building a terminal emulator model (subset of sequences)\n- Running presenter output through model\n- Asserting resulting grid + cursor state matches expected\n\n## Quality Gates (Stop-Ship)\n1. Inline mode stability - no cursor corruption\n2. Diff/presenter correctness - terminal-model passes\n3. Unicode width correctness - ZWJ/emoji corpus passes\n4. Terminal cleanup - PTY tests verify panic cleanup\n\n## CI Enforcement\n- clippy + fmt\n- All test categories run\n- Performance benchmarks tracked (non-blocking initially)\n- Feature matrix: default, +extras\n\n## Success Criteria\n- [ ] All stop-ship gates are enforced by automated tests.\n- [ ] A contributor can reproduce failures locally with clear logs/artifacts.\n- [ ] PTY + terminal-model coverage prevents cursor corruption regressions.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:07:07.502368766Z","created_by":"ubuntu","updated_at":"2026-01-31T23:27:18.513550331Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.11","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:07:07.502368766Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.11","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T22:21:29.525092512Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.11.1","title":"Build terminal-model test harness","description":"# Build terminal-model test harness\n\n## Objective\nCreate a minimal terminal emulator model for validating Presenter output without relying on actual terminals.\n\n## Why Terminal-Model Testing?\n- PTY tests are slow and flaky\n- Need to verify correctness deterministically\n- Can property-test with random buffers\n- Catches subtle sequence ordering issues\n\n## Terminal Model Scope (Minimal)\nSupport only the sequences Presenter emits:\n- CUP: cursor position (CSI r;c H)\n- SGR: style (CSI n;n;...m)\n- ED: erase display (CSI J) - basic\n- EL: erase line (CSI K) - basic\n- OSC 8: hyperlinks\n- Character output (UTF-8)\n\nNOT supporting (out of scope):\n- Full VT100/xterm emulation\n- Scrolling, tabs, alternate charset\n- DCS, APC sequences\n\n## Structure\npub struct TerminalModel {\n    width: u16,\n    height: u16,\n    cells: Vec<ModelCell>,\n    cursor_x: u16,\n    cursor_y: u16,\n    current_style: ModelStyle,\n    current_link: Option<String>,\n}\n\nstruct ModelCell {\n    content: String,  // Grapheme\n    style: ModelStyle,\n    link: Option<String>,\n}\n\nstruct ModelStyle {\n    fg: Option<(u8, u8, u8)>,\n    bg: Option<(u8, u8, u8)>,\n    bold: bool,\n    italic: bool,\n    underline: bool,\n    // ... other attrs\n}\n\n## Sequence Parser\npub fn apply_output(&mut self, bytes: &[u8]) -> Result<(), ParseError>\n\nParse byte stream, apply to model:\n1. Detect escape sequences\n2. Parse parameters\n3. Apply to grid/cursor/style\n\n## Comparison with Buffer\npub fn matches(&self, buffer: &Buffer, pool: &GraphemePool) -> bool\n\nCompare model grid with ftui Buffer:\n- Check each cell content matches\n- Check styles match (with tolerance for default)\n- Check links match\n\n## Test Pattern\n1. Create Buffer with known content\n2. Run through Presenter -> bytes\n3. Apply bytes to fresh TerminalModel\n4. Assert model.matches(buffer)\n\n## Property Testing\nproptest! {\n    fn presenter_roundtrip(buffer: Buffer) {\n        let mut model = TerminalModel::new(buffer.width(), buffer.height());\n        let bytes = present_to_bytes(&buffer);\n        model.apply_output(&bytes).unwrap();\n        assert!(model.matches(&buffer));\n    }\n}\n\n## Tests Required\n- [ ] CUP positions cursor correctly\n- [ ] SGR sets style attributes\n- [ ] Character output advances cursor\n- [ ] Wide chars handled correctly\n- [ ] OSC 8 links tracked\n- [ ] Complete roundtrip works\n\n## Acceptance Criteria\n- [ ] Property tests pass with random buffers\n- [ ] No false positives (model matches bad output)\n- [ ] Clear error messages on mismatch","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:15:13.041157455Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:44.712002706Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.11.1","depends_on_id":"bd-10i.11","type":"parent-child","created_at":"2026-01-31T22:15:13.041157455Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.11.1","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:22:44.711973170Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.11.2","title":"Create PTY test framework (ftui-pty)","description":"# Create PTY test framework (ftui-pty)\n\n## Objective\nBuild a test utility crate for running ftui apps in a PTY and validating terminal behavior.\n\n## Why PTY Tests?\n- Verify real terminal behavior\n- Test cleanup on panic\n- Test cursor restoration\n- Validate inline mode\n- Catch issues terminal-model can't\n\n## PTY Test Capabilities\n\n### Spawn App in PTY\npub fn spawn_app<F>(f: F) -> PtySession\nwhere F: FnOnce(&mut TerminalSession) -> io::Result<()>\n\n- Fork process\n- Set up PTY pair\n- Run closure in child\n- Capture output in parent\n\n### Capture Terminal Output\nimpl PtySession {\n    fn read_output(&mut self) -> Vec<u8>;\n    fn read_until(&mut self, pattern: &[u8], timeout: Duration) -> Result<Vec<u8>>;\n    fn send_input(&mut self, bytes: &[u8]);\n    fn wait(&mut self) -> ExitStatus;\n}\n\n### Assert Terminal State\nAfter app exits, verify terminal is restored:\npub fn assert_terminal_restored(output: &[u8]) {\n    // Check for:\n    // - SGR 0 (reset style)\n    // - CSI ? 25 h (show cursor)\n    // - CSI ? 1049 l (exit alt screen) if was used\n    // - CSI ? 1000 l (disable mouse) if was enabled\n    // - CSI ? 2004 l (disable bracketed paste) if was enabled\n}\n\n### Test Panic Cleanup\n#[test]\nfn panic_cleanup() {\n    let session = spawn_app(|term| {\n        term.enter_raw_mode()?;\n        term.enable_mouse()?;\n        panic\\!('deliberate panic');\n    });\n\n    let output = session.read_output();\n    assert_terminal_restored(&output);\n}\n\n## Inline Mode Tests\n\n### Test Cursor Contract\n#[test]\nfn inline_cursor_restored() {\n    let session = spawn_app(|term| {\n        let harness = AgentHarness::new(ScreenMode::Inline { ui_height: 3 });\n        // Write logs and present UI multiple times\n        for _ in 0..100 {\n            harness.write_log('log line\\n')?;\n            harness.present()?;\n        }\n        // Cursor should be at consistent position\n        Ok(())\n    });\n\n    // Verify no cursor drift in output\n    assert_cursor_stable(&session.output);\n}\n\n### Test Scrollback Preservation\n#[test]\nfn inline_scrollback_preserved() {\n    // Verify scrollback content not corrupted\n    // by inline mode rendering\n}\n\n## Platform Considerations\n- Use nix crate for Unix PTY\n- Windows: may need ConPTY or skip tests\n- CI: ensure PTY available (not all containers have it)\n\n## Tests Required\n- [ ] spawn_app works on Linux/macOS\n- [ ] Normal exit restores terminal\n- [ ] Panic exit restores terminal\n- [ ] Inline mode cursor contract\n- [ ] Alt screen enter/exit\n- [ ] Mouse mode cleanup\n\n## Acceptance Criteria\n- [ ] Framework usable in other test modules\n- [ ] CI can run PTY tests\n- [ ] Cleanup verified for all exit paths","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:15:31.768264464Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:45.226382715Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.11.2","depends_on_id":"bd-10i.11","type":"parent-child","created_at":"2026-01-31T22:15:31.768264464Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.11.2","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T22:22:44.982133948Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.11.2","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T22:22:45.226347218Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.11.3","title":"Implement input parser fuzzing","description":"# Implement input parser fuzzing\n\n## Objective\nFuzz the InputParser to ensure it handles all possible byte sequences without panicking or excessive resource usage.\n\n## Why Fuzzing?\n- Terminal input is untrusted\n- Malformed sequences are common\n- DoS via crafted input is possible\n- Parser must be robust\n\n## Fuzz Targets\n\n### Target 1: Raw Byte Parsing\nfuzz_target\\!(|data: &[u8]| {\n    let mut parser = InputParser::new();\n    let _ = parser.parse(data);\n    // Must not panic\n    // Must not hang\n    // Must not exceed memory limits\n});\n\n### Target 2: Structured Fuzzing\n// Generate semi-valid sequences\n#[derive(Arbitrary)]\nenum FuzzSequence {\n    Char(u8),\n    Escape,\n    Csi(Vec<u8>),\n    Osc(Vec<u8>),\n    Mouse { button: u8, x: u16, y: u16 },\n    Paste(Vec<u8>),\n}\n\n### Target 3: Long Sequences\n// Specifically test DoS limits\nfuzz_target\\!(|len: u16| {\n    let data = vec\\![0x1b, b'[']  // CSI\n        .into_iter()\n        .chain(std::iter::repeat(b'0').take(len as usize))\n        .chain(std::iter::once(b'm'))\n        .collect::<Vec<_>>();\n\n    let mut parser = InputParser::new();\n    let _ = parser.parse(&data);\n    // Should not allocate unbounded memory\n});\n\n## Properties to Verify\n1. No panics on any input\n2. Memory bounded (no OOM from crafted input)\n3. Time bounded (no quadratic behavior)\n4. Always returns to Ground state eventually\n5. DoS limits enforced\n\n## Corpus Seeds\n- Valid key sequences\n- Valid mouse sequences\n- Bracketed paste boundaries\n- OSC 8 links\n- Malformed UTF-8\n- Truncated sequences\n\n## Running Fuzzer\ncargo +nightly fuzz run input_parser -- -max_len=4096\n\n## Integration with CI\n- Run fuzzer for limited time on each PR\n- Maintain corpus in repo\n- Report new crashes immediately\n\n## Tests Required\n- [ ] Fuzz harness builds\n- [ ] Initial corpus covers major cases\n- [ ] No crashes in 1-hour fuzz session\n- [ ] Memory limits enforced\n\n## Acceptance Criteria\n- [ ] Fuzzer integrated in CI\n- [ ] No panics found\n- [ ] Corpus maintained\n- [ ] Coverage tracked","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:15:47.811194117Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:45.486723842Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.11.3","depends_on_id":"bd-10i.11","type":"parent-child","created_at":"2026-01-31T22:15:47.811194117Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.11.3","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:22:45.486693585Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12","title":"Docs: Playbook, Glossary, References","description":"# Docs: Playbook, Glossary, References\n\n## Purpose\nEncode the *non-code* parts of PLAN_TO_CREATE_FRANKENTUI__OPUS.md into durable, discoverable docs so future work does **not** require rereading the plan document.\n\nThis epic is about:\n- capturing the project's intent, constraints, and invariants\n- preventing churn (ADRs + playbook)\n- making the library *pleasant to adopt* (tutorials + examples)\n\n## Scope (v1)\n- Operational Playbook (Chapter 17)\n- Terminal Compatibility Matrix (Chapter 16)\n- Glossary (Appendix B)\n- Risk Register (Appendix C)\n- ANSI Reference extraction (Appendix A)\n- Migration map / \"what we kept\" from the three libraries (Chapter 14 + 1.5)\n- Public API docs + examples (Section 0.8)\n\n## Non-goals\n- Duplicating ADRs here (ADRs remain in bd-10i.10)\n- Writing long-form tutorials before the kernel is stable\n\n## Success Criteria\n- [ ] Every doc deliverable in PLAN_TO_CREATE_FRANKENTUI__OPUS.md (Chapter 16/17 + Appendices A/B/C + Chapter 14) has a corresponding issue with acceptance criteria and test hooks where applicable.\n- [ ] Docs are written with enough context that a contributor can implement features without reopening the original plan.\n- [ ] Docs include explicit \"undefined behavior\" and \"out of scope\" notes where the plan is opinionated (one-writer rule, inline mode, sanitize-by-default).","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T23:07:35.746628357Z","created_by":"ubuntu","updated_at":"2026-01-31T23:14:45.174558275Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T23:07:35.746628357Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.12","depends_on_id":"bd-10i.10","type":"blocks","created_at":"2026-01-31T23:14:45.174515294Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.1","title":"Write Operational Playbook (Chapter 17)","description":"# Write Operational Playbook (Chapter 17)\n\n## Background\nChapter 17 exists to prevent the common failure mode of kernel projects: infinite refinement without a stable deliverable.\n\nThe playbook is part technical, part process:\n- which PRs require which test gates\n- how ADRs are written and frozen\n- the recommended shipping order (avoid the widget trap)\n- what \"agent-ergonomic\" means in concrete UX terms\n\n## Deliverable\nCreate a durable doc (e.g. `docs/operational-playbook.md`) that captures:\n\n### Merge-gate rules (from 17.1)\n- Any change touching: inline mode cursor policy, presenter output sequencing, input parser, width measurement\n  must include appropriate tests (unit/property/pty/snapshot) and must cite which invariants are preserved.\n\n### ADR discipline (from 17.2)\n- ADR template (Context / Decision / Alternatives / Consequences / Test Plan)\n- Rules for when an ADR is required\n\n### Minimal deliverables order (from 17.3)\n1) Kernel (buffer/diff/presenter + terminal session + inline stability)\n2) Runtime (update/view + simulator + snapshot)\n3) Harness (reference app proving inline/log/UI)\n4) Widgets (only harness essentials)\n5) Extras (feature-gated)\n\n### Agent-ergonomic checklist (from 17.4)\n- Hello world harness in <200 LOC\n- Tool output streaming is one function call\n- Pinned bottom UI is one config option\n- Temporary full-screen modal supported\n\n### Immediate Next Steps checklist (from 17.5)\nConvert the listed \"first PRs\" into checkboxes and link them to the relevant Beads tasks.\n\n## Acceptance Criteria\n- [ ] Doc exists with the sections above.\n- [ ] Doc explicitly ties each rule to a reason (cursor safety, one-writer, determinism).\n- [ ] Doc links to the relevant ADR issues and test-suite epics.\n- [ ] Doc includes an \"Out of scope\" section to prevent accidental widget creep.","status":"open","priority":1,"issue_type":"docs","created_at":"2026-01-31T23:07:50.447594010Z","created_by":"ubuntu","updated_at":"2026-01-31T23:07:50.447594010Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.1","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:07:50.447594010Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.2","title":"Write Glossary (Appendix B)","description":"# Write Glossary (Appendix B)\n\n## Background\nThe plan includes a short glossary of terms that recur throughout the kernel design. This needs to be in-repo so future contributors don't need the plan doc to understand terminology.\n\n## Deliverable\nCreate `docs/glossary.md` containing (at minimum) the glossary table below, plus any additional terms introduced by implementation.\n\n| Term | Definition |\n|------|------------|\n| **Cell** | Single grid position (content + fg + bg + attrs) |\n| **Buffer** | 2D array of Cells representing display state |\n| **Frame** | Buffer + metadata for a render pass |\n| **Diff** | Set of (x, y) positions that changed between buffers |\n| **Presenter** | State-tracked ANSI emitter |\n| **Grapheme** | User-perceived character (may be multiple codepoints) |\n| **GraphemePool** | Interned storage for complex grapheme clusters |\n| **LinkRegistry** | URL storage for OSC 8 hyperlinks |\n| **Scissor** | Clipping rectangle for rendering |\n| **SGR** | Select Graphic Rendition (style codes) |\n| **OSC** | Operating System Command (escape sequence) |\n| **CSI** | Control Sequence Introducer (`\\x1b[`) |\n| **DEC** | Digital Equipment Corporation (terminal standard) |\n| **ZWJ** | Zero Width Joiner (connects graphemes into compound) |\n| **Porter-Duff** | Compositing algebra for alpha blending |\n\n## Acceptance Criteria\n- [ ] `docs/glossary.md` exists.\n- [ ] Table is present and correct.\n- [ ] Any additional ftui-specific terms (e.g., TerminalWriter, ScreenMode, UiAnchor) are added with concise definitions.","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T23:08:02.312315920Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:02.312315920Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.2","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:02.312315920Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.3","title":"Write Risk Register + Mitigation Links (Appendix C)","description":"# Write Risk Register + Mitigation Links (Appendix C)\n\n## Background\nThe plan includes a small Risk Register to keep engineering effort focused on the failure modes that destroy trust in a terminal UI kernel (cursor corruption, escape injection, width bugs, capability mismatches, unsafe creep, byte bloat, interleaved writes).\n\nWe want this risk list in-repo so:\n- mitigations stay attached to code and tests\n- adding features doesn't silently reintroduce known risks\n\n## Deliverable\nCreate `docs/risk-register.md` that includes the plan's risks and extends them with:\n- the *actual* Beads issue IDs that mitigate the risk\n- the *actual* test suites / scripts that enforce the mitigation\n\n## Required risks (from plan)\n1) Inline mode cursor corruption\n- Mitigation: PTY tests + strict cursor policy + centralized writer API for logs/UI.\n\n1b) ANSI / OSC injection via untrusted log content\n- Mitigation: sanitize-by-default + explicit opt-in raw passthrough + adversarial PTY tests.\n\n2) Unicode width bugs\n- Mitigation: curated test corpus + snapshot tests + ASCII fast path only when proven.\n\n3) Terminal capability mismatches\n- Mitigation: conservative defaults + feature detection + robust fallbacks.\n\n4) Unsafe creep\n- Mitigation: forbid unsafe by default; isolate any perf tricks; require tests + benches.\n\n5) Presenter byte bloat\n- Mitigation: run grouping + style-run coalescing + output-length benchmarks in CI.\n\n6) Interleaved stdout writes from user code\n- Mitigation: one-writer rule; TerminalSession/TerminalWriter; routing/capture patterns.\n\n## Acceptance Criteria\n- [ ] `docs/risk-register.md` exists and contains the risks above.\n- [ ] Each mitigation links to specific Beads issues and/or specific test suites (unit/property/pty/e2e).\n- [ ] The risk register includes a short section \"How to add a new risk\" and \"When to revisit\".","status":"open","priority":1,"issue_type":"docs","created_at":"2026-01-31T23:08:14.246182Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:14.246182Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.3","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:14.246182Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.4","title":"Extract ANSI Escape Reference into docs","description":"# Extract ANSI Escape Reference into docs\n\n## Background\nAppendix A of the plan contains a minimal ANSI escape sequence reference. Keeping this in-repo helps:\n- implement Presenter/TerminalWriter correctly\n- write terminal-model tests that parse the exact sequences we emit\n- avoid \"tribal knowledge\" and copy/paste drift\n\n## Deliverable\nCreate `docs/ansi-reference.md` with:\n- SGR codes used by ftui\n- Cursor movement + save/restore (ANSI + DEC)\n- Screen control (alt screen, clear line, cursor show/hide)\n- Synchronized output (DEC 2026)\n- OSC 8 hyperlinks\n- Mouse mode enables (SGR encoding)\n- Bracketed paste enables + boundaries\n- Focus events enables + events\n\nSeed content (from plan):\n\n### SGR\n- `\\x1b[0m` reset\n- `\\x1b[1m` bold\n- `\\x1b[3m` italic\n- `\\x1b[4m` underline\n- `\\x1b[38;2;R;G;Bm` truecolor fg\n- `\\x1b[48;2;R;G;Bm` truecolor bg\n- `\\x1b[38;5;Nm` 256 fg\n- `\\x1b[48;5;Nm` 256 bg\n\n### Cursor\n- `\\x1b[{r};{c}H` move\n- `\\x1b[s` save (ANSI)\n- `\\x1b[u` restore (ANSI)\n- `\\x1b7` save (DEC)\n- `\\x1b8` restore (DEC)\n\n### Synchronized Output\n- `\\x1b[?2026h` begin\n- `\\x1b[?2026l` end\n\n### OSC 8\n- `\\x1b]8;;URL\\x1b\\\\` start\n- `\\x1b]8;;\\x1b\\\\` end\n\n(Include the rest from Appendix A.)\n\n## Acceptance Criteria\n- [ ] `docs/ansi-reference.md` exists.\n- [ ] Reference is sufficient to implement the presenter and terminal-model parser without consulting external docs.\n- [ ] Doc explicitly notes which sequences are *emitted* vs merely *parsed*.","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T23:08:26.761368523Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:26.761368523Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.4","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:26.761368523Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.5","title":"Write Migration Map + Sourceftui mapping (Chapter 14 + 1.5)","description":"# Write Migration Map + Sourceftui mapping (Chapter 14 + 1.5)\n\n## Background\nThe plan explicitly says FrankenTUI is *not* a 1:1 port. We keep concepts, not types.\n\nHowever, future contributors will still ask:\n- \"Where did this idea come from?\"\n- \"Which library handled X well?\"\n- \"What did we intentionally drop?\"\n\nChapter 14 (Migration Map) and Chapter 1.5 (What survives vs what gets dropped) answer that.\n\n## Deliverable\nCreate `docs/migration-map.md` that includes:\n- Migration principles (Chapter 14.1)\n- Conceptual mapping: source concept  ftui concept (Chapter 14.2)\n- Compatibility strategy notes (Chapter 14.3)\n- Explicit \"survives vs dropped\" lists (Chapter 1.5)\n\n## Acceptance Criteria\n- [ ] Doc exists and is understandable without the plan.\n- [ ] Doc includes a clear \"Dropped / de-scoped\" section to prevent accidental scope creep (widget zoo, full terminal emulation, etc.).\n- [ ] Doc includes a section \"When to add a new crate vs extend an existing crate\" aligned with the three-ring architecture.","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T23:08:35.526344211Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:35.526344211Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.5","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:35.526344211Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.12.6","title":"Write One-Writer Rule Guidance + Routing Patterns","description":"# Write One-Writer Rule Guidance + Routing Patterns\n\n## Background\nThe plan's one-writer rule is the cornerstone that makes inline mode + streaming logs robust.\n\nWe already have ADR-005 describing *why* the rule exists and what breaks if violated.\nThis doc is about *how users actually comply* in real apps.\n\n## Deliverable\nCreate a user-facing doc (e.g. `docs/one-writer-rule.md`) that covers:\n\n- What \"one-writer\" means (which bytes count as terminal state mutations)\n- What is explicitly unsupported / undefined behavior (e.g., third-party `println!` while inline mode is active)\n- Supported routing patterns (from ADR-005):\n  - LogSink / in-process logs routed through ftui (sanitization applies)\n  - PTY capture for subprocess output (preferred for harnesses)\n  - Optional stdio capture / forwarding (best-effort)\n- Concrete examples:\n  - \"stream tool output\" example\n  - \"capture stderr\" example\n  - \"mux policy\" notes for tmux/screen\n- Safety notes:\n  - sanitize-by-default\n  - when to use raw passthrough and why it is dangerous\n\n## Acceptance Criteria\n- [ ] Doc exists and is linked from the main README/API docs.\n- [ ] Doc includes at least 2 copy/paste-ready examples.\n- [ ] Doc explicitly references ADR-005 and ADR-006.","status":"open","priority":1,"issue_type":"docs","created_at":"2026-01-31T23:09:22.706274596Z","created_by":"ubuntu","updated_at":"2026-01-31T23:09:22.706274596Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.12.6","depends_on_id":"bd-10i.10.5","type":"blocks","created_at":"2026-01-31T23:09:22.706274596Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.12.6","depends_on_id":"bd-10i.10.6","type":"blocks","created_at":"2026-01-31T23:09:22.706274596Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.12.6","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:09:22.706274596Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.13","title":"Formal Specs + Invariants (Chapter 2/3)","description":"# Formal Specs + Invariants (Chapter 2/3)\n\n## Purpose\nCapture the \"math-informed\" parts of the plan as durable specifications and executable checks so correctness claims remain explicit.\n\nThis is not about proving everything; it's about making the kernel invariants *obvious* and keeping regressions from creeping in.\n\n## Scope\nFrom the plan:\n- Chapter 2: Terminal state machine (TLA+-style sketch), rendering pipeline state machine, buffer invariants.\n- Chapter 3: Cache hierarchy analysis and the 16-byte Cell rationale.\n\n## Outputs\n- Human-readable spec docs (in `docs/spec/` or similar)\n- Executable checks:\n  - unit tests for invariants (dimensions, scissor/opacity stack laws, grapheme pool refcount laws)\n  - property tests where meaningful (diff correctness, presenter invariants)\n\n## Success Criteria\n- [ ] The terminal/pipeline state-machine sketches are translated into a contributor-friendly spec doc.\n- [ ] The \"16 bytes per Cell\" and row-major scan rationale is recorded next to the code-level constraints/tests.\n- [ ] Each named invariant has an associated test or a conscious rationale for why it is not testable.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-31T23:09:42.157052080Z","created_by":"ubuntu","updated_at":"2026-01-31T23:09:42.157052080Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.13","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T23:09:42.157052080Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.13.1","title":"Write Spec Doc: Terminal + Rendering Pipeline State Machines","description":"# Write Spec Doc: Terminal + Rendering Pipeline State Machines\n\n## Background\nPlan Chapter 2 provides:\n- a TLA+-style sketch for a terminal state machine\n- a rendering pipeline state machine\n\nWe want these written down in a way that directly informs implementation and testing.\n\n## Deliverable\nCreate `docs/spec/state-machines.md` that captures:\n\n### Terminal State Machine (plan 2.1)\n- State variables: cursor, style, grid, mode\n- Allowed modes: Normal, Raw, AltScreen (and any ftui-specific submodes)\n- Safety invariants: cursor bounds, grid cell validity\n\n### Rendering Pipeline State Machine (plan 2.2)\nStates: Idle, Measuring, Rendering, Diffing, Presenting, Error\n\nInvariants (from plan):\n- In Rendering, only back buffer is modified\n- In Presenting, only ANSI output is produced\n- After Presenting, front buffer == desired grid\n- Error state restores terminal to a safe state\n- Scissor stack intersection monotonically decreases on push\n- Opacity stack product stays in [0,1]\n\n## Acceptance Criteria\n- [ ] Doc exists and matches the plan's states/invariants.\n- [ ] Doc links to the exact code modules that implement each state/transition.\n- [ ] Doc lists which invariants are enforced by type system vs runtime checks vs tests.","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T23:09:55.712585863Z","created_by":"ubuntu","updated_at":"2026-01-31T23:09:55.712585863Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.13.1","depends_on_id":"bd-10i.13","type":"parent-child","created_at":"2026-01-31T23:09:55.712585863Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.13.2","title":"Add Executable Invariant Tests (Chapter 2.3)","description":"# Add Executable Invariant Tests (Chapter 2.3)\n\n## Background\nPlan 2.3 lists explicit invariants for Buffer, scissor/opacity stacks, and GraphemePool validity.\n\nWe want these invariants to be enforced by tests so regressions are caught immediately.\n\n## Invariants to encode (from plan)\n- Buffer dimensions: width/height immutable; cells length == width*height\n- Cell access bounds: safe get/set reject out-of-bounds\n- Scissor stack intersection monotonically decreases on push\n- Opacity stack product stays in [0,1]\n- GraphemePool: slot.refcount > 0 implies slot is valid\n- CellContent with GraphemeId implies id is valid in associated pool\n\n## Test Strategy\n- Unit tests for the deterministic invariants (stack behaviors, bounds)\n- Property tests for randomized sequences of push/pop (scissor/opacity)\n- Explicit regression tests for tricky cases (empty stacks, nested clips, full transparency)\n\n## Acceptance Criteria\n- [ ] Unit tests exist for each invariant above.\n- [ ] Property tests cover randomized stack operation sequences.\n- [ ] Tests are fast and deterministic (seeded) and run in CI.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:10:14.263918675Z","created_by":"ubuntu","updated_at":"2026-01-31T23:10:14.263918675Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.13.2","depends_on_id":"bd-10i.13","type":"parent-child","created_at":"2026-01-31T23:10:14.263918675Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.13.2","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T23:10:14.263918675Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.13.2","depends_on_id":"bd-10i.3.5","type":"blocks","created_at":"2026-01-31T23:10:14.263918675Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.13.2","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T23:10:14.263918675Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.13.3","title":"Write Cache/Layout Rationale (16-byte Cell, row-major scan)","description":"# Write Cache/Layout Rationale (16-byte Cell, row-major scan)\n\n## Background\nPlan Chapter 3 explains why the kernel is designed around:\n- a 16-byte Cell (4 cells per 64-byte cache line)\n- row-major, sequential access patterns for diffing and rendering\n\nThis rationale is core to ftui's performance promises and should live next to the code and benchmarks.\n\n## Deliverable\nCreate `docs/spec/cache-and-layout.md` capturing:\n- L1/L2/L3 and cache-line assumptions (as *guidance*, not a hard guarantee)\n- why 16 bytes is the sweet spot (4 per cache line)\n- why we avoid pointer chasing and per-cell allocations\n- why row-major scan is the default diff strategy\n- how the benchmarks validate these choices\n\n## Acceptance Criteria\n- [ ] Doc exists and includes the plan's key points (Chapter 3.1-3.3).\n- [ ] Doc links to `Cell`/`Buffer`/`Diff` code and the perf benchmark suite.\n- [ ] Doc clearly distinguishes \"must-hold\" invariants (e.g., `size_of::<Cell>() == 16`) from \"expected performance behavior\".","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T23:10:26.815219736Z","created_by":"ubuntu","updated_at":"2026-01-31T23:10:26.815219736Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.13.3","depends_on_id":"bd-10i.13","type":"parent-child","created_at":"2026-01-31T23:10:26.815219736Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.13.3","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T23:10:26.815219736Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.13.3","depends_on_id":"bd-19x","type":"blocks","created_at":"2026-01-31T23:10:26.815219736Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2","title":"Phase 0: Contracts + Workspace Skeleton","description":"# Phase 0: Contracts + Workspace Skeleton\n\n## Purpose\nEstablish the foundational structure before any implementation. This phase creates the workspace layout, defines public contracts, and documents locked decisions via ADRs.\n\n## Deliverables\n1. Workspace crate layout (ftui-core/render/style/text/layout/runtime/widgets/extras)\n2. Public contracts for kernel types: Cell, Buffer, Frame, Presenter, TerminalSession, Event\n3. ADRs for all locked decisions from Section 0.6 of the plan\n4. ftui facade crate with thin stable API surface\n5. Safety policy applied consistently (`#![forbid(unsafe_code)]` per AGENTS.md; SIMD must be safe/portable or deferred)\n\n## Exit Criteria\n- Public API compiles\n- Minimal demo crate prints a frame in Inline mode\n- All ADRs written and reviewed\n\n## Why This Phase Matters\nWithout clear contracts and workspace organization, the project will accumulate accidental complexity. This phase forces us to commit to boundaries and interfaces before writing implementation code.\n\n## Workspace Crate Layout (Target)\n- ftui: facade/public API (re-exports stable types)\n- ftui-core: raw mode, lifecycle guards, capability detection, input parsing, screen mode policy\n- ftui-render: Cell, Buffer, Frame, GraphemePool, LinkRegistry, HitGrid, Diff engine, Presenter\n- ftui-style: TextStyle, CellStyle, Theme, semantic colors, color downgrade\n- ftui-text: Text, Segment, width measurement, wrapping, truncation, alignment\n- ftui-layout: Rect, constraints, row/col/grid layout, measurement protocol\n- ftui-runtime: Bubbletea/Elm-like Program, Model, Cmd, scheduler, simulator\n- ftui-widgets: Component library (feature-gated)\n- ftui-extras: Markdown, syntax highlighting, export, SSH, forms (feature-gated)\n- ftui-harness: Agent harness reference implementation\n- ftui-pty: Test-only PTY utilities\n\n## Success Criteria\n- [ ] Workspace layout exists and enforces intended layering boundaries.\n- [ ] Core public contracts are written and reviewed before implementation starts.\n- [ ] Safety policy is explicit and consistent (no accidental unsafe).\n- [ ] ADR epic is unblocked and actively used to lock decisions.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:04:51.251200646Z","created_by":"ubuntu","updated_at":"2026-01-31T23:25:17.592526002Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:04:51.251200646Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.2","depends_on_id":"bd-10i.1","type":"blocks","created_at":"2026-01-31T22:21:20.041547122Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.2","depends_on_id":"bd-10i.10","type":"blocks","created_at":"2026-01-31T22:21:20.320818635Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.1","title":"Create Cargo workspace with crate layout","description":"# Create Cargo workspace with crate layout\n\n## Objective\nSet up the multi-crate workspace structure that enforces layering boundaries.\n\n## Crate Layout\n\n### ftui (facade)\n- Re-exports stable public types (App, ScreenMode, Event, Frame, Style)\n- Provides prelude, ergonomic builders, sensible defaults\n- What most apps depend on\n\n### ftui-core\n- Raw mode + terminal lifecycle guards (RAII)\n- Capability detection (env heuristics + optional queries)\n- Input parsing into canonical Event\n- Screen mode policy helpers (Inline/AltScreen)\n\n### ftui-render\n- Cell, Buffer, Frame (Frame = buffer + optional hit grid + metadata)\n- GraphemePool, LinkRegistry, optional HitGrid\n- Diff engine (cell-level scan + run grouping)\n- Presenter (ANSI writer, state tracked)\n- Optional simd feature (unsafe isolated)\n\n### ftui-style\n- Visual styling model (TextStyle, CellStyle, Theme)\n- Color downgrade (TrueColor -> 256 -> 16 -> ASCII)\n- Deterministic style merge semantics\n\n### ftui-text\n- Text, Span, Segment (+ markup parser as optional)\n- Width measurement, wrapping, truncation, alignment\n- Caches (LRU widths) and grapheme segmentation\n\n### ftui-layout\n- Rect, constraints, row/col/grid layout, measurement protocol\n\n### ftui-runtime (optional)\n- Bubbletea/Elm-like Program, Model, Cmd, scheduler\n- Deterministic simulator\n\n### ftui-widgets (feature-gated)\n- Component library on kernel + style/text/layout\n\n### ftui-extras (feature-gated)\n- Markdown, syntax highlighting, export, SSH, forms\n\n### ftui-harness (examples)\n- Agent harness reference implementation\n\n### ftui-simd (optional, unsafe allowed)\n- Feature-gated hot loop implementations\n- Strict rules: depends on ftui-render, has scalar fallback\n\n### ftui-pty (test-only)\n- PTY spawning utilities for golden-output harness\n\n## Workspace Cargo.toml\n[workspace]\nmembers = [\n    'ftui',\n    'ftui-core',\n    'ftui-render',\n    'ftui-style',\n    'ftui-text',\n    'ftui-layout',\n    'ftui-runtime',\n    'ftui-widgets',\n    'ftui-extras',\n    'ftui-harness',\n    'ftui-simd',\n    'ftui-pty',\n]\n\n## Safety Policy\nAll crates except ftui-simd: #![forbid(unsafe_code)]\n\n## Acceptance Criteria\n- [ ] Workspace compiles\n- [ ] Each crate has lib.rs with module structure\n- [ ] Dependency graph matches layering (render depends on core, etc.)\n- [ ] forbid(unsafe_code) in place","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:09:47.418333371Z","created_by":"ubuntu","updated_at":"2026-01-31T22:09:47.418333371Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.1","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:09:47.418333371Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.2","title":"Define public Cell API contract","description":"# Define public Cell API contract\n\n## Objective\nDocument and lock the Cell type's public API before implementation. Cell is the most fundamental type - changes here ripple everywhere.\n\n## Cell Contract\n\n### Layout (16 bytes, non-negotiable)\n#[repr(C, align(16))]\npub struct Cell {\n    pub content: CellContent,  // 4 bytes\n    pub fg: PackedRgba,        // 4 bytes\n    pub bg: PackedRgba,        // 4 bytes\n    pub attrs: CellAttrs,      // 4 bytes\n}\n\n### Why 16 Bytes?\n- 4 cells per 64-byte cache line (perfect fit)\n- Single 128-bit SIMD comparison\n- No heap allocation for 99% of cells\n- 24 bytes wastes cache, 32 bytes doubles bandwidth\n\n### CellContent (4 bytes)\nEncoding: [31: type bit][30-0: data]\n- Bit 31 == 0: char (Unicode scalar value)\n- Bit 31 == 1: GraphemeId (pool slot + width)\n\npub struct CellContent(u32);\nimpl CellContent {\n    const EMPTY: Self;\n    fn from_char(c: char) -> Self;\n    fn from_grapheme(id: GraphemeId) -> Self;\n    fn is_grapheme(&self) -> bool;\n    fn width(&self) -> usize;\n}\n\n### PackedRgba (4 bytes)\nLayout: [R:8][G:8][B:8][A:8] native endian\n\npub struct PackedRgba(pub u32);\nimpl PackedRgba {\n    const TRANSPARENT: Self;\n    const BLACK: Self;\n    const WHITE: Self;\n    fn rgb(r: u8, g: u8, b: u8) -> Self;\n    fn rgba(r: u8, g: u8, b: u8, a: u8) -> Self;\n    fn r(&self) -> u8;\n    fn g(&self) -> u8;\n    fn b(&self) -> u8;\n    fn a(&self) -> u8;\n    fn over(self, dst: Self) -> Self;  // Porter-Duff\n    fn with_opacity(self, opacity: f32) -> Self;\n}\n\n### CellAttrs (4 bytes)\nLayout: [31-24: flags][23-0: link_id]\n\npub struct CellAttrs(u32);\nimpl CellAttrs {\n    const NONE: Self;\n    fn new(flags: StyleFlags, link_id: u32) -> Self;\n    fn flags(&self) -> StyleFlags;\n    fn link_id(&self) -> u32;\n    fn with_flags(self, flags: StyleFlags) -> Self;\n    fn with_link(self, link_id: u32) -> Self;\n}\n\n### Cell Methods\nimpl Cell {\n    const CONTINUATION: Self;  // Placeholder for wide chars\n    fn is_continuation(&self) -> bool;\n    fn bits_eq(&self, other: &Self) -> bool;\n    fn width(&self) -> usize;\n}\n\n## Acceptance Criteria\n- [ ] API documented in code comments\n- [ ] Type layout verified with assert_eq!(size_of::<Cell>(), 16)\n- [ ] All methods have doc comments explaining purpose\n- [ ] No pub fields that could break invariants later","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:10:05.152050042Z","created_by":"ubuntu","updated_at":"2026-01-31T22:10:05.152050042Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.2","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:10:05.152050042Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.3","title":"Define public Buffer API contract","description":"# Define public Buffer API contract\n\n## Objective\nDocument and lock the Buffer type's public API. Buffer is the 2D grid that holds Cells.\n\n## Buffer Contract\n\n### Core Structure\npub struct Buffer {\n    width: u16,\n    height: u16,\n    cells: Vec<Cell>,\n    scissor_stack: Vec<Rect>,\n    opacity_stack: Vec<f32>,\n}\n\n### Invariants (MUST ALWAYS HOLD)\n1. cells.len() == width * height\n2. width/height never change after creation\n3. Scissor stack intersection monotonically decreases on push\n4. Opacity stack product stays in [0, 1]\n5. Scissor/opacity stacks always have at least one element\n\n### Constructor\nfn new(width: u16, height: u16) -> Self\n- Initializes cells to Cell::default()\n- Scissor stack starts with full buffer rect\n- Opacity stack starts with 1.0\n\n### Cell Access\nfn get(&self, x: u16, y: u16) -> Option<&Cell>\n- Returns None if out of bounds\n\nfn get_unchecked(&self, x: u16, y: u16) -> &Cell\n- No bounds check, panics on OOB (debug) or UB (release)\n- Only use when bounds verified\n\nfn set(&mut self, x: u16, y: u16, cell: Cell)\n- Respects scissor (skips if outside)\n- Applies opacity stack to cell colors\n- Applies alpha compositing if bg has transparency\n- Handles wide character continuation cells\n\n### Scissor Stack\nfn push_scissor(&mut self, rect: Rect)\n- Computes intersection with current scissor\n- Pushes intersected rect\n\nfn pop_scissor(&mut self)\n- Pops if stack.len() > 1 (preserves base)\n\nfn current_scissor(&self) -> Rect\n- Returns top of stack\n\n### Opacity Stack\nfn push_opacity(&mut self, opacity: f32)\n- Clamps to [0, 1]\n- Pushes current * new\n\nfn pop_opacity(&mut self)\n- Pops if stack.len() > 1\n\nfn current_opacity(&self) -> f32\n- Returns top of stack\n\n### Utilities\nfn clear(&mut self)\n- Fills all cells with Cell::default()\n\nfn cells(&self) -> &[Cell]\n- Raw slice for diffing\n\nfn width(&self) -> u16\nfn height(&self) -> u16\n\n## Frame Contract\nFrame = Buffer + render pass metadata\n\npub struct Frame {\n    pub buffer: Buffer,\n    pub hit_grid: Option<HitGrid>,\n    pub cursor_position: Option<(u16, u16)>,\n    pub cursor_visible: bool,\n}\n\n## Acceptance Criteria\n- [ ] All methods documented\n- [ ] Invariants stated in code comments\n- [ ] Test for each invariant\n- [ ] No UB in safe API","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:10:19.954399597Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:42.521135471Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.3","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:10:19.954399597Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.2.3","depends_on_id":"bd-10i.2.2","type":"blocks","created_at":"2026-01-31T22:21:42.521099182Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.4","title":"Define Event types contract","description":"# Define Event types contract\n\n## Objective\nDocument and lock the canonical Event types used throughout ftui.\n\n## Event Enum\npub enum Event {\n    Key(KeyEvent),\n    Mouse(MouseEvent),\n    Resize { width: u16, height: u16 },\n    Paste(PasteEvent),\n    Focus(bool),  // true = gained, false = lost\n    Clipboard(ClipboardEvent),  // optional, feature-gated\n}\n\n## KeyEvent\npub struct KeyEvent {\n    pub code: KeyCode,\n    pub modifiers: Modifiers,\n    pub kind: KeyEventKind,  // Press/Repeat/Release\n}\n\nimpl KeyEvent {\n    fn is_char(&self, c: char) -> bool;\n}\n\n## KeyCode\npub enum KeyCode {\n    Char(char),\n    Enter, Escape, Backspace, Tab, BackTab,\n    Delete, Insert, Home, End,\n    PageUp, PageDown,\n    Up, Down, Left, Right,\n    F(u8),\n    Null,\n}\n\n## KeyEventKind\npub enum KeyEventKind {\n    Press,    // Key pressed (default)\n    Repeat,   // Key held (when available)\n    Release,  // Key released (when available)\n}\n\n## Modifiers\nbitflags! {\n    pub struct Modifiers: u8 {\n        const SHIFT = 0b0001;\n        const ALT   = 0b0010;\n        const CTRL  = 0b0100;\n        const SUPER = 0b1000;\n    }\n}\n\n## MouseEvent\npub struct MouseEvent {\n    pub kind: MouseEventKind,\n    pub x: u16,\n    pub y: u16,\n    pub modifiers: Modifiers,\n}\n\n## MouseEventKind\npub enum MouseEventKind {\n    Down(MouseButton),\n    Up(MouseButton),\n    Drag(MouseButton),\n    Moved,\n    ScrollUp,\n    ScrollDown,\n}\n\n## MouseButton\npub enum MouseButton {\n    Left, Right, Middle,\n}\n\n## PasteEvent\npub struct PasteEvent {\n    pub text: String,\n    pub bracketed: bool,  // True if from bracketed paste mode\n}\n\n## ClipboardEvent (Optional)\npub struct ClipboardEvent {\n    pub content: String,\n    pub source: ClipboardSource,\n}\n\npub enum ClipboardSource { Osc52, Unknown }\n\n## Design Notes\n- Events are Clone + PartialEq + Eq for use in tests\n- Modifiers use bitflags for easy combination\n- Mouse coordinates are 0-indexed (terminal is 1-indexed)\n- KeyEventKind defaults to Press when not available\n\n## Acceptance Criteria\n- [ ] All types documented\n- [ ] Derive Clone, Debug, PartialEq, Eq where appropriate\n- [ ] Event can be converted From Crossterm events","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:10:33.715692497Z","created_by":"ubuntu","updated_at":"2026-01-31T22:10:33.715692497Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.4","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:10:33.715692497Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.5","title":"Define TerminalCapabilities contract","description":"# Define TerminalCapabilities contract\n\n## Objective\nDocument the capability detection model that informs how ftui behaves on different terminals.\n\n## TerminalCapabilities Structure\npub struct TerminalCapabilities {\n    // Color support\n    pub true_color: bool,\n    pub colors_256: bool,\n\n    // Advanced features\n    pub sync_output: bool,       // DEC mode 2026\n    pub osc8_hyperlinks: bool,\n    pub scroll_region: bool,     // DECSTBM\n\n    // Multiplexer detection\n    pub in_tmux: bool,\n    pub in_screen: bool,\n    pub in_zellij: bool,\n\n    // Input features\n    pub kitty_keyboard: bool,\n    pub focus_events: bool,\n    pub bracketed_paste: bool,\n    pub mouse_sgr: bool,\n\n    // Optional features\n    pub osc52_clipboard: bool,   // Best-effort output\n}\n\n## Detection Logic\n\n### Environment Variables\n- COLORTERM: truecolor, 24bit\n- TERM: terminal type (kitty, xterm-256color, etc.)\n- TERM_PROGRAM: iTerm.app, WezTerm, Alacritty, Ghostty\n- NO_COLOR: disable color (de-facto standard)\n- TMUX, STY, ZELLIJ: multiplexer detection\n- KITTY_WINDOW_ID: Kitty detection\n\n### Detection Rules\ntrue_color = \\!NO_COLOR && (COLORTERM contains truecolor/24bit\n             || TERM_PROGRAM in modern terminals)\n\nsync_output = TERM_PROGRAM in [WezTerm, Alacritty, Ghostty]\n              || TERM contains kitty\n\nosc8_hyperlinks = \\!NO_COLOR && TERM_PROGRAM in modern terminals\n\nscroll_region = TERM \\!= dumb (broadly supported)\n\nosc52_clipboard = \\!in_any_mux && TERM \\!= dumb (security restricted)\n\n## Methods\nimpl TerminalCapabilities {\n    fn detect() -> Self;      // From environment\n    fn basic() -> Self;       // Minimal fallback\n    fn in_any_mux(&self) -> bool;  // Any multiplexer?\n}\n\n## Multiplexer Notes\n- TMUX/screen/zellij sit between us and terminal\n- May need passthrough for some features\n- Some features disabled in mux by default\n- WezTerm/Kitty built-in mux doesn't need special handling\n\n## Future: Runtime Probing\nOptional feature-gated probing:\n- Device attribute queries (DA)\n- OSC queries for capabilities\n- Must be bounded with timeouts\n\n## Acceptance Criteria\n- [ ] All fields documented with detection logic\n- [ ] detect() works on common terminals\n- [ ] basic() provides safe fallback\n- [ ] in_any_mux() helper available","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:10:51.010479895Z","created_by":"ubuntu","updated_at":"2026-01-31T22:10:51.010479895Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.5","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:10:51.010479895Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.6","title":"Define TerminalSession lifecycle contract","description":"# Define TerminalSession lifecycle contract\n\n## Objective\nDocument the RAII-based terminal lifecycle management that ensures cleanup even on panic.\n\n## TerminalSession Structure\npub struct TerminalSession<W: Write> {\n    writer: W,\n    raw_mode_active: bool,\n    alt_screen_active: bool,\n    mouse_active: bool,\n    bracketed_paste_active: bool,\n    capabilities: TerminalCapabilities,\n}\n\n## Lifecycle Guarantees\n1. All terminal state changes tracked\n2. Drop restores previous state\n3. Panic hook ensures cleanup\n4. No leaked state on any exit path\n\n## Constructor\nfn new(writer: W) -> io::Result<Self>\n- Detects capabilities\n- Installs panic hook for cleanup\n- Does NOT enter raw mode automatically\n\n## Terminal Modes\nfn enter_raw_mode(&mut self) -> io::Result<()>\n- Enables raw mode (no echo, no line buffering)\n- Tracks state for cleanup\n\nfn enter_alt_screen(&mut self) -> io::Result<()>\n- Switches to alternate screen buffer\n- Emits CSI ? 1049 h\n\nfn enable_mouse(&mut self) -> io::Result<()>\n- Enables SGR mouse mode (1000, 1002, 1006)\n- Tracks for cleanup\n\nfn enable_bracketed_paste(&mut self) -> io::Result<()>\n- Enables bracketed paste mode\n- Emits CSI ? 2004 h\n\nfn enable_focus_events(&mut self) -> io::Result<()>\n- Enables focus tracking\n- Emits CSI ? 1004 h\n\n## Cleanup (Drop)\nimpl<W: Write> Drop for TerminalSession<W> {\n    fn drop(&mut self) {\n        // Disable mouse modes\n        // Disable bracketed paste\n        // Exit alt screen\n        // Reset style (SGR 0)\n        // Show cursor\n        // Restore raw mode (via backend)\n        // Flush\n    }\n}\n\n## Panic Hook\nOn panic, best-effort cleanup:\n- Exit alt screen\n- Show cursor\n- Reset style\n- Disable mouse\n- Disable bracketed paste\n- Flush\n\n## Escape Sequences Reference\n- Alt screen: CSI ? 1049 h/l\n- Mouse: CSI ? 1000/1002/1006 h/l\n- Bracketed paste: CSI ? 2004 h/l\n- Focus events: CSI ? 1004 h/l\n- Show cursor: CSI ? 25 h\n- Reset style: CSI 0 m\n\n## Acceptance Criteria\n- [ ] All state changes tracked\n- [ ] Drop cleans up all active modes\n- [ ] Panic hook installed and tested\n- [ ] PTY test verifies cleanup","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:11:05.056405558Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:42.784922059Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.6","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:11:05.056405558Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.2.6","depends_on_id":"bd-10i.2.4","type":"blocks","created_at":"2026-01-31T22:21:42.784885690Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.2.7","title":"Create ftui facade crate with prelude","description":"# Create ftui facade crate with prelude\n\n## Objective\nCreate the user-facing ftui crate that re-exports stable types and provides ergonomic defaults.\n\n## Purpose\n- Single dependency for most apps\n- Stable API surface\n- Hides internal crate complexity\n- Provides sensible prelude\n\n## Re-exports from Internal Crates\n\n### From ftui-core\n- Event, KeyEvent, MouseEvent, KeyCode, Modifiers\n- TerminalCapabilities, TerminalSession\n- ScreenMode (Inline, AltScreen)\n\n### From ftui-render\n- Cell, CellContent, CellAttrs\n- Buffer, Frame\n- GraphemePool, LinkRegistry\n- Presenter (advanced users)\n\n### From ftui-style\n- Style, TextStyle, CellStyle\n- Color, Theme\n- StyleFlags\n\n### From ftui-text\n- Text, Span\n\n### From ftui-layout\n- Rect, Sides, Measurement\n\n### From ftui-runtime (optional)\n- App, Program, Model, Cmd\n- ProgramSimulator\n\n## Prelude\npub mod prelude {\n    pub use crate::{\n        App, Cmd, Event, Frame, Model,\n        ScreenMode, Style, Result,\n    };\n}\n\n## Ergonomic Builders\n// App builder\nApp::new(model)\n    .screen_mode(ScreenMode::Inline { ui_height: 6 })\n    .run()\n\n// Style builder\nStyle::new().fg(Color::Red).bold()\n\n## Result Type\npub type Result<T> = std::result::Result<T, Error>;\n\n## Error Type\npub enum Error {\n    Io(std::io::Error),\n    Terminal(String),\n    // Add as needed\n}\n\n## Acceptance Criteria\n- [ ] All public types re-exported\n- [ ] Prelude provides common types\n- [ ] App builder compiles (even if not implemented)\n- [ ] Rustdoc renders correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:11:17.978848598Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:42.267890083Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.2.7","depends_on_id":"bd-10i.2","type":"parent-child","created_at":"2026-01-31T22:11:17.978848598Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.2.7","depends_on_id":"bd-10i.2.1","type":"blocks","created_at":"2026-01-31T22:21:42.267859596Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3","title":"Phase 1: Core Render Kernel","description":"# Phase 1: Core Render Kernel\n\n## Purpose\nImplement the sacred kernel types that everything else builds upon. This is the most critical phase - these types must be correct, fast, and stable.\n\n## Core Types to Implement\n1. Cell (16 bytes exactly): content + fg + bg + attrs\n2. CellContent: char or GraphemeId encoding\n3. CellAttrs: flags (8 bits) + link_id (24 bits)\n4. PackedRgba: RGBA as u32 with Porter-Duff blending\n5. GraphemeId + GraphemePool: reference-counted interned complex strings\n6. Buffer: 2D grid with scissor/opacity stacks\n7. Rect, Sides, Measurement primitives\n\n## Technical Constraints\n\n### Cell Layout (The 16-Byte Sweet Spot)\n- 16 bytes = exactly 4 cells per 64-byte cache line\n- Layout: content(4B) + fg(4B) + bg(4B) + attrs(4B)\n- Must use repr(C, align(16)) if needed to preserve layout\n\n### Why NOT 24 or 32 bytes?\n- 24 bytes: 2.67 cells/line, wastes 16 bytes per line\n- 32 bytes: 2 cells/line, doubles memory bandwidth\n- 16 bytes: Perfect fit, minimal cache misses\n\n### CellContent Encoding\n- Bit 31 == 0: char (Unicode scalar value)\n- Bit 31 == 1: GraphemeId (pool slot in bits 0-23, width in bits 24-30)\n\n### GraphemePool\n- Reference-counted slots for memory efficiency\n- Intern on first use, reuse existing ID if present\n- Free list for slot reuse\n- Refcount management via incref/decref\n\n## Exit Criteria\n- Unit tests pass for all types\n- Scalar bits_eq is correct\n- Buffer invariants enforced (bounds, scissor monotonicity, opacity in [0,1])\n- No unsafe code in this phase\n\n## Success Criteria\n- [ ] `Cell` is 16 bytes and equality/compare is fast and correct.\n- [ ] `Buffer` is correct-by-construction with enforced scissor/opacity invariants.\n- [ ] Grapheme pooling works (no leaks, correct refcounts, stable IDs).\n- [ ] Unit tests exist for every invariant (plus property tests where appropriate).","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:05:06.240633451Z","created_by":"ubuntu","updated_at":"2026-01-31T23:25:37.190034987Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:05:06.240633451Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3","depends_on_id":"bd-10i.2","type":"blocks","created_at":"2026-01-31T22:21:20.563899021Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.1","title":"Implement CellContent with char/grapheme encoding","description":"# Implement CellContent with char/grapheme encoding\n\n## Objective\nImplement the 4-byte CellContent type that efficiently encodes either a single char or a GraphemeId reference.\n\n## Technical Design\n\n### Encoding Scheme\nBit 31 (type discriminator):\n- 0: Direct char (bits 0-30 contain Unicode scalar value)\n- 1: GraphemeId reference (bits 0-23 = slot, bits 24-30 = width)\n\nThis allows:\n- 99% of cells (ASCII/BMP) to be stored without heap\n- Complex graphemes (emoji, ZWJ sequences) stored in pool\n\n### Implementation\n#[derive(Clone, Copy, PartialEq, Eq)]\n#[repr(transparent)]\npub struct CellContent(u32);\n\nimpl CellContent {\n    pub const EMPTY: Self = Self(0);\n\n    #[inline]\n    pub fn from_char(c: char) -> Self {\n        Self(c as u32)\n    }\n\n    #[inline]\n    pub fn from_grapheme(id: GraphemeId) -> Self {\n        Self(0x8000_0000 | id.0)\n    }\n\n    #[inline]\n    pub fn is_grapheme(&self) -> bool {\n        self.0 & 0x8000_0000 != 0\n    }\n\n    #[inline]\n    pub fn as_char(&self) -> Option<char> {\n        if self.is_grapheme() {\n            None\n        } else {\n            char::from_u32(self.0)\n        }\n    }\n\n    #[inline]\n    pub fn width(&self) -> usize {\n        if self.is_grapheme() {\n            ((self.0 >> 24) & 0x7F) as usize\n        } else if self.0 == 0 {\n            0\n        } else {\n            unicode_width::UnicodeWidthChar::width(\n                char::from_u32(self.0).unwrap_or(' ')\n            ).unwrap_or(1)\n        }\n    }\n}\n\n## GraphemeId Structure\n#[derive(Clone, Copy, PartialEq, Eq, Hash)]\n#[repr(transparent)]\npub struct GraphemeId(u32);\n\nimpl GraphemeId {\n    #[inline]\n    pub fn new(slot: u32, width: u8) -> Self {\n        debug_assert!(slot < 0x00FF_FFFF);\n        debug_assert!(width < 128);\n        Self((slot & 0x00FF_FFFF) | ((width as u32) << 24))\n    }\n\n    #[inline]\n    pub fn slot(&self) -> usize {\n        (self.0 & 0x00FF_FFFF) as usize\n    }\n\n    #[inline]\n    pub fn width(&self) -> usize {\n        ((self.0 >> 24) & 0x7F) as usize\n    }\n}\n\n## Tests Required\n- [ ] from_char roundtrip for ASCII\n- [ ] from_char roundtrip for BMP chars\n- [ ] from_char roundtrip for supplementary planes\n- [ ] from_grapheme encodes slot and width\n- [ ] width() correct for narrow, wide, emoji\n- [ ] EMPTY has width 0\n- [ ] is_grapheme() discriminates correctly\n\n## Acceptance Criteria\n- [ ] size_of::<CellContent>() == 4\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Inline hints on hot paths","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:11:34.587530319Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:50.998719908Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.1","depends_on_id":"bd-10i.2.2","type":"blocks","created_at":"2026-01-31T22:21:50.998689812Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.1","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:11:34.587530319Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.2","title":"Implement PackedRgba with Porter-Duff blending","description":"# Implement PackedRgba with Porter-Duff blending\n\n## Objective\nImplement the 4-byte packed RGBA color type with efficient alpha compositing.\n\n## Technical Design\n\n### Layout\n[R:8][G:8][B:8][A:8] in native endian as u32\n\n### Why Packed?\n- 4 bytes fits in Cell's 16-byte budget\n- Fast equality comparison (single u32 compare)\n- SIMD-friendly for bulk operations\n\n### Porter-Duff 'Over' Compositing\nResult = src + dst  (1 - src.alpha)\n\nThis is the standard way to composite translucent colors:\n- Fully opaque src (alpha=255): result = src\n- Fully transparent src (alpha=0): result = dst\n- Partial: blend proportionally\n\n### Implementation\n#[derive(Clone, Copy, PartialEq, Eq, Default)]\n#[repr(transparent)]\npub struct PackedRgba(pub u32);\n\nimpl PackedRgba {\n    pub const TRANSPARENT: Self = Self(0);\n    pub const BLACK: Self = Self::rgb(0, 0, 0);\n    pub const WHITE: Self = Self::rgb(255, 255, 255);\n\n    #[inline]\n    pub const fn rgb(r: u8, g: u8, b: u8) -> Self {\n        Self(((r as u32) << 24) | ((g as u32) << 16) \n             | ((b as u32) << 8) | 255)\n    }\n\n    #[inline]\n    pub const fn rgba(r: u8, g: u8, b: u8, a: u8) -> Self {\n        Self(((r as u32) << 24) | ((g as u32) << 16) \n             | ((b as u32) << 8) | (a as u32))\n    }\n\n    // Component accessors\n    #[inline] pub fn r(&self) -> u8 { (self.0 >> 24) as u8 }\n    #[inline] pub fn g(&self) -> u8 { (self.0 >> 16) as u8 }\n    #[inline] pub fn b(&self) -> u8 { (self.0 >> 8) as u8 }\n    #[inline] pub fn a(&self) -> u8 { self.0 as u8 }\n\n    /// Porter-Duff 'over': src over dst\n    #[inline]\n    pub fn over(self, dst: Self) -> Self {\n        let src_a = self.a() as u32;\n        if src_a == 255 { return self; }\n        if src_a == 0 { return dst; }\n\n        let inv_a = 255 - src_a;\n        let r = ((self.r() as u32 * 255) + (dst.r() as u32 * inv_a)) / 255;\n        let g = ((self.g() as u32 * 255) + (dst.g() as u32 * inv_a)) / 255;\n        let b = ((self.b() as u32 * 255) + (dst.b() as u32 * inv_a)) / 255;\n        let a = src_a + ((dst.a() as u32 * inv_a) / 255);\n\n        Self::rgba(r as u8, g as u8, b as u8, a as u8)\n    }\n\n    /// Apply uniform opacity [0.0, 1.0]\n    #[inline]\n    pub fn with_opacity(self, opacity: f32) -> Self {\n        let a = ((self.a() as f32) * opacity.clamp(0.0, 1.0)) as u8;\n        Self((self.0 & 0xFFFF_FF00) | (a as u32))\n    }\n}\n\n## Tests Required\n- [ ] rgb() creates color with alpha=255\n- [ ] rgba() preserves all components\n- [ ] Component accessors round-trip\n- [ ] over() with opaque src returns src\n- [ ] over() with transparent src returns dst\n- [ ] over() blends correctly for 50% alpha\n- [ ] with_opacity() scales alpha correctly\n\n## Acceptance Criteria\n- [ ] size_of::<PackedRgba>() == 4\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Porter-Duff matches reference implementation","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:11:52.455911761Z","created_by":"ubuntu","updated_at":"2026-01-31T22:11:52.455911761Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.2","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:11:52.455911761Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.3","title":"Implement CellAttrs with StyleFlags","description":"# Implement CellAttrs with StyleFlags\n\n## Objective\nImplement the 4-byte packed attributes type that holds style flags and link ID.\n\n## Technical Design\n\n### Layout\n[31-24: flags (8 bits)][23-0: link_id (24 bits)]\n\n### StyleFlags (8 bits)\nUsing bitflags crate for ergonomic flag manipulation:\n- BOLD (1 << 0)\n- DIM (1 << 1)\n- ITALIC (1 << 2)\n- UNDERLINE (1 << 3)\n- BLINK (1 << 4)\n- REVERSE (1 << 5)\n- STRIKETHROUGH (1 << 6)\n- HIDDEN (1 << 7)\n\n### Link ID (24 bits)\n- 0 = no link\n- 1-16777214 = valid link IDs from LinkRegistry\n- Allows ~16 million unique links per frame\n\n### Implementation\nbitflags::bitflags! {\n    #[derive(Clone, Copy, PartialEq, Eq, Debug)]\n    pub struct StyleFlags: u8 {\n        const BOLD          = 0b0000_0001;\n        const DIM           = 0b0000_0010;\n        const ITALIC        = 0b0000_0100;\n        const UNDERLINE     = 0b0000_1000;\n        const BLINK         = 0b0001_0000;\n        const REVERSE       = 0b0010_0000;\n        const STRIKETHROUGH = 0b0100_0000;\n        const HIDDEN        = 0b1000_0000;\n    }\n}\n\n#[derive(Clone, Copy, PartialEq, Eq, Default)]\n#[repr(transparent)]\npub struct CellAttrs(u32);\n\nimpl CellAttrs {\n    pub const NONE: Self = Self(0);\n\n    #[inline]\n    pub fn new(flags: StyleFlags, link_id: u32) -> Self {\n        debug_assert!(link_id < 0x00FF_FFFF, 'link_id overflow');\n        Self(((flags.bits() as u32) << 24) | (link_id & 0x00FF_FFFF))\n    }\n\n    #[inline]\n    pub fn flags(&self) -> StyleFlags {\n        StyleFlags::from_bits_truncate((self.0 >> 24) as u8)\n    }\n\n    #[inline]\n    pub fn link_id(&self) -> u32 {\n        self.0 & 0x00FF_FFFF\n    }\n\n    #[inline]\n    pub fn with_flags(self, flags: StyleFlags) -> Self {\n        Self((self.0 & 0x00FF_FFFF) | ((flags.bits() as u32) << 24))\n    }\n\n    #[inline]\n    pub fn with_link(self, link_id: u32) -> Self {\n        Self((self.0 & 0xFF00_0000) | (link_id & 0x00FF_FFFF))\n    }\n\n    #[inline]\n    pub fn has_flag(&self, flag: StyleFlags) -> bool {\n        self.flags().contains(flag)\n    }\n}\n\n## Tests Required\n- [ ] NONE has no flags and link_id = 0\n- [ ] new() stores flags and link_id correctly\n- [ ] flags() retrieves stored flags\n- [ ] link_id() retrieves stored link_id\n- [ ] with_flags() preserves link_id\n- [ ] with_link() preserves flags\n- [ ] Flag combinations work (BOLD | ITALIC)\n- [ ] Boundary: link_id at max value\n\n## Acceptance Criteria\n- [ ] size_of::<CellAttrs>() == 4\n- [ ] All tests pass\n- [ ] bitflags derive works correctly\n- [ ] No unsafe code","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:12:07.470523869Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:51.278476055Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.3","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:12:07.470523869Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.3","depends_on_id":"bd-10i.3.2","type":"blocks","created_at":"2026-01-31T22:21:51.278445687Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.4","title":"Implement Cell struct (16 bytes)","description":"# Implement Cell struct (16 bytes)\n\n## Objective\nImplement the complete Cell struct that combines all components into exactly 16 bytes.\n\n## Technical Design\n\n### Layout\n#[repr(C, align(16))]\npub struct Cell {\n    pub content: CellContent,  // 4 bytes (offset 0)\n    pub fg: PackedRgba,        // 4 bytes (offset 4)\n    pub bg: PackedRgba,        // 4 bytes (offset 8)\n    pub attrs: CellAttrs,      // 4 bytes (offset 12)\n}\n// Total: 16 bytes, aligned to 16-byte boundary\n\n### Why repr(C, align(16))?\n- Predictable memory layout\n- 4 cells per 64-byte cache line\n- Enables SIMD comparison (128-bit)\n- No padding surprises\n\n### Special Cells\n- CONTINUATION: Placeholder for second column of wide chars\n  - content = 0xFFFF_FFFF (invalid Unicode)\n  - Used when wide char occupies 2 cells\n\n### Implementation\nimpl Default for Cell {\n    fn default() -> Self {\n        Self {\n            content: CellContent::EMPTY,\n            fg: PackedRgba::WHITE,\n            bg: PackedRgba::TRANSPARENT,\n            attrs: CellAttrs::NONE,\n        }\n    }\n}\n\nimpl Cell {\n    pub const CONTINUATION: Self = Self {\n        content: CellContent(0xFFFF_FFFF),\n        fg: PackedRgba::TRANSPARENT,\n        bg: PackedRgba::TRANSPARENT,\n        attrs: CellAttrs::NONE,\n    };\n\n    #[inline]\n    pub fn is_continuation(&self) -> bool {\n        self.content.0 == 0xFFFF_FFFF\n    }\n\n    /// Bitwise equality (fast path for diffing)\n    #[inline]\n    pub fn bits_eq(&self, other: &Self) -> bool {\n        self.content == other.content &&\n        self.fg == other.fg &&\n        self.bg == other.bg &&\n        self.attrs == other.attrs\n    }\n\n    #[inline]\n    pub fn width(&self) -> usize {\n        self.content.width()\n    }\n\n    // Builder methods\n    pub fn char(c: char) -> Self {\n        Self {\n            content: CellContent::from_char(c),\n            ..Default::default()\n        }\n    }\n\n    pub fn fg(mut self, color: PackedRgba) -> Self {\n        self.fg = color;\n        self\n    }\n\n    pub fn bg(mut self, color: PackedRgba) -> Self {\n        self.bg = color;\n        self\n    }\n\n    pub fn attrs(mut self, attrs: CellAttrs) -> Self {\n        self.attrs = attrs;\n        self\n    }\n}\n\nimpl PartialEq for Cell {\n    fn eq(&self, other: &Self) -> bool {\n        self.bits_eq(other)\n    }\n}\n\nimpl Eq for Cell {}\n\n## Tests Required\n- [ ] size_of::<Cell>() == 16\n- [ ] align_of::<Cell>() == 16\n- [ ] Default produces expected values\n- [ ] CONTINUATION is distinguishable\n- [ ] bits_eq matches PartialEq\n- [ ] Builder methods work correctly\n- [ ] width() delegates to content\n\n## Acceptance Criteria\n- [ ] Exact 16-byte size verified\n- [ ] 16-byte alignment verified\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Performance: bits_eq in < 1ns","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:12:22.103820544Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:51.806317486Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.4","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:12:22.103820544Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.4","depends_on_id":"bd-10i.3.1","type":"blocks","created_at":"2026-01-31T22:21:51.553544228Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.4","depends_on_id":"bd-10i.3.3","type":"blocks","created_at":"2026-01-31T22:21:51.806289113Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.5","title":"Implement GraphemePool with refcounting","description":"# Implement GraphemePool with refcounting\n\n## Objective\nImplement the reference-counted pool for complex grapheme clusters (emoji, ZWJ sequences).\n\n## Why GraphemePool?\nMost cells are simple ASCII or BMP characters that fit in CellContent's 4 bytes directly. But some graphemes (emoji with skin tone, ZWJ sequences like family emoji) require multiple Unicode codepoints and variable-length strings.\n\nThe pool:\n- Stores these complex strings once\n- Returns a compact GraphemeId (4 bytes)\n- Reference counts for memory management\n- Reuses slots from free list\n\n## Technical Design\n\n### Slot Structure\nstruct GraphemeSlot {\n    text: String,      // The actual grapheme string\n    width: u8,         // Display width (0-127)\n    refcount: u32,     // Reference count\n}\n\n### Pool Structure\npub struct GraphemePool {\n    strings: Vec<Option<GraphemeSlot>>,  // Slot storage\n    lookup: HashMap<String, GraphemeId>, // Fast dedup\n    free_list: Vec<u32>,                 // Reusable slots\n}\n\n### Implementation\nimpl GraphemePool {\n    pub fn new() -> Self {\n        Self {\n            strings: Vec::new(),\n            lookup: HashMap::new(),\n            free_list: Vec::new(),\n        }\n    }\n\n    /// Intern a grapheme, returning existing ID if present\n    pub fn intern(&mut self, s: &str) -> GraphemeId {\n        // Check if already interned\n        if let Some(&id) = self.lookup.get(s) {\n            self.incref(id);\n            return id;\n        }\n\n        // Calculate display width\n        let width = unicode_width::UnicodeWidthStr::width(s)\n            .min(127) as u8;\n\n        // Find or create slot\n        let slot_idx = self.free_list.pop().unwrap_or_else(|| {\n            let idx = self.strings.len() as u32;\n            self.strings.push(None);\n            idx\n        });\n\n        let id = GraphemeId::new(slot_idx, width);\n        self.strings[slot_idx as usize] = Some(GraphemeSlot {\n            text: s.to_string(),\n            width,\n            refcount: 1,\n        });\n        self.lookup.insert(s.to_string(), id);\n        id\n    }\n\n    /// Get string for ID\n    pub fn get(&self, id: GraphemeId) -> Option<&str> {\n        self.strings.get(id.slot())\n            .and_then(|slot| slot.as_ref())\n            .map(|s| s.text.as_str())\n    }\n\n    /// Increment refcount\n    fn incref(&mut self, id: GraphemeId) {\n        if let Some(Some(slot)) = self.strings.get_mut(id.slot()) {\n            slot.refcount = slot.refcount.saturating_add(1);\n        }\n    }\n\n    /// Decrement refcount, freeing if zero\n    pub fn decref(&mut self, id: GraphemeId) {\n        let slot_idx = id.slot();\n        if let Some(Some(slot)) = self.strings.get_mut(slot_idx) {\n            slot.refcount = slot.refcount.saturating_sub(1);\n            if slot.refcount == 0 {\n                self.lookup.remove(&slot.text);\n                self.strings[slot_idx] = None;\n                self.free_list.push(slot_idx as u32);\n            }\n        }\n    }\n\n    pub fn len(&self) -> usize {\n        self.strings.iter().filter(|s| s.is_some()).count()\n    }\n}\n\n## Invariants\n- slot.refcount > 0 implies slot is valid\n- GraphemeId only created via pool.intern()\n- lookup and strings are consistent\n- Free list contains only None slots\n\n## Tests Required\n- [ ] intern() returns same ID for same string\n- [ ] intern() increments refcount on reuse\n- [ ] get() retrieves correct string\n- [ ] decref() frees at refcount 0\n- [ ] Free list reuses slots\n- [ ] Width calculation correct for emoji\n- [ ] ZWJ sequences handled\n\n## Acceptance Criteria\n- [ ] All invariants maintained\n- [ ] All tests pass\n- [ ] Intern hit: < 100ns\n- [ ] Intern miss: < 1us","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:12:41.853594562Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:52.050855468Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.5","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:12:41.853594562Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.5","depends_on_id":"bd-10i.3.1","type":"blocks","created_at":"2026-01-31T22:21:52.050825272Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.6","title":"Implement Buffer with scissor/opacity stacks","description":"# Implement Buffer with scissor/opacity stacks\n\n## Objective\nImplement the 2D cell grid with support for scissor (clipping) and opacity stacks for compositing.\n\n## Technical Design\n\n### Structure\npub struct Buffer {\n    width: u16,\n    height: u16,\n    cells: Vec<Cell>,\n    scissor_stack: Vec<Rect>,\n    opacity_stack: Vec<f32>,\n}\n\n### Invariants\n1. cells.len() == width * height (always)\n2. width/height immutable after creation\n3. Scissor intersection monotonically decreases on push\n4. Opacity product stays in [0, 1]\n5. Both stacks always have at least one element\n\n### Implementation\nimpl Buffer {\n    pub fn new(width: u16, height: u16) -> Self {\n        let size = (width as usize) * (height as usize);\n        Self {\n            width,\n            height,\n            cells: vec![Cell::default(); size],\n            scissor_stack: vec![Rect::new(0, 0, width, height)],\n            opacity_stack: vec![1.0],\n        }\n    }\n\n    // Accessors\n    #[inline]\n    pub fn width(&self) -> u16 { self.width }\n    \n    #[inline]\n    pub fn height(&self) -> u16 { self.height }\n\n    // Cell access with bounds check\n    #[inline]\n    pub fn get(&self, x: u16, y: u16) -> Option<&Cell> {\n        if x < self.width && y < self.height {\n            Some(&self.cells[self.index(x, y)])\n        } else {\n            None\n        }\n    }\n\n    // Unchecked access (for diffing hot path)\n    #[inline]\n    pub fn get_unchecked(&self, x: u16, y: u16) -> &Cell {\n        &self.cells[self.index(x, y)]\n    }\n\n    #[inline]\n    fn index(&self, x: u16, y: u16) -> usize {\n        (y as usize) * (self.width as usize) + (x as usize)\n    }\n\n    // Cell mutation with scissor/opacity\n    pub fn set(&mut self, x: u16, y: u16, mut cell: Cell) {\n        if !self.in_scissor(x, y) { return; }\n\n        // Apply opacity\n        let opacity = self.current_opacity();\n        if opacity < 1.0 {\n            cell.fg = cell.fg.with_opacity(opacity);\n            cell.bg = cell.bg.with_opacity(opacity);\n        }\n\n        // Alpha composite if bg transparent\n        if cell.bg.a() < 255 {\n            if let Some(existing) = self.get(x, y) {\n                cell.bg = cell.bg.over(existing.bg);\n            }\n        }\n\n        let idx = self.index(x, y);\n        self.cells[idx] = cell;\n\n        // Wide char continuation\n        if cell.width() == 2 && x + 1 < self.width {\n            self.cells[idx + 1] = Cell::CONTINUATION;\n        }\n    }\n\n    // Scissor stack\n    pub fn push_scissor(&mut self, rect: Rect) {\n        let current = self.current_scissor();\n        self.scissor_stack.push(current.intersection(&rect));\n    }\n\n    pub fn pop_scissor(&mut self) {\n        if self.scissor_stack.len() > 1 {\n            self.scissor_stack.pop();\n        }\n    }\n\n    fn current_scissor(&self) -> Rect {\n        *self.scissor_stack.last().unwrap()\n    }\n\n    fn in_scissor(&self, x: u16, y: u16) -> bool {\n        self.current_scissor().contains(x, y)\n    }\n\n    // Opacity stack\n    pub fn push_opacity(&mut self, opacity: f32) {\n        let current = self.current_opacity();\n        self.opacity_stack.push(current * opacity.clamp(0.0, 1.0));\n    }\n\n    pub fn pop_opacity(&mut self) {\n        if self.opacity_stack.len() > 1 {\n            self.opacity_stack.pop();\n        }\n    }\n\n    fn current_opacity(&self) -> f32 {\n        *self.opacity_stack.last().unwrap()\n    }\n\n    // Utilities\n    pub fn clear(&mut self) {\n        self.cells.fill(Cell::default());\n    }\n\n    pub fn cells(&self) -> &[Cell] {\n        &self.cells\n    }\n}\n\n## Tests Required\n- [ ] new() creates correct size\n- [ ] get() returns None for OOB\n- [ ] set() respects scissor\n- [ ] push_scissor intersects correctly\n- [ ] pop_scissor preserves base\n- [ ] Opacity multiplies correctly\n- [ ] Wide chars create continuation\n- [ ] clear() resets all cells\n\n## Acceptance Criteria\n- [ ] All invariants tested\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Memory: exactly width*height*16 bytes for cells","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:13:01.324377225Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:52.811032251Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.6","depends_on_id":"bd-10i.2.3","type":"blocks","created_at":"2026-01-31T22:21:52.810995362Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.6","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:13:01.324377225Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.6","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T22:21:52.290284214Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.3.6","depends_on_id":"bd-10i.3.5","type":"blocks","created_at":"2026-01-31T22:21:52.547476017Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.3.7","title":"Implement Rect, Sides, Measurement primitives","description":"# Implement Rect, Sides, Measurement primitives\n\n## Objective\nImplement the layout primitives used throughout ftui.\n\n## Rect (Rectangle)\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]\npub struct Rect {\n    pub x: u16,\n    pub y: u16,\n    pub width: u16,\n    pub height: u16,\n}\n\nimpl Rect {\n    pub fn new(x: u16, y: u16, width: u16, height: u16) -> Self {\n        Self { x, y, width, height }\n    }\n\n    pub fn contains(&self, x: u16, y: u16) -> bool {\n        x >= self.x && x < self.x + self.width &&\n        y >= self.y && y < self.y + self.height\n    }\n\n    pub fn intersection(&self, other: &Self) -> Self {\n        let x = self.x.max(other.x);\n        let y = self.y.max(other.y);\n        let right = (self.x + self.width).min(other.x + other.width);\n        let bottom = (self.y + self.height).min(other.y + other.height);\n\n        if right > x && bottom > y {\n            Self::new(x, y, right - x, bottom - y)\n        } else {\n            Self::default()  // Empty rect\n        }\n    }\n\n    pub fn inner(&self, margin: Sides) -> Self {\n        Self::new(\n            self.x + margin.left,\n            self.y + margin.top,\n            self.width.saturating_sub(margin.left + margin.right),\n            self.height.saturating_sub(margin.top + margin.bottom),\n        )\n    }\n\n    pub fn is_empty(&self) -> bool {\n        self.width == 0 || self.height == 0\n    }\n\n    pub fn area(&self) -> u32 {\n        self.width as u32 * self.height as u32\n    }\n}\n\n## Sides (Padding/Margin)\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]\npub struct Sides {\n    pub top: u16,\n    pub right: u16,\n    pub bottom: u16,\n    pub left: u16,\n}\n\nimpl Sides {\n    pub fn all(v: u16) -> Self {\n        Self { top: v, right: v, bottom: v, left: v }\n    }\n\n    pub fn horizontal(v: u16) -> Self {\n        Self { top: 0, right: v, bottom: 0, left: v }\n    }\n\n    pub fn vertical(v: u16) -> Self {\n        Self { top: v, right: 0, bottom: v, left: 0 }\n    }\n\n    pub fn horizontal_sum(&self) -> u16 {\n        self.left + self.right\n    }\n\n    pub fn vertical_sum(&self) -> u16 {\n        self.top + self.bottom\n    }\n}\n\n// CSS-like tuple conversions\nimpl From<u16> for Sides {\n    fn from(v: u16) -> Self { Self::all(v) }\n}\n\nimpl From<(u16, u16)> for Sides {\n    fn from((v, h): (u16, u16)) -> Self {\n        Self { top: v, right: h, bottom: v, left: h }\n    }\n}\n\nimpl From<(u16, u16, u16, u16)> for Sides {\n    fn from((t, r, b, l): (u16, u16, u16, u16)) -> Self {\n        Self { top: t, right: r, bottom: b, left: l }\n    }\n}\n\n## Measurement (for layout negotiation)\n#[derive(Debug, Clone, Copy, Default)]\npub struct Measurement {\n    pub min_width: u16,\n    pub min_height: u16,\n    pub max_width: Option<u16>,\n    pub max_height: Option<u16>,\n}\n\nimpl Measurement {\n    pub fn fixed(width: u16, height: u16) -> Self {\n        Self {\n            min_width: width,\n            min_height: height,\n            max_width: Some(width),\n            max_height: Some(height),\n        }\n    }\n\n    pub fn flexible(min_w: u16, min_h: u16) -> Self {\n        Self {\n            min_width: min_w,\n            min_height: min_h,\n            max_width: None,\n            max_height: None,\n        }\n    }\n}\n\n## Tests Required\n- [ ] Rect::contains for corners and edges\n- [ ] Rect::intersection produces correct result\n- [ ] Rect::intersection with no overlap returns empty\n- [ ] Rect::inner reduces correctly\n- [ ] Sides::all, horizontal, vertical\n- [ ] Sides tuple conversions\n- [ ] Measurement::fixed constraints\n\n## Acceptance Criteria\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Ergonomic tuple conversions work","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:13:17.121141650Z","created_by":"ubuntu","updated_at":"2026-01-31T22:13:17.121141650Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.3.7","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:13:17.121141650Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.4","title":"Phase 2: Diff + Presenter (Near-minimal ANSI)","description":"# Phase 2: Diff + Presenter (Near-minimal ANSI)\n\n## Purpose\nImplement the diff engine and ANSI presenter that transform buffer changes into minimal terminal output. This is where the 'zero-flicker' promise is delivered.\n\n## Components\n\n### BufferDiff\n- Compute diff between old and new buffers\n- Row-major scan for cache efficiency\n- Output as list of changed positions\n- Convert to ChangeRuns for efficient emission\n\n### ChangeRun\n- Contiguous run of changed cells on a single row\n- Allows single cursor move per run instead of per-cell\n\n### Presenter (State-Tracked ANSI Writer)\n- Tracks current style, link, cursor position\n- Only emits changes from tracked state\n- Uses BufWriter with 64KB buffer\n- Supports synchronized output (DEC mode 2026)\n\n## Key Decisions (from ADRs)\n\n### Style Emission Strategy\n- v1 default: Reset+apply (SGR 0 then re-apply)\n- Simple and correct, though more bytes\n- Incremental/hybrid behind feature flag until benchmarks justify\n\n### Synchronized Output\n- Use CSI ? 2026 h/l when available\n- Reduces flicker by batching updates\n- Must work without it (graceful degradation)\n\n### Run Grouping\n- Emit changes in row-major runs\n- Single cursor move per run\n- Sequential character emission within runs (cursor advances naturally)\n\n## Exit Criteria\n- Single buffered write per frame achieved\n- Run grouping works correctly\n- Style state cannot leak across runs (terminal-model tests)\n- Links (OSC 8) cannot remain open after present/exit\n\n## Success Criteria\n- [ ] BufferDiff is correct and fast (row-major; scratch reuse; property tests where possible).\n- [ ] Presenter emits correct ANSI (terminal-model validated) and never leaves dangling state (SGR/link).\n- [ ] Bytes emitted for small changes are O(changes), not O(screen), and are tracked in benches.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:05:21.404504792Z","created_by":"ubuntu","updated_at":"2026-01-31T23:25:54.992729685Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.4","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:05:21.404504792Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T22:21:20.799655478Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.4.1","title":"Implement BufferDiff with row-major scan","description":"# Implement BufferDiff with row-major scan\n\n## Objective\nImplement the diff engine that computes changed cells between two buffers efficiently.\n\n## Why Diffing Matters\nThe fundamental theorem of terminal UI: produce the minimal byte stream to transform current grid to desired grid. Diffing identifies what actually changed so we don't re-emit unchanged cells.\n\n## Technical Design\n\n### Structure\npub struct BufferDiff {\n    changes: Vec<(u16, u16)>,  // (x, y) of changed cells\n}\n\n### Algorithm\nRow-major scan for cache efficiency:\n1. Iterate y from 0 to height\n2. Iterate x from 0 to width\n3. Compare old[x,y] with new[x,y] using bits_eq\n4. Record position if different\n\nRow-major ensures sequential memory access:\n- Cells are stored row-by-row\n- Prefetcher can anticipate next access\n- 4 cells per cache line means 4 comparisons per line load\n\n### Implementation\nimpl BufferDiff {\n    pub fn compute(old: &Buffer, new: &Buffer) -> Self {\n        debug_assert_eq!(old.width(), new.width());\n        debug_assert_eq!(old.height(), new.height());\n\n        let mut changes = Vec::new();\n        let width = old.width();\n        let height = old.height();\n\n        // Row-major scan for cache efficiency\n        for y in 0..height {\n            for x in 0..width {\n                let old_cell = old.get_unchecked(x, y);\n                let new_cell = new.get_unchecked(x, y);\n                if !old_cell.bits_eq(new_cell) {\n                    changes.push((x, y));\n                }\n            }\n        }\n\n        Self { changes }\n    }\n\n    pub fn len(&self) -> usize {\n        self.changes.len()\n    }\n\n    pub fn is_empty(&self) -> bool {\n        self.changes.is_empty()\n    }\n\n    pub fn changes(&self) -> &[(u16, u16)] {\n        &self.changes\n    }\n}\n\n### ChangeRun (for efficient emission)\nConvert point changes into contiguous runs:\n\npub struct ChangeRun {\n    pub y: u16,    // Row\n    pub x0: u16,   // Start column\n    pub x1: u16,   // End column (inclusive)\n}\n\nimpl BufferDiff {\n    pub fn runs(&self, _width: u16) -> Vec<ChangeRun> {\n        // Sort by (y, x) - already sorted from scan\n        // Coalesce consecutive x positions on same row\n\n        let mut runs = Vec::new();\n        if self.changes.is_empty() { return runs; }\n\n        let mut sorted = self.changes.clone();\n        sorted.sort_by_key(|(x, y)| (*y, *x));\n\n        let mut i = 0;\n        while i < sorted.len() {\n            let (x0, y) = sorted[i];\n            let mut x1 = x0;\n            i += 1;\n\n            // Coalesce consecutive x\n            while i < sorted.len() {\n                let (x, yy) = sorted[i];\n                if yy != y || x != x1 + 1 { break; }\n                x1 = x;\n                i += 1;\n            }\n\n            runs.push(ChangeRun { y, x0, x1 });\n        }\n\n        runs\n    }\n}\n\n## Performance Target\n- 80x24, full diff: < 500us\n- Typical 5% change: proportionally faster\n\n## Tests Required\n- [ ] Empty diff when buffers identical\n- [ ] Single cell change detected\n- [ ] Multiple scattered changes detected\n- [ ] runs() coalesces adjacent cells\n- [ ] runs() handles gaps correctly\n- [ ] Performance meets target\n\n## Acceptance Criteria\n- [ ] All tests pass\n- [ ] No unsafe code in default build\n- [ ] Performance: < 500us for 80x24","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:13:35.587846708Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:59.480036868Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.4.1","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:21:59.480007032Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4.1","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:13:35.587846708Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.4.2","title":"Implement LinkRegistry for OSC 8 hyperlinks","description":"# Implement LinkRegistry for OSC 8 hyperlinks\n\n## Objective\nImplement URL storage and ID management for OSC 8 hyperlinks.\n\n## Background: OSC 8 Hyperlinks\nModern terminals support clickable hyperlinks via OSC 8:\n- Start link: ESC ] 8 ; ; URL ESC \\\\\n- End link: ESC ] 8 ; ; ESC \\\\\n\nMultiple cells can share the same link by using the same link ID. The registry deduplicates URLs and manages IDs.\n\n## Technical Design\n\n### Structure\npub struct LinkRegistry {\n    links: Vec<Option<String>>,      // ID -> URL mapping\n    lookup: HashMap<String, u32>,    // URL -> ID for dedup\n    free_list: Vec<u32>,            // Reusable IDs\n}\n\n### Implementation\nimpl LinkRegistry {\n    pub fn new() -> Self {\n        Self {\n            links: Vec::new(),\n            lookup: HashMap::new(),\n            free_list: Vec::new(),\n        }\n    }\n\n    /// Register a URL, returning existing ID if present\n    pub fn register(&mut self, url: &str) -> u32 {\n        // Check for existing\n        if let Some(&id) = self.lookup.get(url) {\n            return id;\n        }\n\n        // Allocate new ID\n        let id = self.free_list.pop().unwrap_or_else(|| {\n            let idx = self.links.len() as u32;\n            self.links.push(None);\n            idx\n        });\n\n        self.links[id as usize] = Some(url.to_string());\n        self.lookup.insert(url.to_string(), id);\n        id\n    }\n\n    /// Get URL for ID\n    pub fn get(&self, id: u32) -> Option<&str> {\n        self.links.get(id as usize)\n            .and_then(|slot| slot.as_ref())\n            .map(|s| s.as_str())\n    }\n\n    /// Unregister a link (for cleanup)\n    pub fn unregister(&mut self, id: u32) {\n        if let Some(Some(url)) = self.links.get(id as usize).cloned() {\n            self.lookup.remove(&url);\n            self.links[id as usize] = None;\n            self.free_list.push(id);\n        }\n    }\n\n    /// Check if ID is valid\n    pub fn contains(&self, id: u32) -> bool {\n        self.links.get(id as usize)\n            .map(|slot| slot.is_some())\n            .unwrap_or(false)\n    }\n\n    pub fn len(&self) -> usize {\n        self.links.iter().filter(|l| l.is_some()).count()\n    }\n}\n\n## Link Lifecycle in Rendering\n1. When drawing a cell with a link:\n   - Register URL with registry\n   - Store link_id in CellAttrs\n\n2. When presenting:\n   - Check if link_id changed from tracked state\n   - If changed, emit OSC 8 open/close sequences\n\n3. After frame:\n   - Links not used can be unregistered (optional GC)\n\n## Tests Required\n- [ ] register() returns same ID for same URL\n- [ ] register() returns different IDs for different URLs\n- [ ] get() retrieves correct URL\n- [ ] unregister() frees slot\n- [ ] Free list reuses IDs\n- [ ] contains() correct for valid/invalid IDs\n\n## Acceptance Criteria\n- [ ] All tests pass\n- [ ] No unsafe code\n- [ ] Deduplication works correctly","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:13:53.031307640Z","created_by":"ubuntu","updated_at":"2026-01-31T22:21:59.746043980Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.4.2","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T22:21:59.746016368Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4.2","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:13:53.031307640Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.4.3","title":"Implement Presenter with state-tracked ANSI emission","description":"# Implement Presenter with state-tracked ANSI emission\n\n## Objective\nImplement the core ANSI emitter that transforms buffer diffs into terminal output with minimal bytes.\n\n## Technical Design\n\n### State Tracking\nTrack current terminal state to avoid redundant sequences:\n- current_style: Option<CellStyle> (fg, bg, attrs)\n- current_link: Option<u32> (link ID)\n- cursor_x, cursor_y: u16 (cursor position)\n\n### Structure\npub struct Presenter<W: Write> {\n    writer: BufWriter<W>,    // 64KB buffer\n    current_style: Option<CellStyle>,\n    current_link: Option<u32>,\n    cursor_x: u16,\n    cursor_y: u16,\n    capabilities: TerminalCapabilities,\n}\n\n#[derive(Clone, Copy, PartialEq, Eq)]\nstruct CellStyle {\n    fg: PackedRgba,\n    bg: PackedRgba,\n    attrs: StyleFlags,\n}\n\n### Implementation\n\nimpl<W: Write> Presenter<W> {\n    pub fn new(writer: W, capabilities: TerminalCapabilities) -> Self {\n        Self {\n            writer: BufWriter::with_capacity(64 * 1024, writer),\n            current_style: None,\n            current_link: None,\n            cursor_x: 0,\n            cursor_y: 0,\n            capabilities,\n        }\n    }\n\n    /// Present a frame using diff\n    pub fn present(\n        &mut self,\n        buffer: &Buffer,\n        diff: &BufferDiff,\n        pool: &GraphemePool,\n        links: &LinkRegistry,\n    ) -> io::Result<()> {\n        // Begin synchronized output\n        if self.capabilities.sync_output {\n            self.writer.write_all(b\"\\x1b[?2026h\")?;\n        }\n\n        // Emit diff using run grouping\n        self.emit_diff(buffer, diff, pool, links)?;\n\n        // Reset style at end (clean state)\n        self.writer.write_all(b\"\\x1b[0m\")?;\n        self.current_style = None;\n\n        // Close any open link\n        if self.current_link.is_some() {\n            self.writer.write_all(b\"\\x1b]8;;\\x1b\\\\\")?;\n            self.current_link = None;\n        }\n\n        // End synchronized output\n        if self.capabilities.sync_output {\n            self.writer.write_all(b\"\\x1b[?2026l\")?;\n        }\n\n        self.writer.flush()\n    }\n\n    fn emit_diff(...) -> io::Result<()> {\n        for run in diff.runs(buffer.width()) {\n            // Single cursor move per run\n            self.move_cursor_to(run.x0, run.y)?;\n\n            // Emit cells (cursor advances naturally)\n            for x in run.x0..=run.x1 {\n                let cell = buffer.get_unchecked(x, run.y);\n                self.emit_cell(cell, pool, links)?;\n            }\n        }\n        Ok(())\n    }\n\n    fn emit_cell(...) -> io::Result<()> {\n        if cell.is_continuation() { return Ok(()); }\n\n        self.emit_style_changes(cell)?;\n        self.emit_link_changes(cell, links)?;\n        self.emit_content(cell, pool)?;\n\n        self.cursor_x += cell.width() as u16;\n        Ok(())\n    }\n\n    fn emit_style_changes(&mut self, cell: &Cell) -> io::Result<()> {\n        // v1: Reset+apply strategy (per ADR-002)\n        // Emit SGR 0 then apply all attributes\n        // Optimization: skip if style unchanged\n    }\n\n    fn emit_link_changes(&mut self, cell: &Cell, registry: &LinkRegistry) -> io::Result<()> {\n        // Open/close OSC 8 links as needed\n    }\n\n    fn emit_content(&mut self, cell: &Cell, pool: &GraphemePool) -> io::Result<()> {\n        // Emit char or grapheme from pool\n    }\n\n    fn move_cursor_to(&mut self, x: u16, y: u16) -> io::Result<()> {\n        if self.cursor_x == x && self.cursor_y == y { return Ok(()); }\n        write!(self.writer, \"\\x1b[{};{}H\", y + 1, x + 1)?;\n        self.cursor_x = x;\n        self.cursor_y = y;\n        Ok(())\n    }\n}\n\n## ANSI Sequences Reference\n- Cursor position: CSI row ; col H (1-indexed)\n- SGR reset: CSI 0 m\n- SGR attributes: CSI n ; n ; ... m\n- True color fg: CSI 38 ; 2 ; r ; g ; b m\n- True color bg: CSI 48 ; 2 ; r ; g ; b m\n- OSC 8 open: OSC 8 ; ; url ST\n- OSC 8 close: OSC 8 ; ; ST\n- Sync begin: CSI ? 2026 h\n- Sync end: CSI ? 2026 l\n\n## Tests Required\n- [ ] present() produces valid ANSI\n- [ ] Style tracking avoids redundant SGR\n- [ ] Link tracking opens/closes correctly\n- [ ] Cursor moves are minimized via runs\n- [ ] Empty diff produces no cell output\n- [ ] Sync output wrapped when supported\n\n## Acceptance Criteria\n- [ ] Terminal-model tests pass\n- [ ] PTY tests show correct output\n- [ ] Single write per frame (buffered)\n- [ ] No style/link leaks after present","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:14:16.508100183Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:00.259747605Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.4.3","depends_on_id":"bd-10i.2.5","type":"blocks","created_at":"2026-01-31T22:22:00.259710385Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4.3","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:14:16.508100183Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4.3","depends_on_id":"bd-10i.4.1","type":"blocks","created_at":"2026-01-31T22:21:59.992602219Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.4.4","title":"Implement TerminalCapabilities detection","description":"# Implement TerminalCapabilities detection\n\n## Objective\nImplement environment-based capability detection for adapting to different terminals.\n\n## Detection Logic Summary\n\n### Color Support\ntrue_color = \\!NO_COLOR && (\n    COLORTERM in [truecolor, 24bit] ||\n    TERM contains [kitty, wezterm, alacritty, ghostty] ||\n    TERM_PROGRAM in [iTerm.app, WezTerm, Alacritty, Ghostty]\n)\n\ncolors_256 = true_color || TERM contains 256color\n\n### Synchronized Output (DEC 2026)\nsync_output = TERM_PROGRAM in [WezTerm, Alacritty, Ghostty] ||\n              TERM contains kitty ||\n              KITTY_WINDOW_ID set\n\n### OSC 8 Hyperlinks\nosc8_hyperlinks = \\!NO_COLOR && (\n    TERM_PROGRAM in [iTerm.app, WezTerm, Ghostty] ||\n    TERM contains kitty\n)\n\n### Multiplexer Detection\nin_tmux = TMUX env var set\nin_screen = STY env var set\nin_zellij = ZELLIJ env var set\n\n### Input Features\nkitty_keyboard = TERM contains kitty || KITTY_WINDOW_ID set\nfocus_events = true (widely supported)\nbracketed_paste = true (widely supported)\nmouse_sgr = true (widely supported)\n\n### Scroll Region (DECSTBM)\nscroll_region = TERM \\!= dumb\n\n### OSC 52 Clipboard\nosc52_clipboard = \\!in_any_mux && TERM \\!= dumb\n(Security restricted in mux environments)\n\n## Environment Variables Used\n- NO_COLOR: Disable color (de-facto standard)\n- COLORTERM: Color capability hint\n- TERM: Terminal type\n- TERM_PROGRAM: Terminal application name\n- TMUX: tmux socket path (indicates tmux)\n- STY: screen session name (indicates screen)\n- ZELLIJ: Zellij session\n- KITTY_WINDOW_ID: Kitty window identifier\n\n## Implementation\nimpl TerminalCapabilities {\n    pub fn detect() -> Self {\n        let no_color = std::env::var('NO_COLOR').is_ok();\n        let colorterm = std::env::var('COLORTERM').unwrap_or_default();\n        let term = std::env::var('TERM').unwrap_or_default();\n        let term_program = std::env::var('TERM_PROGRAM').unwrap_or_default();\n\n        let in_tmux = std::env::var('TMUX').is_ok();\n        let in_screen = std::env::var('STY').is_ok();\n        let in_zellij = std::env::var('ZELLIJ').is_ok();\n\n        // ... detection logic ...\n\n        Self { ... }\n    }\n\n    pub fn basic() -> Self {\n        // Minimal fallback: no advanced features\n    }\n\n    pub fn in_any_mux(&self) -> bool {\n        self.in_tmux || self.in_screen || self.in_zellij\n    }\n}\n\n## Tests Required\n- [ ] NO_COLOR disables color features\n- [ ] COLORTERM=truecolor enables true_color\n- [ ] Known terminals detected correctly\n- [ ] Multiplexer detection works\n- [ ] basic() returns conservative defaults\n\n## Acceptance Criteria\n- [ ] All common terminals detected correctly\n- [ ] Conservative fallbacks for unknown\n- [ ] Tests cover major scenarios","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:14:35.007795448Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:00.519638003Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.4.4","depends_on_id":"bd-10i.2.5","type":"blocks","created_at":"2026-01-31T22:22:00.519607715Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.4.4","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:14:35.007795448Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.5","title":"Phase 3: Input System","description":"# Phase 3: Input System\n\n## Purpose\nImplement robust input parsing that handles terminal input sequences while protecting against DoS attacks.\n\n## Event Types\n- Key(KeyEvent): code, modifiers, kind (Press/Repeat/Release)\n- Mouse(MouseEvent): kind, x, y, modifiers\n- Resize { width, height }\n- Paste(PasteEvent): text, bracketed flag\n- Focus(bool): gained/lost\n\n## Parser State Machine\nStates: Ground, Escape, Csi, CsiParam, Osc, Dcs, Ss3\n\n### DoS Protection (CRITICAL)\n- max_csi_len: 256 bytes (prevents CSI bomb)\n- max_osc_len: 4096 bytes\n- max_dcs_len: 4096 bytes\n- max_paste_len: 1MB (configurable)\n- Parser must remain linear time for worst-case inputs\n- No panics on malformed sequences\n\n## Protocols to Support\n1. Standard ASCII + UTF-8\n2. CSI sequences (arrows, function keys, modifiers)\n3. SS3 sequences (alternate function keys)\n4. SGR mouse protocol (1006) for precise coordinates\n5. Bracketed paste mode (200~/201~)\n6. Focus events (CSI I / CSI O)\n7. Optional: Kitty keyboard protocol (feature-gated)\n\n## Event Coalescing (Recommended)\n- Mouse move: keep latest position per frame\n- Resize: keep latest size per tick\n- Key repeat: optionally surface KeyEventKind::Repeat if kitty protocol enabled\n\n## Exit Criteria\n- Parser passes fuzzing with random byte streams\n- Deterministic tests for all key/mouse/paste/resize sequences\n- Hard bounds on sequence lengths enforced\n- No panics on any input\n\n## Success Criteria\n- [ ] All supported protocols decode into canonical Events (lossless for supported sequences).\n- [ ] Hard caps prevent unbounded memory/time (DoS resistance).\n- [ ] Fuzzing runs continuously in CI (or as a separate job) and remains green.\n- [ ] PTY tests prove bracketed paste/mouse/focus modes are enabled/disabled correctly via RAII.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:05:35.653437996Z","created_by":"ubuntu","updated_at":"2026-01-31T23:26:13.403429268Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.5","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:05:35.653437996Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.5","depends_on_id":"bd-10i.4","type":"blocks","created_at":"2026-01-31T22:21:21.059758726Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.5.1","title":"Implement InputParser state machine","description":"# Implement InputParser state machine\n\n## Objective\nImplement robust terminal input parsing with DoS protection.\n\n## Parser States\nenum ParserState {\n    Ground,    // Normal character input\n    Escape,    // After ESC\n    Csi,       // After ESC [\n    CsiParam,  // Collecting CSI parameters\n    Osc,       // After ESC ]\n    Dcs,       // After ESC P\n    Ss3,       // After ESC O\n}\n\n## Transitions\nGround:\n  ESC (0x1B) -> Escape\n  0x00 -> Key(Null, Ctrl)\n  0x01-0x1A -> Key(Ctrl+A..Z)\n  0x7F -> Key(Backspace)\n  0x80+ -> UTF-8 sequence\n  other -> Key(Char)\n\nEscape:\n  [ -> Csi\n  O -> Ss3\n  ] -> Osc\n  P -> Dcs\n  other -> Key(Alt+char) + Ground\n\nCsi:\n  0-9;:<=>? -> CsiParam\n  A-Za-z~ -> parse + Ground\n\nCsiParam:\n  0-9;: -> stay\n  A-Za-z~Mm -> parse + Ground\n\nSs3:\n  A-S -> function key + Ground\n\nOsc:\n  BEL (0x07) -> complete + Ground\n  ESC \\\\ -> complete + Ground\n\n## DoS Protection Limits\nconst MAX_CSI_LEN: usize = 256;   // Prevent CSI bomb\nconst MAX_OSC_LEN: usize = 4096;\nconst MAX_DCS_LEN: usize = 4096;\nconst MAX_PASTE_LEN: usize = 1024 * 1024;  // 1MB\n\nIf limit exceeded: abandon sequence, return to Ground.\n\n## Special Sequences\n\n### Bracketed Paste\nCSI 200 ~ -> start paste mode\nCSI 201 ~ -> end paste mode, emit Paste event\n\n### Focus Events\nCSI I -> Focus(true)\nCSI O -> Focus(false)\n\n### SGR Mouse (1006)\nCSI < params M -> mouse down\nCSI < params m -> mouse up\nparams: button ; x ; y\n\n### Arrow Keys\nCSI A -> Up\nCSI B -> Down\nCSI C -> Right\nCSI D -> Left\n\n### Function Keys\nSs3 P -> F1\nSs3 Q -> F2\netc.\n\nCSI 15 ~ -> F5\nCSI 17 ~ -> F6\netc.\n\n## Implementation\npub struct InputParser {\n    state: ParserState,\n    buffer: Vec<u8>,\n    paste_buffer: Vec<u8>,\n    in_paste: bool,\n    // Limits\n    max_csi_len: usize,\n    max_osc_len: usize,\n    max_paste_len: usize,\n}\n\nimpl InputParser {\n    pub fn new() -> Self { ... }\n\n    pub fn parse(&mut self, input: &[u8]) -> Vec<Event> {\n        let mut events = Vec::new();\n        for &byte in input {\n            if let Some(event) = self.process_byte(byte) {\n                events.push(event);\n            }\n        }\n        events\n    }\n}\n\n## Tests Required\n- [ ] ASCII characters parsed correctly\n- [ ] Arrow keys produce correct events\n- [ ] Function keys F1-F12\n- [ ] Modifiers (Ctrl, Alt, Shift)\n- [ ] Mouse events decoded correctly\n- [ ] Bracketed paste collected\n- [ ] Focus events detected\n- [ ] DoS limits enforced\n- [ ] Invalid sequences don't panic\n\n## Acceptance Criteria\n- [ ] All tests pass\n- [ ] Fuzz testing passes\n- [ ] No panics on any input\n- [ ] Linear time complexity","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:14:55.632491690Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:05.373599141Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.5.1","depends_on_id":"bd-10i.2.4","type":"blocks","created_at":"2026-01-31T22:22:05.373564095Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.5.1","depends_on_id":"bd-10i.5","type":"parent-child","created_at":"2026-01-31T22:14:55.632491690Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.6","title":"Phase 4: Styling (Split Responsibilities)","description":"# Phase 4: Styling (Split Responsibilities)\n\n## Purpose\nImplement a style system that separates concerns: renderer-facing CellStyle is tiny and fast, while higher-level style (theme/semantic colors) resolves into CellStyle before drawing.\n\n## Architecture Decision\nStyle is split by responsibility:\n- CellStyle: tiny, renderer-facing (packed fg/bg/attrs/link-id)\n- FullStyle: higher-level with all properties + explicit tracking via bitflags\n- Theme: semantic color slots + presets\n\n## Components\n\n### StyleFlags (8 bits)\nBOLD, DIM, ITALIC, UNDERLINE, BLINK, REVERSE, STRIKETHROUGH, HIDDEN\n\n### Props Bitflags (explicit property tracking)\nTracks which properties are explicitly set for proper inheritance.\nUnset properties inherit from parent style.\n\n### Color System\n- AdaptiveColor: can resolve differently for light/dark themes\n- ColorProfile detection: Ascii, Ansi (16), Ansi256 (256), TrueColor (24-bit)\n- Color downgrade: TrueColor -> 256 -> 16 -> ASCII\n- NO_COLOR environment variable respected\n\n### Border System\n- Presets: Rounded, Square, Double, Heavy, Ascii, Hidden\n- Custom borders supported\n- All corner and edge characters defined\n\n### Markup Parser (Optional Layer)\n- Regex-based parser for Rich-style markup: [bold red]text[/]\n- Escape sequences: \\[ becomes literal [\n- Style stack for proper nesting\n- Feature-gated, not part of kernel\n\n## Exit Criteria\n- Deterministic style merge with explicit masks\n- Theme resolution documented and tested\n- Markup parsing correct under tests (feature-gated)\n- Color downgrade works for all profile levels\n\n## Success Criteria\n- [ ] Style merge semantics are deterministic and documented (no hidden precedence).\n- [ ] Color downgrade is correct and tested across profiles.\n- [ ] Border presets are defined and used consistently by widgets.\n- [ ] Markup parsing is optional and cannot destabilize the kernel.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-31T22:05:49.668320221Z","created_by":"ubuntu","updated_at":"2026-01-31T23:26:30.002720740Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.6","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:05:49.668320221Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.6","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T22:21:21.317323021Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.7","title":"Phase 5: Layout + Components (Widgets Ring)","description":"# Phase 5: Layout + Components (Widgets Ring)\n\n## Purpose\nImplement the widget layer that builds on kernel primitives. Widgets are ring-2 concepts - they depend on the kernel but the kernel does not depend on them.\n\n## Renderable Trait\nThe core abstraction for components:\n- measure(&self, ctx: &RenderContext) -> Measurement / TextMeasurement\n- render(&self, ctx: &RenderContext, rect: Rect, buffer: &mut Buffer)\n\n## Measurement Protocol\n- minimum: tightest compression width\n- maximum: ideal unconstrained width\n- union(): for side-by-side layout (max of both)\n- stack(): for vertical stacking (sum of both)\n\n## v1 Essential Widgets (Agent Harness Needs)\n\n### Viewport / Log Viewer\n- Scrollable text area for streaming logs\n- Essential for agent harness UIs\n\n### Panel\n- Bordered container with optional title\n- Border presets: Rounded, Square, Double, Heavy, Ascii, Hidden\n- Title alignment: Left, Center, Right\n\n### Spinner\n- Animated progress indicator\n- Styles: Dots, Line, Braille, Bounce, Custom\n- Frame advancement via tick()\n\n### Progress Bar\n- Value 0.0-1.0 with optional percentage display\n- Customizable filled/empty characters and colors\n\n### Text Input / Prompt\n- Single-line editable text field\n- Cursor management (selection/history can be future)\n\n### Status Line\n- Fixed-position information display\n- For tool indicators, status messages\n\n## Hit Testing (Optional)\nHitGrid for mouse affordances - maps screen positions to interactive elements.\n\n## Exit Criteria\n- Snapshot tests for all widgets across themes and sizes\n- Hit testing works where applicable\n- Widgets compose correctly via Renderable trait\n\n## Success Criteria\n- [ ] Harness-essential widgets exist and are tested (unit + snapshot + PTY where needed).\n- [ ] Widgets build only on kernel primitives (no hidden writes; no kernel deps on widgets).\n- [ ] Layout/measurement behavior is deterministic and documented.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-31T22:06:02.781831931Z","created_by":"ubuntu","updated_at":"2026-01-31T23:26:47.242701721Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.7","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:06:02.781831931Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.7","depends_on_id":"bd-10i.5","type":"blocks","created_at":"2026-01-31T22:21:21.822401345Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.7","depends_on_id":"bd-10i.6","type":"blocks","created_at":"2026-01-31T22:21:21.560738568Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8","title":"Phase 6: Runtime + Agent Harness Reference App","description":"# Phase 6: Runtime + Agent Harness Reference App\n\n## Purpose\nImplement the optional-but-recommended Bubbletea/Elm-style runtime and build a reference agent harness app that proves the architecture works for its primary use case.\n\n## Runtime Model (Bubbletea/Elm Lineage)\n\n### Model Trait\n- init() -> Cmd: initialization commands\n- update(msg) -> Cmd: state transitions\n- view(&self, frame: &mut Frame): render current state\n\n### Cmd Enum\n- None: no-op\n- Quit: exit application\n- Batch(Vec<Cmd>): parallel commands\n- Sequence(Vec<Cmd>): sequential commands\n- Msg(M): send message to self\n- Tick(Duration): schedule tick\n- Async integration (feature-gated): threadpool or tokio\n\n### Program Responsibilities\n- Own terminal lifecycle (raw mode, mouse, paste, focus, alt screen)\n- Poll input -> Event -> Message\n- Run update loop, schedule ticks/commands\n- Render frames only when dirty\n- Enforce screen mode policy (Inline/AltScreen)\n- FPS cap and frame coalescing\n\n## Deterministic Simulator (Stop regressions forever)\nProgramSimulator that:\n- Injects sequence of Events/Messages\n- Captures produced Frames\n- Enables snapshot tests for widgets and full apps\n- Runs without real terminal (no flakiness)\n\n## Agent Harness Reference App\nThe design forcing function - not 'just an example':\n- Inline scrollback log stream + UI region\n- Tool indicators, status line, input area\n- Streaming render updates\n- No flicker, no corruption\n- Survives resize\n- Exits cleanly on panic\n\n## What 'Agent-Ergonomic' Means in Practice\n- Hello world harness in <200 LOC\n- Tool output streaming is one function call\n- Pinned bottom UI is one config option\n- Temporary full-screen modal supported without rewriting app\n\n## Exit Criteria\n- Harness demo passes PTY tests\n- Inline mode stable under sustained output\n- Simulator enables deterministic testing\n\n## Success Criteria\n- [ ] Runtime enables the \"pit of success\" (easy inline harness with strong defaults).\n- [ ] One-writer routing is practical (LogSink + PTY capture paths exist).\n- [ ] Sanitization is enforced by default for untrusted output.\n- [ ] Simulator produces stable snapshots and prevents regressions.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-31T22:06:20.392811659Z","created_by":"ubuntu","updated_at":"2026-01-31T23:27:04.824958170Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:06:20.392811659Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8","depends_on_id":"bd-10i.7","type":"blocks","created_at":"2026-01-31T22:21:22.065119348Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.1","title":"Implement TerminalWriter with inline mode support","description":"# Implement TerminalWriter with inline mode support\n\n## Objective\nImplement the unified terminal output coordinator that enforces the one-writer rule and implements inline mode correctly.\n\n## Why TerminalWriter?\nThe TerminalWriter is the component that makes inline mode work. It:\n- Serializes log writes and UI presents\n- Implements the cursor save/restore contract\n- Manages scroll regions (when optimization enabled)\n- Ensures single buffered write per operation\n\n## Architecture\npub struct TerminalWriter<W: Write> {\n    session: TerminalSession<W>,\n    presenter: Presenter<W>,\n    screen_mode: ScreenMode,\n    ui_anchor: UiAnchor,\n    prev_buffer: Buffer,\n    pool: GraphemePool,\n    links: LinkRegistry,\n}\n\npub enum ScreenMode {\n    Inline { ui_height: u16 },\n    AltScreen,\n}\n\npub enum UiAnchor {\n    Bottom,  // Default for agent harness\n    Top,\n}\n\n## Inline Mode Present Sequence (Overlay Redraw)\n\npub fn present_ui(&mut self, buffer: &Buffer) -> io::Result<()> {\n    if let ScreenMode::Inline { ui_height } = self.screen_mode {\n        // 1. Begin sync output if available\n        if self.session.capabilities().sync_output {\n            write!(self.writer, '\\x1b[?2026h')?;\n        }\n\n        // 2. Save cursor (DEC or ANSI)\n        write!(self.writer, '\\x1b7')?;  // DEC save\n\n        // 3. Move to UI anchor\n        let (_, term_height) = self.terminal_size();\n        let ui_y = term_height - ui_height;\n        write!(self.writer, '\\x1b[{};1H', ui_y + 1)?;\n\n        // 4. Clear UI region only (not full screen!)\n        for _ in 0..ui_height {\n            write!(self.writer, '\\x1b[2K\\n')?;  // Clear line\n        }\n        write!(self.writer, '\\x1b[{};1H', ui_y + 1)?;  // Back to anchor\n\n        // 5. Present diffed UI\n        let diff = BufferDiff::compute(&self.prev_buffer, buffer);\n        self.presenter.present(buffer, &diff, &self.pool, &self.links)?;\n\n        // 6. Restore cursor\n        write!(self.writer, '\\x1b8')?;  // DEC restore\n\n        // 7. End sync output\n        if self.session.capabilities().sync_output {\n            write!(self.writer, '\\x1b[?2026l')?;\n        }\n\n        self.writer.flush()?;\n        std::mem::swap(&mut self.prev_buffer, buffer);\n    }\n    Ok(())\n}\n\n## Log Writing (Inline Mode)\npub fn write_log(&mut self, text: &str) -> io::Result<()> {\n    if let ScreenMode::Inline { .. } = self.screen_mode {\n        // Log writes go to scrollback region (above UI)\n        // Just write normally - terminal scrolls\n        // The next present_ui will redraw UI in correct position\n        self.writer.write_all(text.as_bytes())?;\n        self.writer.flush()\n    } else {\n        // AltScreen: no scrollback, might need different handling\n        Ok(())\n    }\n}\n\n## Scroll Region Optimization (Optional)\nWhen capabilities.scroll_region and policy allows:\n- Set DECSTBM to constrain scrolling\n- Log writes stay in scroll region\n- UI stays pinned outside scroll region\n- Must restore on exit\n\n## Tests Required\n- [ ] present_ui doesn't corrupt scrollback\n- [ ] Cursor restored to correct position\n- [ ] Multiple present/log cycles stable\n- [ ] Resize handled correctly\n- [ ] PTY tests verify behavior\n\n## Acceptance Criteria\n- [ ] Inline mode works without flicker\n- [ ] PTY tests pass\n- [ ] Cursor contract enforced\n- [ ] No scrollback corruption","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:16:09.208130189Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:26.927218289Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.1","depends_on_id":"bd-10i.10.1","type":"blocks","created_at":"2026-01-31T22:22:26.927181830Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.1","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T22:22:26.665689264Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.1","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T22:16:09.208130189Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.2","title":"Implement Program/Model/Cmd runtime","description":"# Implement Program/Model/Cmd runtime\n\n## Objective\nImplement the Bubbletea/Elm-style runtime that manages the update/view loop.\n\n## Why This Runtime?\n- Separates state (Model) from rendering (View)\n- Makes apps testable via deterministic simulator\n- Handles event loop complexity\n- Provides command pattern for side effects\n\n## Core Trait\npub trait Model: Sized {\n    type Message: From<Event> + Send + 'static;\n\n    /// Initialize model, return startup commands\n    fn init(&mut self) -> Cmd<Self::Message> {\n        Cmd::none()\n    }\n\n    /// Handle message, return commands\n    fn update(&mut self, msg: Self::Message) -> Cmd<Self::Message>;\n\n    /// Render current state to frame\n    fn view(&self, frame: &mut Frame);\n}\n\n## Command Type\npub enum Cmd<M> {\n    None,\n    Quit,\n    Batch(Vec<Cmd<M>>),      // Parallel execution\n    Sequence(Vec<Cmd<M>>),   // Sequential execution\n    Msg(M),                  // Send message to self\n    Tick(Duration),          // Schedule tick\n    // Feature-gated async\n    #[cfg(feature = 'async')]\n    Async(BoxFuture<'static, M>),\n}\n\nimpl<M> Cmd<M> {\n    pub fn none() -> Self { Self::None }\n    pub fn quit() -> Self { Self::Quit }\n    pub fn msg(m: M) -> Self { Self::Msg(m) }\n    pub fn batch(cmds: Vec<Self>) -> Self { Self::Batch(cmds) }\n    pub fn tick(d: Duration) -> Self { Self::Tick(d) }\n}\n\n## Program (Runtime)\npub struct Program<M: Model> {\n    model: M,\n    writer: TerminalWriter<Stdout>,\n    input_parser: InputParser,\n    running: bool,\n    tick_rate: Option<Duration>,\n    last_tick: Instant,\n    dirty: bool,\n}\n\nimpl<M: Model> Program<M> {\n    pub fn new(model: M, screen_mode: ScreenMode) -> io::Result<Self> {\n        // Set up terminal\n        // Initialize writer\n        // Start input thread/poll\n    }\n\n    pub fn run(&mut self) -> io::Result<()> {\n        // Initialize\n        let cmd = self.model.init();\n        self.execute_cmd(cmd)?;\n\n        // Main loop\n        while self.running {\n            // Poll for input (with tick timeout)\n            if let Some(event) = self.poll_event()? {\n                let msg = M::Message::from(event);\n                let cmd = self.model.update(msg);\n                self.execute_cmd(cmd)?;\n                self.dirty = true;\n            }\n\n            // Tick handling\n            if self.should_tick() {\n                // Send tick message or just re-render\n                self.dirty = true;\n            }\n\n            // Render if dirty\n            if self.dirty {\n                let mut frame = self.new_frame();\n                self.model.view(&mut frame);\n                self.writer.present_ui(&frame.buffer)?;\n                self.dirty = false;\n            }\n        }\n\n        Ok(())\n    }\n\n    fn execute_cmd(&mut self, cmd: Cmd<M::Message>) -> io::Result<()> {\n        match cmd {\n            Cmd::None => {}\n            Cmd::Quit => self.running = false,\n            Cmd::Msg(m) => {\n                let cmd = self.model.update(m);\n                self.execute_cmd(cmd)?;\n            }\n            Cmd::Batch(cmds) => {\n                for c in cmds {\n                    self.execute_cmd(c)?;\n                }\n            }\n            Cmd::Tick(d) => {\n                self.tick_rate = Some(d);\n            }\n            // ...\n        }\n        Ok(())\n    }\n}\n\n## App Builder (Ergonomic Entry Point)\npub struct App;\n\nimpl App {\n    pub fn new<M: Model>(model: M) -> AppBuilder<M> {\n        AppBuilder { model, screen_mode: ScreenMode::Inline { ui_height: 4 } }\n    }\n}\n\npub struct AppBuilder<M: Model> {\n    model: M,\n    screen_mode: ScreenMode,\n}\n\nimpl<M: Model> AppBuilder<M> {\n    pub fn screen_mode(mut self, mode: ScreenMode) -> Self {\n        self.screen_mode = mode;\n        self\n    }\n\n    pub fn run(self) -> Result<()> {\n        let mut program = Program::new(self.model, self.screen_mode)?;\n        program.run()?;\n        Ok(())\n    }\n}\n\n## Tests Required\n- [ ] Model::update called on events\n- [ ] Model::view called on dirty\n- [ ] Cmd::Quit stops loop\n- [ ] Cmd::Batch executes all\n- [ ] Tick scheduling works\n\n## Acceptance Criteria\n- [ ] Hello world app works\n- [ ] Deterministic when using simulator\n- [ ] Clean shutdown","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:16:30.741993686Z","created_by":"ubuntu","updated_at":"2026-01-31T23:13:17.213277522Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.2","depends_on_id":"bd-10i.2.6","type":"blocks","created_at":"2026-01-31T22:22:27.425356768Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.2","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T23:13:16.618229494Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.2","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T22:16:30.741993686Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.2","depends_on_id":"bd-10i.8.1","type":"blocks","created_at":"2026-01-31T23:13:16.002859148Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.2","depends_on_id":"bd-3cc","type":"blocks","created_at":"2026-01-31T23:13:17.213239651Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.3","title":"Implement ProgramSimulator for deterministic testing","description":"# Implement ProgramSimulator for deterministic testing\n\n## Objective\nCreate a simulator that runs Model logic deterministically without a real terminal.\n\n## Why Simulator?\n- Tests must be deterministic (no real terminal)\n- Snapshot tests for widgets and apps\n- Can inject arbitrary event sequences\n- No flakiness from timing/IO\n\n## Structure\npub struct ProgramSimulator<M: Model> {\n    model: M,\n    frames: Vec<Buffer>,\n    messages: Vec<M::Message>,\n    time: Instant,  // Simulated time\n}\n\nimpl<M: Model> ProgramSimulator<M> {\n    pub fn new(model: M) -> Self {\n        Self {\n            model,\n            frames: Vec::new(),\n            messages: Vec::new(),\n            time: Instant::now(),\n        }\n    }\n\n    /// Inject events and process\n    pub fn inject_events(&mut self, events: &[Event]) {\n        for event in events {\n            let msg = M::Message::from(event.clone());\n            self.messages.push(msg.clone());\n            let _cmd = self.model.update(msg);\n            // Note: Commands are captured but not executed\n            // (async/IO commands meaningless in simulation)\n        }\n    }\n\n    /// Send specific message\n    pub fn send(&mut self, msg: M::Message) {\n        self.messages.push(msg.clone());\n        let _cmd = self.model.update(msg);\n    }\n\n    /// Capture current frame\n    pub fn capture_frame(&mut self, width: u16, height: u16) -> &Buffer {\n        let mut frame = Frame {\n            buffer: Buffer::new(width, height),\n            hit_grid: None,\n            cursor_position: None,\n            cursor_visible: true,\n        };\n        self.model.view(&mut frame);\n        self.frames.push(frame.buffer);\n        self.frames.last().unwrap()\n    }\n\n    /// Get all captured frames\n    pub fn frames(&self) -> &[Buffer] {\n        &self.frames\n    }\n\n    /// Get message history\n    pub fn messages(&self) -> &[M::Message] {\n        &self.messages\n    }\n\n    /// Advance simulated time\n    pub fn advance_time(&mut self, duration: Duration) {\n        self.time += duration;\n    }\n\n    /// Get current model reference\n    pub fn model(&self) -> &M {\n        &self.model\n    }\n}\n\n## Snapshot Testing Pattern\n#[test]\nfn counter_snapshot() {\n    let mut sim = ProgramSimulator::new(Counter { value: 0 });\n\n    // Inject key press\n    sim.inject_events(&[Event::Key(KeyEvent {\n        code: KeyCode::Char('+'),\n        modifiers: Modifiers::empty(),\n    })]);\n\n    // Capture frame\n    let frame = sim.capture_frame(80, 24);\n\n    // Compare with golden snapshot\n    insta::assert_snapshot!(frame_to_string(frame));\n}\n\n## Widget Testing Pattern\n#[test]\nfn spinner_frames() {\n    let mut spinner = Spinner::new('Loading');\n    let ctx = RenderContext::test();\n    let mut frames = Vec::new();\n\n    for _ in 0..10 {\n        spinner.tick();\n        let mut buf = Buffer::new(20, 1);\n        spinner.render(&ctx, Rect::new(0, 0, 20, 1), &mut buf);\n        frames.push(buf);\n    }\n\n    // Verify animation frames differ\n    assert_ne!(frames[0], frames[1]);\n}\n\n## Tests Required\n- [ ] inject_events processes all\n- [ ] capture_frame renders correctly\n- [ ] Messages recorded in order\n- [ ] Works without terminal\n\n## Acceptance Criteria\n- [ ] Snapshot tests work\n- [ ] No IO dependencies\n- [ ] Deterministic results","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:16:48.395010451Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:27.666172346Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.3","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T22:16:48.395010451Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.3","depends_on_id":"bd-10i.8.2","type":"blocks","created_at":"2026-01-31T22:22:27.666141989Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.4","title":"Implement sanitize-by-default for untrusted output (ADR-006)","description":"# Implement sanitize-by-default for untrusted output (ADR-006)\n\n## Background\nNon-negotiable contract (plan 0.1.1 + ADR-006): any untrusted bytes displayed as logs/tool output/LLM streams must be treated as **data**, not executed as terminal control sequences.\n\nThis is a safety requirement and a correctness requirement (cursor invariants).\n\n## Scope\n- Provide a sanitizer that removes or escapes:\n  - ESC (0x1B) sequences: CSI/OSC/DCS/APC/etc.\n  - C0 controls except those we intentionally allow (typically: `\\n`, `\\r`, `\\t`)\n- Integrate sanitizer into:\n  - `TerminalWriter::write_log(...)`\n  - any other \"write external bytes\" path\n\n## API shape\n- Default safe API:\n  - `write_log(&str)` sanitizes\n  - `write_log_bytes(&[u8])` sanitizes (reject invalid UTF-8 or replace?)\n- Explicit opt-in raw passthrough API:\n  - `write_raw(&[u8])` (loud docs + feature gate if needed)\n  - optional `Text::raw(...)` or `Text::trusted_ansi(...)`\n\n## Design notes\n- Sanitization must be fast (log streaming hot path).\n- Avoid allocations where possible:\n  - fast path: detect absence of ESC/control bytes and return borrowed slice\n  - slow path: allocate and filter\n\n## Tests\n- Unit tests for sanitizer:\n  - strips CSI sequences\n  - strips OSC sequences\n  - handles truncated/malformed escape sequences safely\n  - preserves allowed controls (\\n/\\r/\\t)\n- Integration tests:\n  - feed adversarial escape sequences into write_log and assert no terminal mutations occur (via terminal-model and PTY tests)\n\n## Acceptance Criteria\n- [ ] Sanitizer implementation exists with clear policy for allowed controls.\n- [ ] write_log defaults to sanitizing.\n- [ ] Raw passthrough exists but is explicit and documented.\n- [ ] Adversarial tests (bd-397) pass.","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T23:12:01.192774597Z","created_by":"ubuntu","updated_at":"2026-01-31T23:12:01.192774597Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.4","depends_on_id":"bd-10i.10.6","type":"blocks","created_at":"2026-01-31T23:12:01.192774597Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.4","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T23:12:01.192774597Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.5","title":"Implement LogSink for in-process output routing","description":"# Implement LogSink for in-process output routing\n\n## Background\nPlan 0.9.4 and ADR-005 call out the need for in-process log routing so application code and libraries can write output without violating the one-writer rule.\n\nIn real harnesses, we want:\n- a `Write` implementation (or similar) that forwards to `TerminalWriter::write_log`\n- sanitization by default (ADR-006)\n- newline-aware behavior (avoid breaking prompt/UI)\n\n## Deliverable\nProvide a type like:\n- `LogSink` implementing `std::io::Write`\n- plus an ergonomic constructor from `TerminalWriter` / `TerminalSession`\n\n## Behavior\n- Buffers partial lines until newline (or flush)\n- On newline:\n  - forward the complete line through `TerminalWriter::write_log`\n  - trigger any required UI redraw coordination\n- Applies sanitizer by default\n\n## Tests\n- Unit tests:\n  - partial writes are buffered\n  - newline flushes\n  - explicit flush flushes\n  - sanitizer applied\n- Integration tests:\n  - interleave log writes and UI presents and assert UI remains stable (terminal-model + PTY)\n\n## Acceptance Criteria\n- [ ] LogSink exists and is documented as the preferred pattern for in-process output.\n- [ ] Line buffering + flush semantics are correct.\n- [ ] Sanitization is enforced by default.\n- [ ] No deadlocks / re-entrancy issues when used from multiple producers (single-writer enforcement preserved).","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:12:21.164216630Z","created_by":"ubuntu","updated_at":"2026-01-31T23:12:21.164216630Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.5","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T23:12:21.164216630Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.5","depends_on_id":"bd-10i.8.1","type":"blocks","created_at":"2026-01-31T23:12:21.164216630Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.5","depends_on_id":"bd-10i.8.4","type":"blocks","created_at":"2026-01-31T23:12:21.164216630Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.6","title":"Implement PTY capture for subprocess output (one-writer routing)","description":"# Implement PTY capture for subprocess output (one-writer routing)\n\n## Background\nPlan 0.9.4 and ADR-005: For agent harness realism, the most robust way to capture tool subprocess output is to spawn under a PTY and route output through ftui's writer.\n\nPTY capture helps enforce the one-writer rule because:\n- subprocess output cannot directly write to the user's terminal\n- ftui controls how output is displayed (sanitize, chunking, redraw)\n\n## Scope\nFeature-gated PTY capture utilities usable by `ftui-harness`:\n- spawn child process attached to PTY\n- read PTY output asynchronously\n- forward output through `TerminalWriter::write_log` (sanitized by default)\n\n## Design notes\n- This is *not* the same as `ftui-pty` test harness crate.\n  - `ftui-pty` is test-only.\n  - This task is runtime capture functionality (likely in `ftui-extras` or `ftui-harness`).\n- Handle:\n  - stdout/stderr merge semantics (PTY typically merges)\n  - exit status propagation\n  - backpressure / chunking to avoid UI starvation\n\n## Tests\n- Integration tests (PTY):\n  - run a small child process that prints mixed output + escape sequences\n  - assert sanitizer prevents terminal mutation\n  - assert UI redraw remains stable during capture\n\n## Acceptance Criteria\n- [ ] Feature-gated PTY capture API exists.\n- [ ] Output is routed through TerminalWriter/LogSink (no direct terminal writes).\n- [ ] Sanitization is applied by default.\n- [ ] Harness demo uses this path for tool execution.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:12:34.522793321Z","created_by":"ubuntu","updated_at":"2026-01-31T23:12:34.522793321Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.6","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T23:12:34.522793321Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.6","depends_on_id":"bd-10i.8.1","type":"blocks","created_at":"2026-01-31T23:12:34.522793321Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.6","depends_on_id":"bd-10i.8.4","type":"blocks","created_at":"2026-01-31T23:12:34.522793321Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.8.7","title":"Optional: stdio capture/forwarding for accidental println! (best-effort)","description":"# Optional: stdio capture/forwarding for accidental println! (best-effort)\n\n## Background\nADR-005 mentions an optional pattern: capturing stdout/stderr in-process to reduce the chance that third-party libs corrupt inline mode by writing directly.\n\nThis is inherently best-effort and platform-sensitive, so it must be feature-gated and clearly documented.\n\n## Scope\n- Feature-gated utility to capture and forward selected streams through `TerminalWriter::write_log`.\n- Explicitly not a hard guarantee (some output may still escape capture).\n\n## Design constraints\n- Must not deadlock.\n- Must not break normal non-ftui stdout usage.\n- Must be easy to disable.\n\n## Tests\n- Integration tests where feasible (may be limited in CI environments).\n- At minimum, unit tests around forwarding/buffering behavior.\n\n## Acceptance Criteria\n- [ ] Feature-gated capture utility exists.\n- [ ] Documentation clearly explains limitations and when to use PTY capture instead.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T23:12:44.248079720Z","created_by":"ubuntu","updated_at":"2026-01-31T23:12:44.248079720Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.8.7","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T23:12:44.248079720Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.8.7","depends_on_id":"bd-10i.8.5","type":"blocks","created_at":"2026-01-31T23:12:44.248079720Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10i.9","title":"Phase 7: Extras + Polish","description":"# Phase 7: Extras + Polish\n\n## Purpose\nAdd feature-gated extras, complete documentation, run performance audits, and validate terminal compatibility. This is the final polish before v1.\n\n## Documentation Deliverables\n- Rustdoc for all public APIs\n- Agent harness tutorial (inline + modal alt-screen patterns)\n- Inline vs alt-screen explanation (scrollback tradeoffs)\n- One-writer rule guidance + supported routing patterns\n- Windows v1 limitations + compatibility notes\n\n## Examples Gallery\nReference implementations demonstrating:\n- Minimal hello world\n- Streaming log viewer\n- Interactive dashboard\n- Full agent harness\n\n## Performance Audit\n- Verify all budgets met\n- Profile hot paths\n- Benchmark regression tests in CI\n- Track bytes emitted per frame\n\n## Terminal Compatibility Testing\n| Feature | Kitty | WezTerm | Alacritty | Ghostty | iTerm2 | GNOME Term | Win Term |\n|---------|-------|---------|-----------|---------|--------|------------|----------|\n| True Color |  |  |  |  |  |  |  |\n| Sync Output |  |  |  |  |  |  |  |\n| OSC 8 Links |  |  |  |  |  |  |  |\n| Kitty Kbd |  |  |  |  |  |  |  |\n\n## Feature-Gated Extras\n- Markdown renderer\n- Syntax highlighting\n- Forms / pickers\n- Export adapters (HTML/SVG/text)\n- Optional clipboard integration (OSC 52 output)\n\n## CI/CD Setup\n- clippy + fmt enforcement\n- unit/property/snapshot/PTY tests\n- Performance benchmarks as baselines\n- Feature matrix build: default, +extras\n\n## Exit Criteria\n- Stable kernel API\n- Docs + examples complete\n- Performance baselines recorded\n- Compatibility matrix validated\n- All quality gates pass\n\n## Success Criteria\n- [ ] Docs and examples make the library easy to adopt (pit of success).\n- [ ] Extras remain feature-gated and do not destabilize the kernel.\n- [ ] Performance budgets are continuously enforced (bench + CI).","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-31T22:06:35.450846082Z","created_by":"ubuntu","updated_at":"2026-01-31T23:27:35.524128023Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10i.9","depends_on_id":"bd-10i","type":"parent-child","created_at":"2026-01-31T22:06:35.450846082Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10i.9","depends_on_id":"bd-10i.8","type":"blocks","created_at":"2026-01-31T22:21:29.267814226Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-10x","title":"Implement Style struct with cascading/merging","description":"PHASE 4 - STYLING CORE\n\n## Background\nStyle struct is the unified styling type that combines colors, attributes, and modifiers into a single composable unit. Must support cascading/merging like CSS inheritance.\n\n## Technical Requirements\n- Style struct containing:\n  - foreground: Option<PackedRgba>\n  - background: Option<PackedRgba>\n  - attrs: Option<CellAttrs>\n  - underline_color: Option<PackedRgba>\n- Cascading merge: child.merge(parent) fills in None fields from parent\n- Override merge: parent.patch(child) replaces with child's Some values\n- Builder pattern for ergonomic construction\n- impl Default with all None (transparent/inheriting)\n\n## Design Rationale\nOption-wrapped fields enable CSS-like inheritance where unset properties inherit from parent context. This matches user mental model from web development.\n\n## Acceptance Criteria\n- [ ] Style struct with Option-wrapped components\n- [ ] merge() for cascading (child wins on conflict)\n- [ ] patch() for override (explicit values win)\n- [ ] Builder pattern: Style::new().fg(color).bold()\n- [ ] #[derive(Clone, Copy, PartialEq, Eq, Hash)]\n- [ ] Zero-cost when all fields are None\n- [ ] Property tests for merge associativity\n\n## Performance Budget\n- Style merge: < 5ns (branchless bitfield ops)\n- sizeof(Style)  24 bytes\n\n## Location: ftui-style crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:18:29.746530502Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:11.580195940Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10x","depends_on_id":"bd-10i.3.2","type":"blocks","created_at":"2026-01-31T22:22:11.317919006Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-10x","depends_on_id":"bd-10i.3.3","type":"blocks","created_at":"2026-01-31T22:22:11.580166805Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-16k","title":"Unicode width corpus testing with WTF-8","description":"TESTING - UNICODE WIDTH CORPUS\n\n## Background\nUnicode width calculation is notoriously complex with edge cases around emoji, CJK, combining characters, and ZWJ sequences. A comprehensive test corpus is essential for correctness.\n\n## Technical Requirements\n- Test corpus categories:\n  - Basic ASCII (width 1)\n  - CJK Unified Ideographs (width 2)\n  - Fullwidth ASCII variants (width 2)\n  - Halfwidth Katakana (width 1)\n  - Emoji with modifiers (width varies)\n  - ZWJ sequences (flag emoji, family emoji)\n  - Combining characters (width 0)\n  - Control characters (width 0)\n  - Ambiguous width characters (context-dependent)\n- WTF-8 handling for unpaired surrogates\n- Terminal-specific width (vs Unicode Standard)\n- Test against unicode-width crate results\n\n## Known Edge Cases\n-  (family emoji ZWJ) - varies by terminal\n-  (flag ZWJ) - often renders as 2 cells\n- Regional indicators (flag pairs)\n- Variation selectors (VS15/VS16)\n\n## Design Rationale\nCorrectness in width calculation directly impacts rendering quality. The corpus captures real-world edge cases that simple tests miss.\n\n## Acceptance Criteria\n- [ ] Corpus with 1000+ test cases\n- [ ] Categorized by width type\n- [ ] Known terminal-specific behaviors documented\n- [ ] Property tests for grapheme iteration\n- [ ] Fuzz testing for malformed input\n- [ ] Benchmark for width calculation performance\n\n## Location: ftui-text crate tests/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:20:38.382705649Z","created_by":"ubuntu","updated_at":"2026-01-31T23:20:33.615935766Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-16k","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:22:45.728172253Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-16k","depends_on_id":"bd-e211","type":"blocks","created_at":"2026-01-31T23:20:33.615891893Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-19x","title":"Create performance benchmark suite","description":"TESTING - PERFORMANCE BENCHMARKS\n\n## Background\nFrankenTUI has strict performance budgets from the plan. Benchmarks must verify these budgets are met and prevent regressions.\n\n## Performance Budgets (from plan)\n\n### Core Operations\n| Operation | Target | Panic Threshold |\n|-----------|--------|-----------------|\n| Cell comparison | < 1ns | < 5ns |\n| Cell bits_eq SIMD | < 0.5ns | < 2ns |\n| Row comparison (80 cols) | < 100ns | < 500ns |\n| Buffer diff (8024) | < 10s | < 50s |\n\n### Present Operations\n| Scenario | p50 Target | p99 Target |\n|----------|------------|------------|\n| 8024, 5% changed | < 1.0ms | < 3.0ms |\n| 8024, 50% changed | < 2.0ms | < 5.0ms |\n| 20050, 5% changed | < 2.0ms | < 5.0ms |\n| 20050, full redraw | < 10ms | < 25ms |\n\n### Layout Operations\n| Operation | Target | Notes |\n|-----------|--------|-------|\n| Flex solve (10 items) | < 50s | |\n| Flex solve (50 items) | < 200s | |\n| Grid solve (1010) | < 500s | |\n\n### Widget Rendering\n| Widget | Target (per instance) |\n|--------|----------------------|\n| Block | < 50s |\n| Paragraph (100 chars) | < 100s |\n| Table (100 rows visible) | < 500s |\n\n## Technical Requirements\n\n### Benchmark Infrastructure\n- Use criterion crate\n- benches/ directory structure\n- Statistical analysis with confidence intervals\n- Comparison against baseline\n\n### Benchmark Organization\nbenches/\n cell_bench.rs      # Cell operations\n buffer_bench.rs    # Buffer operations  \n diff_bench.rs      # Diff algorithms\n present_bench.rs   # Presenter operations\n layout_bench.rs    # Layout solving\n widget_bench.rs    # Widget rendering\n e2e_bench.rs       # Full pipeline\n\n### Each Benchmark Must\n1. Warm up properly\n2. Use black_box to prevent optimization\n3. Test multiple input sizes\n4. Report memory allocation counts\n5. Compare against budget threshold\n\n### Benchmark Example\nuse criterion::{black_box, criterion_group, criterion_main, Criterion};\n\nfn cell_comparison(c: &mut Criterion) {\n    let cell1 = Cell::default();\n    let cell2 = Cell::char('a');\n    \n    c.bench_function(\"cell_bits_eq_same\", |b| {\n        b.iter(|| black_box(&cell1).bits_eq(black_box(&cell1)))\n    });\n    \n    c.bench_function(\"cell_bits_eq_diff\", |b| {\n        b.iter(|| black_box(&cell1).bits_eq(black_box(&cell2)))\n    });\n}\n\n## Acceptance Criteria\n- [ ] Cell comparison benchmarks\n- [ ] Buffer operation benchmarks\n- [ ] Diff algorithm benchmarks\n- [ ] Present pipeline benchmarks\n- [ ] Layout solver benchmarks\n- [ ] Widget render benchmarks\n- [ ] Budget verification in CI\n- [ ] Baseline comparison reports\n- [ ] Memory allocation tracking\n\n## Location: benches/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:28:46.596540823Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:13.185650979Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-19x","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:29:25.634665985Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-19x","depends_on_id":"bd-10i.4.1","type":"blocks","created_at":"2026-01-31T22:29:25.907101822Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-19x","depends_on_id":"bd-3aqs","type":"blocks","created_at":"2026-01-31T23:22:13.185613398Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1f8","title":"Implement color downgrade (TrueColor  256  16  mono)","description":"PHASE 4 - COLOR DOWNGRADE SYSTEM\n\n## Background\nNot all terminals support TrueColor. The color system must gracefully downgrade colors to match terminal capabilities while maintaining visual coherence.\n\n## Technical Requirements\n\n### Color Profiles (from capabilities)\npub enum ColorProfile {\n    Mono,      // No color (dumb terminal)\n    Ansi16,    // 16 colors (basic)\n    Ansi256,   // 256 colors (xterm)\n    TrueColor, // 24-bit RGB\n}\n\n### Downgrade Chain\nTrueColor  256  16  Mono\n\n### Algorithms\n\n#### RGB to 256-color\nfn rgb_to_256(r: u8, g: u8, b: u8) -> u8 {\n    // Grayscale check first\n    if r == g && g == b {\n        if r < 8 { return 16; }\n        if r > 248 { return 231; }\n        return 232 + ((r - 8) / 10).min(23);\n    }\n    // 666 color cube\n    let r6 = (r as u16 * 6 / 256) as u8;\n    let g6 = (g as u16 * 6 / 256) as u8;\n    let b6 = (b as u16 * 6 / 256) as u8;\n    16 + 36 * r6 + 6 * g6 + b6\n}\n\n#### 256-color to 16-color\n- Map cube colors to nearest ANSI color\n- Preserve bright/normal distinction\n- Use perceptual color distance (not Euclidean RGB)\n\n#### 16-color to Mono\n- Convert to brightness value\n- Above threshold = white, below = black\n- Optionally use bold for emphasis\n\n### Caching\n- Cache downgraded colors (LRU or hash)\n- Profile is detected once at startup\n- Colors resolved at render time\n\n### Theme Integration\nThemes should define colors at highest fidelity.\nPresenter applies downgrade based on detected profile.\n\n## Tests Required\n- [ ] TrueColor passthrough works\n- [ ] 256-color conversion accurate\n- [ ] 16-color conversion visually reasonable\n- [ ] Mono fallback works\n- [ ] Grayscale optimization\n- [ ] Cache hit rate acceptable\n- [ ] Profile detection accurate\n\n## Acceptance Criteria\n- [ ] All profiles supported\n- [ ] Downgrade preserves intent\n- [ ] No performance regression\n- [ ] Theme colors degrade gracefully\n- [ ] Works in tmux/screen\n\n## Location: ftui-style crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:31:11.659117391Z","created_by":"ubuntu","updated_at":"2026-01-31T22:32:19.672075013Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1f8","depends_on_id":"bd-10i.3.2","type":"blocks","created_at":"2026-01-31T22:32:19.672042682Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho","title":"Rich Core Infrastructure (rich_rust port)","description":"Epic for porting core infrastructure from rich_rust. These are foundational modules that support the renderable system.\n\nReference: legacy_reference_library_code/rich_rust/src/\n\nKey modules:\n1. segment.rs - Cow<str> styled text segments\n2. console.rs - Console abstraction for output\n3. measure.rs - Measurement protocol for layout\n4. box.rs - Box drawing characters and borders\n5. text.rs - Rich Text with multiple styles\n6. live.rs - Live display updates\n7. filesize.rs - Human-readable file sizes\n8. logging.rs - Logging integration\n\nThese modules provide the primitives that renderables use for producing styled output.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-31T23:02:34.577032474Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:50.029271738Z","closed_at":"2026-01-31T23:21:50.029254736Z","close_reason":"Closing rich_rust port epic: FrankenTUI tracks extracted concepts (Segments/Measurement/Border) directly under ftui phase epics; not doing a 1:1 port.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1ho.1","title":"Implement Segment system (Cow<str> styled text units)","description":"# Implement Segment system (Cow<str> styled text units)\n\n## Background\nPlan Appendix D.1 describes a Segment system inspired by rich_rust.\n\nA Segment is the atomic unit of styled text that can be:\n- cheaply borrowed (`Cow<str>`) for string literals / static content\n- split at **cell positions** (not byte positions) for correct wrapping\n\nSegments are a bridge:\n- higher-level text/layout systems produce Segments\n- widgets ultimately paint to `Frame`/`Buffer` using measured/split segments\n\n## Core types\n### Segment\n```rust\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct Segment<'a> {\n    pub text: Cow<'a, str>,\n    pub style: Option<Style>,\n    pub control: Option<SmallVec<[ControlCode; 2]>>, // optional; stack-alloc common case\n}\n```\n\n### Control codes (optional)\nSegments may carry control codes for non-textual actions (rare; typically not needed in the kernel).\nIf we keep them, they must be constrained and documented.\n\n## Key APIs\n- `cell_length()` (display width)\n- `split_at_cell(cell_pos)` (critical for wrapping with wide chars/ZWJ)\n- helpers to split/join lines of segments\n\n## Design constraints\n- Splitting MUST respect Unicode scalar boundaries; ideally grapheme boundaries.\n- Control segments must not consume width.\n- ASCII width fast-path is a later optimization (see bd-v6y) and must not change correctness.\n\n## Tests\n- split_at_cell correctness for:\n  - ASCII\n  - CJK wide chars\n  - emoji/ZWJ sequences\n- cell_length matches `unicode_width` for the same input\n- line splitting preserves styles and does not drop content\n\n## Acceptance Criteria\n- [ ] Segment type exists with `Cow<str>` storage.\n- [ ] `cell_length` and `split_at_cell` APIs exist and are tested.\n- [ ] Segment line-splitting/joining helpers exist.","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Create segment with owned String\n- [ ] Create segment with borrowed &str (Cow optimization)\n- [ ] Create control segments (newline, home, bell)\n- [ ] Calculate cell length accounting for:\n  - ASCII characters (1 cell each)\n  - Wide characters (2 cells each)\n  - Zero-width characters (0 cells)\n  - Control segments (0 cells)\n- [ ] Split segment at grapheme boundary\n- [ ] Strip styles preserving text\n- [ ] Join multiple segments\n- [ ] Split segments on newlines into Lines\n- [ ] Join Lines back into segments\n\n### Zero-Copy Requirements\n- [ ] String literals never allocate\n- [ ] Short strings use Cow::Borrowed when possible\n- [ ] Split returns borrowed segments when feasible\n- [ ] Concatenation minimizes copies\n\n### Performance Requirements\n- [ ] Cell length calculation: < 50ns for typical segment\n- [ ] Split operation: O(1) for ASCII content\n- [ ] Join operation: O(n) where n = total chars\n\n### Logging Requirements\n- [ ] tracing::trace! for segment creation (debug builds)\n- [ ] tracing::warn! for unexpectedly long segments (> 10KB)\n\n### Test Coverage\n- [ ] Unit tests for all segment operations\n- [ ] Property test: split-join is identity\n- [ ] Property test: cell length >= 0\n- [ ] Corpus test: Unicode edge cases (ZWJ, RTL, combining)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:02:46.925829242Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:41.976798774Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.1","depends_on_id":"bd-10i.6","type":"parent-child","created_at":"2026-01-31T23:14:50.969799531Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.1","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:18.847212946Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.2","title":"Implement Console abstraction","description":"Port the Console abstraction from rich_rust. Console provides high-level output with automatic styling and width awareness.\n\nReference: legacy_reference_library_code/rich_rust/src/console.rs\n\nKey features to implement:\n1. Console output with automatic line wrapping\n2. Width detection and tracking\n3. Style stack for nested styling\n4. Markup string parsing and rendering\n5. Print, log, and raw output methods\n6. Color capability detection\n7. Force color / no color modes\n8. Record mode for testing\n\nAPI Design (from rich_rust):\n```rust\npub struct Console {\n    width: Option<usize>,\n    force_terminal: bool,\n    no_color: bool,\n    color_system: ColorSystem,\n    style_stack: Vec<Style>,\n    record: Option<Vec<Segment>>,\n}\n\nimpl Console {\n    pub fn new() -> Self;\n    pub fn with_width(width: usize) -> Self;\n    \n    // Output\n    pub fn print(&mut self, content: impl Renderable);\n    pub fn print_styled(&mut self, text: &str, style: Style);\n    pub fn rule(&mut self, title: Option<&str>);\n    pub fn line(&mut self);\n    \n    // State\n    pub fn width(&self) -> usize;\n    pub fn push_style(&mut self, style: Style);\n    pub fn pop_style(&mut self);\n    pub fn current_style(&self) -> Style;\n    \n    // Recording\n    pub fn begin_capture(&mut self);\n    pub fn end_capture(&mut self) -> Vec<Segment>;\n}\n```\n\nImplementation notes:\n- Console is the main entry point for rich output\n- Width defaults to terminal width or 80\n- Style stack enables nested markup parsing\n\nDependencies: Segment system, Terminal detection, Markup parser","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Width detection from terminal or fallback to 80\n- [ ] Explicit width override\n- [ ] Print plain strings with automatic wrapping\n- [ ] Print styled text with style application\n- [ ] Print any Renderable with measurement and rendering\n- [ ] Style stack: push/pop for nested styling\n- [ ] Markup string parsing and rendering\n- [ ] Recording mode for test capture\n\n### Color System Requirements\n- [ ] Auto-detect color capability from environment\n- [ ] NO_COLOR environment variable respected\n- [ ] Force color override option\n- [ ] Color downgrade for limited terminals\n\n### Output Requirements\n- [ ] All output respects current width\n- [ ] Long lines wrapped at word boundaries\n- [ ] Style reset at end of output\n- [ ] No raw escape codes in output (sanitized)\n\n### Logging Requirements\n- [ ] tracing::debug! for width detection\n- [ ] tracing::debug! for color system detection\n- [ ] tracing::trace! for style stack operations\n- [ ] tracing::info! for recording start/stop\n\n### Test Coverage\n- [ ] Unit tests for width handling\n- [ ] Unit tests for style stack\n- [ ] Unit tests for color system detection\n- [ ] Integration tests with renderables\n- [ ] Capture/assertion tests for output verification","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:02:54.445310573Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:44.123507039Z","closed_at":"2026-01-31T23:21:44.123487553Z","close_reason":"Closing rich_rust port utilities (Console/Live/filesize/logging): out of scope for FrankenTUI plan v1; ftui uses Frame+TerminalWriter + tracing (bd-3e8) + widget/runtime layers instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.2","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T23:04:20.442951992Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.2","depends_on_id":"bd-1ho","type":"parent-child","created_at":"2026-01-31T23:02:54.445310573Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.2","depends_on_id":"bd-1ho.1","type":"blocks","created_at":"2026-01-31T23:04:19.913985950Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.2","depends_on_id":"bd-3mo","type":"blocks","created_at":"2026-01-31T23:04:20.973683948Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.3","title":"Implement TextMeasurement protocol (Appendix D.3)","description":"# Implement TextMeasurement protocol (Appendix D.3)\n\n## Background\nPlan Appendix D.3 defines a simple measurement protocol used for layout negotiation.\n\nKey insight:\n- measurement is *bounds* (minimum + maximum), not a single width\n- bounds compose with simple algebra (union vs stack)\n\nThis supports deterministic layout without ad-hoc heuristics.\n\n## Core type (from plan)\n```rust\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]\npub struct TextMeasurement {\n    pub minimum: usize,\n    pub maximum: usize,\n}\n\nimpl TextMeasurement {\n    pub const ZERO: Self = Self { minimum: 0, maximum: 0 };\n\n    /// Union: take max of both bounds (for side-by-side layout)\n    pub fn union(self, other: Self) -> Self {\n        Self { minimum: self.minimum.max(other.minimum), maximum: self.maximum.max(other.maximum) }\n    }\n\n    /// Stack: add both bounds (for vertical stacking)\n    pub fn stack(self, other: Self) -> Self {\n        Self { minimum: self.minimum + other.minimum, maximum: self.maximum + other.maximum }\n    }\n\n    pub fn clamp(self, min_width: Option<usize>, max_width: Option<usize>) -> Self {\n        let mut result = self;\n        if let Some(min_w) = min_width {\n            result.minimum = result.minimum.max(min_w);\n            result.maximum = result.maximum.max(min_w);\n        }\n        if let Some(max_w) = max_width {\n            result.minimum = result.minimum.min(max_w);\n            result.maximum = result.maximum.min(max_w);\n        }\n        result\n    }\n}\n```\n\n## Integration points\n- `ftui-text`: compute measurements for Text/Segments\n- `ftui-layout`: use measurements when allocating space for widgets\n\n## Tests\n- union/stack/clamp behave exactly as defined\n- clamp invariants:\n  - minimum <= maximum\n  - clamps preserve ordering\n\n## Acceptance Criteria\n- [ ] `TextMeasurement` exists with union/stack/clamp.\n- [ ] Unit tests cover composition laws.\n- [ ] Adopted by layout/text measurement code paths (call sites tracked in follow-up issues).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:03:01.763981159Z","created_by":"ubuntu","updated_at":"2026-01-31T23:20:43.312723026Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.3","depends_on_id":"bd-10i.7","type":"parent-child","created_at":"2026-01-31T23:20:15.236621599Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.4","title":"Implement border/box drawing character sets (Appendix D.5)","description":"# Implement border/box drawing character sets (Appendix D.5)\n\n## Background\nPlan Phase 4 includes: \"Border presets and custom\".\n\nAppendix D.5 references a border system inspired by charmed_rust and rich_rust:\n- reusable border presets (rounded, square, double, heavy, ascii)\n- used by Panel/Block widgets\n- should degrade gracefully when Unicode box drawing is undesirable\n\n## Scope\n- Define a border/box character set type (name it `BorderChars` / `BorderSet` etc; avoid `Box` name collisions).\n- Provide presets:\n  - Rounded\n  - Square\n  - Double\n  - Heavy\n  - ASCII fallback\n- Include T-intersections and cross characters for tables where needed.\n\n## Design notes\n- Border characters are from Unicode Box Drawing (U+2500..U+257F).\n- ASCII fallback uses `+`, `-`, `|`.\n- This is a *data* module; actual drawing happens in widgets (`Block`, `Panel`, `Table`).\n\n## Tests\n- Presets contain expected characters (sanity checks)\n- ASCII fallback is complete and consistent\n\n## Acceptance Criteria\n- [ ] Border character set type exists.\n- [ ] Presets exist and are documented.\n- [ ] Used by Block/Panel widgets (follow-up dependencies tracked).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:03:07.697787474Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:06.638255059Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.4","depends_on_id":"bd-10i.6","type":"parent-child","created_at":"2026-01-31T23:20:49.805784770Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.5","title":"Implement Live display system","description":"Port the Live display system from rich_rust. Live provides auto-refreshing display for progress indicators and status updates.\n\nReference: legacy_reference_library_code/rich_rust/src/live.rs\n\nKey features to implement:\n1. Auto-refresh with configurable interval\n2. Transient rendering (overwrite previous output)\n3. Live context manager pattern\n4. Nested live displays\n5. Vertical overflow handling (scrolling content area)\n6. Console output redirection during live\n\nAPI Design (from rich_rust):\n```rust\npub struct Live<'a, R: Renderable> {\n    renderable: R,\n    console: &'a mut Console,\n    refresh_rate: f32,\n    vertical_overflow: VerticalOverflow,\n}\n\npub enum VerticalOverflow {\n    Ellipsis,\n    Visible,\n    Crop,\n}\n\nimpl<'a, R: Renderable> Live<'a, R> {\n    pub fn new(console: &'a mut Console, renderable: R) -> Self;\n    pub fn start(&mut self);\n    pub fn stop(&mut self);\n    pub fn update(&mut self, renderable: R);\n    pub fn refresh(&mut self);\n}\n```\n\nImplementation notes:\n- Uses cursor save/restore for transient display\n- Clears previous output before redrawing\n- Thread-safe for background updates\n- This is rich's approach, different from bubbletea's full-buffer model\n\nDependencies: Console, Presenter, Terminal raw mode","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:03:18.946085437Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:44.153468064Z","closed_at":"2026-01-31T23:21:44.153441063Z","close_reason":"Closing rich_rust port utilities (Console/Live/filesize/logging): out of scope for FrankenTUI plan v1; ftui uses Frame+TerminalWriter + tracing (bd-3e8) + widget/runtime layers instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.5","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T23:04:23.110285746Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.5","depends_on_id":"bd-1ho","type":"parent-child","created_at":"2026-01-31T23:03:18.946085437Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.5","depends_on_id":"bd-1ho.2","type":"blocks","created_at":"2026-01-31T23:04:22.582300790Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.5","depends_on_id":"bd-3ky.10","type":"blocks","created_at":"2026-01-31T23:04:23.633608498Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.6","title":"Implement filesize formatter","description":"Port the filesize formatter from rich_rust. This provides human-readable file size formatting.\n\nReference: legacy_reference_library_code/rich_rust/src/filesize.rs\n\nKey features to implement:\n1. Binary units (KiB, MiB, GiB, TiB)\n2. Decimal units (KB, MB, GB, TB)\n3. Configurable precision\n4. Short format (1.2M) vs long format (1.2 MiB)\n5. Bytes threshold (show bytes below certain size)\n\nAPI Design (from rich_rust):\n```rust\npub struct FileSizeOptions {\n    pub binary: bool,        // Use 1024 vs 1000\n    pub precision: usize,    // Decimal places\n    pub short: bool,         // Short unit names\n    pub separator: &'static str,  // Space between number and unit\n}\n\npub fn filesize(size: u64) -> String;\npub fn filesize_opts(size: u64, opts: &FileSizeOptions) -> String;\npub fn filesize_decimal(size: u64) -> String;\npub fn filesize_binary(size: u64) -> String;\n```\n\nImplementation notes:\n- Binary is more accurate for computer storage\n- Decimal is more familiar to non-technical users\n- Consider humansize crate for implementation\n\nDependencies: None (standalone utility)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T23:03:24.277137420Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:44.158453100Z","closed_at":"2026-01-31T23:21:44.158434746Z","close_reason":"Closing rich_rust port utilities (Console/Live/filesize/logging): out of scope for FrankenTUI plan v1; ftui uses Frame+TerminalWriter + tracing (bd-3e8) + widget/runtime layers instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.6","depends_on_id":"bd-1ho","type":"parent-child","created_at":"2026-01-31T23:03:24.277137420Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.7","title":"Implement logging integration","description":"Port the logging integration from rich_rust. This connects the tracing/log ecosystem with styled console output.\n\nReference: legacy_reference_library_code/rich_rust/src/logging.rs\n\nKey features to implement:\n1. tracing subscriber for rich output\n2. Log level styling (error=red, warn=yellow, etc.)\n3. Timestamp formatting\n4. Source location display (file:line)\n5. Structured field formatting\n6. Live display compatibility (redirect logs)\n7. Quiet mode for minimal output\n\nAPI Design (from rich_rust):\n```rust\npub struct RichHandler {\n    console: Console,\n    show_time: bool,\n    show_path: bool,\n    show_level: bool,\n    level_styles: HashMap<Level, Style>,\n}\n\nimpl RichHandler {\n    pub fn new() -> Self;\n    pub fn with_console(console: Console) -> Self;\n    pub fn install(self);\n}\n\nimpl tracing::Subscriber for RichHandler {\n    // ...\n}\n```\n\nImplementation notes:\n- Wraps tracing-subscriber or log crate\n- Must handle concurrent logging from multiple threads\n- Consider buffer output to avoid interleaving\n\nDependencies: Console, Style system, tracing crate","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:03:29.952985639Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:44.163459657Z","closed_at":"2026-01-31T23:21:44.163415704Z","close_reason":"Closing rich_rust port utilities (Console/Live/filesize/logging): out of scope for FrankenTUI plan v1; ftui uses Frame+TerminalWriter + tracing (bd-3e8) + widget/runtime layers instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.7","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:24.748807179Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.7","depends_on_id":"bd-1ho","type":"parent-child","created_at":"2026-01-31T23:03:29.952985639Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.7","depends_on_id":"bd-1ho.2","type":"blocks","created_at":"2026-01-31T23:04:24.140277628Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1ho.8","title":"Rich Core Infrastructure Test Suite","description":"Comprehensive test suite for rich_rust core infrastructure. These foundational components support all renderables and require thorough verification.\n\n## Test Requirements by Module\n\n### Segment System (bd-1ho.1)\nUnit tests:\n- `test_segment_new_owned` - Owned string segment\n- `test_segment_new_borrowed` - Borrowed string segment (Cow)\n- `test_segment_control` - Control segment creation\n- `test_segment_cell_length_ascii` - ASCII width = byte length\n- `test_segment_cell_length_unicode` - Wide chars counted correctly\n- `test_segment_cell_length_control` - Control segments = 0 width\n- `test_segment_split_at_ascii` - Split ASCII segment\n- `test_segment_split_at_unicode` - Split at grapheme boundary\n- `test_segment_strip_styles` - Remove styles preserve text\n- `test_segments_join` - Concatenate segments\n- `test_segments_split_lines` - Split on newlines\n- `test_segments_join_lines` - Rejoin lines\n\nProperty tests:\n- `prop_split_join_inverse` - Split then join = original\n- `prop_cell_length_non_negative` - Cell length >= 0\n- `prop_split_preserves_total_length` - Sum of parts = whole\n\n### Console (bd-1ho.2)\nUnit tests:\n- `test_console_default_width` - Width detection or fallback\n- `test_console_explicit_width` - Override width\n- `test_console_print_string` - Simple string output\n- `test_console_print_styled` - Styled text output\n- `test_console_print_renderable` - Renderable output\n- `test_console_style_stack_push` - Push style\n- `test_console_style_stack_pop` - Pop style\n- `test_console_style_stack_nested` - Nested styles cascade\n- `test_console_color_system_detect` - Auto-detect color capability\n- `test_console_no_color_env` - NO_COLOR respected\n- `test_console_force_color` - Force color override\n- `test_console_capture_begin` - Start recording\n- `test_console_capture_end` - Retrieve captured segments\n\nIntegration tests:\n- `test_console_with_renderables` - Full rendering pipeline\n- `test_console_line_wrapping` - Long lines wrapped\n\n### Measurement (bd-1ho.3)\nUnit tests:\n- `test_measurement_new_valid` - min <= max\n- `test_measurement_from_width` - min = max = width\n- `test_measurement_span` - max - min\n- `test_measurement_with_maximum` - Clamp maximum\n- `test_measurement_with_minimum` - Clamp minimum\n- `test_measure_text_single_line` - Single line width\n- `test_measure_text_multiline` - Max of all lines\n- `test_measure_text_with_wrap` - Account for wrap points\n\nProperty tests:\n- `prop_measurement_min_le_max` - min always <= max\n- `prop_measurement_clamp_valid` - Clamping preserves invariant\n\n### Box Drawing (bd-1ho.4)\nUnit tests:\n- `test_box_rounded_chars` - Rounded box characters\n- `test_box_square_chars` - Square box characters  \n- `test_box_double_chars` - Double-line characters\n- `test_box_heavy_chars` - Heavy box characters\n- `test_box_ascii_chars` - ASCII fallback\n- `test_box_substitute_true` - Returns ASCII variant\n- `test_box_substitute_false` - Returns original\n- `test_box_get_top` - Top border string\n- `test_box_get_bottom` - Bottom border string\n- `test_box_get_row_single` - Single cell row\n- `test_box_get_row_multiple` - Multi-cell row with separators\n\n### Live Display (bd-1ho.5)\nUnit tests:\n- `test_live_start` - Begin live display\n- `test_live_stop` - End live display\n- `test_live_update` - Replace content\n- `test_live_refresh` - Redraw current content\n- `test_live_vertical_overflow_ellipsis` - Truncate with ...\n- `test_live_vertical_overflow_crop` - Hard crop\n- `test_live_transient` - Cursor save/restore\n\nIntegration tests:\n- `test_live_with_progress` - Progress bar in live context\n- `test_live_nested` - Nested live displays\n\n### Filesize Formatter (bd-1ho.6)\nUnit tests:\n- `test_filesize_bytes` - < 1KB shows bytes\n- `test_filesize_kb_binary` - KiB formatting\n- `test_filesize_mb_binary` - MiB formatting\n- `test_filesize_gb_binary` - GiB formatting\n- `test_filesize_tb_binary` - TiB formatting\n- `test_filesize_decimal` - 1000-based units\n- `test_filesize_precision` - Decimal places\n- `test_filesize_short` - Short unit names\n- `test_filesize_edge_zero` - Zero bytes\n- `test_filesize_edge_max` - u64::MAX\n\nProperty tests:\n- `prop_filesize_parses_back` - Formatted string can be parsed\n\n### Logging Integration (bd-1ho.7)\nUnit tests:\n- `test_log_level_styling` - Error=red, warn=yellow, info=blue\n- `test_log_timestamp_format` - Timestamp in expected format\n- `test_log_source_location` - file:line shown\n- `test_log_structured_fields` - Key=value pairs\n- `test_log_quiet_mode` - Reduced output\n- `test_log_with_live` - Logs don't corrupt live display\n\nIntegration tests:\n- `test_log_tracing_subscriber` - Works with tracing\n\n## E2E Test Scenarios\n\n### Console Pipeline E2E\n```rust\n#[test]\nfn e2e_console_full_render() {\n    // Setup\n    let mut console = Console::with_width(80);\n    console.begin_capture();\n    \n    // Render complex content\n    console.rule(Some(\"Header\"));\n    console.print(Panel::new(Text::from(\"Content\")).with_title(\"Box\"));\n    console.print(Columns::new(vec![col1, col2]));\n    console.rule(None);\n    \n    // Verify\n    let segments = console.end_capture();\n    assert!(!segments.is_empty());\n    assert!(segments.iter().any(|s| s.text.contains(\"Header\")));\n    // ... more assertions\n}\n```\n\n### Measurement Chain E2E\n```rust\n#[test]\nfn e2e_measurement_chain() {\n    let content = Group::new(vec![\n        Box::new(Padding::new(\n            Panel::new(Text::from(\"Inner\")),\n            Sides::all(2)\n        )),\n        Box::new(Rule::new()),\n    ]);\n    \n    let measurement = content.measure(&console, 80);\n    assert!(measurement.minimum <= measurement.maximum);\n    assert!(measurement.maximum <= 80);\n    \n    let rendered = content.render(&console, 80);\n    for line in &rendered.lines {\n        let width: usize = line.iter().map(|s| s.cell_length()).sum();\n        assert!(width <= 80);\n    }\n}\n```\n\n## Logging Requirements\n- `tracing::info!` for console output operations\n- `tracing::debug!` for measurement calculations\n- `tracing::trace!` for segment construction\n- Live display refreshes logged at trace level\n\n## Coverage Targets\n- Line coverage: >= 90%\n- Branch coverage: >= 85%\n\nDependencies: All Rich Core modules, Testing infrastructure (bd-10i.11)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:17:50.143443525Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:44.168667844Z","closed_at":"2026-01-31T23:21:44.168629211Z","close_reason":"Closing rich_rust port utilities (Console/Live/filesize/logging): out of scope for FrankenTUI plan v1; ftui uses Frame+TerminalWriter + tracing (bd-3e8) + widget/runtime layers instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1ho.8","depends_on_id":"bd-10i.11","type":"blocks","created_at":"2026-01-31T23:18:03.450762458Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho","type":"parent-child","created_at":"2026-01-31T23:17:50.143443525Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.1","type":"blocks","created_at":"2026-01-31T23:18:43.516655476Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.2","type":"blocks","created_at":"2026-01-31T23:18:44.145892430Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:18:44.752956235Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.4","type":"blocks","created_at":"2026-01-31T23:18:45.361798387Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.5","type":"blocks","created_at":"2026-01-31T23:18:45.968271329Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.6","type":"blocks","created_at":"2026-01-31T23:18:46.590353912Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1ho.8","depends_on_id":"bd-1ho.7","type":"blocks","created_at":"2026-01-31T23:18:47.201728213Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1mh","title":"Implement HitGrid for mouse hit testing","description":"PHASE 5 - HIT TESTING INFRASTRUCTURE\n\n## Background\nMouse interaction requires knowing what widget is at a given coordinate. HitGrid provides a parallel grid that maps screen positions to interactive elements.\n\n## Technical Requirements\n\n### HitGrid Structure\npub struct HitGrid {\n    width: u16,\n    height: u16,\n    cells: Vec<HitCell>,\n}\n\npub struct HitCell {\n    /// Widget ID at this position\n    widget_id: Option<WidgetId>,\n    /// Interactive region type\n    region: HitRegion,\n    /// User data for callbacks\n    data: HitData,\n}\n\npub enum HitRegion {\n    None,\n    Content,        // Main widget content\n    Border,         // Widget border\n    Scrollbar,      // Scrollbar area\n    Handle,         // Resize handle\n    Button,         // Clickable button\n    Link,           // Hyperlink\n    Custom(u8),     // User-defined\n}\n\npub type WidgetId = u32;\npub type HitData = u64;  // Opaque user data\n\n### Registration API\nimpl HitGrid {\n    /// Clear all hit regions\n    pub fn clear(&mut self);\n    \n    /// Register a hit region\n    pub fn register(&mut self, area: Rect, widget_id: WidgetId, region: HitRegion, data: HitData);\n    \n    /// Query hit at position\n    pub fn hit_test(&self, x: u16, y: u16) -> Option<(WidgetId, HitRegion, HitData)>;\n    \n    /// Query all hits in area\n    pub fn hits_in(&self, area: Rect) -> Vec<(WidgetId, HitRegion, HitData)>;\n}\n\n### Frame Integration\npub struct Frame {\n    buffer: Buffer,\n    hit_grid: Option<HitGrid>,  // Optional for performance\n}\n\nimpl Frame {\n    pub fn enable_hit_testing(&mut self);\n    \n    pub fn register_hit(&mut self, area: Rect, widget_id: WidgetId, region: HitRegion, data: HitData) {\n        if let Some(ref mut grid) = self.hit_grid {\n            grid.register(area, widget_id, region, data);\n        }\n    }\n}\n\n### Widget Integration Pattern\nimpl Widget for Button {\n    fn render(self, area: Rect, buf: &mut Buffer) {\n        // Render button...\n        \n        // Register hit area\n        buf.frame().register_hit(\n            area,\n            self.widget_id,\n            HitRegion::Button,\n            self.on_click_data,\n        );\n    }\n}\n\n### Event Dispatch\nimpl Program {\n    fn handle_mouse(&mut self, event: MouseEvent) {\n        if let Some((widget_id, region, data)) = self.frame.hit_test(event.x, event.y) {\n            // Dispatch to appropriate handler\n        }\n    }\n}\n\n## Tests Required\n- [ ] Registration works\n- [ ] Hit test returns correct widget\n- [ ] Overlapping regions: last wins\n- [ ] Clear removes all hits\n- [ ] hits_in returns all in area\n- [ ] Performance: 80x24 grid operations < 1s\n\n## Acceptance Criteria\n- [ ] HitGrid implementation\n- [ ] Frame integration\n- [ ] Widget registration pattern\n- [ ] Mouse event dispatch\n- [ ] Optional (feature gated) for performance\n\n## Location: ftui-render crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:36:43.854972379Z","created_by":"ubuntu","updated_at":"2026-01-31T22:37:55.696089324Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1mh","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:37:55.696058295Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1oz","title":"Implement LRU width cache for text measurement","description":"# Implement LRU Width Cache for Text Measurement\n\n## Background\nPlan Section 1.4 and Appendix D.3 explicitly mention the \"LRU width cache\" from rich_rust as a key optimization. Text width measurement is a hot path (called for every render) and must be cached.\n\n## Why LRU Cache?\n- Unicode width calculation is expensive (grapheme segmentation + width lookup)\n- Same text strings appear repeatedly (labels, status text, etc.)\n- Cache hit rate expected to be high for typical UIs\n- Prevents O(n) per-frame width recalculation\n\n## Design\n```rust\n/// Width cache with LRU eviction\npub struct WidthCache {\n    cache: LinkedHashMap<u64, usize>,  // hash -> width\n    capacity: usize,\n}\n\nimpl WidthCache {\n    pub fn new(capacity: usize) -> Self {\n        Self {\n            cache: LinkedHashMap::with_capacity(capacity),\n            capacity,\n        }\n    }\n\n    /// Get cached width or compute and cache\n    pub fn get_or_compute(&mut self, text: &str, compute: impl FnOnce() -> usize) -> usize {\n        let hash = hash_text(text);\n        \n        if let Some(&width) = self.cache.get(&hash) {\n            // Move to front (LRU refresh)\n            self.cache.get_refresh(&hash);\n            return width;\n        }\n        \n        let width = compute();\n        \n        // Evict if over capacity\n        while self.cache.len() >= self.capacity {\n            self.cache.pop_front();\n        }\n        \n        self.cache.insert(hash, width);\n        width\n    }\n    \n    pub fn clear(&mut self) {\n        self.cache.clear();\n    }\n}\n\n// Use FNV or xxhash for fast hashing\nfn hash_text(text: &str) -> u64 {\n    use std::hash::{Hash, Hasher};\n    let mut hasher = FnvHasher::default();\n    text.hash(&mut hasher);\n    hasher.finish()\n}\n```\n\n## Integration Points\n- `RenderContext` holds a `RefCell<WidthCache>`\n- `Text::cell_length()` uses the cache\n- `Segment::cell_length()` uses the cache\n- Cache is cleared on theme change (fonts can affect width)\n\n## Cache Sizing\n- Default: 1024 entries (covers typical UI with headroom)\n- Configurable via `WidthCache::new(capacity)`\n- Memory footprint: ~32 bytes per entry (hash + width + list pointers)\n\n## Performance Requirements\n- Cache hit: < 50ns (hash + lookup)\n- Cache miss: < 5s (grapheme segmentation + width calculation)\n- Hash collision handling: rare, just recompute\n\n## Tests Required\n- [ ] Cache hits return correct cached value\n- [ ] Cache misses compute and cache\n- [ ] LRU eviction works correctly\n- [ ] Clear() empties cache\n- [ ] Thread safety if needed (RefCell for single-threaded)\n- [ ] Performance benchmarks\n\n## Acceptance Criteria\n- [ ] LRU cache implemented with configurable capacity\n- [ ] Integrated into text measurement hot path\n- [ ] Performance benchmarks show significant speedup\n- [ ] No correctness regressions in width measurement\n\n## Location\n`ftui-text/src/cache.rs`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:17:08.580451576Z","created_by":"ubuntu","updated_at":"2026-01-31T23:17:19.845573559Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1oz","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:17:19.845536820Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1qb","title":"Implement Image widget with protocol detection","description":"PHASE 7 - EXTRAS: IMAGE WIDGET\n\n## Background\nImage widget displays images in terminal using Kitty Graphics Protocol, iTerm2 inline images, or Sixel fallback. Requires protocol detection and graceful degradation.\n\n## Technical Requirements\n- Protocol detection:\n  - Kitty Graphics Protocol (XTGETTCAP query)\n  - iTerm2 inline images (TERM_PROGRAM check)\n  - Sixel (DA2 response parsing)\n  - Fallback: ASCII/Braille representation\n- Image loading via image crate\n- Resize/fit modes: Contain, Cover, Stretch, None\n- Aspect ratio preservation\n- Partial update for animated GIFs\n- Memory management for large images\n\n## Design Rationale\nImage support is a premium feature gated behind 'image' flag. Protocol detection happens once at startup and caches result. Fallback ensures graceful degradation.\n\n## Acceptance Criteria\n- [ ] Protocol detection and caching\n- [ ] Kitty Graphics Protocol implementation\n- [ ] iTerm2 inline image implementation\n- [ ] Sixel fallback (optional sub-feature)\n- [ ] ASCII fallback when no protocol available\n- [ ] Resize mode configuration\n- [ ] Aspect ratio handling\n- [ ] Feature gate: image\n\n## Performance Budget\n- Protocol detection: < 50ms (one-time)\n- Image encode/transmit: proportional to size\n\n## Location: ftui-extras crate (feature = \"image\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:20:04.942919291Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:35.619831992Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1qb","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T22:22:35.619803037Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1tt","title":"Implement focus and resize event handling in InputParser","description":"# Implement Focus and Resize Event Handling\n\n## Background\nThe plan specifies that the input system must handle focus events and resize events. These are essential for agent harness UIs to respond to window changes and terminal focus state.\n\n## Technical Requirements\n\n### Focus Events\nDetection: Terminals that support focus events send:\n- Focus gained: `\\x1b[I` (CSI I)\n- Focus lost: `\\x1b[O` (CSI O)\n\nActivation:\n```rust\nimpl TerminalSession {\n    pub fn enable_focus_events(&mut self) -> io::Result<()> {\n        self.writer.write_all(b\"\\x1b[?1004h\")?;\n        Ok(())\n    }\n    \n    pub fn disable_focus_events(&mut self) -> io::Result<()> {\n        self.writer.write_all(b\"\\x1b[?1004l\")?;\n        Ok(())\n    }\n}\n```\n\n### Resize Events\nPlatform-specific handling:\n\n#### Unix (SIGWINCH)\n```rust\nuse signal_hook::consts::SIGWINCH;\nuse signal_hook::iterator::Signals;\n\nfn setup_resize_handler() -> Receiver<(u16, u16)> {\n    let (tx, rx) = channel();\n    let mut signals = Signals::new(&[SIGWINCH]).unwrap();\n    \n    thread::spawn(move || {\n        for _ in signals.forever() {\n            if let Some((w, h)) = terminal_size::terminal_size() {\n                let _ = tx.send((w.0, h.0));\n            }\n        }\n    });\n    \n    rx\n}\n```\n\n#### Crossterm Approach\n```rust\n// Crossterm provides resize events in its event stream\nif let Event::Resize(w, h) = event {\n    return Some(ftui::Event::Resize { width: w, height: h });\n}\n```\n\n### Event Types\n```rust\npub enum Event {\n    Key(KeyEvent),\n    Mouse(MouseEvent),\n    Resize { width: u16, height: u16 },\n    Focus(bool),  // true = gained, false = lost\n    Paste(String),\n}\n```\n\n### Parser Handling\n```rust\nimpl InputParser {\n    fn parse_csi_sequence(&mut self) -> Option<Event> {\n        let seq = &self.buffer;\n        \n        // Focus events\n        if seq == b\"I\" {\n            return Some(Event::Focus(true));\n        }\n        if seq == b\"O\" {\n            // Note: Distinguish from application cursor mode O\n            return Some(Event::Focus(false));\n        }\n        \n        // ... other CSI handling\n    }\n}\n```\n\n## Runtime Integration\n```rust\nimpl Program {\n    fn poll_events(&mut self) -> Vec<Event> {\n        let mut events = Vec::new();\n        \n        // Check resize channel\n        while let Ok((w, h)) = self.resize_rx.try_recv() {\n            events.push(Event::Resize { width: w, height: h });\n        }\n        \n        // Check focus events (from input parser)\n        // Check key/mouse events\n        \n        events\n    }\n}\n```\n\n## Resize Handling in Model\n```rust\nimpl Model for MyApp {\n    fn update(&mut self, msg: Event) -> Cmd<Event> {\n        match msg {\n            Event::Resize { width, height } => {\n                // Recalculate layouts\n                // Re-render at new size\n                self.size = (width, height);\n                Cmd::none()\n            }\n            Event::Focus(gained) => {\n                // Update focus state\n                // Maybe pause/resume animations\n                self.focused = gained;\n                Cmd::none()\n            }\n            _ => // ...\n        }\n    }\n}\n```\n\n## Tests Required\n- [ ] Focus gained event parsed correctly\n- [ ] Focus lost event parsed correctly\n- [ ] Focus event vs cursor mode O distinguished\n- [ ] Resize event from SIGWINCH\n- [ ] Resize event propagation to model\n- [ ] Cleanup disables focus events on exit\n\n## Acceptance Criteria\n- [ ] Event::Resize type defined\n- [ ] Event::Focus type defined\n- [ ] InputParser handles focus events\n- [ ] Resize handling (Unix + Windows)\n- [ ] RAII cleanup on exit\n- [ ] Integration with runtime\n\n## Location: ftui-core (input.rs, session.rs)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:54:27.699656379Z","created_by":"ubuntu","updated_at":"2026-01-31T22:54:34.947125219Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1tt","depends_on_id":"bd-10i.5","type":"parent-child","created_at":"2026-01-31T22:54:34.947091165Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1tt","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:54:33.559970198Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1u5","title":"Document Inline vs Alt-Screen mode trade-offs","description":"# Inline vs Alt-Screen Mode Documentation\n\n## Background\nThe plan requires documentation that explains \"inline vs alt-screen explanation (scrollback tradeoffs)\". This is critical for users to understand which mode to use.\n\n## Content Structure\n\n### What Is Inline Mode?\n- UI renders in the normal terminal buffer\n- Scrollback is preserved (native terminal feature)\n- Logs become part of terminal history\n- Can be scrolled back after program exits\n- Default mode for ftui\n\n### What Is Alt-Screen Mode?\n- UI renders in alternate screen buffer\n- Scrollback is NOT preserved (blank alt buffer)\n- When program exits, previous content restored\n- Classic TUI experience (vim, htop, etc.)\n- Opt-in via ScreenMode::AltScreen\n\n### Trade-off Matrix\n\n| Feature | Inline Mode | Alt-Screen Mode |\n|---------|-------------|-----------------|\n| Scrollback preserved |  |  |\n| Full-screen clear OK |  |  |\n| Log history after exit |  |  |\n| Cursor management | Complex | Simple |\n| Classic TUI feel |  |  |\n| Agent harness ideal |  |  |\n\n### When to Use Inline Mode\n- Agent harness UIs (Claude Code style)\n- Log viewers where history matters\n- REPLs and shells\n- Any app where scrollback is valuable\n- Applications that stream output\n\n### When to Use Alt-Screen Mode\n- Full-screen dashboards\n- Traditional TUI applications\n- Modal dialogs and pickers\n- When you WANT content gone on exit\n- Games and visual apps\n\n### Mixed Strategy (Best of Both)\nThe plan supports:\n- Start in inline mode\n- Temporarily switch to alt-screen for complex modal\n- Return to inline mode\n- Context preserved\n\n```rust\nApp::new(State::default())\n    .screen_mode(ScreenMode::Inline {\n        ui_height: 6,\n        allow_modal_alt_screen: true,\n    })\n```\n\n### Implementation Details\n\n#### Inline Mode Contract\n1. Never clear full screen (preserve scrollback)\n2. Only clear bounded UI region\n3. Cursor restored after every present()\n4. Logs enter scrollback naturally\n\n#### Alt-Screen Contract\n1. Full-screen clears allowed\n2. Simpler cursor policy\n3. Exit restores previous content\n4. Cleanup on panic still required\n\n### Common Mistakes\n\n#### Mistake 1: Full-screen clear in inline mode\n- WRONG: `write\\!(stdout, \"\\x1b[2J\")`\n- RIGHT: Clear only UI region with localized EL\n\n#### Mistake 2: Assuming scrollback in alt-screen\n- Alt-screen has NO scrollback\n- User cannot scroll back\n- All content lost on exit\n\n#### Mistake 3: Not handling resize in inline mode\n- Resize can move UI anchor\n- Re-anchor calculation needed\n- PTY tests verify this\n\n## Acceptance Criteria\n- [ ] Both modes clearly explained\n- [ ] Trade-off matrix complete\n- [ ] Use cases documented\n- [ ] Mixed strategy explained\n- [ ] Common mistakes listed\n- [ ] Code examples provided\n\n## Location: docs/concepts/screen-modes.md","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T22:51:24.590650257Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:56.181904252Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1u5","depends_on_id":"bd-10i.10.1","type":"blocks","created_at":"2026-01-31T22:53:59.302413752Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1u5","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:56.181870468Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1un","title":"Document Terminal Compatibility Matrix","description":"# Terminal Compatibility Matrix Documentation\n\n## Background\nPlan Chapter 16 provides a detailed compatibility matrix. This needs to be documented for users to understand what features work where.\n\n## Compatibility Matrix (from Plan)\n\n| Feature | Kitty | WezTerm | Alacritty | Ghostty | iTerm2 | GNOME Term | Win Term |\n|---------|-------|---------|-----------|---------|--------|------------|----------|\n| True Color |  |  |  |  |  |  |  |\n| Sync Output |  |  |  |  |  |  |  |\n| OSC 8 Links |  |  |  |  |  |  |  |\n| Kitty Keyboard |  |  |  |  |  |  |  |\n| Kitty Graphics |  |  |  |  |  |  |  |\n| Sixel |  |  |  |  |  |  |  |\n| Focus Events |  |  |  |  |  |  |  |\n| Bracketed Paste |  |  |  |  |  |  |  |\n\n## Feature Details\n\n### True Color (24-bit RGB)\n- Detection: COLORTERM=truecolor or COLORTERM=24bit\n- Fallback: 256-color or 16-color palette\n- Most modern terminals support this\n\n### Synchronized Output (DEC 2026)\n- Purpose: Atomic frame updates, flicker prevention\n- Detection: Known terminal identification\n- Fallback: Buffered writes still help\n- ftui activates when detected\n\n### OSC 8 Hyperlinks\n- Purpose: Clickable links in terminal\n- Format: `\\x1b]8;;URL\\x1b\\\\text\\x1b]8;;\\x1b\\\\`\n- Windows Terminal: Not supported\n- Most Linux/macOS terminals support\n\n### Kitty Keyboard Protocol\n- Purpose: Enhanced key event information\n- Provides: press/repeat/release, modifiers\n- Limited adoption outside Kitty ecosystem\n- Feature-gated in ftui\n\n### Scroll Region (DECSTBM)\n- Purpose: Inline mode optimization\n- Support: Nearly universal\n- Quirks: tmux/screen passthrough issues\n- ftui uses as optimization, not requirement\n\n## Multiplexer Notes\n\n### tmux\n- Passthrough: Requires `\\x1bPtmux;...\\x1b\\\\`\n- Sync output: Blocked by default\n- OSC 8: Needs recent version + config\n- Detection: TMUX env var\n\n### screen\n- Limited modern feature support\n- No sync output passthrough\n- Basic ANSI works fine\n- Detection: STY env var\n\n### Zellij\n- Better passthrough than tmux/screen\n- Native terminal support varies\n- Detection: ZELLIJ env var\n\n## Windows Considerations\n\n### Windows Terminal\n- True color: \n- Mouse: \n- OSC 8: \n- Sync output: \n- Raw mode: Via Crossterm\n\n### ConEmu/Cmder\n- Limited feature set\n- True color:  (newer versions)\n- ANSI support varies by version\n\n### cmd.exe / PowerShell (legacy)\n- Very limited ANSI support\n- Windows 10+ improved support\n- Use Windows Terminal for best experience\n\n## Inline Mode Notes\n- Works everywhere (no special requirements)\n- Cursor save/restore: Universal\n- Scroll region: Nearly universal (optimization only)\n- Sync output: Nice-to-have (not required)\n\n## Recommended Test Matrix\nFor CI, test against:\n1. Kitty (most features)\n2. WezTerm (cross-platform)\n3. Alacritty (popular, minimal)\n4. Plain Linux VT (baseline)\n\n## Acceptance Criteria\n- [ ] Matrix table documented\n- [ ] Feature descriptions complete\n- [ ] Multiplexer notes included\n- [ ] Windows section clear\n- [ ] Inline mode notes present\n- [ ] Test matrix recommended\n\n## Location: docs/reference/terminal-compatibility.md","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T22:53:27.385131349Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:24.100429484Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1un","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:47.553758638Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1un","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T22:53:59.665227292Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1un","depends_on_id":"bd-2ss","type":"blocks","created_at":"2026-01-31T23:18:24.100392965Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1xo","title":"Windows Terminal compatibility layer","description":"PHASE 7 - POLISH: WINDOWS SUPPORT\n\n## Background\nWindows Terminal v1 support is deferred but must have clear integration path. Modern Windows Terminal supports ANSI, older conhost needs different handling.\n\n## Technical Requirements (v1 Scope - Windows Terminal Only)\n- Detect Windows Terminal vs legacy conhost\n- Enable VT processing mode via SetConsoleMode\n- Handle Windows-specific escape sequences\n- PTY spawning via ConPTY API\n- Signal handling differences (Ctrl+C, Ctrl+Break)\n- Path handling for Windows conventions\n\n## Out of Scope for v1\n- Legacy conhost support (Windows 7/8)\n- PowerShell-specific handling\n- Windows-specific widgets\n\n## Design Rationale\nPer ADR-004, Windows v1 targets modern Windows Terminal only. This dramatically simplifies implementation while covering majority of Windows developer use.\n\n## Acceptance Criteria\n- [ ] Windows Terminal detection\n- [ ] VT mode enabling\n- [ ] ConPTY integration for PTY tests\n- [ ] Signal handling shim\n- [ ] CI testing on Windows\n- [ ] Feature gate: windows\n\n## Testing\n- GitHub Actions Windows runner\n- Manual testing on Windows Terminal\n- Document known limitations\n\n## Location: ftui-render crate + ftui-pty crate (platform-specific code)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:20:16.533908639Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:36.112222Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1xo","depends_on_id":"bd-10i.10.4","type":"blocks","created_at":"2026-01-31T22:22:36.112191833Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-1xo","depends_on_id":"bd-10i.8.1","type":"blocks","created_at":"2026-01-31T22:22:35.870315746Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-1zv","title":"Implement event coalescing and RAII terminal guard","description":"PHASE 3 - EVENT COALESCING + TERMINAL GUARD\n\n## Background\nEvent storms (mouse moves, resize spam) can overwhelm the runtime. RAII guards ensure terminal cleanup even on panic.\n\n## Technical Requirements\n\n### Event Coalescing\npub struct EventCoalescer {\n    pending_mouse_move: Option<MouseEvent>,\n    pending_resize: Option<(u16, u16)>,\n    coalesce_window_ms: u64,\n}\n\nimpl EventCoalescer {\n    /// Add event, returns coalesced event if ready\n    pub fn push(&mut self, event: Event) -> Option<Event> {\n        match event {\n            Event::Mouse(MouseEvent::Move { .. }) => {\n                // Replace pending, return only on next non-move\n                self.pending_mouse_move = Some(event);\n                None\n            }\n            Event::Resize(w, h) => {\n                // Keep latest resize\n                self.pending_resize = Some((w, h));\n                None\n            }\n            _ => {\n                // Flush pending events, then return this one\n                self.flush_pending();\n                Some(event)\n            }\n        }\n    }\n    \n    pub fn flush_pending(&mut self) -> Vec<Event> { ... }\n}\n\n### RAII Terminal Guard\n\npub struct TerminalGuard {\n    raw_mode: bool,\n    alt_screen: bool,\n    mouse_capture: bool,\n    bracketed_paste: bool,\n    cursor_hidden: bool,\n}\n\nimpl TerminalGuard {\n    pub fn new() -> io::Result<Self> {\n        // Install panic hook\n        let prev_hook = std::panic::take_hook();\n        std::panic::set_hook(Box::new(move |info| {\n            // Restore terminal state\n            let _ = disable_raw_mode();\n            let _ = execute\\!(stdout(), LeaveAlternateScreen, Show);\n            prev_hook(info);\n        }));\n        \n        Ok(Self { ... })\n    }\n    \n    pub fn enable_raw_mode(&mut self) -> io::Result<()> { ... }\n    pub fn enter_alt_screen(&mut self) -> io::Result<()> { ... }\n    pub fn enable_mouse_capture(&mut self) -> io::Result<()> { ... }\n    pub fn enable_bracketed_paste(&mut self) -> io::Result<()> { ... }\n    pub fn hide_cursor(&mut self) -> io::Result<()> { ... }\n}\n\nimpl Drop for TerminalGuard {\n    fn drop(&mut self) {\n        // Restore all state in reverse order\n        if self.cursor_hidden {\n            let _ = execute\\!(stdout(), Show);\n        }\n        if self.bracketed_paste {\n            let _ = execute\\!(stdout(), DisableBracketedPaste);\n        }\n        if self.mouse_capture {\n            let _ = execute\\!(stdout(), DisableMouseCapture);\n        }\n        if self.alt_screen {\n            let _ = execute\\!(stdout(), LeaveAlternateScreen);\n        }\n        if self.raw_mode {\n            let _ = disable_raw_mode();\n        }\n    }\n}\n\n## Tests Required\n- [ ] Mouse move coalescing works\n- [ ] Resize coalescing works\n- [ ] Key events pass through\n- [ ] Guard enables/disables correctly\n- [ ] Drop restores all state\n- [ ] Panic hook restores terminal\n- [ ] PTY test: panic cleanup\n\n## Acceptance Criteria\n- [ ] No event storms reach runtime\n- [ ] Terminal always restored on exit\n- [ ] Panic leaves terminal usable\n- [ ] Nested guards work correctly\n- [ ] Mouse flood doesn't cause lag\n\n## Location: ftui-core crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:31:28.569809686Z","created_by":"ubuntu","updated_at":"2026-01-31T22:32:19.954370265Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zv","depends_on_id":"bd-10i.2.4","type":"blocks","created_at":"2026-01-31T22:32:19.954339136Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-22q","title":"Implement Theme system with semantic color slots","description":"PHASE 4 - THEME SYSTEM\n\n## Background\nA Theme provides semantic color slots that map to actual colors. This enables consistent styling and easy theme switching (light/dark mode, custom themes).\n\n## Technical Requirements\n\n### Semantic Color Slots\npub struct Theme {\n    // Primary UI\n    pub primary: AdaptiveColor,\n    pub secondary: AdaptiveColor,\n    pub accent: AdaptiveColor,\n    \n    // Backgrounds\n    pub background: AdaptiveColor,\n    pub surface: AdaptiveColor,\n    pub overlay: AdaptiveColor,\n    \n    // Text\n    pub text: AdaptiveColor,\n    pub text_muted: AdaptiveColor,\n    pub text_subtle: AdaptiveColor,\n    \n    // Semantic\n    pub success: AdaptiveColor,\n    pub warning: AdaptiveColor,\n    pub error: AdaptiveColor,\n    pub info: AdaptiveColor,\n    \n    // Borders\n    pub border: AdaptiveColor,\n    pub border_focused: AdaptiveColor,\n    \n    // Selection\n    pub selection_bg: AdaptiveColor,\n    pub selection_fg: AdaptiveColor,\n    \n    // Scrollbar\n    pub scrollbar_track: AdaptiveColor,\n    pub scrollbar_thumb: AdaptiveColor,\n}\n\n### Adaptive Colors\npub enum AdaptiveColor {\n    Fixed(Color),\n    Adaptive { light: Color, dark: Color },\n}\n\nimpl AdaptiveColor {\n    pub fn resolve(&self, is_dark: bool) -> Color {\n        match self {\n            Self::Fixed(c) => *c,\n            Self::Adaptive { light, dark } => {\n                if is_dark { *dark } else { *light }\n            }\n        }\n    }\n}\n\n### Built-in Theme Presets\npub mod themes {\n    pub fn default() -> Theme;      // Sensible defaults\n    pub fn dark() -> Theme;         // Dark mode\n    pub fn light() -> Theme;        // Light mode\n    pub fn nord() -> Theme;         // Nord color scheme\n    pub fn dracula() -> Theme;      // Dracula colors\n    pub fn solarized_dark() -> Theme;\n    pub fn solarized_light() -> Theme;\n}\n\n### Theme Detection\nimpl Theme {\n    /// Detect dark mode from environment/terminal\n    pub fn detect_dark_mode() -> bool {\n        // Check COLORFGBG for light/dark background\n        // Check OSC 11 background query (if supported)\n        // Default: assume dark\n    }\n}\n\n### Theme Resolution\nWidgets reference theme colors:\n  let style = Style::new().fg(theme.text).bg(theme.surface);\n\n### Runtime Theme Switching\n- Theme stored in Context or Model\n- All widgets receive theme reference\n- Switching triggers full redraw\n\n## Tests Required\n- [ ] All semantic slots have sensible defaults\n- [ ] Adaptive color resolution correct\n- [ ] Built-in presets complete\n- [ ] Dark mode detection works\n- [ ] Theme switching triggers redraw\n\n## Acceptance Criteria\n- [ ] 15+ semantic color slots\n- [ ] Light/dark adaptive colors\n- [ ] 5+ built-in presets\n- [ ] Detection heuristics\n- [ ] Theme switching API\n\n## Location: ftui-style crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:36:27.593131757Z","created_by":"ubuntu","updated_at":"2026-01-31T22:37:55.391526944Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-22q","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T22:37:54.786191489Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-22q","depends_on_id":"bd-1f8","type":"blocks","created_at":"2026-01-31T22:37:55.391498921Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-22q","depends_on_id":"bd-2yd","type":"blocks","created_at":"2026-01-31T22:37:55.103509558Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-27v","title":"Implement Subscriptions and async command integration","description":"PHASE 6 - SUBSCRIPTIONS + ASYNC\n\n## Background\nSubscriptions provide continuous event sources (timers, file watchers, network). Async integration allows non-blocking operations without blocking the UI.\n\n## Technical Requirements\n\n### Subscription System\n\npub trait Subscription<M> {\n    /// Unique ID for deduplication\n    fn id(&self) -> SubId;\n    \n    /// Start producing messages\n    fn start(&self, sender: mpsc::Sender<M>);\n    \n    /// Stop producing messages\n    fn stop(&self);\n}\n\npub type SubId = u64;\n\n// Built-in subscriptions\npub mod subscriptions {\n    /// Tick at fixed interval\n    pub fn every<M: From<Tick>>(duration: Duration) -> impl Subscription<M>;\n    \n    /// File system watcher\n    pub fn watch_file<M: From<FileEvent>>(path: PathBuf) -> impl Subscription<M>;\n    \n    /// Window resize events\n    pub fn window_resize<M: From<Resize>>() -> impl Subscription<M>;\n    \n    /// Focus change events\n    pub fn focus<M: From<Focus>>() -> impl Subscription<M>;\n}\n\n### Model Integration\npub trait Model: Sized {\n    type Message;\n    \n    // Existing\n    fn update(&mut self, msg: Self::Message) -> Cmd<Self::Message>;\n    fn view(&self, frame: &mut Frame);\n    \n    // New: declare active subscriptions\n    fn subscriptions(&self) -> Vec<Box<dyn Subscription<Self::Message>>> {\n        vec![]  // Default: no subscriptions\n    }\n}\n\n### Subscription Lifecycle\nThe runtime:\n1. Calls model.subscriptions() after each update\n2. Compares with previous subscriptions by id()\n3. Starts new subscriptions\n4. Stops removed subscriptions\n5. Routes subscription messages to update()\n\n### Async Commands (Feature: async)\n\n#[cfg(feature = \"async\")]\npub enum Cmd<M> {\n    // Existing...\n    \n    /// Execute async operation\n    Async(BoxFuture<'static, M>),\n    \n    /// Execute blocking operation on threadpool\n    Blocking(Box<dyn FnOnce() -> M + Send + 'static>),\n}\n\n#[cfg(feature = \"async\")]\nimpl<M: Send + 'static> Cmd<M> {\n    pub fn async_fn<F, Fut>(f: F) -> Self\n    where\n        F: FnOnce() -> Fut + Send + 'static,\n        Fut: Future<Output = M> + Send + 'static,\n    {\n        Cmd::Async(Box::pin(async move { f().await }))\n    }\n    \n    pub fn blocking<F>(f: F) -> Self\n    where\n        F: FnOnce() -> M + Send + 'static,\n    {\n        Cmd::Blocking(Box::new(f))\n    }\n}\n\n### Async Runtime Integration\n\n#[cfg(feature = \"tokio\")]\npub struct TokioRuntime { ... }\n\n#[cfg(feature = \"async-std\")]\npub struct AsyncStdRuntime { ... }\n\n// Default: simple threadpool\npub struct ThreadPoolRuntime { ... }\n\n### Deterministic Simulator Compatibility\nSubscriptions must be mockable for testing:\n\npub struct MockSubscription<M> {\n    id: SubId,\n    events: Vec<M>,\n}\n\nimpl<M> Subscription<M> for MockSubscription<M> {\n    fn start(&self, sender: mpsc::Sender<M>) {\n        for msg in &self.events {\n            sender.send(msg.clone()).ok();\n        }\n    }\n}\n\n## Tests Required\n- [ ] Subscription start/stop lifecycle\n- [ ] Subscription deduplication by id\n- [ ] Tick subscription fires correctly\n- [ ] Async command executes\n- [ ] Blocking command on threadpool\n- [ ] Simulator with mock subscriptions\n- [ ] Tokio integration (if feature enabled)\n\n## Acceptance Criteria\n- [ ] Subscription trait defined\n- [ ] Built-in tick subscription\n- [ ] Model.subscriptions() integration\n- [ ] Async Cmd variant (feature-gated)\n- [ ] Threadpool runtime (default)\n- [ ] Tokio runtime (optional)\n- [ ] Simulator compatibility\n\n## Location: ftui-runtime crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:37:23.370393170Z","created_by":"ubuntu","updated_at":"2026-01-31T22:37:56.300717577Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-27v","depends_on_id":"bd-10i.8.2","type":"blocks","created_at":"2026-01-31T22:37:56.300686949Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-29v","title":"Implement Viewport/LogViewer widget (agent harness essential)","description":"PHASE 5 - VIEWPORT/LOG VIEWER WIDGET (ESSENTIAL)\n\n## Background\nThe Viewport/LogViewer is THE ESSENTIAL widget for agent harness UIs. It displays streaming logs with scrollback while maintaining UI chrome. This is the primary use case for FrankenTUI.\n\n## Technical Requirements\n\n### Core Functionality\n- Display scrolling text content\n- Append new lines efficiently (O(1))\n- Scroll to bottom on new content (auto-scroll)\n- Manual scrolling (up/down/page/home/end)\n- Scroll position indicator\n- Max line count with circular buffer\n\n### API Design\n\npub struct LogViewer {\n    lines: VecDeque<Text>,\n    max_lines: usize,\n    scroll_offset: usize,\n    auto_scroll: bool,\n    style: Style,\n}\n\nimpl LogViewer {\n    pub fn new(max_lines: usize) -> Self;\n    \n    /// Append a line (triggers auto-scroll if enabled)\n    pub fn push(&mut self, line: impl Into<Text>);\n    \n    /// Append multiple lines efficiently\n    pub fn push_many(&mut self, lines: impl IntoIterator<Item = impl Into<Text>>);\n    \n    /// Scroll commands\n    pub fn scroll_up(&mut self, lines: usize);\n    pub fn scroll_down(&mut self, lines: usize);\n    pub fn scroll_to_top(&mut self);\n    pub fn scroll_to_bottom(&mut self);\n    pub fn page_up(&mut self);\n    pub fn page_down(&mut self);\n    \n    /// Toggle auto-scroll\n    pub fn set_auto_scroll(&mut self, enabled: bool);\n    \n    /// Check if scrolled to bottom\n    pub fn is_at_bottom(&self) -> bool;\n}\n\nimpl StatefulWidget for LogViewer {\n    type State = LogViewerState;\n    fn render(&self, area: Rect, buf: &mut Buffer, state: &mut Self::State);\n}\n\n### Rendering Strategy\n1. Calculate visible lines based on area height\n2. Determine start index from scroll_offset\n3. Render visible lines with wrapping/truncation\n4. Update scroll indicator\n5. Handle partially visible lines at edges\n\n### Line Wrapping\n- Support: NoWrap, CharWrap, WordWrap modes\n- Handle wide characters correctly\n- Preserve styling across wrapped lines\n\n### Performance Requirements\n- Push: O(1) amortized\n- Render: O(visible_lines)\n- Memory: bounded by max_lines\n\n### Mouse Support (optional)\n- Scroll wheel for scrolling\n- Click to select line (for copy)\n- Drag to select text\n\n## Tests Required\n- [ ] Push appends correctly\n- [ ] Circular buffer eviction works\n- [ ] Auto-scroll behavior\n- [ ] Manual scroll operations\n- [ ] Wrapping modes work\n- [ ] Wide character handling\n- [ ] Visible range calculation\n- [ ] Performance: 10k lines, 60 FPS scroll\n\n## Acceptance Criteria\n- [ ] Streaming logs work smoothly\n- [ ] Scroll position indicator accurate\n- [ ] Auto-scroll toggles correctly\n- [ ] Memory bounded by max_lines\n- [ ] No flicker during append\n- [ ] Works with inline mode\n\n## Location: ftui-widgets crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:30:56.602503037Z","created_by":"ubuntu","updated_at":"2026-01-31T22:32:19.404963362Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-29v","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:32:18.860423343Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-29v","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:32:19.142899265Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-29v","depends_on_id":"bd-wr2","type":"blocks","created_at":"2026-01-31T22:32:19.404932654Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2a5","title":"API documentation and examples suite","description":"PHASE 7 - POLISH: DOCUMENTATION\n\n## Background\nComprehensive documentation is essential for library adoption. Must include API docs, guides, and runnable examples covering all major use cases.\n\n## Technical Requirements\n\n### API Documentation\n- All public types documented with /// comments\n- Module-level documentation with usage examples\n- Cross-linking between related types\n- Platform-specific behavior documented\n- Feature flag documentation\n- Safety documentation for any unsafe code\n\n### Examples Suite\n- examples/hello.rs - Minimal 'Hello World'\n- examples/counter.rs - Basic state management\n- examples/input.rs - Text input handling\n- examples/layout.rs - Flex/Grid layouts\n- examples/styling.rs - Themes and styles\n- examples/table.rs - Data tables\n- examples/async.rs - Async runtime integration\n- examples/inline.rs - Inline mode demo\n\n### Guide Documentation\n- Getting Started guide\n- Architecture overview\n- Migration guide from Ratatui\n- Performance tuning guide\n- Testing guide\n\n## Design Rationale\nDocumentation is a feature. Examples serve as both learning resources and regression tests. Keeping docs close to code via rustdoc ensures accuracy.\n\n## Acceptance Criteria\n- [ ] 100% public API documented\n- [ ] All examples compile and run\n- [ ] Examples cover each major widget\n- [ ] Guide for each major topic\n- [ ] docs.rs badge in README\n- [ ] Changelog maintained\n\n## Location: Workspace-wide + docs/ directory","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:20:27.193051613Z","created_by":"ubuntu","updated_at":"2026-01-31T23:09:01.118650824Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2a5","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:09:01.118613093Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2a5","depends_on_id":"bd-10i.8.3","type":"blocks","created_at":"2026-01-31T22:22:36.366148400Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2a5","depends_on_id":"bd-3k4","type":"blocks","created_at":"2026-01-31T22:22:36.625930213Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2ao","title":"Implement Kitty keyboard protocol support (optional)","description":"# Implement Kitty Keyboard Protocol Support (Optional)\n\n## Background\nThe plan mentions Kitty keyboard protocol in TerminalCapabilities detection and ADR-004. This is an optional enhancement that provides richer key event information.\n\n## What Kitty Keyboard Protocol Provides\n- Distinguish key press vs repeat vs release\n- Modifier key events (Shift pressed, Shift released)\n- Proper handling of key combinations\n- Unicode codepoint of key\n- Alternate key representations\n\n## Why It's Optional (P3)\n- Only supported by Kitty, WezTerm, Ghostty, foot\n- Traditional CSI sequences cover most use cases\n- Additional complexity for marginal benefit\n- Feature-gated to avoid bloating core\n\n## Technical Design\n\n### Detection\n```rust\nimpl TerminalCapabilities {\n    pub fn detect() -> Self {\n        // ...\n        let kitty_keyboard = term.contains(\"kitty\") ||\n            std::env::var(\"KITTY_WINDOW_ID\").is_ok() ||\n            // Could also detect WezTerm, Ghostty\n            false;\n    }\n}\n```\n\n### Protocol Activation\n```rust\nimpl TerminalSession {\n    pub fn enable_kitty_keyboard(&mut self) -> io::Result<()> {\n        // CSI > flags u\n        // flags: 0b1111 = disambiguate + report event types + report alternate keys + report all keys\n        self.writer.write_all(b\"\\x1b[>15u\")?;\n        self.kitty_keyboard_active = true;\n        Ok(())\n    }\n    \n    pub fn disable_kitty_keyboard(&mut self) -> io::Result<()> {\n        // CSI < u - pop keyboard mode\n        self.writer.write_all(b\"\\x1b[<u\")?;\n        self.kitty_keyboard_active = false;\n        Ok(())\n    }\n}\n```\n\n### Enhanced Event Type\n```rust\npub struct KeyEvent {\n    pub code: KeyCode,\n    pub modifiers: Modifiers,\n    pub kind: KeyEventKind,  // Press, Repeat, Release\n    // Kitty-only extensions:\n    pub base_codepoint: Option<char>,\n    pub shifted_key: Option<char>,\n}\n\npub enum KeyEventKind {\n    Press,   // Key pressed\n    Repeat,  // Key held down (auto-repeat)\n    Release, // Key released\n}\n```\n\n### Parser Extension\n```rust\nimpl InputParser {\n    fn parse_kitty_key(&mut self, seq: &[u8]) -> Option<Event> {\n        // CSI unicode-codepoint ; modifiers ; event-type u\n        // Parse the enhanced sequence\n        // ...\n    }\n}\n```\n\n## Graceful Degradation\n- If Kitty protocol not available, fall back to standard CSI\n- KeyEventKind defaults to Press\n- Optional fields are None for legacy input\n\n## Tests Required\n- [ ] Detection works for Kitty terminal\n- [ ] Protocol activation/deactivation\n- [ ] Parse enhanced key sequences\n- [ ] Modifier key press/release events\n- [ ] Graceful fallback when not supported\n- [ ] RAII cleanup on exit\n\n## Acceptance Criteria\n- [ ] Feature-gated behind `kitty-keyboard` feature\n- [ ] Detection in TerminalCapabilities\n- [ ] Activation/deactivation in TerminalSession\n- [ ] Enhanced KeyEvent fields\n- [ ] Parser handles Kitty sequences\n- [ ] Falls back gracefully\n- [ ] Documented in compatibility matrix\n\n## Location: ftui-core crate (feature-gated)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:51:45.755970711Z","created_by":"ubuntu","updated_at":"2026-01-31T22:54:04.314450237Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2ao","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:54:04.314419139Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2dc","title":"Implement Status Line and Panel widgets","description":"PHASE 5 - STATUS LINE + PANEL WIDGETS\n\n## Background\nStatus lines and panels are essential for agent harness UIs. Status line shows current mode/status. Panel provides structured chrome around content areas.\n\n## Technical Requirements\n\n### Status Line Widget\n\npub struct StatusLine<'a> {\n    left: Vec<StatusItem<'a>>,\n    center: Vec<StatusItem<'a>>,\n    right: Vec<StatusItem<'a>>,\n    style: Style,\n    separator: &'a str,\n}\n\npub enum StatusItem<'a> {\n    Text(Text<'a>),\n    Spinner(SpinnerState),\n    Progress { current: u64, total: u64 },\n    KeyHint { key: &'a str, action: &'a str },\n    Spacer,\n}\n\nimpl StatusLine<'_> {\n    pub fn left(mut self, item: StatusItem) -> Self;\n    pub fn center(mut self, item: StatusItem) -> Self;\n    pub fn right(mut self, item: StatusItem) -> Self;\n}\n\n// Typical usage\nStatusLine::new()\n    .left(StatusItem::Text(\"[INSERT]\".into()))\n    .center(StatusItem::Text(\"file.rs\".into()))\n    .right(StatusItem::KeyHint { key: \"^C\", action: \"Quit\" })\n    .right(StatusItem::Text(\"Ln 42, Col 10\".into()))\n\n### Panel Widget\n\npub struct Panel<'a> {\n    title: Option<Title<'a>>,\n    content: Box<dyn Widget + 'a>,\n    footer: Option<Text<'a>>,\n    border_style: BorderStyle,\n    focus_style: Option<Style>,\n    focused: bool,\n}\n\nimpl Panel<'_> {\n    pub fn new(content: impl Widget) -> Self;\n    pub fn title(mut self, title: impl Into<Title>) -> Self;\n    pub fn footer(mut self, footer: impl Into<Text>) -> Self;\n    pub fn focused(mut self, focused: bool) -> Self;\n}\n\n### Layout Integration\nPanels work with Flex/Grid:\n\nFlex::vertical()\n    .add(Panel::new(log_viewer).title(\"Logs\").flex(1.0))\n    .add(Panel::new(input).title(\"Command\").height(3))\n    .add(StatusLine::new()...)\n\n### Focus Management\n- focused property changes border style\n- Tab navigation between panels (runtime handles)\n- Focus indicator (optional marker)\n\n## Tests Required\n- [ ] StatusLine left/center/right positioning\n- [ ] StatusLine separator rendering\n- [ ] StatusLine truncation behavior\n- [ ] Panel border rendering\n- [ ] Panel title positioning\n- [ ] Panel focus style change\n- [ ] Panel with various content types\n- [ ] Empty status line\n\n## Acceptance Criteria\n- [ ] StatusLine with 3 regions\n- [ ] StatusItem variants\n- [ ] Panel wrapper widget\n- [ ] Focus styling\n- [ ] Integration with layouts\n\n## Location: ftui-widgets crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:38:23.477486358Z","created_by":"ubuntu","updated_at":"2026-01-31T22:39:21.399798694Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2dc","depends_on_id":"bd-35p","type":"blocks","created_at":"2026-01-31T22:39:21.399768507Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2dc","depends_on_id":"bd-wr2","type":"blocks","created_at":"2026-01-31T22:39:21.091554241Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2fx","title":"Implement export adapters (HTML/SVG/Text)","description":"PHASE 7 EXTRAS - EXPORT ADAPTERS\n\n## Background\nExport adapters allow saving terminal UI output to various formats for sharing, documentation, and testing.\n\n## Technical Requirements\n\n### Export Formats\n\n#### HTML Export\npub struct HtmlExporter {\n    include_css: bool,\n    class_prefix: String,\n    font_family: String,\n}\n\nimpl HtmlExporter {\n    pub fn export(&self, buffer: &Buffer, pool: &GraphemePool) -> String {\n        // Generate HTML with inline styles or CSS classes\n        // Map colors to CSS colors\n        // Handle wide characters with spans\n    }\n}\n\nOutput:\n<pre class=\"ftui\">\n<span style=\"color:#ff0000;font-weight:bold\">Bold red</span>\n</pre>\n\n#### SVG Export\npub struct SvgExporter {\n    font_size: f32,\n    cell_width: f32,\n    cell_height: f32,\n    background: Color,\n}\n\nimpl SvgExporter {\n    pub fn export(&self, buffer: &Buffer, pool: &GraphemePool) -> String {\n        // Generate SVG with text elements\n        // Position text precisely\n        // Handle colors as fill attributes\n    }\n}\n\n#### Plain Text Export\npub struct TextExporter {\n    strip_styles: bool,\n    include_ansi: bool,\n}\n\nimpl TextExporter {\n    pub fn export(&self, buffer: &Buffer, pool: &GraphemePool) -> String {\n        // strip_styles: just content\n        // include_ansi: full ANSI sequences\n    }\n}\n\n### Frame Capture\npub struct FrameCapture {\n    buffer: Buffer,\n    pool: GraphemePool,\n    timestamp: Instant,\n}\n\nimpl Frame {\n    pub fn capture(&self) -> FrameCapture {\n        // Clone current state for export\n    }\n}\n\n### Session Recording (Optional)\npub struct SessionRecorder {\n    frames: Vec<FrameCapture>,\n    max_frames: usize,\n}\n\nimpl SessionRecorder {\n    pub fn record(&mut self, frame: &Frame);\n    pub fn export_gif(&self) -> Vec<u8>;  // Feature: gif\n    pub fn export_asciinema(&self) -> String;  // Feature: asciinema\n}\n\n## Tests Required\n- [ ] HTML export preserves colors\n- [ ] HTML escape special chars\n- [ ] SVG dimensions correct\n- [ ] SVG text positioning\n- [ ] Plain text strips ANSI\n- [ ] Wide characters handled\n- [ ] Empty buffer exports cleanly\n\n## Acceptance Criteria\n- [ ] HTML exporter with CSS\n- [ ] SVG exporter with fonts\n- [ ] Plain text exporter\n- [ ] Frame capture API\n- [ ] Optional session recording\n- [ ] Feature gate: export\n\n## Location: ftui-extras crate (feature = \"export\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:38:54.774907037Z","created_by":"ubuntu","updated_at":"2026-01-31T22:39:22.296082464Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2fx","depends_on_id":"bd-10i.3.5","type":"blocks","created_at":"2026-01-31T22:39:22.296051996Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2fx","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:39:21.996457852Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2gx","title":"Track Quality Gates (v1 Stop-Ship Criteria)","description":"# Quality Gates: v1 Stop-Ship Criteria\n\n## Background\nPlan Section 0.7 defines four quality gates that are STOP-SHIP if failing. These must be tracked and verified before v1 release.\n\n## Quality Gates\n\n### Gate 1: Inline Mode Stability (CRITICAL)\n**Requirement:** Re-rendering UI region while streaming logs cannot corrupt scrollback or cursor placement.\n\n**Verification:**\n- [ ] PTY test: continuous log stream + periodic UI refresh does not corrupt scrollback\n- [ ] PTY test: cursor returns to correct position after every present()\n- [ ] PTY test: resize during active logging re-anchors correctly\n- [ ] Manual test: 10-minute stress test with rapid log output\n- [ ] Tested on: Linux terminal, tmux, macOS Terminal, WezTerm, Kitty\n\n**Blocking beads:** bd-fbp (overlay redraw), bd-10i.11.2 (PTY tests)\n\n### Gate 2: Diff/Presenter Correctness\n**Requirement:** Property tests validate that applying presenter output to a terminal-model yields the expected grid for supported ops.\n\n**Verification:**\n- [ ] proptest: BufferDiff.compute() identifies all changes\n- [ ] proptest: applying Presenter output to TerminalModel matches source Buffer\n- [ ] proptest: style state never \"leaks\" across runs\n- [ ] proptest: OSC 8 links properly opened and closed\n- [ ] 1000+ random buffer property test passes\n\n**Blocking beads:** bd-10i.11.1 (terminal-model), bd-10i.4.3 (Presenter)\n\n### Gate 3: Unicode Width Correctness\n**Requirement:** Test suite includes emoji/ZWJ/combining marks; no off-by-one wrapping errors.\n\n**Verification:**\n- [ ] Width corpus test: ASCII (all printable)\n- [ ] Width corpus test: CJK wide characters\n- [ ] Width corpus test: Common emoji (, , , etc.)\n- [ ] Width corpus test: ZWJ sequences (, , etc.)\n- [ ] Width corpus test: Combining marks ( = e + )\n- [ ] Width corpus test: Regional indicators ( = U+1F1FA + U+1F1F8)\n- [ ] Text wrapping test: no mid-grapheme breaks\n- [ ] Truncation test: ellipsis at correct position\n\n**Blocking beads:** bd-16k (Unicode width corpus), bd-2uk (Text type)\n\n### Gate 4: Terminal Cleanup\n**Requirement:** PTY tests verify raw mode + cursor visibility + alt screen restoration after normal exit and panic.\n\n**Verification:**\n- [ ] PTY test: normal exit restores cursor visibility\n- [ ] PTY test: normal exit disables raw mode\n- [ ] PTY test: normal exit disables mouse mode\n- [ ] PTY test: normal exit disables bracketed paste\n- [ ] PTY test: alt screen exited on cleanup\n- [ ] PTY test: PANIC during render triggers cleanup\n- [ ] PTY test: IO error mid-write triggers cleanup\n- [ ] Verified panic hook installed correctly\n\n**Blocking beads:** bd-10i.2.6 (TerminalSession), bd-10i.11.2 (PTY tests)\n\n## CI Integration\n- All gates must pass on every PR to main\n- Gates are blocking (not advisory)\n- Gate status visible in CI summary\n\n## Documentation\nWhen all gates pass, update CHANGELOG.md with:\n- \"v1 Quality Gates: PASSED\"\n- Date and commit hash of verification\n\n## Acceptance Criteria\n- [ ] All Gate 1 tests implemented and passing\n- [ ] All Gate 2 tests implemented and passing\n- [ ] All Gate 3 tests implemented and passing\n- [ ] All Gate 4 tests implemented and passing\n- [ ] Gates integrated into CI\n- [ ] All gates green before v1 tag","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T23:17:48.962577656Z","created_by":"ubuntu","updated_at":"2026-01-31T23:27:58.523772275Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2gx","depends_on_id":"bd-10i.11","type":"blocks","created_at":"2026-01-31T23:27:58.523719445Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-10i.11.1","type":"blocks","created_at":"2026-01-31T23:17:56.456035177Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-10i.11.2","type":"blocks","created_at":"2026-01-31T23:17:55.873182651Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-10i.2.6","type":"blocks","created_at":"2026-01-31T23:17:57.621044159Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-16k","type":"blocks","created_at":"2026-01-31T23:17:57.036564148Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-2x0j","type":"blocks","created_at":"2026-01-31T23:21:24.522160540Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2gx","depends_on_id":"bd-fbp","type":"blocks","created_at":"2026-01-31T23:17:55.332559049Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2kj","title":"Build Agent Harness reference application (ftui-harness)","description":"# Build Agent Harness Reference Application\n\n## Background\nThe plan explicitly states: \"The reference harness must not be \\\"just an example\\\"; it is the **design forcing function**.\" This application proves the entire ftui architecture works for its primary use case: Claude Code / Codex-class agent harness UIs.\n\n## Why This Is Critical\nFrom Plan Section 0.8.3 and 12.4:\n- The harness is the integration testbed for the entire library\n- If ftui cannot build this harness easily, the architecture is wrong\n- All Quality Gates must pass against this reference implementation\n\n## Minimum Harness Primitives (Plan Contract)\n- `write_log(text)` - scrollback-native log streaming (inline mode)\n- `present_ui(frame)` - atomic, flicker-resistant UI updates\n- Optional \"modal alt-screen\" for complex UI interactions\n- Child-process capture via PTY to guarantee one-writer rule\n\n## Harness Requirements\n1. **Inline scrollback log stream + UI region**\n   - Logs scroll naturally into terminal scrollback\n   - UI chrome remains fixed at bottom\n   - No cursor corruption or scrollback loss\n\n2. **Tool indicators, status line, input area**\n   - Shows current tool status (running, pending, complete)\n   - Status line with mode/state info\n   - TextInput for user commands/prompts\n\n3. **Streaming render updates**\n   - High-volume log output (100+ lines/second)\n   - UI remains responsive\n   - No dropped frames, no flicker\n\n4. **Survival guarantees**\n   - Survives resize events\n   - Exits cleanly on panic (RAII cleanup)\n   - Handles Ctrl+C gracefully\n\n## Technical Design\n\n```rust\n// Main harness application\nstruct HarnessApp {\n    logs: VecDeque<String>,\n    status: ToolStatus,\n    input: TextInput,\n    ui_height: u16,\n}\n\nimpl Model for HarnessApp {\n    type Message = HarnessMsg;\n    \n    fn update(&mut self, msg: HarnessMsg) -> Cmd<HarnessMsg> {\n        match msg {\n            HarnessMsg::LogLine(line) => {\n                self.logs.push_back(line);\n                if self.logs.len() > MAX_LOGS {\n                    self.logs.pop_front();\n                }\n                Cmd::none()\n            }\n            HarnessMsg::ToolStatusChanged(status) => {\n                self.status = status;\n                Cmd::none()\n            }\n            HarnessMsg::Submit => {\n                let command = self.input.value().to_string();\n                self.input.clear();\n                Cmd::msg(HarnessMsg::ExecuteCommand(command))\n            }\n            // ...\n        }\n    }\n    \n    fn view(&self, frame: &mut Frame) {\n        // Layout: [log viewer] [status line] [input]\n        let chunks = Layout::vertical([\n            Constraint::Min(1),      // logs\n            Constraint::Length(1),   // status\n            Constraint::Length(1),   // input\n        ]).split(frame.area());\n        \n        // Render log viewer\n        let log_widget = Viewport::new(&self.logs);\n        frame.render_widget(log_widget, chunks[0]);\n        \n        // Render status\n        let status = self.status.render();\n        frame.render_widget(status, chunks[1]);\n        \n        // Render input with cursor\n        frame.render_widget(&self.input, chunks[2]);\n        frame.set_cursor(/* input cursor position */);\n    }\n}\n```\n\n## \"What Agent-Ergonomic Means\" (Plan Section 17.4)\n- Hello world harness in **<200 LOC**\n- Tool output streaming is **one function call**\n- Pinned bottom UI is **one config option**\n- Temporary full-screen modal supported without rewriting app\n\n## Tests Required (PTY Tests)\n- [ ] Log spam + UI tick does not corrupt scrollback\n- [ ] Cursor restored after every UI present\n- [ ] Resize re-anchors correctly\n- [ ] Normal exit restores terminal\n- [ ] Panic restores terminal\n- [ ] 1000+ log lines/second remains responsive\n\n## Acceptance Criteria\n- [ ] Reference app compiles and runs\n- [ ] Inline mode with logs + UI chrome works\n- [ ] Resize handling correct\n- [ ] All PTY tests pass\n- [ ] <200 LOC for basic harness\n- [ ] Documented as example in crate\n\n## Location: ftui-harness crate (examples/demos)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:50:43.295616067Z","created_by":"ubuntu","updated_at":"2026-01-31T22:53:53.308955934Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2kj","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T22:53:53.308923193Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2kj","depends_on_id":"bd-10i.8.2","type":"blocks","created_at":"2026-01-31T22:53:51.799707368Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2kj","depends_on_id":"bd-29v","type":"blocks","created_at":"2026-01-31T22:53:52.939855940Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2kj","depends_on_id":"bd-fbp","type":"blocks","created_at":"2026-01-31T22:53:52.193367037Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2kj","depends_on_id":"bd-gpe","type":"blocks","created_at":"2026-01-31T22:53:52.567678843Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2m5","title":"SIMD-accelerated cell comparison and buffer operations","description":"PERFORMANCE - SIMD OPTIMIZATION\n\n## Background\nCell comparison dominates diff performance. The 16-byte Cell design enables 4 cells per 64-byte cache line, optimized for SIMD comparison. This task implements SIMD acceleration.\n\n## Technical Requirements\n- SIMD cell equality comparison:\n  - Compare 4 cells (64 bytes) at once with AVX2\n  - Fallback to 2 cells (32 bytes) with SSE2\n  - Scalar fallback for non-x86\n- Buffer row comparison:\n  - Find first differing cell in row\n  - Find changed row spans for minimal diff\n- Memory alignment:\n  - Buffer rows aligned to 64 bytes\n  - Cell array uses aligned allocation\n\n## Implementation Strategy\n1. Use std::simd (portable_simd) when stabilized\n2. Until then: safe abstraction over platform intrinsics\n3. Feature gate: 'simd' (enabled by default on x86_64)\n4. Graceful fallback with #[cfg] guards\n\n## Design Rationale\nThe plan explicitly calls out SIMD as the optimization path for cell comparison. 16-byte Cell alignment is specifically chosen to enable 4-way comparison.\n\n## Acceptance Criteria\n- [ ] SIMD cell comparison implementation\n- [ ] AVX2 path for x86_64\n- [ ] SSE2 fallback\n- [ ] Scalar fallback for other platforms\n- [ ] Benchmark showing speedup\n- [ ] No unsafe without exhaustive safety comments\n- [ ] Runtime feature detection where appropriate\n\n## Performance Budget\n- Cell comparison: < 1ns (target from plan)\n- Row comparison: < 10ns per cell\n- Buffer diff: sublinear with SIMD\n\n## Location: ftui-simd crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:20:50.805814276Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:46.216494196Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2m5","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T22:22:46.216463669Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2rs","title":"Implement clipboard integration (OSC 52)","description":"PHASE 7 EXTRAS - CLIPBOARD INTEGRATION\n\n## Background\nOSC 52 allows setting the system clipboard from terminal applications. This enables copy/paste functionality without external dependencies.\n\n## Technical Requirements\n\n### OSC 52 Protocol\nSequence: ESC ] 52 ; c ; <base64-data> BEL\n\nc = clipboard selection:\n- c = clipboard\n- p = primary (X11)\n- s = secondary\n- 0-7 = cut buffers\n\n### Clipboard API\n\npub struct Clipboard {\n    caps: TerminalCapabilities,\n}\n\nimpl Clipboard {\n    /// Check if OSC 52 is supported\n    pub fn is_available(&self) -> bool {\n        self.caps.osc52\n    }\n    \n    /// Set clipboard content\n    pub fn set(&self, content: &str, writer: &mut impl Write) -> io::Result<()> {\n        if !self.is_available() {\n            return Err(io::Error::new(\n                io::ErrorKind::Unsupported,\n                \"OSC 52 not available\"\n            ));\n        }\n        \n        let encoded = base64::encode(content);\n        write!(writer, \"\\x1b]52;c;{}\\x07\", encoded)?;\n        writer.flush()\n    }\n    \n    /// Clear clipboard\n    pub fn clear(&self, writer: &mut impl Write) -> io::Result<()> {\n        write!(writer, \"\\x1b]52;c;\\x07\")?;\n        writer.flush()\n    }\n}\n\n### Terminal Compatibility\nOSC 52 support varies:\n-  iTerm2, kitty, alacritty, WezTerm, foot\n-  tmux (needs set-clipboard on)\n-  screen (needs clipboard support)\n-  Many terminal emulators disable by default\n\n### Detection Strategy\n1. Check known terminal from TERM/TERM_PROGRAM\n2. Check tmux/screen allow-passthrough\n3. Attempt set and check for response (risky)\n4. Default: assume unsupported\n\n### Size Limits\nMost terminals limit OSC 52 payload:\n- Common limit: 74994 bytes (base64)\n- Split large content or fail gracefully\n\n### Fallback Options\nWhen OSC 52 unavailable:\n- Fall back to external clipboard tool (feature: clipboard-fallback)\n  - macOS: pbcopy/pbpaste\n  - Linux: xclip, xsel, wl-copy\n  - Windows: clip.exe\n- Or return error for application to handle\n\n## Tests Required\n- [ ] OSC 52 sequence generation\n- [ ] Base64 encoding correct\n- [ ] Size limit handling\n- [ ] Clear clipboard works\n- [ ] Capability detection\n- [ ] Fallback to external tools\n- [ ] Error handling when unavailable\n\n## Acceptance Criteria\n- [ ] OSC 52 set clipboard\n- [ ] Capability detection\n- [ ] Size limit enforcement\n- [ ] Clear clipboard\n- [ ] Optional external fallback\n- [ ] Feature gate: clipboard\n\n## Location: ftui-extras crate (feature = \"clipboard\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:39:12.769788961Z","created_by":"ubuntu","updated_at":"2026-01-31T22:39:22.604131369Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2rs","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T22:39:22.604101432Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2ss","title":"Document Windows v1 Limitations and Compatibility","description":"# Document Windows v1 Limitations and Compatibility\n\n## Background\nPlan Section ADR-004 and Section 0.6.6 require a \"Windows limitations\" section that is honest about what works and what doesn't.\n\n## Document Location\n`docs/WINDOWS.md` or `docs/compatibility/windows.md`\n\n## Required Content\n\n### 1. Supported Features (v1)\nDocument what IS expected to work on Windows:\n- [ ] Raw mode enter/exit and cleanup on panic\n- [ ] Key input handling (basic keys, modifiers)\n- [ ] Resize events\n- [ ] Basic mouse support (where Crossterm supports it)\n- [ ] Color output:\n  - 16 colors (always)\n  - 256 colors (Windows Terminal, modern ConHost)\n  - TrueColor (Windows Terminal)\n\n### 2. Known Limitations (v1)\nBe honest about what MAY NOT work or is best-effort:\n- [ ] DEC synchronized output (mode 2026): Not widely supported\n- [ ] OSC 8 hyperlinks: Windows Terminal only (cmd.exe/ConHost: no)\n- [ ] Bracketed paste: Varies by terminal\n- [ ] Focus events: May not work in all environments\n- [ ] Kitty keyboard protocol: Limited support\n- [ ] Scroll-region optimization: Behavior varies\n- [ ] Mouse SGR mode: May fall back to legacy encoding\n\n### 3. Terminal Compatibility Matrix (Windows)\n| Feature | Windows Terminal | cmd.exe | ConHost | PowerShell |\n|---------|------------------|---------|---------|------------|\n| TrueColor |  |  | ~ | depends |\n| OSC 8 Links |  |  |  | ~ |\n| Mouse |  |  | ~ | ~ |\n| Sync Output |  |  |  |  |\n\n### 4. Configuration Recommendations\n- Recommend Windows Terminal for best experience\n- Document any required ConPTY settings\n- Explain TERM/COLORTERM environment handling on Windows\n\n### 5. Troubleshooting Section\nCommon Windows issues:\n- \"Colors don't show\": Check terminal emulator\n- \"Mouse not working\": Enable in terminal settings\n- \"Cleanup not working\": Known ConHost limitation\n- \"Unicode display broken\": Font/codepage issues\n\n### 6. Future Improvements\nList what may improve in future versions:\n- Better ConHost support\n- WSL integration notes\n- Specific terminal emulator enhancements\n\n## Cross-References\n- Link to ADR-004 for decision context\n- Link to terminal compatibility matrix (bd-1un)\n- Link to capability detection implementation\n\n## Acceptance Criteria\n- [ ] WINDOWS.md exists with all sections\n- [ ] Honest about limitations (not marketing fluff)\n- [ ] Tested on actual Windows systems\n- [ ] Includes actionable troubleshooting\n- [ ] Linked from main README.md\n\n## Location\n`docs/WINDOWS.md`","status":"open","priority":1,"issue_type":"docs","created_at":"2026-01-31T23:18:18.126663735Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:23.485129522Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2ss","depends_on_id":"bd-10i.10.4","type":"blocks","created_at":"2026-01-31T23:18:23.485084968Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2u4","title":"Implement snapshot/golden testing framework","description":"TESTING - SNAPSHOT TESTS\n\n## Background\nSnapshot testing captures expected Buffer output and compares against future runs. Essential for preventing visual regressions and validating rendering correctness.\n\n## Technical Requirements\n- Snapshot capture:\n  - Buffer  text representation (with ANSI or stripped)\n  - Buffer  binary serialization\n  - Configurable normalization (strip cursor position, etc.)\n- Snapshot storage:\n  - tests/snapshots/ directory\n  - Filename based on test name + variant\n  - Human-readable format for review\n- Comparison:\n  - Exact match mode\n  - Fuzzy match mode (ignore whitespace variations)\n  - Diff output on failure showing changes\n- Update workflow:\n  - BLESS=1 env var to update snapshots\n  - cargo insta integration optional\n\n## Design Rationale\nVisual output is hard to assert with unit tests. Snapshots capture 'known good' output and flag any changes for human review. Prevents subtle rendering regressions.\n\n## Acceptance Criteria\n- [ ] Snapshot capture API\n- [ ] Text and binary formats\n- [ ] Diff output on mismatch\n- [ ] Update/bless workflow\n- [ ] Integration with cargo test\n- [ ] Document snapshot review process\n- [ ] Sample snapshots for core widgets\n\n## Integration\n- Consider insta crate for snapshot management\n- Support parallel test execution\n- Snapshot files committed to git\n\n## Location: ftui-harness crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:21:02.513675763Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:45.971542074Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2u4","depends_on_id":"bd-10i.11.1","type":"blocks","created_at":"2026-01-31T22:22:45.971507198Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2uk","title":"Implement Text type with styled spans","description":"# Implement Text type (Segment/Span collection)\n\n## Background\nPlan Section 0.4 and Appendix D establish a text pipeline:\n- `Segment` is the atomic styled unit (Cow<str> where possible)\n- higher-level markup/text APIs produce segments\n- widgets/layout paint segments into `Frame`/`Buffer`\n\nText must support:\n- ergonomic construction for app authors\n- deterministic style application\n- width-correct wrapping/truncation (ZWJ/emoji/combining)\n- fast paths for ASCII-heavy workloads (see bd-v6y)\n\n## Proposed model\nA `Text` is an owned collection of segments (or spans) plus helpers.\n\nOption A (generic, most faithful to plan):\n```rust\npub struct Text<'a> {\n    segments: Vec<Segment<'a>>,\n}\n```\n\nOption B (ergonomic, no lifetimes in app code):\n- `Text` stores `Segment<'static>` (Cow<'static, str>)\n- constructors accept `&str` and own when needed\n\nWe should pick the option that keeps the public API pleasant while preserving the plan's \"borrow when you can\" benefit for string literals.\n\n## Required behaviors\n- Append/push spans/segments\n- Apply a base style (inheritance) deterministically\n- Split into lines (preserve styles)\n- Truncate to width with ellipsis (width-correct)\n- Wrap to width (width-correct)\n\n## Width correctness\n- ASCII fast path must be correct and allocation-free (bd-v6y)\n- Non-ASCII path must use Unicode width + (ideally) grapheme segmentation\n- Must not wrap mid-grapheme for common emoji/ZWJ sequences\n\n## Tests\n- Line splitting preserves styles across `\\n`\n- Truncation is width-correct for:\n  - ASCII\n  - CJK wide chars\n  - emoji/ZWJ sequences\n- Wrapping is width-correct and stable across widths\n\n## Acceptance Criteria\n- [ ] `Text` type exists with an ergonomic builder API.\n- [ ] Wrapping/truncation is width-correct.\n- [ ] ASCII fast path is integrated (bd-v6y).\n- [ ] Unit tests cover ASCII, CJK, emoji/ZWJ cases.\n\n## Location\n`ftui-text` crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:18:51.038800704Z","created_by":"ubuntu","updated_at":"2026-01-31T23:16:06.591430721Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2uk","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T22:22:12.067575457Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2uk","depends_on_id":"bd-1ho.1","type":"blocks","created_at":"2026-01-31T23:15:51.396823035Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2vr","title":"Create comprehensive E2E test suite","description":"TESTING - E2E TEST SCRIPTS\n\n## Background\nEnd-to-end tests verify the complete rendering pipeline from widget construction through terminal output. Must test real terminal interactions, not mocked abstractions.\n\n## Technical Requirements\n\n### E2E Test Infrastructure\n- scripts/e2e_test.sh master script\n- Individual test scripts per feature area\n- JSON output for CI parsing\n- Verbose mode with full trace output\n- Exit codes: 0=pass, 1=fail, 2=skip\n\n### Test Categories\n\n#### 1. Rendering Tests (scripts/e2e/render/)\n- hello_world.sh - Basic text output\n- colors.sh - Full color palette rendering\n- unicode.sh - Emoji, CJK, RTL text\n- styles.sh - Bold, italic, underline, strikethrough\n- hyperlinks.sh - OSC 8 hyperlink rendering\n\n#### 2. Layout Tests (scripts/e2e/layout/)\n- flex_horizontal.sh - Row layout constraints\n- flex_vertical.sh - Column layout constraints\n- grid.sh - 2D grid positioning\n- nested.sh - Complex nested layouts\n- resize.sh - Terminal resize handling\n\n#### 3. Widget Tests (scripts/e2e/widgets/)\n- block.sh - Borders, titles, padding\n- paragraph.sh - Text wrapping, alignment\n- table.sh - Column sizing, selection\n- list.sh - Selection, scrolling\n- input.sh - Text entry, cursor\n\n#### 4. Input Tests (scripts/e2e/input/)\n- keyboard.sh - Key events, modifiers\n- mouse.sh - Click, scroll, drag\n- paste.sh - Bracketed paste mode\n- focus.sh - Focus in/out events\n\n#### 5. Integration Tests (scripts/e2e/integration/)\n- full_app.sh - Complete application lifecycle\n- inline_mode.sh - Scrollback-native rendering\n- alt_screen.sh - Alternate screen buffer\n- raw_mode.sh - Raw terminal mode transitions\n\n### Test Script Template\n#!/bin/bash\nset -euo pipefail\nsource \"\"/usr/bin/../common.sh\"\n\nTEST_NAME=\"render/hello_world\"\nlog_start \"\"\n\n# Run the test binary\noutput=error: could not find `Cargo.toml` in `/data/projects/frankentui` or any parent directory || fail \"Example failed to run\"\n\n# Verify output\nassert_contains \"\" \"Hello\"\nassert_no_errors \"\"\n\nlog_pass \"\"\n\n### Logging Requirements\n- Start: timestamp, test name, configuration\n- Progress: major checkpoints\n- Failure: full context, expected vs actual\n- Pass: duration, resource usage\n\n### CI Integration\n- JUnit XML output for test runners\n- Parallel execution where safe\n- Retry logic for flaky tests\n- Artifact collection on failure\n\n## Acceptance Criteria\n- [ ] Master e2e_test.sh script\n- [ ] 5+ rendering tests\n- [ ] 5+ layout tests\n- [ ] 5+ widget tests\n- [ ] 5+ input tests\n- [ ] 3+ integration tests\n- [ ] JSON output mode\n- [ ] Verbose trace mode\n- [ ] CI-friendly exit codes\n- [ ] Test duration < 60s total\n\n## Location: scripts/e2e/","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:28:13.459580138Z","created_by":"ubuntu","updated_at":"2026-01-31T22:29:24.582469538Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2vr","depends_on_id":"bd-10i.8.2","type":"blocks","created_at":"2026-01-31T22:29:24.582439311Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2w5","title":"Implement view_string() easy mode adapter","description":"# Implement view_string() Easy Mode Adapter\n\n## Background\nPlan Section 0.8.2 and 12.3 describe a \"Easy mode adapter\" for trivial apps and prototyping. This allows developers to return a String from view() while still going through the full kernel pipeline.\n\n## Why This Matters\n- Enables quick prototyping without learning full Frame API\n- Familiar model for developers coming from Bubbletea\n- Keeps kernel discipline (String still goes through Frame)\n- Lower barrier to entry for simple apps\n\n## Technical Design\n\n### Model Trait Extension\n```rust\n/// Optional trait for models that want string-based views\npub trait StringModel: Model {\n    /// Return view as string (styled text with markup)\n    fn view_string(&self) -> String;\n}\n\n/// Blanket implementation: view_string -> Frame\nimpl<M: StringModel> Model for M {\n    fn view(&self, frame: &mut Frame) {\n        let text = self.view_string();\n        let parsed = Text::from_markup(&text);\n        frame.render_widget(parsed, frame.area());\n    }\n}\n```\n\n### Alternative: Wrapper Type\n```rust\n/// Wrapper that converts StringModel to Model\npub struct StringModelAdapter<M: StringModel> {\n    inner: M,\n}\n\nimpl<M: StringModel> Model for StringModelAdapter<M> {\n    type Message = M::Message;\n    \n    fn update(&mut self, msg: Self::Message) -> Cmd<Self::Message> {\n        self.inner.update(msg)\n    }\n    \n    fn view(&self, frame: &mut Frame) {\n        let text = self.inner.view_string();\n        let parsed = Text::from_markup(&text);\n        frame.render_widget(Paragraph::new(parsed), frame.area());\n    }\n}\n```\n\n### Pipeline Preservation\nString -> Text/Segments -> Frame draw -> Diff -> Presenter\n\nThis ensures:\n- Markup is properly parsed\n- Styles are correctly applied\n- Width measurement is correct\n- Diffing works normally\n- All kernel guarantees hold\n\n## Usage Example\n```rust\nstruct Counter { count: i32 }\n\nimpl StringModel for Counter {\n    fn view_string(&self) -> String {\n        format\\!(\"[bold]Count:[/] {}\", self.count)\n    }\n}\n\nfn main() -> Result<()> {\n    App::string_model(Counter { count: 0 })\n        .screen_mode(ScreenMode::Inline { ui_height: 1 })\n        .run()\n}\n```\n\n## API Options\n\n### Option 1: StringModel trait\n```rust\nApp::string_model(model)\n```\n\n### Option 2: view() callback\n```rust\nApp::new(model)\n    .view(|state| format\\!(\"Count: {}\", state.count))\n```\n\n### Option 3: Both\nSupport both patterns for flexibility.\n\n## Tests Required\n- [ ] view_string() produces correct Frame output\n- [ ] Markup parsing works correctly\n- [ ] Multi-line strings render properly\n- [ ] Width measurement correct\n- [ ] Style application correct\n- [ ] Diffing works as expected\n\n## Acceptance Criteria\n- [ ] StringModel trait or equivalent\n- [ ] Integration with App/Program\n- [ ] Proper pipeline (not bypass)\n- [ ] Documentation with examples\n- [ ] Tests for all paths\n\n## Location: ftui-runtime crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:53:03.545821731Z","created_by":"ubuntu","updated_at":"2026-01-31T22:54:03.936757737Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2w5","depends_on_id":"bd-10i.8.2","type":"blocks","created_at":"2026-01-31T22:54:03.587890261Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2w5","depends_on_id":"bd-3mo","type":"blocks","created_at":"2026-01-31T22:54:03.936708244Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2wi","title":"Implement Grid layout for 2D positioning","description":"PHASE 5 - GRID LAYOUT\n\n## Background\nGrid layout provides 2D positioning with rows/columns. More powerful than Flex for dashboard-style layouts with multiple regions.\n\n## Technical Requirements\n- Grid struct with rows  cols dimensions\n- Cell addressing: grid[(row, col)]\n- Column/row constraints (reuse Flex constraint types)\n- Cell spanning: colspan/rowspan for merged cells\n- Gap between cells (row_gap, col_gap)\n- Area naming: grid.area('sidebar') returns Rect\n- Template syntax for declarative grid definition\n\n## Design Rationale\nCSS Grid concepts adapted for TUI. Area naming enables semantic layout references. Cell spanning handles common dashboard patterns.\n\n## Acceptance Criteria\n- [ ] Grid struct with constraint-based sizing\n- [ ] Row and column constraint solving\n- [ ] Cell span support (colspan, rowspan)\n- [ ] Named area definition and lookup\n- [ ] Gap configuration\n- [ ] Template DSL for grid definition\n- [ ] Overflow handling for too-small grids\n- [ ] Property tests for area calculations\n\n## Performance Budget\n- Grid solve for 1010: < 500s\n- Area lookup: O(1) after solve\n\n## Location: ftui-layout crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:19:13.186902512Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:19.086437578Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2wi","depends_on_id":"bd-yzu","type":"blocks","created_at":"2026-01-31T22:22:19.086408393Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2wo","title":"Implement tmux/screen passthrough and mux detection","description":"# Implement tmux/screen Passthrough and Mux Detection\n\n## Background\nPlan Section 9.4 and ADR-001 describe multiplexer (tmux/screen/zellij) detection and passthrough handling. This is important for inline mode to work correctly under multiplexers.\n\n## Why This Matters\n- tmux/screen intercept escape sequences\n- Some features (sync output, OSC 8) need passthrough\n- Scroll regions behave differently under muxes\n- Detection enables correct fallback strategies\n\n## Technical Design\n\n### Detection\n```rust\nimpl TerminalCapabilities {\n    pub fn detect() -> Self {\n        // Multiplexer detection\n        let in_tmux = std::env::var(\"TMUX\").is_ok();\n        let in_screen = std::env::var(\"STY\").is_ok();\n        let in_zellij = std::env::var(\"ZELLIJ\").is_ok();\n        \n        // Note: WezTerm/Kitty built-in muxes don't need special handling\n        \n        Self {\n            in_tmux,\n            in_screen,\n            in_zellij,\n            // ...\n        }\n    }\n    \n    pub fn in_any_mux(&self) -> bool {\n        self.in_tmux || self.in_screen || self.in_zellij\n    }\n}\n```\n\n### tmux Passthrough Wrapper\n```rust\n/// Wrap sequence for tmux passthrough\n/// tmux intercepts escape sequences unless wrapped in DCS passthrough\npub fn tmux_wrap(sequence: &str) -> String {\n    if in_tmux() {\n        // Double escapes for tmux\n        let escaped = sequence.replace('\\\\x1b', \"\\\\x1b\\\\x1b\");\n        format\\!(\"\\\\x1bPtmux;{}\\\\x1b\\\\\\\\\", escaped)\n    } else {\n        sequence.to_string()\n    }\n}\n\n// Usage example for OSC 8 hyperlinks under tmux\nfn emit_hyperlink(url: &str) -> String {\n    let osc = format\\!(\"\\\\x1b]8;;{}\\\\x1b\\\\\\\\\", url);\n    tmux_wrap(&osc)\n}\n```\n\n### Mux-Aware Feature Policies\n```rust\nimpl TerminalCapabilities {\n    /// Returns whether sync output should be enabled\n    pub fn use_sync_output(&self) -> bool {\n        // Disable in multiplexers (passthrough unreliable)\n        if self.in_any_mux() {\n            return false;\n        }\n        self.sync_output\n    }\n    \n    /// Returns whether scroll-region optimization is safe\n    pub fn use_scroll_region(&self) -> bool {\n        // Conservative in muxes due to quirks\n        if self.in_any_mux() {\n            return false;  // Fall back to overlay redraw\n        }\n        self.scroll_region\n    }\n    \n    /// OSC 8 hyperlink support\n    pub fn use_hyperlinks(&self) -> bool {\n        // tmux passthrough needed for hyperlinks\n        // Only enable if passthrough is reliable\n        if self.in_tmux {\n            // Modern tmux (3.3+) supports OSC 8 passthrough\n            // but detection is fragile\n            return false;  // Conservative default\n        }\n        self.osc8_hyperlinks\n    }\n}\n```\n\n### Screen Passthrough\n```rust\n/// screen uses different passthrough syntax\npub fn screen_wrap(sequence: &str) -> String {\n    if in_screen() {\n        // screen uses P escape sequence\n        format\\!(\"\\\\x1bP{}\\\\x1b\\\\\\\\\", sequence)\n    } else {\n        sequence.to_string()\n    }\n}\n```\n\n### Zellij Handling\n```rust\n// Zellij generally has better passthrough than tmux/screen\n// but some features still need care\nimpl TerminalCapabilities {\n    pub fn zellij_passthrough_mode(&self) -> bool {\n        // Zellij 0.39+ has improved passthrough\n        self.in_zellij\n    }\n}\n```\n\n## Integration Points\n\n1. **TerminalCapabilities::detect()** - Detect multiplexer presence\n2. **Presenter output** - Apply passthrough wrapping where needed\n3. **ADR-001 inline mode** - Fall back to overlay redraw in muxes\n4. **Feature policies** - Conservative defaults in mux environments\n\n## Tests Required\n- [ ] TMUX env var detection\n- [ ] STY env var detection (screen)\n- [ ] ZELLIJ env var detection\n- [ ] tmux_wrap produces correct output\n- [ ] screen_wrap produces correct output\n- [ ] Feature policies respect mux detection\n- [ ] PTY test under tmux (if CI supports)\n\n## Acceptance Criteria\n- [ ] Mux detection in TerminalCapabilities\n- [ ] in_any_mux() helper method\n- [ ] Passthrough wrappers for tmux/screen\n- [ ] Feature policies mux-aware\n- [ ] Documentation of mux limitations\n\n## Location: ftui-core crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:55:01.998491733Z","created_by":"ubuntu","updated_at":"2026-01-31T22:55:09.706951315Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2wo","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:55:09.706897083Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2wo","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T22:55:09.339827361Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2x0j","title":"Implement property tests for diff correctness and presenter roundtrip","description":"# Implement Property Tests for Diff and Presenter Correctness\n\n## Background\nPlan Section 13.1 and J specifically require property tests to ensure diff correctness and presenter output validation. Property tests use randomized inputs to find edge cases humans miss.\n\n## Property Test Categories\n\n### Category 1: Diff Correctness\n**Property**: Applying diff changes to old buffer produces new buffer\n\n```rust\nproptest! {\n    #[test]\n    fn diff_apply_produces_target(\n        width in 10u16..200,\n        height in 5u16..100,\n        changes in proptest::collection::vec(\n            (0u16..200, 0u16..100, any::<Cell>()), \n            0..1000\n        )\n    ) {\n        // Create old buffer\n        let mut old = Buffer::new(width, height);\n        \n        // Apply random changes to create new buffer\n        let mut new = old.clone();\n        for (x, y, cell) in &changes {\n            if *x < width && *y < height {\n                new.set(*x, *y, cell.clone());\n            }\n        }\n        \n        // Compute diff\n        let diff = BufferDiff::compute(&old, &new);\n        \n        // Apply diff to old should produce new\n        let mut result = old.clone();\n        for (x, y) in diff.changes() {\n            let cell = new.get(*x, *y).unwrap().clone();\n            result.set(*x, *y, cell);\n        }\n        \n        // Verify buffers match\n        for y in 0..height {\n            for x in 0..width {\n                prop_assert_eq!(\n                    result.get(x, y),\n                    new.get(x, y),\n                    \"Mismatch at ({}, {})\", x, y\n                );\n            }\n        }\n    }\n}\n```\n\n### Category 2: Presenter Roundtrip\n**Property**: Presenter output applied to terminal model matches source buffer\n\n```rust\nproptest! {\n    #[test]\n    fn presenter_roundtrip_correct(\n        width in 10u16..80,\n        height in 5u16..40,\n        fill_ratio in 0.0f32..1.0,\n    ) {\n        // Create random buffer\n        let buffer = generate_random_buffer(width, height, fill_ratio);\n        \n        // Present to bytes\n        let mut output = Vec::new();\n        let mut presenter = Presenter::new(&mut output, TerminalCapabilities::basic());\n        presenter.present_full(&buffer, &GraphemePool::new(), &LinkRegistry::new())\n            .unwrap();\n        \n        // Apply to terminal model\n        let mut model = TerminalModel::new(width, height);\n        model.apply_output(&output).unwrap();\n        \n        // Verify match\n        prop_assert!(\n            model.matches(&buffer, &GraphemePool::new()),\n            \"Presenter output doesn't reproduce buffer\"\n        );\n    }\n}\n```\n\n### Category 3: Style State Never Leaks\n**Property**: After complete frame, style is reset\n\n```rust\nproptest! {\n    #[test]\n    fn style_state_reset_after_present(\n        width in 10u16..80,\n        height in 5u16..40,\n    ) {\n        let buffer = generate_styled_buffer(width, height);\n        \n        let mut output = Vec::new();\n        let mut presenter = Presenter::new(&mut output, TerminalCapabilities::basic());\n        presenter.present_full(&buffer, &GraphemePool::new(), &LinkRegistry::new())\n            .unwrap();\n        \n        // Output must end with SGR 0 (reset)\n        let output_str = String::from_utf8_lossy(&output);\n        prop_assert!(\n            output_str.ends_with(\"\\x1b[0m\") || \n            output_str.contains(\"\\x1b[0m\\x1b[\"),  // Reset before final positioning\n            \"Style not reset at end: {}\", &output_str[output_str.len().saturating_sub(50)..]\n        );\n    }\n}\n```\n\n### Category 4: Links Properly Closed\n**Property**: Every OSC 8 link open has corresponding close\n\n```rust\nproptest! {\n    #[test]\n    fn links_balanced(width in 10u16..80, height in 5u16..40) {\n        let buffer = generate_buffer_with_links(width, height);\n        \n        let mut output = Vec::new();\n        let mut presenter = Presenter::new(&mut output, TerminalCapabilities { \n            osc8_hyperlinks: true, \n            ..TerminalCapabilities::basic() \n        });\n        presenter.present_full(&buffer, &GraphemePool::new(), &links())\n            .unwrap();\n        \n        let output_str = String::from_utf8_lossy(&output);\n        \n        // Count link opens and closes\n        let opens = output_str.matches(\"\\x1b]8;;\").count()  // link with URL\n            + output_str.matches(\"\\x1b]8;id=\").count();     // link with id\n        let closes = output_str.matches(\"\\x1b]8;;\\x1b\\\\\").count();\n        \n        // Every open needs a close (or one final close)\n        prop_assert!(\n            opens <= closes,\n            \"Unbalanced links: {} opens, {} closes\", opens, closes\n        );\n    }\n}\n```\n\n### Category 5: Width Invariants\n**Property**: Rendering never writes beyond buffer bounds\n\n```rust\nproptest! {\n    #[test]\n    fn render_within_bounds(\n        width in 10u16..80,\n        height in 5u16..40,\n        text in \".*\",\n    ) {\n        let mut buffer = Buffer::new(width, height);\n        \n        // Render text into buffer (via whatever rendering API)\n        render_text(&mut buffer, &text, 0, 0, width);\n        \n        // Check no writes beyond bounds\n        // (Buffer should enforce this internally, but verify)\n        for y in 0..height {\n            let mut x = 0;\n            while x < width {\n                let cell = buffer.get(x, y).unwrap();\n                let cell_width = cell.width() as u16;\n                \n                // Wide char can't overflow right edge\n                prop_assert!(\n                    x + cell_width <= width,\n                    \"Wide char at ({}, {}) overflows (width {})\",\n                    x, y, cell_width\n                );\n                \n                x += cell_width.max(1);\n            }\n        }\n    }\n}\n```\n\n## Test Helpers Needed\n- `generate_random_buffer(w, h, fill_ratio)` - Random content\n- `generate_styled_buffer(w, h)` - Random styles\n- `generate_buffer_with_links(w, h)` - Random hyperlinks\n- `Arbitrary` impl for Cell, CellContent, CellAttrs, PackedRgba\n\n## Running Property Tests\n```bash\n# Run with many iterations\nPROPTEST_CASES=10000 cargo test --test prop_tests\n\n# Generate regression cases on failure\nPROPTEST_ENABLE_FAILURE_PERSISTENCE=1 cargo test\n```\n\n## Acceptance Criteria\n- [ ] Diff apply property test passes 10k iterations\n- [ ] Presenter roundtrip property test passes 10k iterations\n- [ ] Style reset property test passes 10k iterations\n- [ ] Link balance property test passes 10k iterations\n- [ ] Width bounds property test passes 10k iterations\n- [ ] No panics under property testing\n- [ ] Regression cases saved for failed tests\n\n## Location\n`tests/prop_tests.rs`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:21:15.739827546Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:23.803374191Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2x0j","depends_on_id":"bd-10i.11.1","type":"blocks","created_at":"2026-01-31T23:21:23.803332893Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2x0j","depends_on_id":"bd-10i.4.1","type":"blocks","created_at":"2026-01-31T23:21:22.515794868Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2x0j","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T23:21:23.163621516Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2yd","title":"Implement StyleSheet registry for named styles","description":"PHASE 4 - STYLESHEET REGISTRY\n\n## Background\nStyleSheet provides named style registration similar to CSS classes. Enables theme-able applications and consistent style reuse without hardcoding colors.\n\n## Technical Requirements\n- StyleSheet struct with HashMap<StyleId, Style>\n- StyleId: either interned string or u32 index\n- Register named styles: stylesheet.define('error', Style::new().fg(RED).bold())\n- Lookup by name: stylesheet.get('error')\n- Style composition: stylesheet.compose(['base', 'error']) merges in order\n- Default styles for common semantic names (error, warning, info, success, muted)\n\n## Design Rationale\nNamed styles decouple visual appearance from widget logic. Themes can override the stylesheet without changing widget code. Matches patterns from Textual/Rich.\n\n## Acceptance Criteria\n- [ ] StyleSheet with define/get/compose API\n- [ ] StyleId type (string or integer based on perf analysis)\n- [ ] Thread-safe for read access (RwLock or immutable after init)\n- [ ] Default semantic style set\n- [ ] Style merging for composition\n- [ ] Clear error handling for missing styles\n\n## Integration Points\n- Widgets reference styles by name\n- Theme loading populates stylesheet\n- Buffer.set_style() accepts Style or StyleId\n\n## Location: ftui-style crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:18:40.688288609Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:11.824857915Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2yd","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T22:22:11.824828780Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2yu","title":"Implement run grouping and style-run coalescing in Presenter","description":"# Implement Run Grouping and Style-Run Coalescing in Presenter\n\n## Background\nADR-002 and Plan Section 8.1 specify that the Presenter must emit \"grouped runs\" rather than per-cell cursor moves. This is critical for minimal ANSI output and flicker reduction.\n\n## Why This Matters\nWithout run grouping:\n- Each changed cell requires a cursor move: `\\x1b[y;xH`\n- Each cell change might reset style: `\\x1b[0m...`\n- Output is O(changes  escape_overhead)\n- Slow terminals show visible tearing\n\nWith run grouping:\n- Consecutive changed cells emit one cursor move\n- Style only changes when cell style differs\n- Output is O(runs  escape_overhead)\n- Smooth, fast rendering\n\n## Technical Design\n\n### ChangeRun Structure\n```rust\n/// A contiguous run of changed cells on a single row\npub struct ChangeRun {\n    pub y: u16,   // Row\n    pub x0: u16,  // Start column (inclusive)\n    pub x1: u16,  // End column (inclusive)\n}\n```\n\n### Run Grouping Algorithm\n```rust\nimpl BufferDiff {\n    /// Convert point changes into row-major runs\n    pub fn runs(&self, width: u16) -> Vec<ChangeRun> {\n        if self.changes.is_empty() {\n            return Vec::new();\n        }\n        \n        // Sort by (y, x) for row-major order\n        let mut sorted: Vec<_> = self.changes.iter().copied().collect();\n        sorted.sort_by_key(|(x, y)| (*y, *x));\n        \n        let mut runs = Vec::new();\n        let mut i = 0;\n        \n        while i < sorted.len() {\n            let (x0, y) = sorted[i];\n            let mut x1 = x0;\n            i += 1;\n            \n            // Coalesce consecutive x positions on same row\n            while i < sorted.len() {\n                let (x, yy) = sorted[i];\n                if yy != y || x != x1 + 1 {\n                    break;\n                }\n                x1 = x;\n                i += 1;\n            }\n            \n            runs.push(ChangeRun { y, x0, x1 });\n        }\n        \n        runs\n    }\n}\n```\n\n### Style-Run Coalescing\nWithin a run, group cells by style to minimize SGR changes:\n\n```rust\nimpl Presenter {\n    fn emit_run(\n        &mut self,\n        run: &ChangeRun,\n        buffer: &Buffer,\n        pool: &GraphemePool,\n        links: &LinkRegistry,\n    ) -> io::Result<()> {\n        // Single cursor move for entire run\n        self.move_cursor_to(run.x0, run.y)?;\n        \n        // Emit cells, tracking style changes\n        for x in run.x0..=run.x1 {\n            let cell = buffer.get_unchecked(x, run.y);\n            if cell.is_continuation() {\n                continue;  // Skip wide char continuations\n            }\n            \n            // Only emit style change if different from current\n            self.emit_style_if_changed(cell)?;\n            self.emit_link_if_changed(cell, links)?;\n            self.emit_content(cell, pool)?;\n            \n            // Cursor advances naturally after character output\n            self.cursor_x += cell.width() as u16;\n        }\n        \n        Ok(())\n    }\n    \n    fn emit_style_if_changed(&mut self, cell: &Cell) -> io::Result<()> {\n        let new_style = CellStyle {\n            fg: cell.fg,\n            bg: cell.bg,\n            attrs: cell.attrs.flags(),\n        };\n        \n        if Some(new_style) == self.current_style {\n            return Ok(());  // No change needed\n        }\n        \n        // Emit minimal SGR change\n        // v1: reset+apply (simple, correct)\n        // future: incremental (fewer bytes)\n        self.writer.write_all(b\"\\x1b[0\")?;\n        // ... emit style codes ...\n        self.writer.write_all(b\"m\")?;\n        self.current_style = Some(new_style);\n        \n        Ok(())\n    }\n}\n```\n\n### Optimization Opportunities\n1. **Skip cursor move when at expected position** - After emitting a run, cursor may be at next change\n2. **Batch style attributes** - Emit `\\x1b[0;1;38;2;r;g;bm` not separate sequences\n3. **Link run grouping** - Keep link open across cells with same link_id\n4. **Empty cell optimization** - Runs of spaces can use `\\x1b[nX` (erase characters)\n\n## Performance Targets\n- Cursor moves reduced by 50-90% vs naive\n- Style changes reduced by 30-70%\n- Bytes per frame for \"small changes\" is O(changes), not O(screen)\n\n## Tests Required\n- [ ] Empty diff produces no runs\n- [ ] Single cell change produces one run\n- [ ] Consecutive cells on row produce one run\n- [ ] Non-consecutive cells produce multiple runs\n- [ ] Cross-row changes produce separate runs\n- [ ] Style tracking minimizes SGR output\n- [ ] Link tracking minimizes OSC 8 output\n- [ ] Benchmark: bytes emitted vs naive approach\n\n## Acceptance Criteria\n- [ ] BufferDiff::runs() implemented\n- [ ] Presenter uses runs for emission\n- [ ] Style-run coalescing active\n- [ ] Link-run coalescing active\n- [ ] Benchmark shows byte reduction\n- [ ] PTY tests verify correct output\n\n## Location: ftui-render crate (diff.rs, presenter.rs)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:52:42.940861576Z","created_by":"ubuntu","updated_at":"2026-01-31T22:54:03.212147662Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2yu","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T22:54:03.212116303Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2yu","depends_on_id":"bd-10i.4.1","type":"blocks","created_at":"2026-01-31T22:54:02.859312055Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2yu","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T22:54:02.508150100Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2zd","title":"Implement scroll-region optimization for inline mode","description":"PHASE 2.5 - SCROLL REGION OPTIMIZATION\n\n## Background\nScroll regions (DECSTBM) can optimize inline mode by pinning the UI region and letting logs scroll naturally. This is an OPTIMIZATION, not the baseline.\n\n## Technical Requirements\n\n### DECSTBM Usage\n- Set scroll region to exclude UI: ESC[1;{log_bottom}r\n- Logs scroll within region, UI stays pinned\n- Must restore scroll region on exit\n\n### Capability Gating\nOnly use when:\n- caps.scroll_region == true\n- NOT in tmux/screen/zellij (mux passthrough issues)\n- Terminal known to support correctly\n\n### Implementation\n\npub struct ScrollRegionPresenter {\n    ui_height: u16,\n    scroll_region_active: bool,\n}\n\nimpl ScrollRegionPresenter {\n    pub fn setup_scroll_region(&mut self, writer: &mut TerminalWriter) {\n        if !self.can_use_scroll_region() {\n            return;  // Fall back to overlay\n        }\n        \n        let (_, height) = writer.size();\n        let log_bottom = height - self.ui_height;\n        \n        // Set scroll region (excludes UI at bottom)\n        write!(writer, \"\\x1b[1;{}r\", log_bottom)?;\n        self.scroll_region_active = true;\n    }\n    \n    pub fn restore_scroll_region(&mut self, writer: &mut TerminalWriter) {\n        if self.scroll_region_active {\n            writer.write_all(b\"\\x1b[r\")?;  // Reset to full screen\n            self.scroll_region_active = false;\n        }\n    }\n    \n    fn can_use_scroll_region(&self) -> bool {\n        let caps = TerminalCapabilities::detect();\n        caps.scroll_region && \n        !caps.in_tmux &&\n        !caps.in_screen &&\n        !caps.in_zellij\n    }\n}\n\n### Mux Detection\n- TMUX env var presence\n- TERM containing \"screen\"\n- ZELLIJ env var presence\n\n### Resize Handling\nOn terminal resize:\n1. Disable scroll region\n2. Recalculate dimensions\n3. Re-enable if still appropriate\n\n## Tests Required\n- [ ] Scroll region setup/teardown\n- [ ] Logs scroll within region\n- [ ] UI stays pinned at bottom\n- [ ] Mux detection works\n- [ ] Resize re-anchoring\n- [ ] PTY test: scroll region behavior\n\n## Acceptance Criteria\n- [ ] DECSTBM used correctly\n- [ ] Capability gating works\n- [ ] Mux passthrough disabled\n- [ ] Fallback to overlay works\n- [ ] Clean restore on exit\n\n## Location: ftui-render crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:30:39.520720244Z","created_by":"ubuntu","updated_at":"2026-01-31T22:32:18.606601626Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2zd","depends_on_id":"bd-fbp","type":"blocks","created_at":"2026-01-31T22:32:18.606568613Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-30h","title":"Implement Sparkline and Chart widgets","description":"PHASE 7 - EXTRAS: DATA VISUALIZATION\n\n## Background\nSparkline and Chart widgets provide data visualization for metrics, trends, and timeseries. Common requirement for monitoring dashboards and CLI tools.\n\n## Technical Requirements\n\n### Sparkline Widget\n- Compact single-line visualization\n- Data as Vec<f64> or iterator\n- Auto-scaling to min/max range\n- Configurable bar character set ()\n- Color gradient based on value\n- Reference line support (mean, threshold)\n\n### Chart Widget (BarChart, LineChart)\n- BarChart:\n  - Horizontal/vertical orientation\n  - Grouped and stacked modes\n  - Labels and value display\n  - Color per series\n- LineChart:\n  - Multiple series support\n  - Point markers optional\n  - Area fill under line\n  - Axis labels and ticks\n  - Legend positioning\n\n## Design Rationale\nFeature-gated for projects that need visualization. Sparkline is minimal overhead. Full charts use Canvas internally for rendering.\n\n## Acceptance Criteria\n- [ ] Sparkline with auto-scaling\n- [ ] Sparkline color gradient\n- [ ] BarChart with orientations\n- [ ] BarChart grouped/stacked\n- [ ] LineChart multi-series\n- [ ] LineChart axis rendering\n- [ ] Feature gate: charts\n\n## Location: ftui-extras crate (feature = \"charts\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:19:54.798796411Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:35.360701005Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-30h","depends_on_id":"bd-3k4","type":"blocks","created_at":"2026-01-31T22:22:35.360672091Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-35p","title":"Implement Progress and Spinner widgets","description":"PHASE 5 - PROGRESS + SPINNER WIDGETS\n\n## Background\nProgress indicators and spinners are essential for agent harness UIs showing tool execution status.\n\n## Technical Requirements\n\n### Spinner Widget\n\npub struct Spinner {\n    frames: &'static [&'static str],\n    style: Style,\n    label: Option<Text>,\n}\n\n// Preset spinner styles\npub mod spinners {\n    pub const DOTS: &[&str] = &[\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"];\n    pub const LINE: &[&str] = &[\"|\", \"/\", \"-\", \"\\\\\"];\n    pub const BRAILLE: &[&str] = &[\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"];\n    pub const MOON: &[&str] = &[\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"];\n}\n\nimpl StatefulWidget for Spinner {\n    type State = SpinnerState;  // Contains current frame index\n    fn render(&self, area: Rect, buf: &mut Buffer, state: &mut Self::State);\n}\n\nimpl SpinnerState {\n    pub fn tick(&mut self) {\n        self.frame = (self.frame + 1) % self.total_frames;\n    }\n}\n\n### Progress Bar Widget\n\npub struct ProgressBar {\n    ratio: f64,  // 0.0 to 1.0\n    style: ProgressStyle,\n    label: Option<Text>,\n}\n\npub struct ProgressStyle {\n    bar_style: Style,\n    fill_style: Style,\n    empty_style: Style,\n    chars: ProgressChars,  // [filled, partial, empty]\n}\n\n// Preset progress styles\npub mod progress_styles {\n    pub const BLOCK: ProgressChars = ['', '', ''];\n    pub const LINE: ProgressChars = ['=', '>', ' '];\n    pub const DOTS: ProgressChars = ['', '', ''];\n}\n\nimpl Widget for ProgressBar {\n    fn render(&self, area: Rect, buf: &mut Buffer);\n}\n\n### Progress with ETA\n\npub struct ProgressWithEta {\n    current: u64,\n    total: u64,\n    started_at: Instant,\n}\n\nimpl ProgressWithEta {\n    pub fn ratio(&self) -> f64;\n    pub fn eta(&self) -> Duration;\n    pub fn elapsed(&self) -> Duration;\n    pub fn items_per_second(&self) -> f64;\n}\n\n## Tests Required\n- [ ] Spinner frame cycling\n- [ ] Spinner with label\n- [ ] Progress bar ratio rendering\n- [ ] Progress bar edge cases (0%, 100%, overflow)\n- [ ] Partial fill character selection\n- [ ] ETA calculation accuracy\n- [ ] Wide character handling\n\n## Acceptance Criteria\n- [ ] Multiple spinner presets\n- [ ] Multiple progress bar presets\n- [ ] Customizable styles\n- [ ] Accurate ETA calculation\n- [ ] Works at any width\n- [ ] Unicode spinners work\n\n## Location: ftui-widgets crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:31:44.547803785Z","created_by":"ubuntu","updated_at":"2026-01-31T22:32:20.218541510Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-35p","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:32:20.218510171Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-376","title":"Implement interactive widgets (List, Scrollbar, Input)","description":"PHASE 5 - INTERACTIVE WIDGETS\n\n## Background\nInteractive widgets handle user input and state changes. List provides selectable items, Scrollbar visualizes scroll position, Input accepts text entry.\n\n## Technical Requirements\n\n### List Widget\n- Items with optional styling per item\n- Single/multi selection modes\n- Keyboard navigation (up/down/pageup/pagedown/home/end)\n- Highlight style for selected item\n- Scroll into view on selection change\n- Item filtering/search support\n\n### Scrollbar Widget\n- Vertical and horizontal orientation\n- Track, thumb, and arrow styles\n- Thumb size proportional to content ratio\n- Click/drag support (if mouse enabled)\n- Auto-hide when content fits\n\n### Input Widget\n- Single-line text input\n- Cursor positioning with blinking\n- Text selection (shift+arrow)\n- Clipboard operations (copy/paste)\n- Placeholder text when empty\n- Password mode (masked input)\n- Input validation hooks\n\n## Design Rationale\nThese widgets encapsulate common interaction patterns. State management follows Elm architecture - widgets emit events, parent handles state updates.\n\n## Acceptance Criteria\n- [ ] List with selection modes\n- [ ] List keyboard navigation\n- [ ] Scrollbar sizing algorithm\n- [ ] Scrollbar orientation support\n- [ ] Input cursor management\n- [ ] Input text selection\n- [ ] All widgets implement StatefulWidget trait\n- [ ] Event emission for state changes\n\n## StatefulWidget Trait\npub trait StatefulWidget {\n    type State;\n    fn render(&self, area: Rect, buf: &mut Buffer, state: &mut Self::State);\n}\n\n## Location: ftui-widgets crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:19:33.823793890Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:20.398953138Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-376","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:22:20.398922120Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-376","depends_on_id":"bd-wr2","type":"blocks","created_at":"2026-01-31T22:22:20.135191747Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-381","title":"Implement syntax highlighting for code blocks","description":"PHASE 7 - EXTRAS: SYNTAX HIGHLIGHTING\n\n## Background\nSyntax highlighting is essential for code-centric TUI applications. Feature-gated as optional extra.\n\n## Technical Requirements\n\n### Highlighting Engine\n- Use syntect or tree-sitter for parsing\n- Support common languages: Rust, Python, TypeScript, JSON, YAML, TOML, Markdown\n- Theme integration (VS Code themes, base16, etc.)\n- Line number gutter option\n- Diff highlighting (additions, deletions)\n\n### API Design\n\npub struct SyntaxHighlighter {\n    syntax_set: SyntaxSet,\n    theme_set: ThemeSet,\n    current_theme: String,\n}\n\nimpl SyntaxHighlighter {\n    pub fn new() -> Self;\n    \n    /// Highlight code string\n    pub fn highlight(&self, code: &str, lang: &str) -> Text;\n    \n    /// Highlight with line numbers\n    pub fn highlight_numbered(&self, code: &str, lang: &str, start_line: usize) -> Text;\n    \n    /// Set theme\n    pub fn set_theme(&mut self, name: &str);\n    \n    /// Get available themes\n    pub fn themes(&self) -> &[String];\n}\n\n### Performance Considerations\n- Lazy syntax loading\n- Incremental re-highlighting for edits\n- Cache parsed syntax per file extension\n- Background highlighting for large files\n\n## Tests Required\n- [ ] Rust code highlights correctly\n- [ ] Unknown language falls back gracefully\n- [ ] Theme switching works\n- [ ] Line numbers align correctly\n- [ ] Diff highlighting marks changes\n\n## Acceptance Criteria\n- [ ] 10+ languages supported\n- [ ] 3+ built-in themes\n- [ ] Integration with Paragraph widget\n- [ ] Performance: < 10ms for 1000 lines\n\n## Location: ftui-extras crate (feature = \"syntax\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:44:16.720155418Z","created_by":"ubuntu","updated_at":"2026-01-31T22:44:35.866304818Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-381","depends_on_id":"bd-22q","type":"blocks","created_at":"2026-01-31T22:44:35.866274611Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-381","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:44:33.713706561Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-397","title":"Create adversarial tests for escape injection","description":"TESTING - ADVERSARIAL SECURITY TESTS\n\n## Background\nFrankenTUI must be secure against untrusted content. Escape sequences in user-provided text could corrupt the terminal or execute malicious sequences. This implements ADR-006 (Sanitize-by-Default).\n\n## Threat Model\n\n### Attack Vectors\n1. **Log injection**: Untrusted output contains escape sequences\n2. **Title injection**: OSC sequences to change window title\n3. **Clipboard injection**: OSC 52 to set clipboard\n4. **Cursor corruption**: CSI sequences to move cursor\n5. **Mode hijacking**: Enabling raw mode, mouse, etc.\n\n### Example Malicious Inputs\n- \"\\x1b[2J\" - Clear screen\n- \"\\x1b[H\" - Home cursor\n- \"\\x1b]0;pwned\\x07\" - Set window title\n- \"\\x1b]52;c;SGVsbG8=\\x07\" - Set clipboard\n- \"\\x1b[?1049h\" - Enter alt screen\n- \"\\x1b[?1000h\" - Enable mouse\n- \"\\x1b[31mred\\x1b[0m\" - Color injection\n\n## Technical Requirements\n\n### Sanitizer Implementation\npub fn sanitize_for_display(input: &str) -> Cow<str> {\n    // Fast path: no control characters\n    if !input.bytes().any(|b| b < 0x20 || b == 0x7F || b == 0x1B) {\n        return Cow::Borrowed(input);\n    }\n    \n    // Slow path: filter control sequences\n    let mut output = String::with_capacity(input.len());\n    let mut chars = input.chars().peekable();\n    \n    while let Some(c) = chars.next() {\n        match c {\n            '\\x1b' => skip_escape_sequence(&mut chars),\n            c if c.is_control() && c != '\\n' && c != '\\t' => {\n                // Replace with visual representation\n                output.push_str(&format!(\"^{}\", (c as u8 + 64) as char));\n            }\n            _ => output.push(c),\n        }\n    }\n    \n    Cow::Owned(output)\n}\n\n### Test Categories\n\n#### 1. Escape Sequence Filtering\n- [ ] ESC [ ... (CSI) filtered\n- [ ] ESC ] ... (OSC) filtered\n- [ ] ESC P ... (DCS) filtered\n- [ ] ESC _ ... (APC) filtered\n- [ ] ESC ^ ... (PM) filtered\n\n#### 2. Control Character Handling\n- [ ] NUL (0x00) filtered\n- [ ] BEL (0x07) filtered\n- [ ] BS (0x08) filtered\n- [ ] Tab (0x09) preserved\n- [ ] LF (0x0A) preserved\n- [ ] CR (0x0D) handled\n- [ ] DEL (0x7F) filtered\n\n#### 3. Incomplete Sequence Handling\n- [ ] Truncated ESC at end\n- [ ] Truncated CSI at end\n- [ ] Truncated OSC at end\n- [ ] Invalid sequence bytes\n\n#### 4. Raw Passthrough (Explicit Opt-In)\n- [ ] raw_text() API exists\n- [ ] Loud documentation warning\n- [ ] Works for ANSI colors when intended\n\n## PTY Tests\n\n### Test Script\nfor payload in \"${MALICIOUS_PAYLOADS[@]}\"; do\n    # Run payload through ftui log viewer\n    echo \"$payload\" | ftui-test-harness\n    \n    # Verify terminal state unchanged\n    verify_terminal_state\n    \n    # Verify no escape sequences in output\n    verify_no_escapes\ndone\n\n## Acceptance Criteria\n- [ ] All ESC/CSI/OSC/DCS/APC filtered by default\n- [ ] Control characters filtered except tab/newline\n- [ ] Fast path for clean input (no allocation)\n- [ ] Raw passthrough API documented with warnings\n- [ ] PTY tests verify terminal state preserved\n- [ ] Fuzz testing for parser robustness\n\n## Location: ftui-text crate + tests/adversarial/","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:32:05.241501461Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:45.436902390Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-397","depends_on_id":"bd-10i.11.2","type":"blocks","created_at":"2026-01-31T22:32:20.756074625Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-397","depends_on_id":"bd-10i.8.4","type":"blocks","created_at":"2026-01-31T23:23:45.436858908Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-397","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:32:20.492615671Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3aqs","title":"Implement output bytes tracking and budget monitoring","description":"# Implement Output Bytes Tracking and Budget Monitoring\n\n## Background\nPlan Section 0.12.1 specifies that bytes emitted per frame should be tracked and regress-tested. For \"small change\" frames, bytes should be O(changes) not O(screen).\n\n## Why This Matters\n- Excessive output causes visible flicker\n- Slow terminals/connections need minimal bytes\n- Regression in bytes = regression in UX\n- Validates that diff engine is working\n\n## Requirements\n\n### Byte Tracking\n```rust\npub struct PresentStats {\n    /// Bytes written in this present() call\n    pub bytes_written: usize,\n    /// Cells changed (from diff)\n    pub cells_changed: usize,\n    /// Total cells in buffer\n    pub total_cells: usize,\n    /// Time spent in present()\n    pub duration: Duration,\n}\n\nimpl Presenter {\n    pub fn present_with_stats(...) -> io::Result<PresentStats> {\n        let start = Instant::now();\n        let bytes_before = self.writer.bytes_written();\n        \n        // ... do present ...\n        \n        let bytes_after = self.writer.bytes_written();\n        Ok(PresentStats {\n            bytes_written: bytes_after - bytes_before,\n            cells_changed: diff.len(),\n            total_cells: buffer.width() * buffer.height(),\n            duration: start.elapsed(),\n        })\n    }\n}\n```\n\n### Counting Writer Wrapper\n```rust\npub struct CountingWriter<W: Write> {\n    inner: W,\n    bytes_written: usize,\n}\n\nimpl<W: Write> CountingWriter<W> {\n    pub fn new(inner: W) -> Self {\n        Self { inner, bytes_written: 0 }\n    }\n    \n    pub fn bytes_written(&self) -> usize {\n        self.bytes_written\n    }\n    \n    pub fn reset_count(&mut self) {\n        self.bytes_written = 0;\n    }\n}\n\nimpl<W: Write> Write for CountingWriter<W> {\n    fn write(&mut self, buf: &[u8]) -> io::Result<usize> {\n        let n = self.inner.write(buf)?;\n        self.bytes_written += n;\n        Ok(n)\n    }\n    \n    fn flush(&mut self) -> io::Result<()> {\n        self.inner.flush()\n    }\n}\n```\n\n### Budget Assertions (for tests/CI)\n```rust\n/// Asserts bytes written is proportional to changes\npub fn assert_bytes_budget(stats: &PresentStats, budget_per_cell: usize) {\n    let expected_max = stats.cells_changed * budget_per_cell;\n    assert!(\n        stats.bytes_written <= expected_max,\n        \"Bytes budget exceeded: {} written for {} changes (max {})\",\n        stats.bytes_written, stats.cells_changed, expected_max\n    );\n}\n```\n\n### Baseline Tracking (for representative scenes)\nCreate baseline files for common scenarios:\n- `baselines/status_only_update.json` - Single status line change\n- `baselines/cursor_blink.json` - Cursor visibility toggle\n- `baselines/spinner_tick.json` - Spinner frame change\n- `baselines/log_line.json` - Single log line append\n\n```json\n{\n  \"scenario\": \"status_only_update\",\n  \"screen_size\": [80, 24],\n  \"cells_changed\": 80,\n  \"bytes_written_baseline\": 450,\n  \"bytes_written_max\": 1000,\n  \"notes\": \"Status line redraw should be ~5-10 bytes per cell\"\n}\n```\n\n### CI Integration\n```yaml\n# In CI workflow\n- name: Check bytes budget\n  run: cargo test --test bytes_budget -- --ignored\n```\n\n## Metrics to Track\n1. **Bytes per changed cell** - Should be bounded (~10-50 depending on style)\n2. **Overhead bytes** - Fixed cost per frame (sync output, cursor moves)\n3. **Full redraw vs diff ratio** - Diff should be much smaller\n4. **Historical trend** - Track over commits\n\n## Tests Required\n- [ ] CountingWriter tracks bytes correctly\n- [ ] present_with_stats returns accurate counts\n- [ ] Baseline scenarios match expected budgets\n- [ ] Regression test fails on 2x budget violation\n- [ ] Integration with benchmark suite (bd-19x)\n\n## Acceptance Criteria\n- [ ] CountingWriter implemented\n- [ ] PresentStats returned from present\n- [ ] Baseline files for 4+ scenarios\n- [ ] CI checks bytes budgets\n- [ ] Trend visible in benchmark reports\n\n## Location\n`ftui-render/src/stats.rs`\n`tests/bytes_budget.rs`\n`baselines/*.json`","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:22:04.623182152Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:12.536051834Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3aqs","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T23:22:12.536010396Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp","title":"Rich Renderables Collection (rich_rust port)","description":"Epic for porting all renderables from rich_rust. Renderables are high-level display components that implement the Renderable trait for producing styled terminal output. These come from the Python Rich library via the rich_rust Rust port.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/\n\nThe Renderable architecture from rich_rust:\n```rust\npub trait Renderable {\n    fn render(&self, console: &Console, options: &RenderOptions) -> Lines;\n    fn measure(&self, console: &Console, max_width: usize) -> Measurement;\n}\n\npub struct Measurement {\n    pub minimum: usize,  // Minimum width needed\n    pub maximum: usize,  // Preferred width\n}\n\npub struct Lines {\n    pub lines: Vec<Segments>,  // Each line is a sequence of styled segments\n}\n```\n\nKey design principles:\n1. Measurement before rendering (constraint-based layout)\n2. Segments are Cow<str> for zero-copy where possible\n3. Style inheritance through console context\n4. Composable (renderables can contain other renderables)\n5. Width-aware wrapping and truncation\n\nThis epic covers: Align, Columns, Emoji, Group, JSON, Layout, Padding, Panel, Pretty, Rule, Traceback, Tree. Progress and Table are covered by other beads.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-31T22:58:58.234325316Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.956736046Z","closed_at":"2026-01-31T23:22:03.956717311Z","close_reason":"Closing rich_rust renderables port epic: out of scope for FrankenTUI plan v1; keep widget scope aligned to PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp","depends_on_id":"bd-1ho","type":"blocks","created_at":"2026-01-31T23:04:25.777460862Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.1","title":"Implement Align renderable (text alignment container)","description":"Port the Align renderable from rich_rust. Align provides horizontal and vertical text alignment within a specified width.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/align.rs\n\nKey features to implement:\n1. Horizontal alignment: left, center, right, justify\n2. Vertical alignment: top, middle, bottom (for multi-line content)\n3. Fill character customization (default: space)\n4. Width constraint handling\n5. Preserve content style while adding alignment padding\n\nAPI Design (from rich_rust):\n```rust\npub enum HorizontalAlign {\n    Left,\n    Center,\n    Right,\n    Justify,  // Distributes extra space between words\n}\n\npub enum VerticalAlign {\n    Top,\n    Middle,\n    Bottom,\n}\n\npub struct Align<R: Renderable> {\n    renderable: R,\n    horizontal: HorizontalAlign,\n    vertical: VerticalAlign,\n    width: Option<usize>,\n    height: Option<usize>,\n    fill_char: char,\n    style: Option<Style>,\n}\n```\n\nImplementation notes:\n- Justify alignment needs word boundary detection\n- Center alignment handles odd widths correctly\n- Vertical alignment requires knowing content height first\n- Fill character should respect style inheritance\n\nDependencies: Measurement protocol, Style system, runeutil","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:08.463381546Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.281651524Z","closed_at":"2026-01-31T23:22:03.281633420Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.1","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:03:54.710013480Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.1","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:03:54.004147312Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.1","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:08.463381546Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.1","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:03:55.241850657Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.10","title":"Implement Rule renderable (horizontal line)","description":"Port the Rule renderable from rich_rust. Rule draws a horizontal line across the terminal with optional centered title.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/rule.rs\n\nKey features to implement:\n1. Full-width horizontal line\n2. Centered title within the line\n3. Left/right aligned titles\n4. Custom line character (default: )\n5. Custom end characters (optional corners)\n6. Title style and line style independence\n7. Minimum title padding\n\nAPI Design (from rich_rust):\n```rust\npub struct Rule {\n    title: Option<Text>,\n    characters: String,    // Line character(s)\n    style: Style,\n    title_align: HorizontalAlign,\n    end: Option<String>,   // Optional end characters\n}\n\nimpl Rule {\n    pub fn new() -> Self;\n    pub fn with_title(title: impl Into<Text>) -> Self;\n    pub fn styled(mut self, style: Style) -> Self;\n    pub fn ascii(mut self) -> Self;  // Use - instead of \n}\n```\n\nImplementation notes:\n- Simple but common pattern for visual separation\n- Title is surrounded by spaces and line characters\n- Width should fill available space\n\nDependencies: Style system, Text type, Measurement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:00:13.951008425Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.353777511Z","closed_at":"2026-01-31T23:22:03.353740001Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.10","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:04.561487154Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.10","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:04:05.054923940Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.10","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T23:00:13.951008425Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.11","title":"Implement Traceback renderable (error display)","description":"Port the Traceback renderable from rich_rust. Traceback provides formatted display of error backtraces with syntax highlighting.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/traceback.rs\n\nKey features to implement:\n1. Stack frame display with file:line:column\n2. Syntax-highlighted code context (lines around error)\n3. Error message styling\n4. Cause chain display (nested errors)\n5. Frame filtering (hide standard library frames)\n6. Locals variable display (if available)\n7. Clickable file paths (OSC 8 hyperlinks)\n\nAPI Design (from rich_rust):\n```rust\npub struct Traceback {\n    frames: Vec<Frame>,\n    message: String,\n    cause: Option<Box<Traceback>>,\n    show_locals: bool,\n    suppress: Vec<PathBuf>,  // Paths to hide\n    code_context: usize,     // Lines before/after\n    style: TracebackStyle,\n}\n\npub struct Frame {\n    file: PathBuf,\n    line: usize,\n    column: Option<usize>,\n    function: String,\n    source: Option<String>,\n    locals: Vec<(String, String)>,\n}\n\npub struct TracebackStyle {\n    frame: Style,\n    file: Style,\n    function: Style,\n    line_number: Style,\n    error: Style,\n    cause: Style,\n}\n```\n\nImplementation notes:\n- Parse from std::backtrace::Backtrace or anyhow\n- Source context requires reading files (may fail)\n- Consider integration with color-eyre ecosystem\n\nDependencies: Syntax highlighting (bd-381), Panel, OSC 8 links","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T23:00:21.292787140Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.358873417Z","closed_at":"2026-01-31T23:22:03.358850594Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.11","depends_on_id":"bd-10i.4.2","type":"blocks","created_at":"2026-01-31T23:04:06.637786543Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.11","depends_on_id":"bd-381","type":"blocks","created_at":"2026-01-31T23:04:05.598465203Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.11","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T23:00:21.292787140Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.11","depends_on_id":"bd-3bp.8","type":"blocks","created_at":"2026-01-31T23:04:06.098869052Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.12","title":"Implement Tree renderable (hierarchical display)","description":"Port the Tree renderable from rich_rust. Tree displays hierarchical data with indentation guides (ASCII art tree lines).\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/tree.rs\n\nKey features to implement:\n1. Tree line characters (  , etc.)\n2. Collapsible nodes (optional interactivity)\n3. Node icons (folder, file, custom)\n4. Label styling per node\n5. Configurable indentation width\n6. ASCII-only mode for compatibility\n7. Hide root option\n8. Sort children option\n9. Maximum depth limiting\n\nAPI Design (from rich_rust):\n```rust\npub struct Tree {\n    label: Text,\n    children: Vec<Tree>,\n    expanded: bool,\n    guide_style: Style,\n    highlight: bool,\n    hide_root: bool,\n}\n\nimpl Tree {\n    pub fn new(label: impl Into<Text>) -> Self;\n    pub fn add(&mut self, child: Tree) -> &mut Tree;\n    pub fn add_leaf(&mut self, label: impl Into<Text>) -> &mut Self;\n}\n\n// Tree guide characters\npub struct TreeGuide {\n    vertical: &'static str,      // \n    horizontal: &'static str,    // \n    branch: &'static str,        // \n    last_branch: &'static str,   // \n    space: &'static str,         // (space)\n}\n```\n\nImplementation notes:\n- Guide characters depend on whether node is last child\n- Need to track depth and is_last state during render\n- Collapsibility requires state management\n\nDependencies: Style system, Text type","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T23:00:30.776900763Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.364202581Z","closed_at":"2026-01-31T23:22:03.364175640Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.12","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:07.159810350Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.12","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:04:07.666256190Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.12","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T23:00:30.776900763Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.13","title":"Rich Renderables Test Suite","description":"Comprehensive test suite for all rich_rust renderables. Ensures correct rendering, measurement, and styling across all components.\n\n## Testing Philosophy\nRenderables require three types of verification:\n1. **Measurement correctness** - min/max width calculations\n2. **Rendering correctness** - Output matches expected segments\n3. **Style propagation** - Styles cascade properly through nesting\n\n## Test Requirements by Renderable\n\n### Align (bd-3bp.1)\nUnit tests:\n- `test_align_left_no_change` - Left alignment is identity\n- `test_align_center_even_width` - Symmetric padding for even widths\n- `test_align_center_odd_width` - Extra space goes right\n- `test_align_right_full_pad` - All padding on left\n- `test_align_justify_word_spacing` - Even word spacing\n- `test_align_vertical_middle` - Correct top/bottom padding\n- `test_align_custom_fill_char` - Non-space fill characters\n\nSnapshot tests:\n- `snapshot_align_all_modes` - Visual grid of all alignment modes\n\n### Columns (bd-3bp.2)\nUnit tests:\n- `test_columns_equal_width` - Each column gets 1/N of space\n- `test_columns_ratio_distribution` - Proportional width allocation\n- `test_columns_fixed_width` - Fixed columns don't flex\n- `test_columns_auto_width` - Auto columns shrink to content\n- `test_columns_gutter_applied` - Correct spacing between columns\n- `test_columns_overflow_truncate` - Content truncated when too wide\n- `test_columns_height_alignment` - Shorter columns padded to match tallest\n\nProperty tests:\n- `prop_total_width_matches` - Sum of column widths + gutters = total\n- `prop_no_overlap` - Column content areas don't overlap\n\n### Emoji (bd-3bp.3)\nUnit tests:\n- `test_emoji_lookup_valid` - Known emoji names resolve\n- `test_emoji_lookup_invalid` - Unknown names return None\n- `test_emoji_width_standard` - Most emoji are 2 cells\n- `test_emoji_width_variation` - Variation selectors handled\n- `test_emoji_zwj_family` - Family emoji width correct\n- `test_emoji_skin_tone` - Skin tone modifiers work\n- `test_emoji_shortcode_replace` - :thumbsup: -> \n\nCorpus tests:\n- `corpus_all_emoji` - Test all emoji in database\n\n### Group (bd-3bp.4)\nUnit tests:\n- `test_group_single_item` - Single item renders unchanged\n- `test_group_multiple_items` - Items stacked vertically\n- `test_group_with_separator` - Separator between each pair\n- `test_group_measurement_max` - Width is max of all children\n- `test_group_measurement_sum` - Height is sum of all children\n- `test_group_nested` - Groups can contain groups\n\n### JSON (bd-3bp.5)\nUnit tests:\n- `test_json_primitive_string` - String with quotes and escapes\n- `test_json_primitive_number` - Integer and float formatting\n- `test_json_primitive_bool` - true/false styling\n- `test_json_primitive_null` - null styling\n- `test_json_object_empty` - {} formatting\n- `test_json_object_single_key` - No trailing comma\n- `test_json_object_multiple_keys` - Commas between entries\n- `test_json_array_inline` - Small arrays on one line\n- `test_json_array_multiline` - Large arrays split across lines\n- `test_json_nested_deep` - Correct indentation at depth\n- `test_json_invalid_fallback` - Invalid JSON shows error\n\nSnapshot tests:\n- `snapshot_json_complex_document` - Full document rendering\n\n### Layout (bd-3bp.6)\nUnit tests:\n- `test_layout_single_cell` - One item fills grid\n- `test_layout_multiple_rows` - Items wrap to next row\n- `test_layout_column_span` - Item spans multiple columns\n- `test_layout_row_span` - Item spans multiple rows\n- `test_layout_gap_applied` - Row and column gaps\n- `test_layout_auto_sizing` - Auto columns fit content\n- `test_layout_fr_distribution` - Fr units divide remaining space\n\nProperty tests:\n- `prop_no_cell_overlap` - Grid cells don't overlap\n- `prop_bounds_respected` - All content within grid bounds\n\n### Padding (bd-3bp.7)\nUnit tests:\n- `test_padding_all` - Equal padding on all sides\n- `test_padding_horizontal` - Left/right only\n- `test_padding_vertical` - Top/bottom only\n- `test_padding_individual` - Each side different\n- `test_padding_measurement` - Min/max adjusted by padding\n- `test_padding_style_applied` - Padding area styled\n\n### Panel (bd-3bp.8)\nUnit tests:\n- `test_panel_rounded_border` - Rounded corners render\n- `test_panel_square_border` - Square corners render\n- `test_panel_double_border` - Double-line border\n- `test_panel_ascii_fallback` - ASCII-only border chars\n- `test_panel_title_left` - Title at top-left\n- `test_panel_title_center` - Title centered in top border\n- `test_panel_title_truncation` - Long title truncated with ellipsis\n- `test_panel_subtitle` - Subtitle on bottom border\n- `test_panel_content_padding` - Content inset from border\n\nSnapshot tests:\n- `snapshot_panel_all_styles` - Grid of all border styles\n\n### Pretty (bd-3bp.9)\nUnit tests:\n- `test_pretty_primitive_types` - i32, f64, bool, char\n- `test_pretty_string_quoted` - Strings show quotes\n- `test_pretty_vec_inline` - Small vecs on one line\n- `test_pretty_vec_multiline` - Large vecs split\n- `test_pretty_struct` - Named fields with values\n- `test_pretty_enum_unit` - Variant name only\n- `test_pretty_enum_tuple` - Variant with tuple args\n- `test_pretty_depth_limit` - Stops at max depth with ...\n- `test_pretty_string_limit` - Long strings truncated\n\n### Rule (bd-3bp.10)\nUnit tests:\n- `test_rule_full_width` - Fills available width\n- `test_rule_with_title` - Title centered in line\n- `test_rule_title_left` - Title at left edge\n- `test_rule_custom_char` - Non-default line character\n- `test_rule_ascii_fallback` - Uses - instead of \n\n### Traceback (bd-3bp.11)\nUnit tests:\n- `test_traceback_single_frame` - One stack frame\n- `test_traceback_multiple_frames` - Stack of frames\n- `test_traceback_with_source` - Source code context\n- `test_traceback_without_source` - Graceful degradation\n- `test_traceback_chained_cause` - Caused by: chain\n- `test_traceback_frame_filter` - Hide stdlib frames\n- `test_traceback_hyperlinks` - File paths are clickable\n\n### Tree (bd-3bp.12)\nUnit tests:\n- `test_tree_single_node` - Root only\n- `test_tree_single_child` - Root with one child\n- `test_tree_multiple_children` - Root with siblings\n- `test_tree_deep_nesting` - Multi-level hierarchy\n- `test_tree_guide_last_child` -  for last child\n- `test_tree_guide_middle_child` -  for middle children\n- `test_tree_collapsed_node` - Collapsed indicator\n- `test_tree_ascii_fallback` - Uses +-- instead of \n\nSnapshot tests:\n- `snapshot_tree_filesystem` - Typical directory structure\n\n## Measurement Protocol Tests\nFor all renderables:\n- `test_measure_returns_valid` - min <= max\n- `test_measure_respects_constraint` - max <= max_width param\n- `test_render_fits_measurement` - Rendered output <= measured width\n\n## Logging Requirements\n- `tracing::debug!` for measurement decisions\n- `tracing::debug!` for style resolution\n- `tracing::trace!` for segment construction\n- Measurement cache hit/miss logged at trace level\n\nDependencies: All renderables, Testing infrastructure (bd-10i.11)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:16:05.699642278Z","created_by":"ubuntu","updated_at":"2026-01-31T23:24:07.091659713Z","closed_at":"2026-01-31T23:24:07.091629176Z","close_reason":"Closing rich renderables test suite: rich_rust renderables port work is out of scope for FrankenTUI plan v1; ftui tests are tracked under bd-10i.11 + harness/widget snapshot tests.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.13","depends_on_id":"bd-10i.11","type":"blocks","created_at":"2026-01-31T23:18:02.243281204Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T23:16:05.699642278Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.1","type":"blocks","created_at":"2026-01-31T23:18:25.067172386Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.10","type":"blocks","created_at":"2026-01-31T23:18:30.426875072Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.11","type":"blocks","created_at":"2026-01-31T23:18:30.987026894Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.12","type":"blocks","created_at":"2026-01-31T23:18:31.567714063Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.2","type":"blocks","created_at":"2026-01-31T23:18:25.783648515Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.3","type":"blocks","created_at":"2026-01-31T23:18:26.368454149Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.4","type":"blocks","created_at":"2026-01-31T23:18:26.950713408Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.5","type":"blocks","created_at":"2026-01-31T23:18:27.542909999Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.6","type":"blocks","created_at":"2026-01-31T23:18:28.151181827Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.7","type":"blocks","created_at":"2026-01-31T23:18:28.747205834Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.8","type":"blocks","created_at":"2026-01-31T23:18:29.277542898Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.13","depends_on_id":"bd-3bp.9","type":"blocks","created_at":"2026-01-31T23:18:29.865454340Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.2","title":"Implement Columns renderable (column layout)","description":"Port the Columns renderable from rich_rust. Columns arranges multiple renderables side by side with configurable spacing and proportional widths.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/columns.rs\n\nKey features to implement:\n1. Multiple columns with equal or proportional widths\n2. Gutter spacing between columns\n3. Column padding (per-column)\n4. Column width modes: equal, ratio, fit-content, fixed\n5. Row alignment when columns have different heights\n6. Column expansion to fill available width\n7. Overflow handling (wrap vs truncate)\n\nAPI Design (from rich_rust):\n```rust\npub enum ColumnWidth {\n    Auto,              // Fit to content\n    Fixed(usize),      // Exact width\n    Ratio(f32),        // Proportion of remaining space\n    Range(usize, usize), // Min/max width\n}\n\npub struct Column<R: Renderable> {\n    renderable: R,\n    width: ColumnWidth,\n    style: Option<Style>,\n}\n\npub struct Columns {\n    columns: Vec<Column>,\n    gutter: usize,      // Space between columns\n    equal: bool,        // Force equal widths\n    expand: bool,       // Expand to fill width\n}\n```\n\nImplementation notes:\n- Constraint solving: measure all columns, allocate widths, render\n- Handle case where sum of min-widths exceeds available width\n- Vertical alignment within row respects column heights\n\nDependencies: Measurement protocol, Flex layout (bd-yzu)","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Equal width distribution across columns\n- [ ] Ratio-based width distribution\n- [ ] Fixed width columns\n- [ ] Auto-fit columns to content\n- [ ] Range-constrained columns (min/max)\n- [ ] Gutter spacing between columns\n- [ ] Per-column padding\n- [ ] Expand mode fills available width\n- [ ] Fit mode uses minimum necessary width\n\n### Layout Requirements\n- [ ] Column widths sum to available width (with gutters)\n- [ ] Content truncated when column too narrow\n- [ ] Vertical alignment within row\n- [ ] Shorter columns padded to match tallest\n- [ ] No content overlap between columns\n\n### Measurement Requirements\n- [ ] Minimum = sum of column minimums + gutters\n- [ ] Maximum = sum of column maximums + gutters\n- [ ] Constraint solving for ratio columns\n\n### Logging Requirements\n- [ ] tracing::debug! for width distribution decisions\n- [ ] tracing::trace! for column measurement\n- [ ] tracing::warn! for constraint violations\n\n### Test Coverage\n- [ ] Unit tests for each width mode\n- [ ] Property test: no column overlap\n- [ ] Property test: total width correct\n- [ ] Snapshot tests for visual verification\n- [ ] Edge case: zero-width column\n- [ ] Edge case: single column","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:14.940919021Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.312180958Z","closed_at":"2026-01-31T23:22:03.312149639Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.2","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:03:55.768351680Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.2","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:14.940919021Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.2","depends_on_id":"bd-yzu","type":"blocks","created_at":"2026-01-31T23:03:56.304298019Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.3","title":"Implement Emoji renderable (emoji display)","description":"Port the Emoji renderable from rich_rust. Emoji provides named emoji lookup and proper width-aware rendering.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/emoji.rs\nReference: legacy_reference_library_code/rich_rust/src/emoji.rs (emoji data)\n\nKey features to implement:\n1. Named emoji lookup (:thumbsup: -> )\n2. Emoji shortcode database\n3. Proper display width calculation (most emoji are 2 cells wide)\n4. ZWJ sequence handling ( family emoji)\n5. Skin tone modifier support\n6. Fallback for unsupported terminals\n7. Emoji parsing in markup text\n\nAPI Design (from rich_rust):\n```rust\npub struct Emoji {\n    name: String,\n    character: &'static str,\n    width: usize,\n}\n\nimpl Emoji {\n    pub fn get(name: &str) -> Option<&'static Emoji>;\n    pub fn replace_codes(text: &str) -> Cow<str>;\n}\n\npub struct EmojiRenderable {\n    emoji: Emoji,\n    style: Option<Style>,\n}\n```\n\nImplementation notes:\n- Emoji database is static and generated at build time\n- Width calculation must handle variation selectors (U+FE0E, U+FE0F)\n- Some terminals render emoji as 1 cell, need detection/fallback\n\nDependencies: Unicode width (bd-v6y), GraphemePool (bd-10i.3.5)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:59:22.066848834Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.317389806Z","closed_at":"2026-01-31T23:22:03.317359770Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.3","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T23:14:42.077987167Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.3","depends_on_id":"bd-10i.3.5","type":"blocks","created_at":"2026-01-31T23:03:57.334151791Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.3","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:22.066848834Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.3","depends_on_id":"bd-v6y","type":"blocks","created_at":"2026-01-31T23:03:56.821229783Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.4","title":"Implement Group renderable (composite container)","description":"Port the Group renderable from rich_rust. Group composes multiple renderables vertically, stacking them in order.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/group.rs\n\nKey features to implement:\n1. Vertical stacking of renderables\n2. Optional separator between items\n3. Group-level style application (inherited by children)\n4. Fit mode (content width) vs expand mode (fill width)\n5. Measurement aggregation (max width, sum of heights)\n\nAPI Design (from rich_rust):\n```rust\npub struct Group {\n    renderables: Vec<Box<dyn Renderable>>,\n    fit: bool,           // Use minimum width vs expand\n    separator: Option<Box<dyn Renderable>>,\n    style: Option<Style>,\n}\n\nimpl Group {\n    pub fn new(renderables: Vec<Box<dyn Renderable>>) -> Self;\n    pub fn with_separator(self, sep: impl Renderable) -> Self;\n    pub fn fit(self) -> Self;\n}\n```\n\nImplementation notes:\n- This is the simplest layout container\n- Measurement returns max width of all children\n- Separator is rendered between each pair of children\n\nDependencies: Renderable trait, Measurement protocol","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:27.080696290Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.323263095Z","closed_at":"2026-01-31T23:22:03.323237978Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.4","depends_on_id":"bd-1ho.1","type":"blocks","created_at":"2026-01-31T23:03:58.384812401Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.4","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:03:57.877674128Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.4","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:27.080696290Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.5","title":"Implement JSON renderable (pretty JSON display)","description":"Port the JSON renderable from rich_rust. JSON provides syntax-highlighted, indented display of JSON data with collapsible sections.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/json.rs\n\nKey features to implement:\n1. Syntax highlighting (keys, strings, numbers, booleans, null)\n2. Configurable indentation (2 or 4 spaces, or tabs)\n3. Line length limiting with wrapping\n4. Trailing comma handling\n5. Collapsible objects/arrays (optional interactivity)\n6. Sorted keys option\n7. Invalid JSON fallback (display raw with error highlight)\n\nAPI Design (from rich_rust):\n```rust\npub struct Json {\n    data: Value,  // serde_json::Value\n    indent: usize,\n    sort_keys: bool,\n    style: JsonStyle,\n}\n\npub struct JsonStyle {\n    key: Style,\n    string: Style,\n    number: Style,\n    boolean: Style,\n    null: Style,\n    bracket: Style,\n    colon: Style,\n    comma: Style,\n}\n```\n\nImplementation notes:\n- Parse with serde_json, format with custom renderer\n- Long strings should be wrapped with continuation indicator\n- Numbers and booleans should not be split across lines\n\nDependencies: Style system, Text type, Pretty printer (bd-3bp.8)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:59:36.616288826Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.328958610Z","closed_at":"2026-01-31T23:22:03.328938291Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.5","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:03:58.909419880Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.5","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:03:59.433016217Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.5","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:36.616288826Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.6","title":"Implement Layout renderable (advanced grid layout)","description":"Port the Layout renderable from rich_rust. Layout provides a flexible grid-based layout system similar to CSS Grid.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/layout.rs\n\nKey features to implement:\n1. Row and column definitions with size modes\n2. Grid cell placement (row, column, rowspan, colspan)\n3. Nested layouts\n4. Gap/gutter between cells\n5. Alignment within cells\n6. Responsive column collapsing\n7. Minimum/maximum constraints\n\nAPI Design (from rich_rust):\n```rust\npub enum SizeMode {\n    Auto,           // Fit content\n    Fixed(usize),   // Exact size\n    Ratio(f32),     // Proportion\n    Fr(f32),        // Fractional unit (like CSS fr)\n}\n\npub struct LayoutColumn {\n    size: SizeMode,\n    min: Option<usize>,\n    max: Option<usize>,\n}\n\npub struct Layout {\n    columns: Vec<LayoutColumn>,\n    children: Vec<(Box<dyn Renderable>, GridArea)>,\n    row_gap: usize,\n    col_gap: usize,\n}\n\npub struct GridArea {\n    row: usize,\n    col: usize,\n    row_span: usize,\n    col_span: usize,\n}\n```\n\nImplementation notes:\n- This is more complex than Columns - full CSS Grid-like behavior\n- Need constraint solver for auto-sizing columns\n- Consider using a simpler flexbox model for v1\n\nDependencies: Measurement protocol, Columns (for simpler cases)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:42.211918374Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.333648340Z","closed_at":"2026-01-31T23:22:03.333629424Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.6","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:03:59.931165042Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.6","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:42.211918374Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.6","depends_on_id":"bd-3bp.2","type":"blocks","created_at":"2026-01-31T23:04:00.415155711Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.7","title":"Implement Padding renderable (spacing container)","description":"Port the Padding renderable from rich_rust. Padding adds whitespace around a renderable on all four sides.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/padding.rs\n\nKey features to implement:\n1. Individual padding for each side (top, right, bottom, left)\n2. CSS-style shorthand (all, vertical/horizontal, individual)\n3. Padding character customization (not just space)\n4. Style inheritance through padding area\n5. Padding respects available width constraints\n\nAPI Design (from rich_rust):\n```rust\npub struct Sides {\n    pub top: usize,\n    pub right: usize,\n    pub bottom: usize,\n    pub left: usize,\n}\n\nimpl Sides {\n    pub fn all(n: usize) -> Self;\n    pub fn horizontal(n: usize) -> Self;\n    pub fn vertical(n: usize) -> Self;\n    pub fn new(top: usize, right: usize, bottom: usize, left: usize) -> Self;\n}\n\npub struct Padding<R: Renderable> {\n    renderable: R,\n    padding: Sides,\n    style: Option<Style>,\n    expand: bool,  // Fill to available width\n}\n```\n\nImplementation notes:\n- Horizontal padding reduces available width for child\n- Vertical padding adds blank lines with style\n- Measurement accounts for padding in minimum/maximum\n\nDependencies: Measurement protocol, Sides primitive (bd-10i.3.7)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:48.822726004Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.338133495Z","closed_at":"2026-01-31T23:22:03.338118236Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.7","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T23:14:43.394230844Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.7","depends_on_id":"bd-10i.3.7","type":"blocks","created_at":"2026-01-31T23:04:00.959334944Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.7","depends_on_id":"bd-1ho.3","type":"blocks","created_at":"2026-01-31T23:04:01.499464026Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.7","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:48.822726004Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.8","title":"Implement Panel renderable (bordered box)","description":"Port the Panel renderable from rich_rust. Panel wraps content in a decorative border with optional title.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/panel.rs\n\nKey features to implement:\n1. Multiple border styles (rounded, square, double, heavy, ascii, none)\n2. Title placement (top-left, top-center, top-right, bottom variants)\n3. Subtitle support\n4. Title truncation when panel is narrow\n5. Padding between border and content\n6. Border style/color customization\n7. Safe characters option (ASCII-only for compatibility)\n8. Expand to fill width option\n\nAPI Design (from rich_rust):\n```rust\npub struct Panel<R: Renderable> {\n    renderable: R,\n    title: Option<Text>,\n    subtitle: Option<Text>,\n    title_align: HorizontalAlign,\n    border: BorderStyle,\n    border_style: Style,\n    padding: Sides,\n    width: Option<usize>,\n    expand: bool,\n}\n\npub enum BorderStyle {\n    None,\n    Ascii,\n    Rounded,\n    Square,\n    Double,\n    Heavy,\n    Custom(Border),\n}\n\npub struct Border {\n    top_left: char,\n    top_right: char,\n    bottom_left: char,\n    bottom_right: char,\n    horizontal: char,\n    vertical: char,\n}\n```\n\nImplementation notes:\n- Border characters are single-cell (no emoji borders)\n- Title is rendered inline with top border\n- Must handle unicode title truncation correctly\n\nDependencies: Border primitives, Padding, Measurement, Text type","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Support all border styles: Rounded, Square, Double, Heavy, Ascii, None\n- [ ] Title placement: top-left, top-center, top-right\n- [ ] Subtitle placement: bottom-left, bottom-center, bottom-right\n- [ ] Title truncation with ellipsis when panel too narrow\n- [ ] Content padding (inner spacing from border)\n- [ ] Border style/color customization\n- [ ] Expand mode fills available width\n- [ ] Fit mode uses minimum necessary width\n- [ ] ASCII fallback for non-Unicode terminals\n\n### Rendering Requirements\n- [ ] Border characters are single-cell (no emoji)\n- [ ] Title renders inline with top border\n- [ ] Content properly indented from border\n- [ ] Wide characters in title handled correctly\n- [ ] Minimum width = border (2) + title (if any)\n\n### Measurement Requirements\n- [ ] Minimum = content minimum + border + padding\n- [ ] Maximum = content maximum + border + padding\n- [ ] Respects max_width constraint\n\n### Logging Requirements\n- [ ] tracing::debug! for border style selection\n- [ ] tracing::trace! for title truncation decisions\n- [ ] tracing::warn! for content overflow\n\n### Test Coverage\n- [ ] Snapshot tests for all border styles\n- [ ] Unit tests for title placement variants\n- [ ] Property test: output width <= specified width\n- [ ] Integration test: nested panels","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:59:56.154048039Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.343136916Z","closed_at":"2026-01-31T23:22:03.343116417Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.8","depends_on_id":"bd-1ho.4","type":"blocks","created_at":"2026-01-31T23:04:01.991836820Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.8","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:04:03.012459619Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.8","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T22:59:56.154048039Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.8","depends_on_id":"bd-3bp.7","type":"blocks","created_at":"2026-01-31T23:04:02.497288949Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3bp.9","title":"Implement Pretty renderable (pretty printing)","description":"Port the Pretty renderable from rich_rust. Pretty provides automatic formatting of complex data structures with syntax highlighting.\n\nReference: legacy_reference_library_code/rich_rust/src/renderables/pretty.rs\n\nKey features to implement:\n1. Automatic type detection (maps, lists, structs, etc.)\n2. Configurable indentation and max width\n3. Inline vs block formatting based on content size\n4. Reference cycle detection and handling\n5. Maximum depth limiting\n6. Maximum string length truncation\n7. Collection size limiting (e.g., first 100 items)\n8. Custom formatters for specific types\n\nAPI Design (from rich_rust):\n```rust\npub struct Pretty {\n    object: Box<dyn std::fmt::Debug>,\n    indent: usize,\n    max_width: usize,\n    max_depth: usize,\n    max_string: usize,\n    max_sequence: usize,\n    style: PrettyStyle,\n}\n\npub struct PrettyStyle {\n    type_name: Style,\n    key: Style,\n    value: Style,\n    string: Style,\n    number: Style,\n    keyword: Style,\n    ellipsis: Style,\n}\n```\n\nImplementation notes:\n- Uses Debug trait for inspection, not serde\n- Inline format: { a: 1, b: 2 } vs block format with newlines\n- Smart decision based on total width vs available width\n\nDependencies: Style system, Text type, Measurement protocol","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T23:00:07.607762605Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:03.347784076Z","closed_at":"2026-01-31T23:22:03.347763017Z","close_reason":"Closing rich_rust renderables port: out of scope for FrankenTUI plan v1 (avoid widget zoo); ftui-widgets will implement only harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bp.9","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:03.523962015Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.9","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:04:04.019683541Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3bp.9","depends_on_id":"bd-3bp","type":"parent-child","created_at":"2026-01-31T23:00:07.607762605Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3cc","title":"Implement Frame struct (Buffer + metadata)","description":"# Implement Frame struct (Buffer + metadata)\n\n## Background\nFrame is the canonical render target that combines a Buffer with render-pass metadata. This is a kernel-level primitive that widgets render into.\n\n## Technical Design (from Plan Section 6.1)\n\n```rust\n/// Frame = Buffer + metadata for a render pass\npub struct Frame {\n    pub buffer: Buffer,\n    pub hit_grid: Option<HitGrid>,\n    pub cursor_position: Option<(u16, u16)>,\n    pub cursor_visible: bool,\n}\n```\n\n## Responsibilities\n- Owns the back buffer for the current render pass\n- Tracks cursor position for widgets that need cursor placement (Input, etc.)\n- Optionally tracks hit regions for mouse interactivity\n- Passed to Model::view() in the runtime\n\n## API Design\n```rust\nimpl Frame {\n    pub fn new(width: u16, height: u16) -> Self;\n    pub fn buffer(&self) -> &Buffer;\n    pub fn buffer_mut(&mut self) -> &mut Buffer;\n    pub fn size(&self) -> (u16, u16);\n    pub fn set_cursor(&mut self, x: u16, y: u16);\n    pub fn hide_cursor(&mut self);\n    pub fn show_cursor(&mut self);\n    \n    // For widgets that need hit testing\n    pub fn register_hit_area(&mut self, rect: Rect, id: HitId);\n    pub fn hit_test(&self, x: u16, y: u16) -> Option<HitId>;\n}\n```\n\n## Why Frame is Separate from Buffer\n- Buffer is the grid of cells (data structure)\n- Frame adds render-pass context (cursor, hit testing)\n- This separation keeps Buffer pure and testable\n- Runtime manages Frame lifecycle; widgets just render into it\n\n## Tests Required\n- [ ] Frame creation with dimensions\n- [ ] Buffer access (mutable and immutable)\n- [ ] Cursor position tracking\n- [ ] Cursor visibility toggling\n- [ ] Hit area registration\n- [ ] Hit testing returns correct IDs\n- [ ] Size matches buffer dimensions\n\n## Acceptance Criteria\n- [ ] Frame struct defined with all fields\n- [ ] Public API for cursor management\n- [ ] Optional HitGrid integration\n- [ ] Unit tests pass\n- [ ] Documentation with examples\n\n## Location: ftui-render crate\n\n## Performance Notes\nFrame is created once per render pass and passed by mutable reference. No allocations during render.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:49:50.364819793Z","created_by":"ubuntu","updated_at":"2026-01-31T22:53:47.983955523Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3cc","depends_on_id":"bd-10i.3","type":"parent-child","created_at":"2026-01-31T22:53:47.983923493Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3cc","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:53:47.602013413Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3e8","title":"Implement structured logging with tracing","description":"INFRASTRUCTURE - LOGGING & TRACING\n\n## Background\nComprehensive logging is critical for debugging terminal rendering issues, performance analysis, and understanding execution flow. Must support both development debugging and production diagnostics.\n\n## Technical Requirements\n\n### Tracing Infrastructure\n- Use tracing crate for structured, async-aware logging\n- Log levels: ERROR, WARN, INFO, DEBUG, TRACE\n- Span-based instrumentation for render pipeline\n- Subscriber configuration for:\n  - Development: pretty-printed to stderr\n  - Testing: captured for assertions\n  - Production: JSON structured output (optional)\n\n### Key Instrumentation Points\n- Frame lifecycle: start  render  diff  present  complete\n- Widget rendering: widget type, area, render time\n- Buffer operations: resize, clear, set (at TRACE level)\n- Input parsing: raw bytes  parsed events\n- State changes: model updates, command execution\n- Error conditions: with full context\n\n### Log Format\nDevelopment:\n  2026-01-31T12:00:00.123Z INFO ftui::render frame_start frame=42 widgets=15\n  2026-01-31T12:00:00.125Z DEBUG ftui::diff changed_cells=120 skip_rows=10\n  \nTesting (structured capture):\n  LogEntry { level: INFO, target: \"ftui::render\", msg: \"frame_start\", ... }\n\n### Feature Gates\n- feature = \"tracing\" - enables all instrumentation\n- feature = \"tracing-json\" - JSON subscriber for production\n- Default: tracing disabled for minimal overhead\n\n## Design Rationale\nTerminal UIs are notoriously hard to debug. Structured tracing with spans enables understanding complex render pipelines. Feature-gated to avoid overhead in release builds.\n\n## Acceptance Criteria\n- [ ] tracing subscriber configuration\n- [ ] Frame-level span instrumentation\n- [ ] Widget render spans with timing\n- [ ] Input parsing tracing\n- [ ] Error context capture\n- [ ] Test log capture mechanism\n- [ ] Feature gate documentation\n- [ ] Example showing log output\n\n## Performance Budget\n- Disabled: zero overhead (compiled out)\n- Enabled: < 1s per span enter/exit\n\n## Location: ftui-core crate (feature = \"tracing\")","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:27:56.000241382Z","created_by":"ubuntu","updated_at":"2026-01-31T22:29:24.287545487Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3e8","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:29:24.287504810Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3hy","title":"Define per-module unit test coverage requirements","description":"TESTING - UNIT TEST COVERAGE MATRIX\n\n## Background\nEach module in FrankenTUI must have comprehensive unit tests. This bead defines the required test coverage for every crate and module.\n\n## Coverage Requirements by Crate\n\n### ftui-core ( 80% coverage)\n#### Cell Module\n- [ ] CellContent creation from char, grapheme\n- [ ] CellContent width calculation (ASCII, CJK, emoji)\n- [ ] PackedRgba from RGB, RGBA, named colors\n- [ ] PackedRgba Porter-Duff alpha blending\n- [ ] PackedRgba opacity scaling\n- [ ] CellAttrs bitfield operations\n- [ ] CellAttrs merge/override\n- [ ] Cell construction and defaults\n- [ ] Cell bits_eq correctness\n- [ ] Cell continuation sentinel\n- [ ] Cell builder methods\n\n#### Buffer Module\n- [ ] Buffer creation with dimensions\n- [ ] Buffer get/set bounds checking\n- [ ] Buffer scissor stack operations\n- [ ] Buffer opacity stack operations\n- [ ] Buffer clear operations\n- [ ] Wide character handling\n- [ ] Cell iteration\n- [ ] Resize behavior (if supported)\n\n### ftui-render ( 75% coverage)\n#### Diff Module\n- [ ] BufferDiff empty (no changes)\n- [ ] BufferDiff single cell change\n- [ ] BufferDiff row changes\n- [ ] BufferDiff skip unchanged rows\n- [ ] BufferDiff wide character changes\n- [ ] Diff iteration order\n\n#### Presenter Module\n- [ ] ANSI escape sequence generation\n- [ ] Cursor movement optimization\n- [ ] Color state tracking\n- [ ] Attribute state tracking\n- [ ] SGR sequence batching\n- [ ] Hyperlink OSC 8 handling\n\n### ftui-style ( 80% coverage)\n- [ ] Style creation and defaults\n- [ ] Style merge (cascading)\n- [ ] Style patch (override)\n- [ ] Style builder pattern\n- [ ] StyleSheet define/get\n- [ ] StyleSheet compose\n- [ ] Named style inheritance\n\n### ftui-text ( 80% coverage)\n- [ ] Text creation from string\n- [ ] Text span appending\n- [ ] Text width calculation\n- [ ] Text truncation with ellipsis\n- [ ] Text line splitting\n- [ ] GraphemePool interning\n- [ ] GraphemePool refcounting\n- [ ] Unicode edge cases (ZWJ, VS15/16)\n\n### ftui-layout ( 70% coverage)\n- [ ] Rect operations (intersection, contains)\n- [ ] Flex horizontal layout\n- [ ] Flex vertical layout\n- [ ] Flex constraint types (Fixed, Percent, Min, Max, Ratio)\n- [ ] Flex gap handling\n- [ ] Grid row/column solving\n- [ ] Grid cell spanning\n- [ ] Grid named areas\n\n### ftui-runtime ( 70% coverage)\n- [ ] TerminalWriter mode transitions\n- [ ] Program/Model lifecycle\n- [ ] Cmd execution\n- [ ] Event dispatch\n- [ ] Subscription handling\n\n### ftui-widgets ( 70% coverage)\n- [ ] Block border rendering\n- [ ] Block title positioning\n- [ ] Paragraph text wrapping\n- [ ] Paragraph alignment\n- [ ] Table column sizing\n- [ ] Table row selection\n- [ ] List item rendering\n- [ ] List selection state\n- [ ] Input cursor positioning\n- [ ] Input text selection\n\n## Test Quality Guidelines\n\n### Each Test Must\n1. Test ONE behavior (single assertion focus)\n2. Have descriptive name: test_<function>_<scenario>_<expected>\n3. Include edge cases (empty, max, boundary)\n4. Be deterministic (no random, no time)\n5. Be fast (< 10ms each)\n6. Be independent (no shared mutable state)\n\n### Property Testing Requirements\nUse proptest for:\n- Numeric overflow (widths, coordinates)\n- Unicode string handling\n- Color calculations\n- Layout constraint solving\n\n## Acceptance Criteria\n- [ ] Test module in each crate\n- [ ] Coverage thresholds met per crate\n- [ ] Property tests for numeric operations\n- [ ] Edge case coverage documented\n- [ ] Test naming conventions followed\n- [ ] No flaky tests\n\n## Location: Each crate's tests/ or src/**/tests.rs","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:29:14.532567931Z","created_by":"ubuntu","updated_at":"2026-01-31T22:29:26.163983601Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3hy","depends_on_id":"bd-10i.2.1","type":"blocks","created_at":"2026-01-31T22:29:26.163954296Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3i6","title":"Implement bracketed paste and mouse SGR protocol","description":"PHASE 3 - ADVANCED INPUT PROTOCOLS\n\n## Background\nBracketed paste mode prevents pasted content from being interpreted as commands. SGR mouse protocol provides precise mouse reporting with modifiers.\n\n## Technical Requirements\n\n### Bracketed Paste Mode\nEscape sequences:\n- Enable: ESC[?2004h\n- Disable: ESC[?2004l\n- Paste start: ESC[200~\n- Paste end: ESC[201~\n\npub struct BracketedPasteParser {\n    in_paste: bool,\n    paste_buffer: Vec<u8>,\n    max_paste_size: usize,  // Default: 1MB\n}\n\nimpl BracketedPasteParser {\n    pub fn parse(&mut self, byte: u8) -> Option<InputEvent> {\n        if self.in_paste {\n            // Accumulate until paste end sequence\n            // Enforce max_paste_size limit\n        } else {\n            // Check for paste start sequence\n        }\n    }\n}\n\npub enum InputEvent {\n    Key(KeyEvent),\n    Mouse(MouseEvent),\n    Paste(String),  // Complete paste content\n    Resize(u16, u16),\n    Focus(bool),\n}\n\n### SGR Mouse Protocol (1006)\nEscape sequence: ESC[<Cb;Cx;CyM or ESC[<Cb;Cx;Cym\n\nstruct SgrMouseParser;\n\nimpl SgrMouseParser {\n    /// Parse SGR extended mouse report\n    pub fn parse(&self, params: &[u8]) -> Option<MouseEvent> {\n        // Parse: <button;column;rowM or <button;column;rowm\n        // Button encoding:\n        //   0 = left, 1 = middle, 2 = right\n        //   +4 = shift, +8 = meta, +16 = ctrl\n        //   32 = motion, 64 = scroll\n        // M = press, m = release\n    }\n}\n\npub struct MouseEvent {\n    pub kind: MouseEventKind,\n    pub column: u16,\n    pub row: u16,\n    pub modifiers: KeyModifiers,\n}\n\npub enum MouseEventKind {\n    Down(MouseButton),\n    Up(MouseButton),\n    Drag(MouseButton),\n    Moved,\n    ScrollDown,\n    ScrollUp,\n    ScrollLeft,\n    ScrollRight,\n}\n\n### Enable/Disable Mouse\npub fn enable_mouse_capture(writer: &mut impl Write) -> io::Result<()> {\n    // Enable SGR extended mode (1006)\n    // Enable any-event tracking (1003) or button-event (1002)\n    write!(writer, \"\\x1b[?1000h\\x1b[?1006h\")?;\n    Ok(())\n}\n\npub fn disable_mouse_capture(writer: &mut impl Write) -> io::Result<()> {\n    write!(writer, \"\\x1b[?1006l\\x1b[?1000l\")?;\n    Ok(())\n}\n\n### Paste Size Limits\n- Default max: 1MB\n- Configurable via builder\n- Large pastes: return error or truncate\n\n### Focus Events (bonus)\n- Enable: ESC[?1004h\n- Disable: ESC[?1004l\n- Focus in: ESC[I\n- Focus out: ESC[O\n\n## Tests Required\n- [ ] Bracketed paste parse correct\n- [ ] Paste size limit enforced\n- [ ] SGR mouse button decoding\n- [ ] SGR mouse position decoding\n- [ ] Modifier key detection\n- [ ] Scroll events\n- [ ] Motion events\n- [ ] Focus events\n\n## Acceptance Criteria\n- [ ] Bracketed paste with size limit\n- [ ] SGR mouse protocol parsing\n- [ ] All mouse event types\n- [ ] Modifier key capture\n- [ ] Focus in/out events\n- [ ] Enable/disable APIs\n\n## Location: ftui-core crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:37:03.205238952Z","created_by":"ubuntu","updated_at":"2026-01-31T22:37:55.993493314Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3i6","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:37:55.993463057Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3k4","title":"Implement Canvas widget for custom drawing","description":"PHASE 7 - EXTRAS: CANVAS WIDGET\n\n## Background\nCanvas widget enables arbitrary pixel/shape drawing using Braille/block characters. Useful for graphs, plots, and custom visualizations that exceed normal cell-based rendering.\n\n## Technical Requirements\n- Canvas coordinate system (virtual pixels mapped to cells)\n- Drawing primitives:\n  - Point, Line, Rectangle, Circle, Ellipse\n  - Polygon (filled/outline)\n  - Text at arbitrary positions\n- Braille mode: 24 dots per cell = 8 pixels\n- Block mode: 22 quadrants per cell = 4 pixels\n- Half-block mode: 21 vertical halves\n- Color support within resolution limits\n- Painter API for building drawings\n\n## Design Rationale\nFeature-gated extra for visualization use cases. Braille provides highest resolution but requires font support. Multiple modes allow fallback based on terminal capabilities.\n\n## Acceptance Criteria\n- [ ] Canvas struct with configurable resolution mode\n- [ ] All drawing primitives\n- [ ] Braille character mapping\n- [ ] Block character mapping\n- [ ] Color support per primitive\n- [ ] Painter builder pattern\n- [ ] Coordinate transformation (pan, zoom)\n- [ ] Feature gate: canvas\n\n## Performance Budget\n- Line rasterization: Bresenham's algorithm\n- 1000 points render: < 1ms\n\n## Location: ftui-extras crate (feature = \"canvas\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:19:44.847948610Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:35.106522209Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3k4","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:22:35.106494166Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky","title":"OpenTUI Core Systems (opentui_rust port)","description":"Epic for porting core systems from opentui_rust. OpenTUI provides the low-level terminal handling infrastructure including ANSI sequences, buffer operations, highlighting, text editing primitives, and Unicode handling.\n\nReference: legacy_reference_library_code/opentui_rust/src/\n\nKey subsystems:\n1. ANSI module - escape sequence generation and parsing\n2. Buffer module - cell grid with scissor/opacity/pixel operations\n3. Highlight module - syntax tokenization and themed highlighting\n4. Input module - keyboard and event parsing\n5. Renderer module - diff engine and hit grid\n6. Terminal module - capabilities, cursor, mouse, raw mode\n7. Text module - rope, editor, segment, view for text manipulation\n8. Unicode module - bidi, grapheme, normalization, search, width\n\nThese are foundational primitives that the higher-level widgets and renderables build upon. Many of these are already covered by existing beads but need additional detail for specific features.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-31T23:00:44.420755776Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:23.740524781Z","closed_at":"2026-01-31T23:19:23.740505945Z","close_reason":"Closing OpenTUI port epic: PLAN_TO_CREATE_FRANKENTUI__OPUS.md is not a 1:1 port; relevant extracted concepts are tracked under ftui phase epics instead.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T23:04:26.303601247Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.1","title":"Implement ANSI sequence generator module","description":"Port the ANSI output module from opentui_rust. This module provides type-safe generation of ANSI escape sequences for terminal control.\n\nReference: legacy_reference_library_code/opentui_rust/src/ansi/output.rs\nReference: legacy_reference_library_code/opentui_rust/src/ansi/sequences.rs\n\nKey features to implement:\n1. SGR (Select Graphic Rendition) sequence generation\n   - Foreground/background colors (16, 256, RGB)\n   - Text attributes (bold, italic, underline, strikethrough, etc.)\n   - Reset codes\n2. Cursor movement sequences (CUP, CUU, CUD, CUF, CUB)\n3. Erase sequences (ED, EL)\n4. Scroll region (DECSTBM)\n5. Mode switching (DECSET, DECRST)\n6. OSC sequences (hyperlinks, clipboard, title)\n7. Bracketed paste mode\n8. Mouse mode sequences\n9. Synchronized output (DEC private mode 2026)\n\nAPI Design (from opentui_rust):\n```rust\npub struct AnsiWriter<W: Write> {\n    writer: W,\n    buf: Vec<u8>,\n}\n\nimpl<W: Write> AnsiWriter<W> {\n    pub fn sgr_reset(&mut self);\n    pub fn sgr_fg_rgb(&mut self, r: u8, g: u8, b: u8);\n    pub fn sgr_bg_256(&mut self, color: u8);\n    pub fn cursor_to(&mut self, row: u16, col: u16);\n    pub fn cursor_save(&mut self);\n    pub fn cursor_restore(&mut self);\n    pub fn erase_line(&mut self);\n    pub fn scroll_region(&mut self, top: u16, bottom: u16);\n    pub fn begin_sync(&mut self);\n    pub fn end_sync(&mut self);\n    pub fn osc_hyperlink_start(&mut self, url: &str);\n    pub fn osc_hyperlink_end(&mut self);\n}\n```\n\nImplementation notes:\n- Sequences are written to internal buffer first for batching\n- Use write_all with single syscall per frame\n- Escape character is 0x1B (ESC)\n- CSI is ESC [ (0x1B 0x5B)\n- OSC is ESC ] (0x1B 0x5D)\n\nDependencies: None (foundational module)","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] SGR sequences for all 16, 256, and RGB colors\n- [ ] SGR sequences for all text attributes (bold, italic, underline, etc.)\n- [ ] Cursor movement: absolute (CUP), relative (CUU/CUD/CUF/CUB)\n- [ ] Cursor save/restore (DECSC/DECRC)\n- [ ] Erase sequences: line (EL), screen (ED) with all modes\n- [ ] Scroll region (DECSTBM) setup and restore\n- [ ] Mode switching: DECSET/DECRST for alt screen, mouse, paste\n- [ ] OSC sequences: hyperlinks (OSC 8), title (OSC 0/2), clipboard (OSC 52)\n- [ ] Synchronized output (DEC 2026) with fallback\n- [ ] All sequences batched to single write syscall per frame\n\n### Correctness Requirements\n- [ ] All sequences conform to ECMA-48 and xterm spec\n- [ ] No malformed sequences emitted (valid ESC, CSI, OSC terminators)\n- [ ] State tracking prevents redundant sequences\n- [ ] Proper escaping of user content in OSC parameters\n\n### Performance Requirements\n- [ ] Sequence generation: < 100ns per sequence\n- [ ] Frame buffer assembly: < 50s for 80x24 terminal\n- [ ] Zero allocation for common sequences (use stack buffers)\n\n### Logging Requirements\n- [ ] tracing::trace! for each sequence emitted (behind feature flag)\n- [ ] tracing::debug! for mode changes\n- [ ] tracing::warn! for fallback activation\n\n### Test Coverage\n- [ ] Unit test for every sequence type\n- [ ] Property test: all output is valid UTF-8\n- [ ] Conformance tests against VT100/xterm reference\n- [ ] Fuzz test: no panics on arbitrary state","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T23:00:58.180891179Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:24.643192865Z","closed_at":"2026-01-31T23:18:55.111265931Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.1","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:00:58.180891179Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.10","title":"Implement terminal raw mode handling","description":"Port terminal raw mode handling from opentui_rust. This manages the terminal state for interactive TUI applications.\n\nReference: legacy_reference_library_code/opentui_rust/src/terminal/raw.rs\n\nKey features to implement:\n1. Enter/exit raw mode (termios manipulation)\n2. RAII guard for automatic cleanup\n3. Panic hook for emergency cleanup\n4. Signal handling (SIGTERM, SIGINT, SIGWINCH)\n5. Alternative screen buffer (optional)\n6. Mouse mode enable/disable\n7. Bracketed paste mode enable/disable\n8. Cursor visibility control\n\nAPI Design (from opentui_rust):\n```rust\npub struct RawMode {\n    original: Termios,\n    alternate_screen: bool,\n}\n\nimpl RawMode {\n    pub fn enter() -> io::Result<Self>;\n    pub fn enter_with_alt_screen() -> io::Result<Self>;\n}\n\nimpl Drop for RawMode {\n    fn drop(&mut self) {\n        // Restore terminal state\n    }\n}\n\npub struct TerminalGuard {\n    raw: RawMode,\n    panic_hook: Option<...>,\n}\n\nimpl TerminalGuard {\n    pub fn new(config: TerminalConfig) -> io::Result<Self>;\n}\n```\n\nImplementation notes:\n- Must handle panic cleanup (set panic hook)\n- Use signal-hook for portable signal handling\n- Termios on Unix, ConsoleMode on Windows\n\nDependencies: Platform abstraction (crossterm internals)","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Enter raw mode (disable line buffering, echo, signals)\n- [ ] Exit raw mode (restore original termios)\n- [ ] RAII guard for automatic cleanup on drop\n- [ ] Panic hook for emergency cleanup on panic\n- [ ] Alternative screen buffer enter/exit\n- [ ] Mouse mode enable/disable\n- [ ] Bracketed paste mode enable/disable\n- [ ] Cursor visibility control\n- [ ] Signal handling: SIGWINCH, SIGTERM, SIGINT\n\n### Safety Requirements\n- [ ] Terminal always restored on normal exit\n- [ ] Terminal always restored on panic\n- [ ] Terminal restored even on SIGKILL (best effort)\n- [ ] No undefined behavior on double-enter or double-exit\n- [ ] Thread-safe (only one raw mode active at a time)\n\n### Platform Requirements\n- [ ] Unix: termios manipulation\n- [ ] macOS: termios with BSD extensions\n- [ ] Windows: ConsoleMode manipulation (future)\n\n### Logging Requirements\n- [ ] tracing::info! on mode enter/exit\n- [ ] tracing::debug! for termios changes\n- [ ] tracing::error! for restoration failures\n- [ ] tracing::warn! for signal handler issues\n\n### Test Coverage\n- [ ] Unit test: enter/exit cycle\n- [ ] Unit test: RAII cleanup\n- [ ] PTY test: isolation from parent terminal\n- [ ] PTY test: cleanup after simulated panic\n- [ ] Integration test: signal handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T23:02:12.911475071Z","created_by":"ubuntu","updated_at":"2026-01-31T23:20:31.953256710Z","closed_at":"2026-01-31T23:18:55.186320232Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.10","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:02:12.911475071Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.11","title":"Optional: runtime terminal capability probing (bounded timeouts)","description":"# Optional: runtime terminal capability probing (bounded timeouts)\n\n## Background\nPlan Section 0.4/9.1 + TerminalCapabilities contract: v1 detection should be conservative and environment-based.\n\nHowever, the plan allows an optional *feature-gated* probing layer:\n- device attribute queries (DA)\n- OSC queries\n\nCritical constraints:\n- probing must be bounded with timeouts\n- probing must fail-open (unknown => disable feature, never hang startup)\n- probing must not compromise the one-writer rule\n\n## Scope\nAdd an optional probing module that can refine `TerminalCapabilities`.\n\nExamples (only if safe and supported):\n- cursor position report (CPR)\n- DA1/DA2 (device attributes)\n- synchronized output support probing (if an unambiguous probe exists)\n- background color query (for dark/light heuristics) if we decide to support it\n\n## Design constraints\n- Must run only when we have exclusive terminal ownership (TerminalSession active).\n- Must be guarded by a feature flag (e.g., `caps-probe`).\n- Must never block indefinitely; hard timeouts.\n\n## Tests\n- Unit tests for response parsing\n- Integration tests (PTY) to ensure:\n  - probe timeouts do not hang\n  - capability results are conservative when probe fails\n\n## Acceptance Criteria\n- [ ] Feature-gated probe module exists.\n- [ ] All probes are bounded by timeouts and fail-open.\n- [ ] Tests cover success + timeout + malformed responses.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T23:02:19.243199848Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:00.759446498Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.11","depends_on_id":"bd-10i.2.6","type":"blocks","created_at":"2026-01-31T23:17:22.209661254Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.11","depends_on_id":"bd-10i.4","type":"parent-child","created_at":"2026-01-31T23:17:06.856234469Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.11","depends_on_id":"bd-10i.4.4","type":"blocks","created_at":"2026-01-31T23:17:22.796892855Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.12","title":"Implement optional render/output thread (Mode B)","description":"# Implement optional render/output thread (Mode B)\n\n## Background\nPlan Sections 0.9.2 (Mode B) and 8.2 describe an optional dedicated render/output thread.\n\nThis exists to solve the real harness problem:\n- logs can be produced by background tasks / subprocess capture\n- UI needs tick-driven updates\n- if output interleaves, inline mode breaks\n\nMode B keeps the **one-writer rule** by construction: the render thread is the only place bytes hit the terminal.\n\n## Scope\n- Feature-gated \"Mode B\" operation in addition to the default single-threaded mode.\n- Render/output thread owns:\n  - `TerminalSession` output handle\n  - `Presenter`\n  - `prev_buffer` (front buffer)\n  - inline-mode policy state (ui rect/anchor/height)\n\n## Design\n### Messages\n```rust\nenum OutMsg {\n    Log(Vec<u8>),\n    Render(Buffer),\n    Resize { w: u16, h: u16 },\n    SetMode(ScreenMode),\n    Shutdown,\n}\n```\n\n### Coalescing rules\n- Render messages are coalesced (\"latest wins\"):\n  - drop intermediate renders if a newer one arrives\n  - present at most one buffer per loop iteration\n- Log messages are *not* dropped, but are:\n  - newline-aware\n  - chunked to avoid starving UI\n\n### Error handling\n- Render thread errors propagate back to the Program so we can:\n  - restore terminal state\n  - exit with a useful error\n\n## Test Plan\n- PTY tests must run in both modes:\n  - default single-threaded mode\n  - render/output thread enabled\n- Stress tests:\n  - heavy log spam + UI tick (spinner) + resize storms\n  - ensure cursor invariants and scrollback preservation\n\n## Acceptance Criteria\n- [ ] Mode B can be enabled via feature flag and/or App/Program option.\n- [ ] All terminal writes are serialized in the render thread.\n- [ ] Render coalescing works (latest buffer presented).\n- [ ] Log chunking works and does not starve UI.\n- [ ] PTY tests pass in both Mode A and Mode B.\n\n## Location\nLikely `ftui-core` (thread + terminal ownership) with integration hooks in `ftui-runtime`.","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Background thread for frame rendering\n- [ ] Double buffering with atomic swap\n- [ ] Frame rate limiting (configurable FPS cap)\n- [ ] Frame skipping when behind schedule\n- [ ] Graceful shutdown without hanging\n- [ ] Error propagation to main thread\n- [ ] Submit frame (non-blocking)\n- [ ] Flush pending frames (blocking)\n\n### Threading Requirements\n- [ ] Main thread never blocked on I/O\n- [ ] Channel-based command passing\n- [ ] No data races on buffer swap\n- [ ] Proper synchronization on shutdown\n\n### Performance Requirements\n- [ ] Submit latency: < 100s\n- [ ] Render latency: < 1ms for 80x24\n- [ ] Memory: 2 buffers + channel overhead\n- [ ] No allocation per frame (buffer reuse)\n\n### Error Handling\n- [ ] I/O errors propagated to main thread\n- [ ] Panics in render thread caught\n- [ ] Graceful degradation on slow I/O\n\n### Logging Requirements\n- [ ] tracing::debug! for frame submission\n- [ ] tracing::debug! for frame skip\n- [ ] tracing::trace! for render timing\n- [ ] tracing::error! for I/O failures\n- [ ] tracing::info! for shutdown\n\n### Test Coverage\n- [ ] Unit test: submit/flush cycle\n- [ ] Unit test: frame rate limiting\n- [ ] Stress test: high FPS submission\n- [ ] Stress test: large frame buffers\n- [ ] Error injection test: I/O failure","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T23:02:25.066721177Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:00.786052735Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.12","depends_on_id":"bd-10i.2.6","type":"blocks","created_at":"2026-01-31T23:11:20.157864932Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.12","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T23:04:17.439227362Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.12","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T23:04:16.913196123Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.12","depends_on_id":"bd-10i.8","type":"parent-child","created_at":"2026-01-31T23:10:40.488717797Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.12","depends_on_id":"bd-10i.8.1","type":"blocks","created_at":"2026-01-31T23:11:26.835649872Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.13","title":"Implement language-specific tokenizers (Rust, Python, JS, JSON, TOML, Markdown)","description":"Implement tokenizer grammars for common programming languages. These provide syntax highlighting for code blocks and text editors.\n\nReference: legacy_reference_library_code/opentui_rust/src/highlight/languages/\n\nLanguages to implement:\n1. Rust - keywords, types, lifetimes, macros, attributes\n2. Python - keywords, decorators, f-strings, type hints\n3. JavaScript/TypeScript - keywords, JSX, template literals\n4. JSON - keys, strings, numbers, booleans, null\n5. TOML - sections, keys, values, arrays, inline tables\n6. Markdown - headers, emphasis, links, code blocks, lists\n\nEach tokenizer implements the Tokenizer trait:\n```rust\npub trait Tokenizer: Send + Sync {\n    fn tokenize(&self, line: &str, state: u32) -> (Vec<Token>, u32);\n    fn initial_state(&self) -> u32;\n    fn language_name(&self) -> &'static str;\n    fn file_extensions(&self) -> &[&'static str];\n}\n```\n\nKey implementation details:\n- State machine for multi-line strings/comments\n- Regex-based token matching\n- Priority ordering for overlapping patterns\n- Performance: tokenize 10,000 lines in < 100ms\n\nDependencies: Tokenizer engine (bd-3ky.3)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:04:47.816763643Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.191773620Z","closed_at":"2026-01-31T23:18:55.191753903Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.13","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:04:47.816763643Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.13","depends_on_id":"bd-3ky.3","type":"blocks","created_at":"2026-01-31T23:04:56.197642632Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.14","title":"Implement text View (scrollable text display)","description":"Port the text View from opentui_rust. View provides a scrollable window into a text buffer with word wrapping.\n\nReference: legacy_reference_library_code/opentui_rust/src/text/view.rs\n\nKey features to implement:\n1. Viewport with scroll offset (line, column)\n2. Soft wrapping at word boundaries\n3. Hard wrapping at specified width\n4. Line number gutter (optional)\n5. Scroll to line/position\n6. Visible range calculation\n7. Selection highlighting\n8. Search result highlighting\n\nAPI Design:\n```rust\npub struct View {\n    text: Rope,  // or &str for static content\n    viewport: Rect,\n    scroll_offset: (usize, usize),  // line, column\n    wrap: WrapMode,\n    show_line_numbers: bool,\n    selections: Vec<Range<usize>>,\n    highlights: Vec<(Range<usize>, Style)>,\n}\n\npub enum WrapMode {\n    None,\n    Word,\n    Char,\n    Truncate,\n}\n\nimpl View {\n    pub fn scroll_to(&mut self, line: usize);\n    pub fn scroll_by(&mut self, delta: isize);\n    pub fn visible_lines(&self) -> Range<usize>;\n    pub fn render_to_buffer(&self, buffer: &mut Buffer);\n}\n```\n\nDependencies: Rope (bd-3ky.5), Buffer (bd-10i.3.6), runeutil (bd-6e9.8)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:04:54.331187709Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.196454003Z","closed_at":"2026-01-31T23:18:55.196435308Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.14","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T23:14:44.620336451Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.14","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T23:04:57.288139223Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.14","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:04:54.331187709Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.14","depends_on_id":"bd-3ky.5","type":"blocks","created_at":"2026-01-31T23:04:56.744682359Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.14","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:04:57.928832265Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.15","title":"OpenTUI Core Systems Test Suite","description":"Comprehensive test suite for OpenTUI core systems. These are foundational components that require rigorous testing including fuzzing, property tests, and performance benchmarks.\n\n## Testing Philosophy\nCore systems require:\n1. **Correctness** - Behavior matches specification exactly\n2. **Robustness** - Handles malformed input gracefully\n3. **Performance** - Meets latency and throughput targets\n4. **Security** - No buffer overflows, escape injection, etc.\n\n## Test Requirements by Module\n\n### ANSI Sequence Generator (bd-3ky.1)\nUnit tests:\n- `test_sgr_reset` - \\x1b[0m emitted correctly\n- `test_sgr_fg_16` - ANSI 16-color foreground\n- `test_sgr_fg_256` - 256-color foreground\n- `test_sgr_fg_rgb` - 24-bit foreground\n- `test_sgr_bg_all` - Background color variants\n- `test_sgr_bold` - Bold attribute\n- `test_sgr_italic` - Italic attribute\n- `test_sgr_underline_variants` - Single, double, curly\n- `test_cursor_absolute` - CUP sequence\n- `test_cursor_relative` - CUU/CUD/CUF/CUB\n- `test_cursor_save_restore` - DECSC/DECRC\n- `test_erase_line` - EL variants\n- `test_erase_screen` - ED variants\n- `test_scroll_region` - DECSTBM\n- `test_mouse_enable` - SGR mouse mode\n- `test_bracketed_paste` - Enable/disable\n- `test_sync_output` - DEC mode 2026\n- `test_osc_hyperlink` - OSC 8 link sequences\n\nProperty tests:\n- `prop_sequences_valid_ascii` - All bytes are valid escape sequences\n- `prop_sequences_terminate` - All sequences properly terminated\n\nConformance tests:\n- `conformance_vt100` - VT100 compatibility\n- `conformance_xterm` - xterm extensions\n\n### Buffer Drawing (bd-3ky.2)\nUnit tests:\n- `test_draw_hline` - Horizontal line placement\n- `test_draw_vline` - Vertical line placement\n- `test_draw_line_diagonal` - Bresenham algorithm\n- `test_draw_rect_outline` - Rectangle border only\n- `test_draw_rect_filled` - Filled rectangle\n- `test_draw_border` - Border with corner chars\n- `test_print_ascii` - ASCII text at position\n- `test_print_unicode` - Wide characters handled\n- `test_print_styled` - Style applied to cells\n- `test_blit_opaque` - Buffer copied without alpha\n- `test_blit_alpha` - Alpha blending during blit\n- `test_scissor_clips` - Drawing clipped to scissor rect\n\nProperty tests:\n- `prop_draw_in_bounds` - All draws stay within buffer\n- `prop_scissor_respected` - Nothing drawn outside scissor\n\nBenchmark tests:\n- `bench_draw_line_1000` - 1000 lines < 1ms\n- `bench_blit_full_screen` - 80x24 blit < 100s\n\n### Syntax Tokenizer (bd-3ky.3)\nUnit tests:\n- `test_tokenize_empty` - Empty string yields no tokens\n- `test_tokenize_whitespace` - Whitespace token type\n- `test_tokenize_keyword` - Language keywords detected\n- `test_tokenize_string_single` - Single-quoted strings\n- `test_tokenize_string_double` - Double-quoted strings\n- `test_tokenize_string_escape` - Escaped characters in strings\n- `test_tokenize_string_multiline` - State preserved across lines\n- `test_tokenize_comment_line` - // and # comments\n- `test_tokenize_comment_block` - /* */ comments\n- `test_tokenize_number_int` - Integer literals\n- `test_tokenize_number_float` - Float literals\n- `test_tokenize_number_hex` - Hexadecimal\n- `test_tokenize_operator` - Operators detected\n- `test_tokenize_incremental` - Re-tokenize after edit\n\nFuzz tests:\n- `fuzz_tokenizer_no_panic` - Random input never panics\n- `fuzz_tokenizer_valid_ranges` - Token ranges always valid\n\nPerformance tests:\n- `perf_tokenize_10k_lines` - 10,000 lines < 100ms\n\n### Highlight Theme (bd-3ky.4)\nUnit tests:\n- `test_theme_load_toml` - Parse theme from TOML\n- `test_theme_load_json` - Parse theme from JSON\n- `test_theme_builtin_dark` - Dark theme colors\n- `test_theme_builtin_light` - Light theme colors\n- `test_theme_token_style` - Style lookup by token type\n- `test_theme_fallback` - Unknown token uses default\n- `test_highlighted_buffer_cache` - Cache invalidation on edit\n\n### Text Rope (bd-3ky.5)\nUnit tests:\n- `test_rope_from_empty` - Empty rope\n- `test_rope_from_string` - Initialize from string\n- `test_rope_len_bytes` - Byte length tracking\n- `test_rope_len_lines` - Line count tracking\n- `test_rope_insert_start` - Insert at position 0\n- `test_rope_insert_middle` - Insert in middle\n- `test_rope_insert_end` - Append\n- `test_rope_delete_range` - Delete byte range\n- `test_rope_replace` - Delete + insert\n- `test_rope_line_access` - Get line by index\n- `test_rope_slice` - Extract substring\n- `test_rope_byte_to_line_col` - Coordinate conversion\n- `test_rope_line_col_to_byte` - Reverse conversion\n\nProperty tests:\n- `prop_rope_insert_delete_inverse` - Insert then delete = original\n- `prop_rope_len_consistent` - len() matches actual content\n- `prop_rope_lines_consistent` - line count matches newlines + 1\n\nPerformance tests:\n- `perf_rope_insert_random` - 10,000 random inserts < 100ms\n- `perf_rope_large_file` - 1MB file operations < 10ms\n\n### Text Editor (bd-3ky.6)\nUnit tests:\n- `test_editor_insert_char` - Single character insertion\n- `test_editor_insert_text` - Multi-char insertion\n- `test_editor_delete` - Delete forward\n- `test_editor_backspace` - Delete backward\n- `test_editor_move_cursor` - Arrow key movement\n- `test_editor_move_word` - Ctrl+Arrow movement\n- `test_editor_select_shift` - Shift+Arrow selection\n- `test_editor_select_all` - Ctrl+A selection\n- `test_editor_cut_copy_paste` - Clipboard operations\n- `test_editor_undo` - Single undo\n- `test_editor_undo_chain` - Multiple undos\n- `test_editor_redo` - Redo after undo\n- `test_editor_redo_discard` - New edit clears redo stack\n- `test_editor_transaction` - Grouped operations\n\nProperty tests:\n- `prop_editor_cursor_valid` - Cursor always in bounds\n- `prop_editor_undo_redo_inverse` - Full undo/redo is identity\n\n### Unicode BiDi (bd-3ky.7)\nUnit tests:\n- `test_bidi_ltr_only` - Left-to-right text unchanged\n- `test_bidi_rtl_only` - Right-to-left reversed\n- `test_bidi_mixed` - LTR with embedded RTL\n- `test_bidi_numbers_in_rtl` - Numbers in Arabic text\n- `test_bidi_explicit_marks` - LRM/RLM characters\n- `test_bidi_reorder_for_display` - Visual reordering\n\nConformance tests:\n- `conformance_uax9` - Unicode BiDi algorithm tests\n\n### Unicode Normalization (bd-3ky.8)\nUnit tests:\n- `test_nfc_combining` - Combining characters composed\n- `test_nfd_decompose` - Precomposed decomposed\n- `test_nfkc_compatibility` - Compatibility mappings\n- `test_nfkd_full_decompose` - Full compatibility decomposition\n- `test_quick_check_fast` - Already-normalized detected quickly\n\nConformance tests:\n- `conformance_normalization_tests` - Unicode consortium test suite\n\n### Unicode Search (bd-3ky.9)\nUnit tests:\n- `test_search_exact` - Exact substring match\n- `test_search_case_insensitive` - Case-folded match\n- `test_search_normalized` - NFC-normalized match\n- `test_search_whole_word` - Word boundary detection\n- `test_search_regex` - Regex pattern matching\n- `test_search_find_all` - All occurrences returned\n- `test_search_find_next` - Forward iteration\n- `test_search_find_prev` - Backward iteration\n\n### Terminal Raw Mode (bd-3ky.10)\nUnit tests:\n- `test_raw_mode_enter` - Mode entered successfully\n- `test_raw_mode_exit` - Mode restored on drop\n- `test_raw_mode_panic_cleanup` - Cleaned up on panic\n- `test_alt_screen_enter` - Switch to alt screen\n- `test_alt_screen_exit` - Return to main screen\n- `test_mouse_mode_enable` - Mouse events received\n- `test_signal_handler` - SIGWINCH handled\n\nPTY tests:\n- `pty_raw_mode_isolation` - Mode changes isolated to session\n- `pty_cleanup_on_crash` - Terminal restored after kill -9\n\n### Terminal Queries (bd-3ky.11)\nUnit tests:\n- `test_query_cursor_position` - CPR response parsed\n- `test_query_terminal_size` - Size query works\n- `test_query_timeout` - Timeout on no response\n- `test_query_partial_response` - Handle incomplete response\n\n### Threaded Renderer (bd-3ky.12)\nUnit tests:\n- `test_renderer_submit_frame` - Frame accepted\n- `test_renderer_frame_rate_limit` - FPS capped\n- `test_renderer_skip_frames` - Old frames skipped when behind\n- `test_renderer_shutdown_clean` - Graceful shutdown\n- `test_renderer_error_propagation` - I/O errors reach main thread\n\nStress tests:\n- `stress_renderer_high_fps` - 1000 FPS submission\n- `stress_renderer_large_frames` - 200x50 terminal\n\n### Language Tokenizers (bd-3ky.13)\nUnit tests per language:\n- Rust: keywords, lifetimes, macros, attributes, strings, comments\n- Python: keywords, decorators, f-strings, comments, indentation\n- JavaScript: keywords, template literals, JSX, comments\n- JSON: keys, strings, numbers, booleans, null, structure\n- TOML: sections, keys, strings, arrays, inline tables\n- Markdown: headers, emphasis, links, code blocks, lists\n\n### Text View (bd-3ky.14)\nUnit tests:\n- `test_view_scroll_to_line` - Scroll to specific line\n- `test_view_scroll_by_page` - Page up/down\n- `test_view_visible_range` - Correct range calculation\n- `test_view_wrap_word` - Word wrap at boundaries\n- `test_view_wrap_char` - Character wrap fallback\n- `test_view_line_numbers` - Line number gutter\n- `test_view_selection_highlight` - Selection styling\n- `test_view_search_highlight` - Search result styling\n\n## Logging Requirements\n- `tracing::debug!` for state transitions\n- `tracing::trace!` for per-operation details\n- `tracing::warn!` for recovered errors\n- `tracing::error!` for fatal conditions\n- Performance-sensitive paths use `tracing::trace_span!`\n\n## Coverage Targets\n- Line coverage: >= 95% (core systems are critical)\n- Branch coverage: >= 90%\n- Fuzzing: 1M iterations without crash\n\nDependencies: All OpenTUI modules, Testing infrastructure (bd-10i.11)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T23:17:04.100606955Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:14.551019874Z","closed_at":"2026-01-31T23:19:14.550997542Z","close_reason":"Closing OpenTUI-port test suite: OpenTUI port work is out of scope for FrankenTUI plan v1; use ftui-specific test epics instead (bd-10i.11 + child tasks).","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.15","depends_on_id":"bd-10i.11","type":"blocks","created_at":"2026-01-31T23:18:02.831842710Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:17:04.100606955Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.1","type":"blocks","created_at":"2026-01-31T23:18:34.064768965Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.10","type":"blocks","created_at":"2026-01-31T23:18:39.501250819Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.11","type":"blocks","created_at":"2026-01-31T23:18:40.087004178Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.12","type":"blocks","created_at":"2026-01-31T23:18:40.670255765Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.13","type":"blocks","created_at":"2026-01-31T23:18:41.257648851Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.14","type":"blocks","created_at":"2026-01-31T23:18:41.845876639Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.2","type":"blocks","created_at":"2026-01-31T23:18:34.678871472Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.3","type":"blocks","created_at":"2026-01-31T23:18:35.275303087Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.4","type":"blocks","created_at":"2026-01-31T23:18:35.830634573Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.5","type":"blocks","created_at":"2026-01-31T23:18:36.517946959Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.6","type":"blocks","created_at":"2026-01-31T23:18:37.064537096Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.7","type":"blocks","created_at":"2026-01-31T23:18:37.642713247Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.8","type":"blocks","created_at":"2026-01-31T23:18:38.218533111Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.15","depends_on_id":"bd-3ky.9","type":"blocks","created_at":"2026-01-31T23:18:38.900909122Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.2","title":"Implement Buffer drawing operations","description":"Port the buffer drawing operations from opentui_rust. These extend the basic Buffer with drawing primitives.\n\nReference: legacy_reference_library_code/opentui_rust/src/buffer/drawing.rs\nReference: legacy_reference_library_code/opentui_rust/src/buffer/pixel.rs\n\nKey features to implement:\n1. Line drawing (horizontal, vertical, diagonal)\n2. Rectangle drawing (filled, outline)\n3. Circle/ellipse drawing (Bresenham algorithm)\n4. Text rendering at position\n5. Block character rendering for pseudo-graphics\n6. Flood fill (bounded)\n7. Braille pattern rendering for high-res\n8. Sprite blitting\n\nAPI Design (from opentui_rust):\n```rust\nimpl Buffer {\n    // Line drawing\n    pub fn draw_line(&mut self, x1: u16, y1: u16, x2: u16, y2: u16, cell: Cell);\n    pub fn draw_hline(&mut self, x: u16, y: u16, len: u16, cell: Cell);\n    pub fn draw_vline(&mut self, x: u16, y: u16, len: u16, cell: Cell);\n    \n    // Rectangles\n    pub fn draw_rect(&mut self, rect: Rect, cell: Cell);\n    pub fn fill_rect(&mut self, rect: Rect, cell: Cell);\n    pub fn draw_border(&mut self, rect: Rect, border: Border, style: Style);\n    \n    // Text\n    pub fn print(&mut self, x: u16, y: u16, text: &str, style: Style);\n    pub fn print_styled(&mut self, x: u16, y: u16, text: &Text);\n    \n    // Advanced\n    pub fn blit(&mut self, x: u16, y: u16, source: &Buffer, blend: bool);\n}\n```\n\nImplementation notes:\n- All operations respect scissor stack\n- Opacity stack affects alpha blending during blit\n- Wide characters occupy two cells (second is continuation)\n\nDependencies: Buffer (bd-10i.3.6), Cell (bd-10i.3.4), Rect (bd-10i.3.7)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:07.671267058Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.147012479Z","closed_at":"2026-01-31T23:18:55.146983274Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.2","depends_on_id":"bd-10i.3","type":"blocks","created_at":"2026-01-31T23:14:42.627519466Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.2","depends_on_id":"bd-10i.3.4","type":"blocks","created_at":"2026-01-31T23:04:10.712265139Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.2","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T23:04:10.193676237Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.2","depends_on_id":"bd-10i.3.7","type":"blocks","created_at":"2026-01-31T23:04:11.241988307Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.2","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:07.671267058Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.3","title":"Implement syntax tokenizer engine","description":"Port the syntax tokenizer from opentui_rust highlight module. The tokenizer provides language-agnostic tokenization for syntax highlighting.\n\nReference: legacy_reference_library_code/opentui_rust/src/highlight/tokenizer.rs\nReference: legacy_reference_library_code/opentui_rust/src/highlight/token.rs\nReference: legacy_reference_library_code/opentui_rust/src/highlight/syntax.rs\n\nKey features to implement:\n1. Token types (keyword, string, number, comment, operator, etc.)\n2. State machine for multi-line tokens (strings, comments)\n3. Language grammar definitions\n4. Incremental re-tokenization on edit\n5. Token range queries\n6. Token iteration API\n\nAPI Design (from opentui_rust):\n```rust\npub enum TokenType {\n    Keyword,\n    String,\n    Number,\n    Comment,\n    Operator,\n    Punctuation,\n    Identifier,\n    Type,\n    Function,\n    Attribute,\n    Macro,\n    Whitespace,\n    Error,\n}\n\npub struct Token {\n    pub ty: TokenType,\n    pub start: usize,\n    pub end: usize,\n}\n\npub trait Tokenizer: Send + Sync {\n    fn tokenize(&self, line: &str, state: u32) -> (Vec<Token>, u32);\n    fn initial_state(&self) -> u32;\n}\n\npub struct SyntaxSet {\n    languages: HashMap<String, Box<dyn Tokenizer>>,\n}\n```\n\nImplementation notes:\n- State is passed between lines for multi-line constructs\n- Grammars are simpler than tree-sitter but faster\n- Built-in support for: Rust, Python, JavaScript, JSON, TOML, Markdown\n\nDependencies: None (foundational module)","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Token types: Keyword, String, Number, Comment, Operator, Punctuation, Identifier, Type, Function, Attribute, Macro, Whitespace, Error\n- [ ] State machine for multi-line tokens (strings, block comments)\n- [ ] State passed between lines for continuations\n- [ ] Incremental re-tokenization on single-line edit\n- [ ] Token range queries (get tokens in byte range)\n- [ ] Token iteration API\n\n### Language Support (via bd-3ky.13)\n- [ ] Grammar definitions are data-driven\n- [ ] New languages can be added without code changes\n- [ ] Fallback to plain text for unknown languages\n\n### Performance Requirements\n- [ ] Tokenize single line: < 10s for typical 80-char line\n- [ ] Tokenize 10,000 lines: < 100ms\n- [ ] Incremental update: < 1ms for single line change\n- [ ] Memory: < 50 bytes per line state\n\n### Robustness Requirements\n- [ ] Never panic on any input\n- [ ] Malformed syntax produces Error tokens, not crashes\n- [ ] Unterminated strings/comments handled gracefully\n- [ ] Binary/non-UTF8 produces Error tokens\n\n### Logging Requirements\n- [ ] tracing::trace! for token production (debug builds)\n- [ ] tracing::debug! for state transitions\n- [ ] tracing::warn! for tokenization errors\n\n### Test Coverage\n- [ ] Unit tests per token type\n- [ ] Fuzz test: 1M random strings, no panic\n- [ ] Conformance tests for each language\n- [ ] Property test: token ranges cover entire input","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:15.428988015Z","created_by":"ubuntu","updated_at":"2026-01-31T23:20:03.767072104Z","closed_at":"2026-01-31T23:18:55.151964242Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.3","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:11.775766255Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.3","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:15.428988015Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.4","title":"Implement highlight theme system","description":"Port the highlight theme system from opentui_rust. Themes map token types to styles for syntax highlighting.\n\nReference: legacy_reference_library_code/opentui_rust/src/highlight/theme.rs\nReference: legacy_reference_library_code/opentui_rust/src/highlight/highlighted_buffer.rs\n\nKey features to implement:\n1. Theme definition format (TOML or embedded)\n2. Token type to style mapping\n3. Built-in themes (dark, light, monokai, etc.)\n4. Custom theme loading\n5. Theme scope selectors (like TextMate)\n6. Background color handling\n7. Highlighted buffer for caching styled output\n\nAPI Design (from opentui_rust):\n```rust\npub struct Theme {\n    pub name: String,\n    pub background: Color,\n    pub foreground: Color,\n    pub selection: Color,\n    pub cursor: Color,\n    pub tokens: HashMap<TokenType, Style>,\n}\n\nimpl Theme {\n    pub fn get_style(&self, token: TokenType) -> Style;\n    pub fn load(path: &Path) -> Result<Theme>;\n}\n\npub struct HighlightedBuffer {\n    lines: Vec<HighlightedLine>,\n    theme: Theme,\n    tokenizer: Box<dyn Tokenizer>,\n}\n\npub struct HighlightedLine {\n    text: String,\n    tokens: Vec<Token>,\n    styled_segments: Vec<(usize, usize, Style)>,\n}\n```\n\nImplementation notes:\n- HighlightedBuffer caches tokenization results\n- Invalidation on edit is line-granular\n- State propagation handles multi-line constructs\n\nDependencies: Tokenizer, Style system, Color system","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:20.871415257Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.156899375Z","closed_at":"2026-01-31T23:18:55.156879938Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.4","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:04:12.806761776Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.4","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:20.871415257Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.4","depends_on_id":"bd-3ky.3","type":"blocks","created_at":"2026-01-31T23:04:12.284361089Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.5","title":"Implement text Rope data structure","description":"Port the Rope data structure from opentui_rust text module. Rope provides efficient text manipulation for large documents with O(log n) edit operations.\n\nReference: legacy_reference_library_code/opentui_rust/src/text/rope.rs\n\nKey features to implement:\n1. B-tree based rope with configurable chunk size\n2. O(log n) insert/delete at arbitrary positions\n3. Line index for fast line-based access\n4. Byte offset to line/column conversion\n5. Iterator over chars, graphemes, lines\n6. Slice extraction (Cow for small slices)\n7. Search within rope (substring, regex)\n8. Undo-friendly edit representation\n\nAPI Design (from opentui_rust):\n```rust\npub struct Rope {\n    root: Node,\n    len_bytes: usize,\n    len_lines: usize,\n}\n\nimpl Rope {\n    pub fn new() -> Self;\n    pub fn from_str(s: &str) -> Self;\n    \n    // Access\n    pub fn len(&self) -> usize;\n    pub fn lines(&self) -> usize;\n    pub fn line(&self, idx: usize) -> Option<Cow<str>>;\n    pub fn slice(&self, range: Range<usize>) -> Cow<str>;\n    pub fn char_at(&self, byte_idx: usize) -> Option<char>;\n    \n    // Modification\n    pub fn insert(&mut self, pos: usize, text: &str);\n    pub fn delete(&mut self, range: Range<usize>);\n    pub fn replace(&mut self, range: Range<usize>, text: &str);\n    \n    // Conversion\n    pub fn byte_to_line_col(&self, byte: usize) -> (usize, usize);\n    pub fn line_col_to_byte(&self, line: usize, col: usize) -> usize;\n}\n```\n\nImplementation notes:\n- Consider using ropey crate as reference/dependency\n- Chunk size should be cache-line friendly (64-256 bytes)\n- Line index is maintained incrementally on edits\n- Critical for TextArea and code editor performance\n\nDependencies: None (foundational data structure)","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Create rope from empty, string, and file\n- [ ] Insert text at any byte position in O(log n)\n- [ ] Delete byte range in O(log n)\n- [ ] Replace (delete + insert) atomically\n- [ ] Get line by index in O(log n)\n- [ ] Slice extraction returns Cow (zero-copy when possible)\n- [ ] Byte offset to line/column conversion\n- [ ] Line/column to byte offset conversion\n- [ ] Character and grapheme iteration\n- [ ] Line iteration with proper newline handling\n\n### Correctness Requirements\n- [ ] All operations maintain rope invariants (balanced tree)\n- [ ] Line count always matches actual newline count + 1\n- [ ] Byte length always matches actual content length\n- [ ] UTF-8 validity preserved on all operations\n- [ ] Operations at grapheme boundaries don't split graphemes\n\n### Performance Requirements\n- [ ] Insert 10,000 random positions: < 100ms\n- [ ] Delete 10,000 random ranges: < 100ms\n- [ ] Load 1MB file: < 50ms\n- [ ] Memory overhead: < 2x document size\n- [ ] Chunk size: 64-256 bytes for cache efficiency\n\n### Logging Requirements\n- [ ] tracing::trace! for rebalance operations\n- [ ] tracing::debug! for large insertions (> 10KB)\n- [ ] tracing::info! for file load completion\n\n### Test Coverage\n- [ ] Unit tests for all public methods\n- [ ] Property test: insert-delete inverse\n- [ ] Property test: line count consistency\n- [ ] Stress test: 1M random edits without crash\n- [ ] Benchmark regression tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:33.850875181Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:36.438129849Z","closed_at":"2026-01-31T23:18:55.162026850Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.5","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:33.850875181Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.6","title":"Implement text Editor core","description":"Port the text Editor from opentui_rust. Editor provides text manipulation operations with cursor and selection management.\n\nReference: legacy_reference_library_code/opentui_rust/src/text/editor.rs\nReference: legacy_reference_library_code/opentui_rust/src/text/edit.rs\n\nKey features to implement:\n1. Cursor position management (byte offset, line/col)\n2. Selection (anchor + head)\n3. Multiple cursors (future extensibility)\n4. Edit operations (insert, delete, backspace, etc.)\n5. Word-aware operations (delete word, move by word)\n6. Line operations (duplicate, move up/down, delete)\n7. Indent/dedent\n8. Undo/redo with edit history\n9. Transaction grouping for undo\n\nAPI Design (from opentui_rust):\n```rust\npub struct Editor {\n    rope: Rope,\n    cursor: usize,       // Byte offset\n    anchor: Option<usize>, // Selection start\n    history: EditHistory,\n}\n\npub struct Edit {\n    pub range: Range<usize>,\n    pub replacement: String,\n    pub cursor_after: usize,\n}\n\nimpl Editor {\n    // Cursor\n    pub fn move_left(&mut self);\n    pub fn move_right(&mut self);\n    pub fn move_up(&mut self);\n    pub fn move_down(&mut self);\n    pub fn move_word_left(&mut self);\n    pub fn move_word_right(&mut self);\n    \n    // Selection\n    pub fn select_all(&mut self);\n    pub fn select_word(&mut self);\n    pub fn select_line(&mut self);\n    pub fn selection(&self) -> Option<Range<usize>>;\n    pub fn selected_text(&self) -> Option<Cow<str>>;\n    \n    // Editing\n    pub fn insert(&mut self, text: &str);\n    pub fn delete(&mut self);\n    pub fn backspace(&mut self);\n    pub fn delete_word_backward(&mut self);\n    pub fn delete_line(&mut self);\n    \n    // History\n    pub fn undo(&mut self) -> bool;\n    pub fn redo(&mut self) -> bool;\n    pub fn begin_transaction(&mut self);\n    pub fn commit_transaction(&mut self);\n}\n```\n\nImplementation notes:\n- All operations are grapheme-aware\n- Transaction groups multiple edits into one undo step\n- Selection is maintained as anchor (start) + cursor (head)\n\nDependencies: Rope, Cursor utilities, runeutil","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Cursor position management (byte offset and line/col)\n- [ ] Selection with anchor and head\n- [ ] Insert character at cursor\n- [ ] Insert text at cursor (multi-char)\n- [ ] Delete forward (Delete key)\n- [ ] Delete backward (Backspace)\n- [ ] Delete word forward/backward\n- [ ] Delete line\n- [ ] Move cursor: left/right/up/down/home/end\n- [ ] Move cursor by word\n- [ ] Select: shift+movement, select all, select word, select line\n- [ ] Cut, copy, paste operations\n- [ ] Undo/redo with history\n- [ ] Transaction grouping for compound operations\n\n### Grapheme Awareness\n- [ ] All operations respect grapheme boundaries\n- [ ] Wide characters handled correctly\n- [ ] Combining marks stay with base character\n- [ ] Cursor never positioned inside grapheme\n\n### History Requirements\n- [ ] Single undo step per logical operation\n- [ ] Undo groups by word boundaries for typing\n- [ ] Paste is single undo unit\n- [ ] Transaction commits as single undo unit\n- [ ] Redo cleared on new edit\n\n### Logging Requirements\n- [ ] tracing::debug! for cursor movement\n- [ ] tracing::debug! for selection changes\n- [ ] tracing::info! for undo/redo\n- [ ] tracing::trace! for individual edits\n\n### Test Coverage\n- [ ] Unit tests for all edit operations\n- [ ] Property test: cursor always valid\n- [ ] Property test: undo/redo inverse\n- [ ] Unicode corpus tests\n- [ ] Stress test: rapid editing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:43.801662252Z","created_by":"ubuntu","updated_at":"2026-01-31T23:21:09.549160880Z","closed_at":"2026-01-31T23:18:55.166682406Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.6","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:43.801662252Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.6","depends_on_id":"bd-3ky.5","type":"blocks","created_at":"2026-01-31T23:04:13.314121635Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.6","depends_on_id":"bd-6e9.7","type":"blocks","created_at":"2026-01-31T23:04:13.818753221Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.6","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:04:14.333680692Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.7","title":"Implement Unicode bidi algorithm","description":"Port the Unicode BiDi implementation from opentui_rust. BiDi (Bidirectional) handles mixed left-to-right and right-to-left text.\n\nReference: legacy_reference_library_code/opentui_rust/src/unicode/bidi.rs\n\nKey features to implement:\n1. Character bidi class detection\n2. Paragraph embedding level calculation\n3. Explicit directional formatting (LRE, RLE, PDF, etc.)\n4. Implicit directional runs\n5. Visual reordering for display\n6. Cursor movement in bidi text\n7. Selection in bidi text\n\nAPI Design (from opentui_rust):\n```rust\npub enum BidiClass {\n    L,   // Left-to-Right\n    R,   // Right-to-Left\n    AL,  // Arabic Letter\n    EN,  // European Number\n    AN,  // Arabic Number\n    // ... and more per UAX#9\n}\n\npub struct BidiParagraph {\n    text: String,\n    base_level: u8,\n    levels: Vec<u8>,\n}\n\nimpl BidiParagraph {\n    pub fn new(text: &str) -> Self;\n    pub fn reorder_line(&self, range: Range<usize>) -> Vec<(usize, usize)>;\n    pub fn visual_to_logical(&self, visual: usize) -> usize;\n    pub fn logical_to_visual(&self, logical: usize) -> usize;\n}\n```\n\nImplementation notes:\n- UAX#9 is complex; consider unicode-bidi crate\n- Most terminal content is LTR, so optimize for that case\n- BiDi is optional feature for internationalization\n\nDependencies: None (can use external crate)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:49.118921016Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.171979730Z","closed_at":"2026-01-31T23:18:55.171960965Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.7","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:49.118921016Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.8","title":"Implement Unicode normalization","description":"Port Unicode normalization from opentui_rust. Normalization ensures consistent representation of equivalent character sequences.\n\nReference: legacy_reference_library_code/opentui_rust/src/unicode/normalize.rs\n\nKey features to implement:\n1. NFC (Canonical Decomposition, followed by Canonical Composition)\n2. NFD (Canonical Decomposition)\n3. NFKC (Compatibility Decomposition + Canonical Composition)\n4. NFKD (Compatibility Decomposition)\n5. Quick check for already-normalized strings\n6. Streaming normalization for large inputs\n\nAPI Design (from opentui_rust):\n```rust\npub enum NormalizationForm {\n    NFC,\n    NFD,\n    NFKC,\n    NFKD,\n}\n\npub fn normalize(s: &str, form: NormalizationForm) -> Cow<str>;\npub fn is_normalized(s: &str, form: NormalizationForm) -> bool;\npub fn normalize_to(s: &str, form: NormalizationForm, out: &mut String);\n```\n\nImplementation notes:\n- Use unicode-normalization crate for heavy lifting\n- NFC is the most common form for display\n- Quick check avoids allocation for already-normalized strings\n\nDependencies: None (use external crate)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:01:54.782143835Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.176897760Z","closed_at":"2026-01-31T23:18:55.176882371Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.8","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:01:54.782143835Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3ky.9","title":"Implement Unicode text search","description":"Port Unicode-aware text search from opentui_rust. This provides proper substring matching that handles normalization and case folding.\n\nReference: legacy_reference_library_code/opentui_rust/src/unicode/search.rs\n\nKey features to implement:\n1. Case-insensitive search (Unicode case folding)\n2. Normalization-aware matching\n3. Whole word matching\n4. Regex search integration\n5. Find all matches with ranges\n6. Incremental search (find next/previous)\n7. Search within selection\n\nAPI Design (from opentui_rust):\n```rust\npub struct SearchOptions {\n    pub case_sensitive: bool,\n    pub whole_word: bool,\n    pub regex: bool,\n    pub wrap: bool,\n}\n\npub struct SearchResult {\n    pub start: usize,\n    pub end: usize,\n    pub line: usize,\n}\n\npub fn find(text: &str, pattern: &str, options: &SearchOptions) -> Vec<SearchResult>;\npub fn find_next(text: &str, pattern: &str, from: usize, options: &SearchOptions) -> Option<SearchResult>;\npub fn find_prev(text: &str, pattern: &str, from: usize, options: &SearchOptions) -> Option<SearchResult>;\n```\n\nImplementation notes:\n- Case folding uses Unicode's CaseFolding.txt data\n- Whole word uses Unicode word boundaries (UAX#29)\n- Normalize both pattern and text for matching\n\nDependencies: Unicode normalization, Word boundaries (runeutil)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:02:05.877682695Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:55.181802045Z","closed_at":"2026-01-31T23:18:55.181782718Z","close_reason":"Out of scope for FrankenTUI plan v1 (avoid port/widget creep); focus on ftui kernel/widgets/extras as defined in PLAN_TO_CREATE_FRANKENTUI__OPUS.md.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ky.9","depends_on_id":"bd-3ky","type":"parent-child","created_at":"2026-01-31T23:02:05.877682695Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.9","depends_on_id":"bd-3ky.8","type":"blocks","created_at":"2026-01-31T23:04:14.843910884Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-3ky.9","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:04:15.373466997Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-3mo","title":"Implement markup parsing for styled text","description":"PHASE 4/EXTRAS - MARKUP PARSER (Feature-gated)\n\n## Background\nMarkup parsing allows writing styled text with inline syntax like [bold]text[/bold] or Rich-style markup. Feature-gated as it's not needed by all apps.\n\n## Technical Requirements\n\n### Markup Syntax Options\n\n#### Option A: BBCode-style\n[bold]Bold text[/bold]\n[italic]Italic[/italic]\n[fg=red]Red text[/fg]\n[bg=#00ff00]Green background[/bg]\n[link=https://example.com]Click here[/link]\n\n#### Option B: Rich-style (Python Rich compatible)\n[bold]Bold[/bold]\n[red]Red text[/red]\n[on blue]Blue background[/on blue]\n[link=url]Link text[/link]\n[#ff0000]Hex color[/#ff0000]\n\n### Parser Structure\n\npub struct MarkupParser {\n    style_stack: Vec<Style>,\n    current_style: Style,\n}\n\nimpl MarkupParser {\n    /// Parse markup string into styled Text\n    pub fn parse(&mut self, input: &str) -> Result<Text, MarkupError> {\n        let mut spans = Vec::new();\n        let mut current_text = String::new();\n        \n        for token in self.tokenize(input)? {\n            match token {\n                Token::Text(s) => current_text.push_str(&s),\n                Token::StyleStart(style) => {\n                    if !current_text.is_empty() {\n                        spans.push(Span::styled(\n                            std::mem::take(&mut current_text),\n                            self.current_style.clone(),\n                        ));\n                    }\n                    self.style_stack.push(self.current_style.clone());\n                    self.current_style = self.current_style.merge(style);\n                }\n                Token::StyleEnd => {\n                    if !current_text.is_empty() {\n                        spans.push(Span::styled(\n                            std::mem::take(&mut current_text),\n                            self.current_style.clone(),\n                        ));\n                    }\n                    self.current_style = self.style_stack.pop().unwrap_or_default();\n                }\n            }\n        }\n        \n        Ok(Text::from_spans(spans))\n    }\n}\n\n### Error Handling\npub enum MarkupError {\n    UnmatchedTag { tag: String, position: usize },\n    InvalidColor { value: String },\n    InvalidAttribute { name: String },\n    NestedLinkNotAllowed,\n}\n\n### Extension: Emoji Shortcodes\nOptional: :smile: -> , :rocket: -> \n\npub fn expand_emoji(input: &str) -> Cow<str> {\n    // Fast path: no colons\n    if !input.contains(':') {\n        return Cow::Borrowed(input);\n    }\n    // Replace :name: patterns with Unicode\n}\n\n### Integration\n// Direct usage\nlet text = markup!(\"[bold]Hello[/bold] [red]world[/red]\");\n\n// Via Text\nlet text = Text::from_markup(\"[bold]Hello[/bold]\");\n\n// In widgets\nParagraph::new(markup!(\"[italic]Styled[/italic] text\"))\n\n## Tests Required\n- [ ] Bold tag parsing\n- [ ] Color name parsing\n- [ ] Hex color parsing\n- [ ] Nested tags\n- [ ] Unclosed tag error\n- [ ] Escape sequences (\\\\[)\n- [ ] Empty tags\n- [ ] Link with URL\n- [ ] Performance: 1000 char markup < 100s\n\n## Acceptance Criteria\n- [ ] BBCode-style syntax supported\n- [ ] All style attributes (fg, bg, bold, italic, underline)\n- [ ] Link parsing with URL extraction\n- [ ] Error handling with positions\n- [ ] Escape sequence support\n- [ ] Optional emoji expansion\n- [ ] Feature gate: markup\n\n## Location: ftui-text crate (feature = \"markup\")","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:37:44.886882212Z","created_by":"ubuntu","updated_at":"2026-01-31T22:37:56.617722024Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3mo","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:37:56.617685796Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9","title":"Bubbles Widget Collection (charmed_rust port)","description":"Epic for porting all bubbles widgets from charmed_rust. The bubbles library provides production-ready interactive widgets with full keyboard/mouse support, proper focus handling, and consistent styling. These widgets are battle-tested from the original Charm Go ecosystem and represent mature, ergonomic designs.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/\n\nKey design principles from bubbles:\n1. Each widget implements Model trait (Init/Update/View cycle)\n2. Widgets handle their own focus state and key bindings\n3. Consistent use of lipgloss styling via Style parameter\n4. Clean separation between state and presentation\n5. Event-driven updates with Cmd return values\n\nThis epic covers: TextArea, FilePicker, Help, Paginator, Stopwatch, Timer, Cursor utilities, and runeutil grapheme helpers. The viewport, textinput, list, table, progress, and spinner are covered by other beads.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-31T22:57:47.683736546Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.887923496Z","closed_at":"2026-01-31T23:23:10.887737195Z","close_reason":"Closing Bubbles widget collection epic: out of scope for plan v1; retained only the generic grapheme helper task under ftui-text.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9","depends_on_id":"bd-10i.6","type":"blocks","created_at":"2026-01-31T23:04:25.246802134Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.1","title":"Implement TextArea widget (multi-line text editor)","description":"Port the TextArea widget from charmed_rust bubbles. TextArea is a multi-line text input widget that provides full text editing capabilities including cursor movement, text selection, word wrapping, and viewport scrolling.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/textarea.rs\n\nKey features to implement:\n1. Multi-line text buffer with line management\n2. Cursor position tracking (row, column) with visual column handling\n3. Text selection with Shift+Arrow key support\n4. Word wrapping (soft wrap vs hard wrap modes)\n5. Viewport scrolling when content exceeds visible area\n6. Clipboard operations (copy, cut, paste via bracketed paste)\n7. Undo/redo stack for text operations\n8. Line numbering option\n9. Placeholder text support\n10. Character limit enforcement\n11. Input validation callbacks\n12. Focus state and blur handling\n\nAPI Design (from charmed_rust):\n```rust\npub struct TextArea {\n    value: String,\n    cursor_row: usize,\n    cursor_col: usize,\n    viewport_offset: usize,\n    selection: Option<Selection>,\n    width: u16,\n    height: u16,\n    max_height: Option<u16>,\n    char_limit: Option<usize>,\n    show_line_numbers: bool,\n    placeholder: String,\n    prompt: String,\n    focused: bool,\n    style: TextAreaStyle,\n}\n\npub struct TextAreaStyle {\n    base: Style,\n    focused: Style,\n    cursor: Style,\n    cursor_line: Style,\n    line_number: Style,\n    placeholder: Style,\n    selection: Style,\n}\n```\n\nDependencies: Style system (bd-10x), Text type (bd-2uk), Input handling (bd-10i.5.1)\n\nTesting requirements:\n- Multi-line text insertion and deletion\n- Cursor movement edge cases (start/end of line, document)\n- Word wrapping correctness with unicode\n- Selection spanning multiple lines\n- Viewport scrolling behavior\n- Undo/redo correctness","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] Multi-line text insertion and deletion works correctly\n- [ ] Cursor movement: left/right/up/down/home/end/word navigation\n- [ ] Text selection with Shift+Arrow, Ctrl+Shift+Arrow, Shift+Home/End\n- [ ] Word wrapping: soft wrap preserves buffer, hard wrap inserts newlines\n- [ ] Viewport scrolling follows cursor and supports manual scroll\n- [ ] Undo/redo: all operations reversible, undo groups by word boundaries\n- [ ] Clipboard: copy/cut/paste including bracketed paste support\n- [ ] Line numbers display option\n- [ ] Placeholder text shown when empty\n- [ ] Character limit enforcement prevents exceeding limit\n- [ ] Validation callback can reject invalid input\n\n### Unicode Requirements\n- [ ] ZWJ sequences (emoji families) treated as single grapheme\n- [ ] Wide characters (CJK) render as 2 cells\n- [ ] Combining characters handled correctly\n- [ ] RTL text renders correctly (if bidi enabled)\n\n### Performance Requirements\n- [ ] Typing latency < 5ms for buffers up to 100K characters\n- [ ] Scrolling latency < 16ms (60 FPS capable)\n- [ ] Memory: < 3x document size overhead\n\n### Logging Requirements\n- [ ] tracing::debug! for cursor position changes\n- [ ] tracing::debug! for selection changes\n- [ ] tracing::trace! for individual character insertions\n- [ ] tracing::info! for undo/redo operations\n- [ ] tracing::warn! for validation rejections\n\n### Test Coverage\n- [ ] Unit tests for all cursor movement functions\n- [ ] Property tests for undo/redo inverse\n- [ ] Integration test with real terminal input\n- [ ] Snapshot tests for visual output","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:58:07.169424449Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.249967694Z","closed_at":"2026-01-31T23:23:10.249949139Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.1","depends_on_id":"bd-10i.5","type":"blocks","created_at":"2026-01-31T23:14:44.057936907Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T23:03:47.305100847Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:03:46.260483541Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:03:46.789771048Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:07.169424449Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-6e9.7","type":"blocks","created_at":"2026-01-31T23:03:47.832993109Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.1","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:03:48.372243948Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.2","title":"Implement FilePicker widget","description":"Port the FilePicker widget from charmed_rust bubbles. FilePicker provides a directory browser interface for selecting files and folders with keyboard navigation.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/filepicker.rs\n\nKey features to implement:\n1. Directory listing with file/folder icons\n2. Keyboard navigation (up/down, enter to open, backspace to go up)\n3. File filtering by extension or pattern\n4. Hidden file toggle\n5. Current path display with breadcrumbs\n6. File metadata display (size, modified date)\n7. Multiple selection mode option\n8. Custom sort order (name, size, date, type)\n9. Permission checking and error display\n10. Symlink handling\n\nAPI Design:\n```rust\npub struct FilePicker {\n    current_dir: PathBuf,\n    entries: Vec<DirEntry>,\n    cursor: usize,\n    show_hidden: bool,\n    filter: Option<String>,\n    selected: Vec<PathBuf>,\n    allow_dirs: bool,\n    style: FilePickerStyle,\n}\n\npub enum FilePickerMsg {\n    Select(PathBuf),\n    Cancel,\n}\n```\n\nDependencies: List widget, Input handling\n\nNote: This is a P3 feature-gated widget for applications that need file selection UX. Not essential for agent harness but valuable for CLI tools.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:58:08.315042658Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.279347404Z","closed_at":"2026-01-31T23:23:10.279324100Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.2","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:08.315042658Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.3","title":"Implement Help widget (keybinding display)","description":"Port the Help widget from charmed_rust bubbles. Help displays a formatted list of keyboard shortcuts grouped by category, typically shown at the bottom of the screen or in a modal.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/help.rs\n\nKey features to implement:\n1. KeyBinding definition (key, description, optional group)\n2. Horizontal layout with separator between bindings\n3. Vertical stacked layout for longer lists\n4. Grouped bindings with headers\n5. Ellipsis truncation when exceeds width\n6. Full help toggle (show all vs show essential)\n7. Customizable key styling\n8. Customizable separator\n\nAPI Design:\n```rust\npub struct KeyBinding {\n    key: String,\n    help: String,\n}\n\npub struct Help {\n    bindings: Vec<KeyBinding>,\n    short_help: Vec<KeyBinding>,  // Subset for compact display\n    full_help: bool,\n    width: u16,\n    style: HelpStyle,\n}\n\npub struct HelpStyle {\n    key: Style,\n    desc: Style,\n    separator: Style,\n    ellipsis: String,\n}\n```\n\nDependencies: Style system, width measurement\n\nThis is essential for discoverability in interactive applications. The agent harness uses this to show available commands.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:58:13.947005157Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.284799119Z","closed_at":"2026-01-31T23:23:10.284763041Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.3","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:03:48.873064530Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.3","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:13.947005157Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.3","depends_on_id":"bd-v6y","type":"blocks","created_at":"2026-01-31T23:03:49.377591719Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.4","title":"Implement Paginator widget","description":"Port the Paginator widget from charmed_rust bubbles. Paginator displays page indicators (dots or numbers) for multi-page content.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/paginator.rs\n\nKey features to implement:\n1. Dot pagination (   )\n2. Numeric pagination (1/4)\n3. Range pagination with ellipsis (1 2 3 ... 10)\n4. Per-page items count display\n5. Keyboard shortcuts for page navigation\n6. Active page highlighting\n7. Customizable dot/separator characters\n\nAPI Design:\n```rust\npub struct Paginator {\n    page: usize,\n    per_page: usize,\n    total_items: usize,\n    style: PaginatorStyle,\n    use_dots: bool,\n    show_range: bool,\n}\n\nimpl Paginator {\n    pub fn total_pages(&self) -> usize;\n    pub fn set_page(&mut self, page: usize);\n    pub fn next_page(&mut self);\n    pub fn prev_page(&mut self);\n    pub fn items_on_current_page(&self) -> Range<usize>;\n}\n```\n\nDependencies: Style system\n\nEssential for list views, log viewers, and any content that requires pagination.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:58:19.200289100Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.289751223Z","closed_at":"2026-01-31T23:23:10.289711078Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.4","depends_on_id":"bd-10x","type":"blocks","created_at":"2026-01-31T23:03:49.892272907Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.4","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:19.200289100Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.5","title":"Implement Stopwatch widget","description":"Port the Stopwatch widget from charmed_rust bubbles. Stopwatch provides a running timer display that counts up from zero with start/stop/reset controls.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/stopwatch.rs\n\nKey features to implement:\n1. Start/stop/reset state machine\n2. Elapsed time display (HH:MM:SS.mmm formats)\n3. Lap time recording\n4. Tick subscription for updates\n5. Configurable precision (seconds/milliseconds/microseconds)\n6. Customizable format string\n7. Pause without reset\n\nAPI Design:\n```rust\npub struct Stopwatch {\n    start_time: Option<Instant>,\n    elapsed: Duration,\n    running: bool,\n    laps: Vec<Duration>,\n    format: TimeFormat,\n    style: Style,\n}\n\npub enum StopwatchMsg {\n    Start,\n    Stop,\n    Reset,\n    Lap,\n    Tick,\n}\n```\n\nDependencies: Runtime tick subscription (bd-27v)\n\nUseful for performance displays, long-running operation timing, and debugging tools.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:58:28.476889405Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.295093843Z","closed_at":"2026-01-31T23:23:10.295074577Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.5","depends_on_id":"bd-27v","type":"blocks","created_at":"2026-01-31T23:03:50.432150736Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.5","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:28.476889405Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.6","title":"Implement Timer widget (countdown)","description":"Port the Timer widget from charmed_rust bubbles. Timer provides a countdown timer display that counts down to zero with completion notification.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/timer.rs\n\nKey features to implement:\n1. Countdown from specified duration\n2. Start/pause/reset controls\n3. Remaining time display with multiple formats\n4. Completion callback/message\n5. Warning threshold styling (e.g., red when < 10 seconds)\n6. Optional auto-restart (interval mode)\n7. Tick subscription integration\n\nAPI Design:\n```rust\npub struct Timer {\n    duration: Duration,\n    remaining: Duration,\n    running: bool,\n    interval: Option<Duration>,  // For repeating timers\n    style: TimerStyle,\n}\n\npub struct TimerStyle {\n    normal: Style,\n    warning: Style,     // Applied when remaining < threshold\n    critical: Style,    // Applied when remaining < critical_threshold\n    completed: Style,\n}\n\npub enum TimerMsg {\n    Start,\n    Pause,\n    Reset,\n    Tick,\n    Timeout,  // Fired when timer reaches zero\n}\n```\n\nDependencies: Runtime tick subscription (bd-27v)\n\nUseful for timed operations, countdown displays, and Pomodoro-style applications.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:58:32.951730710Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.299894322Z","closed_at":"2026-01-31T23:23:10.299879815Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.6","depends_on_id":"bd-27v","type":"blocks","created_at":"2026-01-31T23:03:50.972298462Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.6","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:32.951730710Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.7","title":"Implement Cursor utilities module","description":"Port the cursor utilities from charmed_rust bubbles. This module provides cursor position calculation and movement helpers for text editing widgets.\n\nReference: legacy_reference_library_code/charmed_rust/crates/bubbles/src/cursor.rs\n\nKey features to implement:\n1. CursorPosition struct (row, column, visual_column)\n2. Visual column vs byte offset conversion\n3. Movement by character, word, line, paragraph\n4. Beginning/end of line/document movement\n5. Screen coordinate to buffer position mapping\n6. Cursor blink state management\n7. Multi-cursor support (for future extensibility)\n\nAPI Design:\n```rust\npub struct CursorPosition {\n    pub row: usize,\n    pub col: usize,        // Byte offset within line\n    pub visual_col: usize, // Display column (accounts for tabs, wide chars)\n}\n\nimpl CursorPosition {\n    pub fn move_left(&mut self, text: &str);\n    pub fn move_right(&mut self, text: &str);\n    pub fn move_up(&mut self, lines: &[&str]);\n    pub fn move_down(&mut self, lines: &[&str]);\n    pub fn move_word_left(&mut self, text: &str);\n    pub fn move_word_right(&mut self, text: &str);\n    pub fn move_to_line_start(&mut self);\n    pub fn move_to_line_end(&mut self, line: &str);\n}\n\npub enum CursorShape {\n    Block,\n    Underline,\n    Bar,\n}\n```\n\nDependencies: Unicode width calculation (bd-v6y), GraphemePool (bd-10i.3.5)\n\nThis is a foundational utility for TextInput, TextArea, and any text editing widget.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T22:58:40.485978763Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.305067753Z","closed_at":"2026-01-31T23:23:10.305049529Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.7","depends_on_id":"bd-10i.3.5","type":"blocks","created_at":"2026-01-31T23:03:51.958691160Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.7","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T22:58:40.485978763Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.7","depends_on_id":"bd-v6y","type":"blocks","created_at":"2026-01-31T23:03:51.458176794Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.8","title":"Implement grapheme segmentation helpers for ftui-text","description":"# Implement grapheme segmentation helpers for ftui-text\n\n## Background\nPlan requirements:\n- width correctness for emoji/ZWJ/combining marks is a stop-ship gate\n- ftui-text needs grapheme segmentation helpers for wrapping/truncation/alignment\n\nWe should isolate Unicode segmentation logic behind a small set of helpers so:\n- widgets/text algorithms stay readable\n- we can swap implementation details without touching call sites\n\n## Scope\nProvide utilities built on `unicode-segmentation` + `unicode-width`:\n- grapheme iteration\n- grapheme-aware truncation to display width\n- (optional) word boundaries / soft wrap points\n\nExample APIs (shape, not necessarily final):\n```rust\npub fn grapheme_count(s: &str) -> usize;\npub fn graphemes(s: &str) -> impl Iterator<Item = &str>;\npub fn display_width(s: &str) -> usize; // uses ASCII fast path where applicable (bd-v6y)\n\n/// Returns (prefix, width) where prefix fits within max_width.\npub fn truncate_to_width(s: &str, max_width: usize) -> (&str, usize);\n```\n\n## Non-goals\n- Full Unicode normalization/bidi/search subsystems (out of scope for plan v1)\n\n## Tests\n- Grapheme iteration matches expectations on:\n  - ASCII\n  - combining marks\n  - emoji + ZWJ sequences\n- truncate_to_width never splits mid-grapheme\n\n## Acceptance Criteria\n- [ ] Helpers exist and are used by Text wrapping/truncation code.\n- [ ] Unicode width corpus tests (bd-16k) can exercise these helpers.","acceptance_criteria":"## Acceptance Criteria\n\n### Functional Requirements\n- [ ] grapheme_count: Count grapheme clusters in string\n- [ ] grapheme_at: Get grapheme at index (0-based)\n- [ ] grapheme_slice: Extract grapheme range\n- [ ] word_boundaries: Iterator over word break positions\n- [ ] is_word_char: Classify grapheme as word character\n- [ ] display_width: Calculate display width in cells\n- [ ] truncate_to_width: Truncate to max display width\n\n### Unicode Requirements\n- [ ] ZWJ sequences treated as single grapheme ( = 1)\n- [ ] Combining marks attached to base (e +  = 1)\n- [ ] Emoji with skin tone = 1 grapheme\n- [ ] Regional indicators paired correctly ( = 1)\n- [ ] Word boundaries per UAX #29\n- [ ] Width per UAX #11 (East Asian Width)\n\n### Performance Requirements\n- [ ] grapheme_count: O(n) with < 10ns/grapheme\n- [ ] display_width: O(n) with width cache hits\n- [ ] truncate_to_width: O(n) worst case, O(log n) with cache\n\n### Caching Requirements\n- [ ] Width cache for common graphemes\n- [ ] LRU eviction for cache management\n- [ ] Cache hit rate > 90% for typical text\n\n### Logging Requirements\n- [ ] tracing::trace! for cache misses (debug builds)\n- [ ] tracing::debug! for unusual grapheme clusters\n- [ ] tracing::warn! for width lookup failures\n\n### Test Coverage\n- [ ] Corpus test: all Unicode grapheme break tests\n- [ ] Corpus test: East Asian Width edge cases\n- [ ] Property test: truncate never exceeds width\n- [ ] Property test: grapheme count >= 0\n- [ ] Benchmark: ASCII fast path performance","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:58:45.504414906Z","created_by":"ubuntu","updated_at":"2026-01-31T23:28:04.803939453Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.8","depends_on_id":"bd-10i.6","type":"parent-child","created_at":"2026-01-31T23:22:42.515214108Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.8","depends_on_id":"bd-16k","type":"blocks","created_at":"2026-01-31T23:28:04.803899969Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.8","depends_on_id":"bd-v6y","type":"blocks","created_at":"2026-01-31T23:27:57.730831268Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-6e9.9","title":"Bubbles Widget Test Suite","description":"Comprehensive test suite for all bubbles widgets. This ensures every widget is thoroughly tested with unit tests, property tests, integration tests, and e2e scenarios.\n\n## Testing Philosophy\nEvery widget must be tested at multiple levels:\n1. **Unit tests** - Individual method correctness\n2. **Property tests** - Invariant verification with random inputs\n3. **Integration tests** - Widget composition and interaction\n4. **E2E tests** - Full user workflow simulation\n5. **Snapshot tests** - Visual regression detection\n\n## Test Requirements by Widget\n\n### TextArea (bd-6e9.1)\nUnit tests:\n- `test_insert_single_char` - Insert at various cursor positions\n- `test_insert_multiline` - Insert text containing newlines\n- `test_delete_backward` - Backspace at line start joins lines\n- `test_delete_forward` - Delete at line end joins lines\n- `test_cursor_movement_horizontal` - Left/right wraps at line boundaries\n- `test_cursor_movement_vertical` - Up/down maintains visual column\n- `test_selection_shift_arrow` - Selection with shift+arrows\n- `test_selection_word` - Double-click word selection\n- `test_selection_line` - Triple-click line selection\n- `test_undo_single_char` - Undo groups by word boundaries\n- `test_undo_paste` - Paste is single undo unit\n- `test_redo_after_edit` - Redo branch is discarded on new edit\n- `test_word_wrap_soft` - Soft wrap doesn't modify buffer\n- `test_word_wrap_hard` - Hard wrap inserts actual newlines\n- `test_viewport_scroll_cursor_follow` - Viewport follows cursor\n- `test_unicode_grapheme_cluster` - ZWJ sequences treated as single char\n- `test_char_limit_enforcement` - Can't exceed limit\n- `test_validation_callback` - Validation prevents invalid input\n\nProperty tests:\n- `prop_insert_delete_inverse` - Insert then delete restores state\n- `prop_undo_redo_inverse` - Undo then redo restores state\n- `prop_cursor_always_valid` - Cursor never outside buffer bounds\n- `prop_selection_ordered` - Selection start <= end\n\nIntegration tests:\n- `test_textarea_in_form` - TextArea with other form widgets\n- `test_textarea_focus_blur` - Focus/blur event handling\n- `test_textarea_bracketed_paste` - Large paste via bracketed paste\n\nE2E tests:\n- `e2e_edit_document` - Open, edit, save workflow\n- `e2e_search_replace` - Find and replace across document\n\n### Help Widget (bd-6e9.3)\nUnit tests:\n- `test_single_binding_render` - Key + description formatting\n- `test_multiple_bindings_horizontal` - Separator between bindings\n- `test_binding_truncation` - Ellipsis when exceeds width\n- `test_grouped_bindings` - Group headers and sections\n- `test_full_help_toggle` - Short vs full help modes\n\n### Paginator (bd-6e9.4)\nUnit tests:\n- `test_dot_pagination_render` - Correct dots for each page\n- `test_numeric_pagination` - 'N/M' format\n- `test_range_pagination_ellipsis` - '1 2 3 ... 10' format\n- `test_page_navigation_bounds` - Can't go below 0 or above max\n- `test_items_on_page_calculation` - Correct item ranges\n\nProperty tests:\n- `prop_page_always_valid` - Page number always in valid range\n\n### Cursor Utilities (bd-6e9.7)\nUnit tests:\n- `test_visual_column_tabs` - Tab width affects visual column\n- `test_visual_column_wide_chars` - CJK chars are 2 columns\n- `test_move_word_left` - Stops at word boundaries\n- `test_move_word_right` - Skips punctuation correctly\n- `test_byte_to_char_offset` - Correct conversion for UTF-8\n\nProperty tests:\n- `prop_byte_char_roundtrip` - byte->char->byte is identity\n- `prop_visual_always_positive` - Visual column >= 0\n\n### runeutil (bd-6e9.8)\nUnit tests:\n- `test_grapheme_count_ascii` - ASCII string length\n- `test_grapheme_count_emoji` - ZWJ family is 1 grapheme\n- `test_grapheme_slice` - Correct slicing at grapheme boundaries\n- `test_word_boundary_english` - Word splits on spaces/punctuation\n- `test_word_boundary_cjk` - CJK characters are word boundaries\n- `test_display_width_ascii` - ASCII is 1 cell per char\n- `test_display_width_cjk` - CJK is 2 cells per char\n- `test_truncate_to_width` - Truncates at grapheme boundaries\n\nProperty tests:\n- `prop_truncate_never_exceeds` - Result width <= max_width\n- `prop_grapheme_count_non_negative` - Count >= 0\n\n## Logging Requirements\nAll tests must use structured logging with:\n- `tracing::debug!` for test setup/teardown\n- `tracing::info!` for key assertions\n- `tracing::warn!` for unexpected but non-fatal conditions\n- Test failures dump full state snapshot to logs\n\n## Coverage Targets\n- Line coverage: >= 90%\n- Branch coverage: >= 85%\n- Mutation testing survival: <= 20%\n\n## Test Harness\nUse `ftui-test` harness that provides:\n- Deterministic time (frozen or controlled advancement)\n- Mock terminal capabilities\n- Input simulation API\n- Output capture and assertion\n\nDependencies: All bubbles widgets, Testing infrastructure (bd-10i.11)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:15:20.100943766Z","created_by":"ubuntu","updated_at":"2026-01-31T23:23:10.309705756Z","closed_at":"2026-01-31T23:23:10.309685478Z","close_reason":"Closing charmed_rust Bubbles widget ports: out of scope for FrankenTUI plan v1 (avoid widget zoo); keep only kernel + harness-essential widgets.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6e9.9","depends_on_id":"bd-10i.11","type":"blocks","created_at":"2026-01-31T23:18:01.603690945Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9","type":"parent-child","created_at":"2026-01-31T23:15:20.100943766Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9.1","type":"blocks","created_at":"2026-01-31T23:18:04.060257239Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9.3","type":"blocks","created_at":"2026-01-31T23:18:04.692052140Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9.4","type":"blocks","created_at":"2026-01-31T23:18:05.281609862Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9.7","type":"blocks","created_at":"2026-01-31T23:18:05.881517041Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-6e9.9","depends_on_id":"bd-6e9.8","type":"blocks","created_at":"2026-01-31T23:18:06.483627147Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-7u8","title":"Implement cursor save/restore strategy (DEC vs ANSI vs emulated)","description":"# Implement Cursor Save/Restore Strategy\n\n## Background\nPlan Section 9.3 describes a critical cursor save/restore strategy for inline mode robustness. Terminals differ in which save/restore sequences they support reliably.\n\n## Problem Statement\nInline mode requires saving cursor position before drawing UI and restoring after. However:\n- DEC save/restore (\\`ESC 7\\` / \\`ESC 8\\`) is preferred but not universal\n- ANSI save/restore (\\`CSI s\\` / \\`CSI u\\`) is an alternative\n- Some terminals/muxes have quirks with either\n- Must handle failures gracefully\n\n## Layered Strategy (from Plan)\n\n### Layer 1: DEC Save/Restore (Preferred)\n\\`\\`\\`rust\nconst DEC_SAVE: &[u8] = b\"\\x1b7\";    // ESC 7 (DECSC)\nconst DEC_RESTORE: &[u8] = b\"\\x1b8\"; // ESC 8 (DECRC)\n\\`\\`\\`\n- Most widely supported on modern terminals\n- Saves more state (cursor position, attributes, charset)\n- Works in tmux/screen with passthrough\n\n### Layer 2: ANSI Save/Restore (Fallback)\n\\`\\`\\`rust\nconst ANSI_SAVE: &[u8] = b\"\\x1b[s\";    // CSI s\nconst ANSI_RESTORE: &[u8] = b\"\\x1b[u\"; // CSI u\n\\`\\`\\`\n- Less widely supported\n- Only saves cursor position (not attributes)\n- May conflict with some terminal modes\n\n### Layer 3: Emulated (Last Resort)\n\\`\\`\\`rust\n// Track cursor position explicitly\nstruct CursorTracker {\n    x: u16,\n    y: u16,\n}\n\nimpl CursorTracker {\n    fn save(&mut self, current_x: u16, current_y: u16) {\n        self.x = current_x;\n        self.y = current_y;\n    }\n    \n    fn restore(&self, writer: &mut impl Write) -> io::Result<()> {\n        write!(writer, \"\\x1b[{};{}H\", self.y + 1, self.x + 1)\n    }\n}\n\\`\\`\\`\n- Works everywhere that supports CUP\n- Requires tracking cursor position throughout\n- More overhead but guaranteed to work\n\n## Strategy Selection\n\\`\\`\\`rust\npub enum CursorSaveStrategy {\n    Dec,       // ESC 7 / ESC 8\n    Ansi,      // CSI s / CSI u\n    Emulated,  // Track and CUP\n    Auto,      // Detect best for environment\n}\n\nimpl CursorSaveStrategy {\n    pub fn detect(caps: &TerminalCapabilities) -> Self {\n        // Most terminals support DEC\n        if !caps.in_screen {\n            return Self::Dec;\n        }\n        // Screen has quirks, try ANSI\n        Self::Ansi\n    }\n}\n\\`\\`\\`\n\n## Implementation\n\\`\\`\\`rust\npub struct CursorManager {\n    strategy: CursorSaveStrategy,\n    saved_position: Option<(u16, u16)>,  // For emulated mode\n}\n\nimpl CursorManager {\n    pub fn save(&mut self, writer: &mut impl Write, current_pos: (u16, u16)) -> io::Result<()> {\n        match self.strategy {\n            CursorSaveStrategy::Dec => writer.write_all(DEC_SAVE),\n            CursorSaveStrategy::Ansi => writer.write_all(ANSI_SAVE),\n            CursorSaveStrategy::Emulated => {\n                self.saved_position = Some(current_pos);\n                Ok(())\n            }\n            CursorSaveStrategy::Auto => {\n                // Try DEC, it's most common\n                writer.write_all(DEC_SAVE)\n            }\n        }\n    }\n    \n    pub fn restore(&mut self, writer: &mut impl Write) -> io::Result<()> {\n        match self.strategy {\n            CursorSaveStrategy::Dec => writer.write_all(DEC_RESTORE),\n            CursorSaveStrategy::Ansi => writer.write_all(ANSI_RESTORE),\n            CursorSaveStrategy::Emulated => {\n                if let Some((x, y)) = self.saved_position {\n                    write!(writer, \"\\x1b[{};{}H\", y + 1, x + 1)?;\n                }\n                Ok(())\n            }\n            CursorSaveStrategy::Auto => writer.write_all(DEC_RESTORE),\n        }\n    }\n}\n\\`\\`\\`\n\n## PTY Test: Cursor Restoration\nTest that verifies cursor is correctly restored:\n1. Move cursor to known position\n2. Save cursor\n3. Move cursor elsewhere\n4. Restore cursor\n5. Query position (DSR) and verify matches saved position\n\n## Tests Required\n- [ ] DEC save/restore works on xterm-like terminals\n- [ ] ANSI save/restore works as fallback\n- [ ] Emulated mode tracks and restores correctly\n- [ ] Auto-detection chooses appropriate strategy\n- [ ] PTY test verifies cursor contract per strategy\n\n## Acceptance Criteria\n- [ ] CursorManager implemented with all three strategies\n- [ ] Auto-detection based on TerminalCapabilities\n- [ ] Integrated into InlinePresenter\n- [ ] PTY tests pass for all strategies\n- [ ] Documented which terminals use which strategy\n\n## Location\n\\`ftui-core/src/cursor.rs\\`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:18:52.006565139Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:59.328003692Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-7u8","depends_on_id":"bd-10i.2.5","type":"blocks","created_at":"2026-01-31T23:18:59.327962044Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-cw8","title":"Implement Markdown renderer","description":"PHASE 7 EXTRAS - MARKDOWN RENDERER\n\n## Background\nMarkdown rendering is essential for agent harness UIs that display documentation, help text, and AI-generated content.\n\n## Technical Requirements\n\n### Supported Markdown Elements\n- Headers (h1-h6) with styled text\n- Bold, italic, strikethrough, code\n- Links (rendered as OSC 8 hyperlinks if supported)\n- Code blocks with syntax highlighting (optional)\n- Lists (ordered and unordered)\n- Blockquotes\n- Horizontal rules\n- Tables (basic)\n\n### Parser Choice\n- Use pulldown-cmark for parsing (battle-tested)\n- Convert events to ftui Text/Spans\n\n### Renderer Structure\n\npub struct MarkdownRenderer {\n    theme: MarkdownTheme,\n    code_theme: Option<SyntaxTheme>,\n    link_style: Style,\n    max_width: Option<u16>,\n}\n\npub struct MarkdownTheme {\n    h1: Style,\n    h2: Style,\n    h3: Style,\n    // ...\n    code_inline: Style,\n    code_block: Style,\n    blockquote: Style,\n    link: Style,\n}\n\nimpl MarkdownRenderer {\n    pub fn render(&self, markdown: &str) -> Text {\n        // Parse markdown\n        // Convert to styled spans\n        // Handle line breaks and wrapping\n    }\n    \n    pub fn render_to_buffer(&self, markdown: &str, area: Rect, buf: &mut Buffer) {\n        // Render directly to buffer with area constraints\n    }\n}\n\n### Widget Integration\n\npub struct Markdown<'a> {\n    content: &'a str,\n    renderer: MarkdownRenderer,\n}\n\nimpl Widget for Markdown<'_> {\n    fn render(self, area: Rect, buf: &mut Buffer) {\n        self.renderer.render_to_buffer(self.content, area, buf);\n    }\n}\n\n### Syntax Highlighting Integration\nOptional feature: syntax-highlight\n\n#[cfg(feature = \"syntax-highlight\")]\npub fn highlight_code_block(code: &str, language: &str) -> Text {\n    // Use syntect or tree-sitter\n}\n\n## Tests Required\n- [ ] Headers render with correct styles\n- [ ] Bold/italic/code inline\n- [ ] Links extracted and styled\n- [ ] Code blocks rendered\n- [ ] Lists with bullets/numbers\n- [ ] Nested lists\n- [ ] Tables basic rendering\n- [ ] Long content wraps correctly\n\n## Acceptance Criteria\n- [ ] All common Markdown elements\n- [ ] Themeable rendering\n- [ ] OSC 8 links (when supported)\n- [ ] Optional syntax highlighting\n- [ ] Feature gate: markdown\n\n## Location: ftui-extras crate (feature = \"markdown\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:38:39.511264647Z","created_by":"ubuntu","updated_at":"2026-01-31T22:39:21.703572700Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-cw8","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:39:21.703540850Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-e211","title":"Implement Text wrapping and truncation with ZWJ/emoji/combining mark correctness","description":"# Implement Text Wrapping and Truncation with Width Correctness\n\n## Background\nPlan Section F and Chapter 11 emphasize that text wrapping and truncation must be WIDTH-CORRECT for ZWJ sequences, emoji, and combining marks. This is a non-negotiable for Unicode correctness.\n\n## Problem Statement\nBreaking text at arbitrary byte or codepoint boundaries corrupts display:\n- ZWJ sequences () are single graphemes but multiple codepoints\n- Combining marks ( = e + ) must stay with base char\n- Regional indicators () are pairs of codepoints\n- CJK characters are 2 cells wide\n\n## Requirements\n\n### Wrapping Rules\n1. Never break inside a grapheme cluster\n2. Respect cell width (CJK = 2 cells)\n3. Handle ZWJ sequences as atomic units\n4. Word-wrap at whitespace when possible\n5. Character-wrap as fallback for long words\n\n### Truncation Rules\n1. Truncate at grapheme boundary only\n2. Ellipsis () counts as 1 cell\n3. If content + ellipsis > width, drop graphemes until it fits\n4. Never leave partial grapheme displayed\n\n## Implementation\n\n### Text Wrapping\n```rust\npub fn wrap_text(text: &str, width: usize) -> Vec<String> {\n    let mut lines = Vec::new();\n    let mut current_line = String::new();\n    let mut current_width = 0;\n    \n    for grapheme in text.graphemes(true) {\n        let grapheme_width = unicode_width::UnicodeWidthStr::width(grapheme);\n        \n        if current_width + grapheme_width > width {\n            // Line full, start new line\n            if !current_line.is_empty() {\n                lines.push(std::mem::take(&mut current_line));\n            }\n            current_width = 0;\n        }\n        \n        current_line.push_str(grapheme);\n        current_width += grapheme_width;\n    }\n    \n    if !current_line.is_empty() {\n        lines.push(current_line);\n    }\n    \n    lines\n}\n```\n\n### Text Truncation\n```rust\npub fn truncate_text(text: &str, max_width: usize, ellipsis: &str) -> String {\n    let text_width = unicode_width::UnicodeWidthStr::width(text);\n    \n    if text_width <= max_width {\n        return text.to_string();\n    }\n    \n    let ellipsis_width = unicode_width::UnicodeWidthStr::width(ellipsis);\n    let target_width = max_width.saturating_sub(ellipsis_width);\n    \n    let mut result = String::new();\n    let mut current_width = 0;\n    \n    for grapheme in text.graphemes(true) {\n        let grapheme_width = unicode_width::UnicodeWidthStr::width(grapheme);\n        \n        if current_width + grapheme_width > target_width {\n            break;\n        }\n        \n        result.push_str(grapheme);\n        current_width += grapheme_width;\n    }\n    \n    result.push_str(ellipsis);\n    result\n}\n```\n\n## Test Cases Required\n\n### Wrapping Tests\n- [ ] ASCII text wraps at word boundaries\n- [ ] CJK text wraps correctly (each char = 2 cells)\n- [ ] Emoji never split mid-sequence\n- [ ] ZWJ family emoji () wrap as unit\n- [ ] Combining marks stay with base ()\n- [ ] Regional indicators () wrap as pair\n- [ ] Long words wrap mid-word correctly\n- [ ] Empty lines preserved\n\n### Truncation Tests\n- [ ] Short text unchanged\n- [ ] Long ASCII truncated with ellipsis\n- [ ] CJK truncated at grapheme boundary\n- [ ] Emoji truncated correctly\n- [ ] ZWJ sequence truncated as unit\n- [ ] Ellipsis fits within width\n- [ ] Edge case: width < ellipsis width\n\n### Comprehensive Corpus (from bd-16k)\n- [ ] All ASCII printable characters\n- [ ] Common CJK (, , )\n- [ ] Common emoji (, , , )\n- [ ] ZWJ sequences (, , )\n- [ ] Skin tone modifiers (, )\n- [ ] Combining diacritics (, , )\n- [ ] Variation selectors\n- [ ] Zero-width characters (ZWSP, ZWNJ)\n\n## Dependencies\n- Uses unicode-segmentation crate for graphemes()\n- Uses unicode-width crate for width measurement\n- Integrates with LRU width cache (bd-1oz)\n\n## Acceptance Criteria\n- [ ] wrap_text() is grapheme-correct\n- [ ] truncate_text() is grapheme-correct\n- [ ] All test cases pass\n- [ ] Integrated into Text type (bd-2uk)\n- [ ] Performance: < 10s for typical text (cached)\n\n## Location\n`ftui-text/src/wrap.rs`","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T23:20:21.625908161Z","created_by":"ubuntu","updated_at":"2026-01-31T23:27:59.159987979Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-e211","depends_on_id":"bd-1oz","type":"blocks","created_at":"2026-01-31T23:20:27.585419330Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-e211","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:27:59.159939288Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-fbp","title":"Implement inline mode overlay redraw baseline","description":"PHASE 2.5 - INLINE MODE IMPLEMENTATION (CRITICAL)\n\n## Background\nInline mode is a NON-NEGOTIABLE requirement. The overlay redraw baseline is the correctness foundation that works everywhere, before optimization.\n\n## Technical Requirements (from Plan Section D)\n\n### Overlay Redraw Strategy\n1. Save cursor position (DECSC or manual tracking)\n2. Move cursor to UI region start\n3. Clear UI region only (never full screen!)\n4. Render UI frame\n5. Restore cursor position (DECRC)\n\n### UI Region Anchoring\n- Bottom-anchored (default): UI at bottom, logs scroll above\n- Top-anchored (optional): UI at top, logs scroll below\n- Configurable height: ui_height parameter\n\n### Log Write Coordination\nwrite_log() must:\n1. Suspend UI temporarily\n2. Print log line to scrollback region\n3. Re-render UI in its anchored position\n4. Maintain cursor contract\n\n### Cursor Contract\nAfter any present():\n- Cursor is at the correct position per active policy\n- UI region is intact\n- Scrollback is preserved\n\n### Never Clear Full Screen\nThe DECRC/ED2 pattern that clears full screen is FORBIDDEN in inline mode.\nOnly clear the bounded UI region using EL (erase line) or localized ED.\n\n## Implementation\n\npub struct InlinePresenter {\n    ui_height: u16,\n    anchor: Anchor,  // Bottom or Top\n    cursor_saved: bool,\n}\n\nimpl InlinePresenter {\n    pub fn present(&mut self, buffer: &Buffer, writer: &mut TerminalWriter) {\n        // 1. Save cursor\n        writer.write_all(b\"\\x1b7\")?;  // DECSC\n        \n        // 2. Move to UI region\n        let (_, term_height) = writer.size();\n        let ui_start = match self.anchor {\n            Anchor::Bottom => term_height - self.ui_height,\n            Anchor::Top => 0,\n        };\n        writer.move_to(0, ui_start)?;\n        \n        // 3. Clear UI region only (line by line)\n        for row in 0..self.ui_height {\n            writer.write_all(b\"\\x1b[2K\")?;  // EL - clear line\n            if row < self.ui_height - 1 {\n                writer.write_all(b\"\\n\")?;\n            }\n        }\n        \n        // 4. Move back and render\n        writer.move_to(0, ui_start)?;\n        // ... emit diff ...\n        \n        // 5. Restore cursor\n        writer.write_all(b\"\\x1b8\")?;  // DECRC\n    }\n}\n\n## Tests Required\n- [ ] UI renders at correct position (bottom/top)\n- [ ] Scrollback is preserved after present()\n- [ ] Cursor returns to correct position\n- [ ] Log writes don't corrupt UI\n- [ ] Resize re-anchors correctly\n- [ ] PTY test: verify no scrollback corruption\n\n## Acceptance Criteria\n- [ ] Overlay redraw works on all terminals\n- [ ] Cursor contract maintained\n- [ ] UI region bounded, never full-screen clear\n- [ ] Log coordination implemented\n- [ ] PTY tests pass\n\n## Performance Budget\n- Overlay redraw: < 2ms (acceptable for correctness baseline)\n\n## Location: ftui-render crate","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-31T22:30:23.970211625Z","created_by":"ubuntu","updated_at":"2026-01-31T23:18:59.949872182Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-fbp","depends_on_id":"bd-10i.10.1","type":"blocks","created_at":"2026-01-31T22:32:18.333877686Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-fbp","depends_on_id":"bd-10i.4.3","type":"blocks","created_at":"2026-01-31T22:32:18.052629717Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-fbp","depends_on_id":"bd-7u8","type":"blocks","created_at":"2026-01-31T23:18:59.949835924Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-gpe","title":"Implement TextInput widget (agent harness essential)","description":"# Implement TextInput Widget (Agent Harness Essential)\n\n## Background\nTextInput is explicitly called out in the plan as an \"agent harness essential\" widget. It provides single-line text input for command prompts, search boxes, and user input fields. This is critical for Claude Code / Codex-style agent harness UIs.\n\n## Why Elevated Priority\nThe plan states under \"H) Widgets (v1 essentials)\":\n- \"Text input / prompt line\" is a REQUIRED widget for v1\n- Agent harnesses need a way for users to type input\n- This is part of the \"minimum harness primitives\" contract\n\n## Technical Design\n\n```rust\npub struct TextInput {\n    /// Current text content\n    value: String,\n    /// Cursor position (byte offset)\n    cursor: usize,\n    /// Selection anchor (byte offset), None if no selection\n    selection_anchor: Option<usize>,\n    /// Placeholder text when empty\n    placeholder: Option<String>,\n    /// Password mode (mask characters)\n    masked: bool,\n    /// Mask character for password mode\n    mask_char: char,\n    /// Style for text\n    style: Style,\n    /// Style for cursor\n    cursor_style: Style,\n    /// Style for placeholder\n    placeholder_style: Style,\n    /// Maximum length (characters)\n    max_length: Option<usize>,\n}\n```\n\n## API Design\n```rust\nimpl TextInput {\n    pub fn new() -> Self;\n    pub fn value(&self) -> &str;\n    pub fn set_value(&mut self, value: impl Into<String>);\n    pub fn placeholder(self, text: impl Into<String>) -> Self;\n    pub fn masked(self) -> Self;\n    pub fn max_length(self, len: usize) -> Self;\n    \n    // Cursor operations\n    pub fn move_cursor_left(&mut self);\n    pub fn move_cursor_right(&mut self);\n    pub fn move_cursor_start(&mut self);\n    pub fn move_cursor_end(&mut self);\n    pub fn move_cursor_word_left(&mut self);\n    pub fn move_cursor_word_right(&mut self);\n    \n    // Editing operations\n    pub fn insert_char(&mut self, c: char);\n    pub fn delete_char_before(&mut self);  // backspace\n    pub fn delete_char_after(&mut self);   // delete\n    pub fn delete_word_before(&mut self);  // ctrl+backspace\n    pub fn clear(&mut self);\n    \n    // Selection operations\n    pub fn select_all(&mut self);\n    pub fn selected_text(&self) -> Option<&str>;\n    pub fn delete_selection(&mut self);\n}\n\nimpl Renderable for TextInput {\n    fn measure(&self, ctx: &RenderContext) -> Measurement;\n    fn render(&self, ctx: &RenderContext, rect: Rect, buffer: &mut Buffer);\n}\n```\n\n## Rendering Behavior\n- Shows current value with cursor at position\n- Cursor blinks (controlled by runtime tick)\n- Selection highlighted with reverse video\n- Placeholder shown in muted style when empty\n- Password mode shows mask_char instead of actual characters\n- Scrolls horizontally if text exceeds width\n\n## Cursor Contract\nAfter render, Frame::cursor_position should be set to the TextInput cursor location so the terminal cursor appears at the right place.\n\n## Event Handling Pattern\n```rust\n// In parent Model::update\nEvent::Key(key) if focused => {\n    match key.code {\n        KeyCode::Char(c) if !key.modifiers.contains(Modifiers::CTRL) => {\n            self.input.insert_char(c);\n        }\n        KeyCode::Backspace => self.input.delete_char_before(),\n        KeyCode::Delete => self.input.delete_char_after(),\n        KeyCode::Left => self.input.move_cursor_left(),\n        KeyCode::Right => self.input.move_cursor_right(),\n        KeyCode::Home => self.input.move_cursor_start(),\n        KeyCode::End => self.input.move_cursor_end(),\n        // ... etc\n    }\n}\n```\n\n## Tests Required\n- [ ] Empty input renders placeholder\n- [ ] Text insertion at cursor position\n- [ ] Cursor movement (all directions)\n- [ ] Word-wise cursor movement\n- [ ] Backspace and delete\n- [ ] Selection with shift+arrow\n- [ ] Password mode masking\n- [ ] Max length enforcement\n- [ ] Unicode handling (grapheme-aware)\n- [ ] Horizontal scroll when text exceeds width\n- [ ] Cursor position reported to Frame\n\n## Acceptance Criteria\n- [ ] Basic text entry works\n- [ ] Cursor rendering and blinking\n- [ ] All keyboard shortcuts functional\n- [ ] Placeholder support\n- [ ] Password mode\n- [ ] Frame cursor position set correctly\n- [ ] Unit tests pass\n- [ ] Integration with runtime event loop\n\n## Location: ftui-widgets crate","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:50:16.110227001Z","created_by":"ubuntu","updated_at":"2026-01-31T22:53:50.107043545Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-gpe","depends_on_id":"bd-10i.5.1","type":"blocks","created_at":"2026-01-31T22:53:49.333671503Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-gpe","depends_on_id":"bd-10i.7","type":"parent-child","created_at":"2026-01-31T22:53:50.107013218Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-gpe","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:53:49.726151291Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-jbg","title":"Implement forms and picker widgets","description":"PHASE 7 - EXTRAS: FORMS AND PICKERS\n\n## Background\nInteractive forms and picker dialogs are common UI patterns for configuration, data entry, and selection. Feature-gated as optional extra.\n\n## Technical Requirements\n\n### Form Widget\n- Field types: TextInput, Checkbox, Radio, Select, Number\n- Validation support with error messages\n- Tab navigation between fields\n- Submit/Cancel actions\n- Vertical or horizontal layout\n- Required field indicators\n\n### Form API\n\npub struct Form {\n    fields: Vec<FormField>,\n    focused: usize,\n    on_submit: Option<Box<dyn Fn(&FormData)>>,\n}\n\npub enum FormField {\n    Text { label: String, value: String, placeholder: Option<String> },\n    Checkbox { label: String, checked: bool },\n    Radio { label: String, options: Vec<String>, selected: usize },\n    Select { label: String, options: Vec<String>, selected: usize },\n    Number { label: String, value: i64, min: Option<i64>, max: Option<i64> },\n}\n\nimpl Form {\n    pub fn new(fields: Vec<FormField>) -> Self;\n    pub fn focus_next(&mut self);\n    pub fn focus_prev(&mut self);\n    pub fn submit(&self) -> FormData;\n    pub fn validate(&self) -> Vec<ValidationError>;\n}\n\n### Picker Widgets\n- FilePicker: Browse filesystem with filtering\n- ColorPicker: Visual color selection\n- DatePicker: Calendar-based date selection\n- ConfirmDialog: Yes/No confirmation\n\n### Picker API\n\npub struct FilePicker {\n    current_dir: PathBuf,\n    filter: Option<String>,  // glob pattern\n    show_hidden: bool,\n    selection: Option<PathBuf>,\n}\n\nimpl FilePicker {\n    pub fn new(start_dir: impl AsRef<Path>) -> Self;\n    pub fn filter(mut self, pattern: &str) -> Self;\n    pub fn show_hidden(mut self, show: bool) -> Self;\n    pub fn selected(&self) -> Option<&Path>;\n}\n\n## Tests Required\n- [ ] Form field navigation works\n- [ ] Validation errors display correctly\n- [ ] Submit collects all values\n- [ ] FilePicker navigates directories\n- [ ] ColorPicker returns valid RGB\n\n## Acceptance Criteria\n- [ ] All form field types implemented\n- [ ] Keyboard navigation complete\n- [ ] FilePicker with glob filtering\n- [ ] ConfirmDialog with Yes/No\n- [ ] Accessible focus indicators\n\n## Location: ftui-extras crate (feature = \"forms\")","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-31T22:44:26.319113364Z","created_by":"ubuntu","updated_at":"2026-01-31T22:44:38.747722333Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-jbg","depends_on_id":"bd-376","type":"blocks","created_at":"2026-01-31T22:44:37.248828520Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-jbg","depends_on_id":"bd-yzu","type":"blocks","created_at":"2026-01-31T22:44:38.747690513Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-tb84","title":"v1 Definition of Done (Ship Checklist)","description":"# v1 Definition of Done (Ship Checklist)\n\n## Background\nPlan Section 0.11 defines when ftui \"v1\" is done. This is the comprehensive checklist that must be completed before tagging v1.0.0.\n\n## Definition of Done Criteria\n\n### 1. Inline Mode Default is Stable\n- [ ] Streaming logs + UI chrome does not corrupt scrollback\n- [ ] Streaming logs + UI chrome does not corrupt cursor placement\n- [ ] PTY tests confirm behavior on normal exit\n- [ ] PTY tests confirm behavior on panic\n- [ ] Tested on: Linux (xterm-like), macOS Terminal, tmux, screen\n- [ ] No flicker under sustained log output\n- [ ] Resize during logging re-anchors correctly\n\n**Verified by:** bd-2gx Gate 1, bd-fbp, bd-10i.11.2\n\n### 2. Diff/Presenter Correctness Validated\n- [ ] Terminal-model tests for supported sequences pass\n- [ ] Property tests with random buffers pass\n- [ ] Output size baselines for representative workloads documented\n- [ ] Style state never leaks across runs\n- [ ] OSC 8 links properly managed (open/close)\n\n**Verified by:** bd-2gx Gate 2, bd-10i.11.1, bd-10i.4.3\n\n### 3. Unicode Width Correctness Proven\n- [ ] Corpus tests cover ZWJ sequences\n- [ ] Corpus tests cover emoji\n- [ ] Corpus tests cover combining marks\n- [ ] No off-by-one wrapping errors\n- [ ] Truncation at correct grapheme boundaries\n\n**Verified by:** bd-2gx Gate 3, bd-16k, bd-2uk\n\n### 4. Style System is Deterministic and Documented\n- [ ] Explicit masks documented\n- [ ] Inheritance rules documented\n- [ ] Style merge is deterministic (same input = same output)\n- [ ] Theme resolution documented\n- [ ] No \"heisenbug\" style flickers\n\n**Verified by:** bd-10x, bd-22q\n\n### 5. Runtime Supports Required Features\n- [ ] update/view loop works\n- [ ] Ticks scheduling works\n- [ ] Batch commands work\n- [ ] Sequence commands work\n- [ ] Deterministic simulator works\n- [ ] Snapshot tests work\n\n**Verified by:** bd-10i.8.2, bd-10i.8.3\n\n### 6. Core Widgets for Harness UIs Exist and Tested\n- [ ] Viewport/log viewer: bd-29v\n- [ ] Status line / panel: bd-2dc\n- [ ] Text input / prompt line: bd-gpe\n- [ ] Progress: bd-35p\n- [ ] Spinner: bd-35p\n- [ ] All widgets have snapshot tests\n\n**Verified by:** bd-10i.7 (Phase 5)\n\n### 7. Documentation Complete\n- [ ] \"Build an agent harness UI\" tutorial: bd-wo2\n- [ ] Inline vs alt-screen explanation: bd-1u5\n- [ ] IO ownership and one-writer rule guidance: bd-10i.12.6\n- [ ] Windows limitations documented: bd-2ss\n- [ ] API documentation (rustdoc) complete\n\n**Verified by:** bd-10i.12 (Docs epic)\n\n### 8. Quality Gates Pass (All Four)\n- [ ] Gate 1: Inline mode stability\n- [ ] Gate 2: Diff/presenter correctness\n- [ ] Gate 3: Unicode width correctness\n- [ ] Gate 4: Terminal cleanup\n\n**Verified by:** bd-2gx\n\n### 9. Performance Budgets Met\n- [ ] Present (8024, 5% changed): p50 < 1.0ms, p99 < 3.0ms\n- [ ] Present (12040, 5% changed): p50 < 2.0ms, p99 < 6.0ms\n- [ ] Cell comparison: < 1ns\n- [ ] Input parse: < 100s/event\n\n**Verified by:** bd-19x (benchmarks)\n\n### 10. CI/CD Complete\n- [ ] All tests pass on Linux, macOS, Windows\n- [ ] Coverage meets thresholds\n- [ ] Benchmarks run and tracked\n- [ ] Release workflow configured\n- [ ] Dependabot configured\n\n**Verified by:** bd-xn2\n\n## Ship Process\n1. Create v1 tracking issue listing all criteria\n2. Verify all beads above are closed\n3. Run full test suite on all platforms\n4. Update CHANGELOG.md with v1 release notes\n5. Tag v1.0.0\n6. Publish to crates.io\n\n## Acceptance Criteria\n- [ ] All 10 sections verified green\n- [ ] No P0 or P1 issues open\n- [ ] v1.0.0 tagged and published","status":"open","priority":0,"issue_type":"docs","created_at":"2026-01-31T23:19:32.880914588Z","created_by":"ubuntu","updated_at":"2026-01-31T23:19:40.669006523Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-tb84","depends_on_id":"bd-10i.12","type":"blocks","created_at":"2026-01-31T23:19:40.668966638Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-tb84","depends_on_id":"bd-19x","type":"blocks","created_at":"2026-01-31T23:19:39.357620264Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-tb84","depends_on_id":"bd-2gx","type":"blocks","created_at":"2026-01-31T23:19:38.747696054Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-tb84","depends_on_id":"bd-xn2","type":"blocks","created_at":"2026-01-31T23:19:39.952586690Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-v6y","title":"Implement ASCII width fast-path optimization","description":"# Implement ASCII Width Fast-Path Optimization\n\n## Background\nThe plan emphasizes that ASCII must dominate common workloads:\n- Section 0.12: \"ASCII fast-path must remain allocation-free and dominate common workloads\"\n- Section 4.3: ASCII width is a major optimization opportunity\n\nMost harness/log output is ASCII. For ASCII:\n- display width == byte length\n- no grapheme segmentation needed\n- no Unicode tables needed\n\n## Scope\n- Provide a fast, allocation-free `ascii_width` / `display_width` helper.\n- Integrate it into text measurement / wrapping / truncation hot paths.\n\n## Design\n### Core API\n```rust\n/// Returns Some(width) if s is pure ASCII; otherwise None.\n#[inline]\npub fn ascii_width(s: &str) -> Option<usize> {\n    let bytes = s.as_bytes();\n    if bytes.iter().all(|&b| b < 0x80) {\n        Some(bytes.len())\n    } else {\n        None\n    }\n}\n\n#[inline]\npub fn display_width(s: &str) -> usize {\n    ascii_width(s).unwrap_or_else(|| unicode_width::UnicodeWidthStr::width(s))\n}\n```\n\n### Performance notes\n- ASCII detection is O(n) but extremely cheap (tight loop over bytes).\n- Optional micro-optimizations (still safe): use `memchr` or portable SIMD via `std::simd` if available.\n- **Repo policy: unsafe is forbidden**, so any SIMD path must be safe or it is out of scope.\n\n## Integration points\n- Segment/Text measurement\n- Wrapping/truncation (byte-fast for ASCII)\n- Viewport/log viewer rendering\n\n## Tests\n- Pure ASCII returns correct width\n- Mixed ASCII/Unicode returns None from `ascii_width`\n- Empty string returns Some(0)\n- Integration tests: wrapping/truncation correctness unchanged\n\n## Acceptance Criteria\n- [ ] `ascii_width` and `display_width` exist.\n- [ ] ASCII path is allocation-free.\n- [ ] Non-ASCII path matches `unicode_width`.\n- [ ] Integrated into the ftui-text measurement code paths.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-31T22:52:10.389324927Z","created_by":"ubuntu","updated_at":"2026-01-31T23:17:20.444443185Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-v6y","depends_on_id":"bd-10i.6","type":"parent-child","created_at":"2026-01-31T23:13:33.822578175Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-v6y","depends_on_id":"bd-1oz","type":"blocks","created_at":"2026-01-31T23:17:20.444396266Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-v6y","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T23:16:20.236617070Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-wo2","title":"Write Agent Harness Tutorial documentation","description":"# Agent Harness Tutorial Documentation\n\n## Background\nThe plan explicitly requires documentation that includes an \"Agent harness tutorial\". This is the primary documentation goal because agent harness UIs are ftui's core use case.\n\n## Tutorial Structure\n\n### Part 1: Hello World Harness\nDemonstrate the simplest possible harness in <50 LOC:\n- Setup ftui dependency\n- Create minimal Model\n- Inline mode with fixed UI height\n- Print \"Hello from ftui\" and exit\n\n### Part 2: Adding Log Streaming\nBuild on Part 1:\n- Implement write_log() pattern\n- Show logs scrolling in scrollback\n- UI remains fixed at bottom\n- Demonstrate scrollback preservation\n\n### Part 3: Interactive Input\nAdd user interaction:\n- TextInput widget for command entry\n- Handle Enter to submit\n- Display command echo in logs\n- Basic event routing\n\n### Part 4: Tool Status and Indicators\nAdd agent-style status:\n- Spinner for in-progress operations\n- Status line with mode/state\n- Tool completion indicators\n- Progress bars for long operations\n\n### Part 5: Modal Alt-Screen\nOptional complex interactions:\n- Temporarily switch to alt-screen\n- Show picker/form UI\n- Return to inline mode\n- Preserve context\n\n### Part 6: PTY Child Process Capture\nAdvanced integration:\n- Spawn child process with PTY\n- Capture stdout/stderr\n- Route through ftui one-writer\n- Preserve scrollback integrity\n\n## Key Concepts to Explain\n\n### The One-Writer Rule\n\"All bytes that affect terminal state are serialized through a single owner.\"\n- Why this matters for inline mode\n- How ftui enforces it\n- What happens if violated\n\n### Inline vs Alt-Screen\n- Scrollback preservation trade-offs\n- When to use each mode\n- Mixed strategy (modal alt-screen)\n\n### Cursor Contract\n\"After any present(), cursor position is restored per the active policy.\"\n- What this means in practice\n- How to debug cursor corruption\n- PTY testing for verification\n\n### Sanitization Policy\n\"Untrusted bytes are never executed.\"\n- Why logs are sanitized by default\n- How to opt-in to raw ANSI\n- Security implications\n\n## Code Examples\nEach section should have:\n- Complete, runnable code\n- Explanation of key lines\n- Common mistakes to avoid\n- Performance notes\n\n## Acceptance Criteria\n- [ ] Tutorial covers all 6 parts\n- [ ] Each part builds on previous\n- [ ] Code examples compile and run\n- [ ] Key concepts explained clearly\n- [ ] Common pitfalls documented\n- [ ] PTY testing mentioned for verification\n\n## Location: docs/tutorials/agent-harness.md","status":"open","priority":2,"issue_type":"docs","created_at":"2026-01-31T22:51:01.345137543Z","created_by":"ubuntu","updated_at":"2026-01-31T23:08:51.408710205Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-wo2","depends_on_id":"bd-10i.12","type":"parent-child","created_at":"2026-01-31T23:08:51.408671131Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-wo2","depends_on_id":"bd-2kj","type":"blocks","created_at":"2026-01-31T22:53:58.911082296Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-wr2","title":"Implement core widgets (Block, Paragraph, Table)","description":"PHASE 5 - CORE WIDGETS\n\n## Background\nCore widgets provide essential UI building blocks. Block is a container with borders/title, Paragraph renders styled text with wrapping, Table displays tabular data.\n\n## Technical Requirements\n\n### Block Widget\n- Border styles: None, Single, Double, Rounded, Thick, Custom\n- Title positioning: Top/Bottom  Left/Center/Right\n- Padding (inner margin)\n- Style for border and background\n- Child content area calculation\n\n### Paragraph Widget\n- Text rendering with word/char wrap modes\n- Alignment: Left, Center, Right, Justify\n- Scroll offset for long content\n- Line height/spacing\n- Style inheritance from parent\n\n### Table Widget\n- Header row with column titles\n- Column constraints (width, alignment)\n- Row selection/highlighting\n- Cell styling\n- Horizontal/vertical scroll\n- Fixed header during scroll\n\n## Design Rationale\nThese three widgets cover the majority of TUI use cases. Block is the universal container, Paragraph handles all text display, Table presents structured data.\n\n## Acceptance Criteria\n- [ ] Block with all border styles\n- [ ] Block title positioning\n- [ ] Paragraph word wrap\n- [ ] Paragraph alignment modes\n- [ ] Table column constraints\n- [ ] Table row selection\n- [ ] All widgets implement Widget trait\n- [ ] Style customization for all components\n- [ ] Comprehensive unit tests\n\n## Widget Trait\nAll widgets implement:\npub trait Widget {\n    fn render(&self, area: Rect, buf: &mut Buffer);\n}\n\n## Location: ftui-widgets crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:19:23.813896695Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:19.875729497Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-wr2","depends_on_id":"bd-10i.3.6","type":"blocks","created_at":"2026-01-31T22:22:19.331465022Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-wr2","depends_on_id":"bd-2uk","type":"blocks","created_at":"2026-01-31T22:22:19.599179431Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-wr2","depends_on_id":"bd-yzu","type":"blocks","created_at":"2026-01-31T22:22:19.875690904Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-xn2","title":"Create CI/CD pipeline configuration","description":"INFRASTRUCTURE - CI/CD PIPELINE\n\n## Background\nContinuous integration ensures code quality, test coverage, and performance budgets are maintained. Must run on every PR and push to main.\n\n## Technical Requirements\n\n### GitHub Actions Workflow (.github/workflows/ci.yml)\n\n#### Jobs Overview\n| Job | Trigger | Purpose | Blocking |\n|-----|---------|---------|----------|\n| check | PR, push | Format, clippy, tests | Yes |\n| coverage | PR, push | Coverage thresholds | Yes |\n| benchmarks | push to main | Performance budgets | Warn |\n| e2e | PR, push | End-to-end tests | Yes |\n| docs | PR, push | Doc build verification | Yes |\n\n#### Check Job\n- cargo fmt --check\n- cargo clippy --all-targets -- -D warnings\n- cargo test --all-features\n- cargo test --no-default-features\n\n#### Coverage Job\n- Use cargo-llvm-cov for coverage\n- Thresholds:\n  - Overall:  70%\n  - ftui-core:  80%\n  - ftui-render:  75%\n- Upload to codecov.io\n\n#### Benchmarks Job\n- Run on push to main only\n- Performance budgets from plan:\n  - Cell comparison: < 1ns\n  - Present (8024, 5% changed): p50 < 1.0ms\n  - Diff scan: < 100s\n  - Layout solve (20 items): < 100s\n- Fail on 2x regression\n\n#### E2E Job\n- Run scripts/e2e_test.sh\n- Upload artifacts on failure\n- Test on ubuntu-latest and macos-latest\n\n#### Docs Job\n- cargo doc --all-features --no-deps\n- Verify no broken links\n- Upload docs artifact\n\n### Matrix Testing\n- OS: ubuntu-latest, macos-latest, windows-latest\n- Rust: stable, nightly\n- Features: default, all, minimal\n\n### Caching\n- Cache ~/.cargo/registry\n- Cache ~/.cargo/git\n- Cache target/ with hash key\n\n## Acceptance Criteria\n- [ ] check job with format/clippy/tests\n- [ ] coverage job with thresholds\n- [ ] benchmarks job with budgets\n- [ ] e2e job with script execution\n- [ ] docs job with verification\n- [ ] Matrix: 3 OS  2 toolchains\n- [ ] Proper caching configuration\n- [ ] Badge in README\n\n## Location: .github/workflows/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:28:30.044639148Z","created_by":"ubuntu","updated_at":"2026-01-31T23:22:13.815675296Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-xn2","depends_on_id":"bd-19x","type":"blocks","created_at":"2026-01-31T22:29:25.095127714Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-xn2","depends_on_id":"bd-2u4","type":"blocks","created_at":"2026-01-31T22:29:25.375726031Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-xn2","depends_on_id":"bd-2vr","type":"blocks","created_at":"2026-01-31T22:29:24.833414137Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-xn2","depends_on_id":"bd-3aqs","type":"blocks","created_at":"2026-01-31T23:22:13.815637014Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-yzu","title":"Implement Flex layout with constraint solving","description":"PHASE 5 - FLEX LAYOUT\n\n## Background\nFlex layout provides 1D constraint-based sizing for rows/columns. Core layout primitive that most complex layouts build upon. Based on CSS Flexbox concepts adapted for terminal grid.\n\n## Technical Requirements\n- Flex struct with direction (Row/Column)\n- Constraint types:\n  - Fixed(u16): exact size\n  - Percent(f32): percentage of parent\n  - Min(u16): minimum size, grow to fill\n  - Max(u16): maximum size, shrink to fit\n  - Ratio(u16, u16): proportional sharing\n- Constraint solving algorithm:\n  1. Allocate Fixed constraints first\n  2. Calculate Percent based on remaining space\n  3. Distribute remainder to Min/Ratio proportionally\n  4. Clamp Max constraints\n- Gap/spacing between items\n- Cross-axis alignment: Start, Center, End, Stretch\n\n## Design Rationale\nFlex is simpler than full 2D grid but handles 90% of TUI layouts. Constraint types mirror Ratatui's proven model. Solving algorithm is deterministic for predictable layouts.\n\n## Acceptance Criteria\n- [ ] Flex struct with direction and items\n- [ ] Full constraint type enum\n- [ ] Deterministic constraint solver\n- [ ] Gap/margin support\n- [ ] Cross-axis alignment\n- [ ] Nested Flex support\n- [ ] Property tests for constraint invariants\n- [ ] Edge case handling (overflow, zero space)\n\n## Performance Budget\n- Layout solve for 20 items: < 100s\n- No allocations for typical layouts (stack buffer)\n\n## Location: ftui-layout crate","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-31T22:19:03.472657582Z","created_by":"ubuntu","updated_at":"2026-01-31T22:22:18.821559934Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-yzu","depends_on_id":"bd-10i.3.7","type":"blocks","created_at":"2026-01-31T22:22:18.821529657Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
